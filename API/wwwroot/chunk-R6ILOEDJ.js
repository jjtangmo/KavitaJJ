import{a as B}from"./chunk-IYLIANWB.js";import{a as Se}from"./chunk-23B3ZJIN.js";import{a as Fe}from"./chunk-SBTJKJNK.js";import{o as xe}from"./chunk-SPNNO5LP.js";import{s as be}from"./chunk-E6ZKMAWP.js";import{$b as D,$d as k,Ae as he,Bb as v,Dc as y,Ea as z,Ec as I,Fa as h,Fb as J,Ga as C,Gc as ie,Ib as s,Jd as oe,Kb as P,Na as H,Pa as j,Rb as Q,Rc as O,Rd as E,Sd as re,Td as $,Ud as ae,Vb as c,Wb as a,Xb as F,Yb as x,Zb as b,_b as X,_d as ce,be as le,bf as Ce,cc as S,ce as se,dc as d,de,fe as U,g as L,hd as A,he as me,id as K,lb as n,mb as R,me as pe,nc as M,nd as ne,ne as ve,oc as l,oe as fe,pc as m,pe as _e,qa as g,qc as u,qe as ue,tc as Y,uc as ee,va as V,vc as te,xc as N,ya as Z,ze as ge}from"./chunk-2LHIXASS.js";var p=function(e){return e[e.Custom=0]="Custom",e[e.PocketBook=1]="PocketBook",e[e.Kindle=2]="Kindle",e[e.Kobo=3]="Kobo",e}(p||{}),De=[p.Custom,p.Kindle,p.Kobo,p.PocketBook];var q=(()=>{let o=class o{constructor(){this.translocoService=g(re)}transform(i){switch(i){case p.Kindle:return"Kindle";case p.Kobo:return"Kobo";case p.PocketBook:return"PocketBook";case p.Custom:return this.translocoService.translate("device-platform-pipe.custom");default:return i+""}}};o.\u0275fac=function(r){return new(r||o)},o.\u0275pipe=Z({name:"devicePlatform",type:o,pure:!0,standalone:!0});let e=o;return e})();function Ee(e,o){if(e&1&&(c(0,"p",20),l(1),a()),e&2){let t=d(2).$implicit;n(),u(" ",t("required-field")," ")}}function ke(e,o){if(e&1&&(x(0),v(1,Ee,2,1,"p",19),b()),e&2){let t=o.ngIf;n(),s("ngIf",t.required)}}function we(e,o){if(e&1&&l(0),e&2){let t=d().$implicit;m(t("email-tooltip"))}}function Te(e,o){if(e&1&&(c(0,"p",20),l(1),a()),e&2){let t=d(2).$implicit;n(),u(" ",t("valid-email")," ")}}function Ve(e,o){if(e&1&&(c(0,"p",20),l(1),a()),e&2){let t=d(2).$implicit;n(),u(" ",t("required-field")," ")}}function Re(e,o){if(e&1&&(x(0),v(1,Te,2,1,"p",19)(2,Ve,2,1,"p",19),b()),e&2){let t=o.ngIf;n(),s("ngIf",t.email),n(),s("ngIf",t.required)}}function Pe(e,o){if(e&1&&(c(0,"option",21),l(1),y(2,"devicePlatform"),a()),e&2){let t=o.$implicit;s("value",t),n(),m(I(2,2,t))}}function Me(e,o){if(e&1&&(c(0,"p",20),l(1),a()),e&2){let t=d(2).$implicit;n(),u(" ",t("required-field")," ")}}function Ne(e,o){if(e&1&&(x(0),v(1,Me,2,1,"p",19),b()),e&2){let t=o.ngIf;n(),s("ngIf",t.required)}}function Oe(e,o){if(e&1){let t=D();x(0),c(1,"div",2)(2,"form",3)(3,"div",4)(4,"div",5)(5,"label",6),l(6),a(),F(7,"input",7),v(8,ke,2,1,"ng-container",8),a(),c(9,"div",5)(10,"label",9),l(11),a(),F(12,"i",10),v(13,we,1,1,"ng-template",null,0,ie),c(15,"span",11),X(16,12),a(),F(17,"input",13),v(18,Re,3,2,"ng-container",8),a(),c(19,"div",5)(20,"label",14),l(21),a(),c(22,"select",15),v(23,Pe,3,4,"option",16),a(),v(24,Ne,2,1,"ng-container",8),a()(),c(25,"div",17)(26,"button",18),S("click",function(){h(t);let r=d();return C(r.addDevice())}),l(27),a()()()(),b()}if(e&2){let t,i,r,f,w,W,T=o.$implicit,G=M(14),_=d();n(2),s("formGroup",_.settingsForm),n(4),m(T("device-name-label")),n(),P("is-invalid",((t=_.settingsForm.get("name"))==null?null:t.invalid)&&((t=_.settingsForm.get("name"))==null?null:t.touched)),n(),s("ngIf",(i=_.settingsForm.get("name"))==null?null:i.errors),n(3),m(T("email-label")),n(),s("ngbTooltip",G),n(4),s("ngTemplateOutlet",G),n(),P("is-invalid",((r=_.settingsForm.get("email"))==null?null:r.invalid)&&((r=_.settingsForm.get("email"))==null?null:r.touched)),n(),s("ngIf",(f=_.settingsForm.get("email"))==null?null:f.errors),n(3),m(T("device-platform-label")),n(),P("is-invalid",((w=_.settingsForm.get("platform"))==null?null:w.invalid)&&((w=_.settingsForm.get("platform"))==null?null:w.touched)),n(),s("ngForOf",_.devicePlatforms),n(),s("ngIf",(W=_.settingsForm.get("platform"))==null?null:W.errors),n(2),s("disabled",!_.settingsForm.dirty),n(),m(T("save"))}}var Ie=(()=>{let o=class o{constructor(i,r,f){this.deviceService=i,this.toastr=r,this.cdRef=f,this.deviceAdded=new j,this.deviceUpdated=new j,this.destroyRef=g(H),this.settingsForm=new de({}),this.devicePlatforms=De}ngOnInit(){this.settingsForm.addControl("name",new U(this.device?.name||"",[k.required])),this.settingsForm.addControl("email",new U(this.device?.emailAddress||"",[k.required,k.email])),this.settingsForm.addControl("platform",new U(this.device?.platform||p.Custom,[k.required])),this.settingsForm.get("email")?.valueChanges.pipe(oe(this.destroyRef)).subscribe(i=>{this.settingsForm.get("platform")?.dirty||i==null||i===""||(i.endsWith("@kindle.com")?this.settingsForm.get("platform")?.setValue(p.Kindle):i.endsWith("@pbsync.com")?this.settingsForm.get("platform")?.setValue(p.PocketBook):this.settingsForm.get("platform")?.setValue(p.Custom),this.cdRef.markForCheck())})}ngOnChanges(i){this.device&&(this.settingsForm.get("name")?.setValue(this.device.name),this.settingsForm.get("email")?.setValue(this.device.emailAddress),this.settingsForm.get("platform")?.setValue(this.device.platform),this.cdRef.markForCheck(),this.settingsForm.markAsPristine())}addDevice(){if(this.device!==void 0){this.deviceService.updateDevice(this.device.id,this.settingsForm.value.name,parseInt(this.settingsForm.value.platform,10),this.settingsForm.value.email).subscribe(()=>{this.settingsForm.reset(),this.toastr.success(E("toasts.device-updated")),this.cdRef.markForCheck(),this.deviceUpdated.emit()});return}this.deviceService.createDevice(this.settingsForm.value.name,parseInt(this.settingsForm.value.platform,10),this.settingsForm.value.email).subscribe(()=>{this.settingsForm.reset(),this.toastr.success(E("toasts.device-created")),this.cdRef.markForCheck(),this.deviceAdded.emit()})}};o.\u0275fac=function(r){return new(r||o)(R(B),R(be),R(O))},o.\u0275cmp=V({type:o,selectors:[["app-edit-device"]],inputs:{device:"device"},outputs:{deviceAdded:"deviceAdded",deviceUpdated:"deviceUpdated"},standalone:!0,features:[z,N],decls:1,vars:1,consts:[["emailTooltip",""],[4,"transloco","translocoRead"],[1,"card"],[1,"card-body",3,"formGroup"],[1,"row","g-0","mb-2"],[1,"col-md-3","col-sm-12","pe-2"],["for","settings-name",1,"form-label"],["id","settings-name","formControlName","name","type","text",1,"form-control"],[4,"ngIf"],["for","email",1,"form-label"],["placement","right","role","button","tabindex","0",1,"fa","fa-info-circle","ms-1",3,"ngbTooltip"],["id","email-help",1,"visually-hidden"],[3,"ngTemplateOutlet"],["id","email","aria-describedby","email-help","formControlName","email","type","email","inputmode","email","placeholder","id@kindle.com",1,"form-control"],["for","device-platform",1,"form-label"],["id","device-platform","aria-describedby","device-platform-help","formControlName","platform",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[1,"col-auto","d-flex","d-md-block","justify-content-sm-center","text-md-end"],["type","submit",1,"flex-fill","btn","btn-primary",3,"click","disabled"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"],[3,"value"]],template:function(r,f){r&1&&v(0,Oe,28,18,"ng-container",1),r&2&&s("translocoRead","edit-device")},dependencies:[ge,me,_e,ue,ce,fe,le,se,pe,ve,K,Ce,A,q,ae,$,ne],styles:["/*# sourceMappingURL=edit-device.component-NPKDK6DP.css.map */"],changeDetection:0});let e=o;return e})();function Ae(e,o){if(e&1&&(c(0,"div",8),l(1),a()),e&2){let t=d().$implicit;n(),m(t("email-setup-alert"))}}function Ke(e,o){if(e&1&&(c(0,"p"),l(1),a()),e&2){let t=d().$implicit;n(),u(" ",t("no-devices")," ")}}function $e(e,o){if(e&1){let t=D();x(0),c(1,"div",14)(2,"div",15)(3,"h5",16),l(4),y(5,"sentenceCase"),a(),l(6),c(7,"h6",17),l(8),y(9,"devicePlatform"),a(),l(10),c(11,"h6",17),l(12),a(),c(13,"button",18),S("click",function(){let r=h(t).$implicit,f=d(2);return C(f.deleteDevice(r))}),l(14),a(),c(15,"button",19),S("click",function(){let r=h(t).$implicit,f=d(2);return C(f.editDevice(r))}),l(16),a()()(),b()}if(e&2){let t=o.$implicit,i=d().$implicit;n(4),m(I(5,7,t.name)),n(2),u(" ",i("platform-label"),""),n(2),m(I(9,9,t.platform)),n(2),u(" ",i("email-label"),""),n(2),m(t.emailAddress),n(2),m(i("delete")),n(2),m(i("edit"))}}function Ue(e,o){if(e&1){let t=D();x(0),c(1,"div",2)(2,"div",3)(3,"div",4)(4,"h3"),l(5),a()(),c(6,"div",5)(7,"button",6),S("click",function(){h(t);let r=M(14);return C(r.toggle())}),F(8,"i",7),l(9),a()()(),c(10,"p"),l(11),a(),v(12,Ae,2,1,"div",8),c(13,"div",9,0),te("ngbCollapseChange",function(r){h(t);let f=d();return ee(f.addDeviceIsCollapsed,r)||(f.addDeviceIsCollapsed=r),C(r)}),c(15,"app-edit-device",10),S("deviceAdded",function(){h(t);let r=d();return C(r.loadDevices())})("deviceUpdated",function(){h(t);let r=d();return C(r.loadDevices())}),a()(),c(16,"div",11)(17,"h4"),l(18),a(),v(19,Ke,2,1,"p",12)(20,$e,17,11,"ng-container",13),a()(),b()}if(e&2){let t=o.$implicit,i=d();n(5),m(t("title")),n(2),J("aria-expanded",!i.addDeviceIsCollapsed),n(2),u("",t("add")," "),n(2),u(" ",t("description")," "),n(),Q(12,i.hasEmailSetup?12:-1),n(),Y("ngbCollapse",i.addDeviceIsCollapsed),n(2),s("device",i.device),n(3),m(t("devices-title")),n(),s("ngIf",i.devices.length===0),n(),s("ngForOf",i.devices)}}var St=(()=>{let o=class o{constructor(){this.cdRef=g(O),this.deviceService=g(B),this.settingsService=g(Se),this.confirmService=g(xe),this.devices=[],this.addDeviceIsCollapsed=!0,this.hasEmailSetup=!1}ngOnInit(){this.settingsService.isEmailSetup().subscribe(i=>{this.hasEmailSetup=i,this.cdRef.markForCheck()}),this.loadDevices()}loadDevices(){this.addDeviceIsCollapsed=!0,this.device=void 0,this.cdRef.markForCheck(),this.deviceService.getDevices().subscribe(i=>{this.devices=i,this.cdRef.markForCheck()})}deleteDevice(i){return L(this,null,function*(){(yield this.confirmService.confirm(E("toasts.delete-device")))&&this.deviceService.deleteDevice(i.id).subscribe(()=>{let r=this.devices.indexOf(i);this.devices.splice(r,1),this.cdRef.markForCheck()})})}editDevice(i){this.device=i,this.addDeviceIsCollapsed=!1,this.cdRef.markForCheck()}};o.\u0275fac=function(r){return new(r||o)},o.\u0275cmp=V({type:o,selectors:[["app-manage-devices"]],standalone:!0,features:[N],decls:1,vars:1,consts:[["collapse","ngbCollapse"],[4,"transloco","translocoRead"],[1,"container-fluid"],[1,"row","mb-2"],[1,"col-8"],[1,"col-4"],["aria-controls","collapseExample",1,"btn","btn-primary","float-end",3,"click"],["aria-hidden","true",1,"fa","fa-plus","me-1"],["role","alert",1,"alert","alert-warning"],[3,"ngbCollapseChange","ngbCollapse"],[3,"deviceAdded","deviceUpdated","device"],[1,"row","g-0","mt-2"],[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"card","col-auto","me-3","mb-3",2,"width","18rem"],[1,"card-body"],[1,"card-title"],[1,"card-subtitle","mb-2","text-muted"],[1,"btn","btn-danger","me-2",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(r,f){r&1&&v(0,Ue,21,10,"ng-container",1),r&2&&s("translocoRead","manage-devices")},dependencies:[he,Ie,K,A,Fe,q,$],styles:["/*# sourceMappingURL=manage-devices.component-SVUC6WZR.css.map */"],changeDetection:0});let e=o;return e})();export{St as ManageDevicesComponent};
//# sourceMappingURL=chunk-R6ILOEDJ.js.map
