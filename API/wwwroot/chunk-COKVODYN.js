import{a as he}from"./chunk-SEAKSSGD.js";import{a as h}from"./chunk-ZRHV3LXB.js";import{j as ae,k as le}from"./chunk-SPNNO5LP.js";import{$b as J,B as D,Ea as u,Fa as V,Ga as B,Ib as Z,Jd as ce,K as N,L as b,Na as $,O as x,Oa as _,Pa as H,Rc as re,S as v,Sd as me,Ta as K,Vb as G,Wb as Y,ca as j,cc as X,fa as l,j as k,kc as ee,la as F,lc as te,m as z,mb as c,mc as ie,na as P,o as M,qa as m,sb as Q,tb as q,u as y,ua as R,ud as ne,va as W,wa as A,xa as T,xc as se,xd as oe,ya as U,z as O}from"./chunk-2LHIXASS.js";function Ie(){return typeof window<"u"?window.navigator:void 0}function ue(t){return!!(t.parentElement&&t.parentElement.nodeName.toLowerCase()==="picture")}function g(t){return t.nodeName.toLowerCase()==="img"}function fe(t,e,i){return g(t)?i&&"srcset"in t?t.srcset=e:t.src=e:t.style.backgroundImage=`url('${e}')`,t}function w(t){return e=>{let i=e.parentElement.getElementsByTagName("source");for(let s=0;s<i.length;s++){let r=i[s].getAttribute(t);r&&("srcset"in i[s]?i[s].srcset=r:i[s].src=r)}}}var Se=w("defaultImage"),pe=w("lazyLoad"),Ce=w("errorImage");function L(t){return(e,i,s)=>{g(e)&&ue(e)&&t(e),i&&fe(e,i,s)}}var Ee=L(Se),we=L(pe),Le=L(Ce),S=class{constructor(){this.navigator=Ie()}setPlatformId(e){this.platformId=e}onDestroy(e){}onAttributeChange(e){}},d={loaded:"ng-lazyloaded",loading:"ng-lazyloading",failed:"ng-failed-lazyloaded"};function de(t,e){t.className=t.className.replace(e,"")}function I(t,e){t.className.includes(e)||(t.className+=` ${e}`)}function ke(t,e){return t.className&&t.className.includes(e)}var C=class extends S{setup(e){Ee(e.element,e.defaultImagePath,e.useSrcset),e.imagePath&&I(e.element,d.loading),ke(e.element,d.loaded)&&de(e.element,d.loaded)}finally(e){I(e.element,d.loaded),de(e.element,d.loading)}loadImage(e){if(this.skipLazyLoading(e))return[e.imagePath];let{element:i,useSrcset:s,imagePath:r,decode:n}=e,o;return g(i)&&ue(i)?(o=i.parentNode.cloneNode(!0).getElementsByTagName("img")[0],pe(o),fe(o,r,s)):(o=new Image,g(i)&&i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),g(i)&&i.sizes&&(o.sizes=i.sizes),s&&"srcset"in o?o.srcset=r:o.src=r),n&&o.decode?o.decode().then(()=>r):new Promise((a,p)=>{o.onload=()=>a(r),o.onerror=()=>p(null)})}setErrorImage(e,i){let{element:s,useSrcset:r,errorImagePath:n}=i;Le(s,n,r),I(s,d.failed)}setLoadedImage(e,i){let{element:s,useSrcset:r}=i;we(s,e,r)}isDisabled(){return oe(this.platformId)&&!this.isBot()}skipLazyLoading(e){return this.isBot(e)}isBot(e){return this.navigator?.userAgent?/googlebot|bingbot|yandex|baiduspider|facebookexternalhit|twitterbot|rogerbot|linkedinbot|embedly|quora\ link\ preview|showyoubot|outbrain|pinterest\/0\.|pinterestbot|slackbot|vkShare|W3C_Validator|whatsapp|duckduckbot|prerender/i.test(this.navigator.userAgent):!1}},E=class extends C{constructor(){super(...arguments),this.observers=new WeakMap,this.intersectionSubject=new z,this.uniqKey={}}getObservable(e){if(this.skipLazyLoading(e))return y({isIntersecting:!0});if(e.customObservable)return e.customObservable;let i=e.scrollContainer||this.uniqKey,s={root:e.scrollContainer||null};e.offset&&(s.rootMargin=`${e.offset}px`);let r=this.observers.get(i);return r||(r=new IntersectionObserver(n=>this.loadingCallback(n),s),this.observers.set(i,r)),r.observe(e.element),k.create(n=>{let o=this.intersectionSubject.pipe(b(a=>a.target===e.element)).subscribe(n);return()=>{o.unsubscribe(),r.unobserve(e.element)}})}isVisible(e){return e.isIntersecting}loadingCallback(e){e.forEach(i=>this.intersectionSubject.next(i))}};function ze(t,e){return i=>i.pipe(l(s=>e.onStateChange.emit({reason:"observer-emit",data:s})),b(s=>t.isVisible(s,e)),v(1),l(()=>e.onStateChange.emit({reason:"start-loading"})),D(()=>t.loadImage(e)),l(()=>e.onStateChange.emit({reason:"mount-image"})),l(s=>t.setLoadedImage(s,e)),l(()=>e.onStateChange.emit({reason:"loading-succeeded"})),O(()=>!0),x(s=>(e.onStateChange.emit({reason:"loading-failed",data:s}),t.setErrorImage(s,e),y(!1))),l(()=>{e.onStateChange.emit({reason:"finally"}),t.finally(e)}))}var ye=new P("LazyLoadImageHooks"),be=(()=>{class t{constructor(i,s,r,n){this.onStateChange=new H,this.elementRef=i,this.ngZone=s,this.propertyChanges$=new M,this.hooks=n,this.hooks.setPlatformId(r),this.uid=Math.random().toString(36).substr(2,9)}ngOnChanges(){this.debug===!0&&!this.debugSubscription&&(this.debugSubscription=this.onStateChange.subscribe(i=>console.log(i))),this.propertyChanges$.next({element:this.elementRef.nativeElement,imagePath:this.lazyImage,defaultImagePath:this.defaultImage,errorImagePath:this.errorImage,useSrcset:this.useSrcset,offset:this.offset?this.offset|0:0,scrollContainer:this.scrollTarget,customObservable:this.customObservable,decode:this.decode,onStateChange:this.onStateChange,id:this.uid})}ngAfterContentInit(){if(this.hooks.isDisabled())return null;this.ngZone.runOutsideAngular(()=>{this.loadSubscription=this.propertyChanges$.pipe(l(i=>this.hooks.onAttributeChange(i)),l(i=>i.onStateChange.emit({reason:"setup"})),l(i=>this.hooks.setup(i)),j(i=>i.imagePath?this.hooks.getObservable(i).pipe(ze(this.hooks,i)):N())).subscribe({next:()=>null})})}ngOnDestroy(){this.propertyChanges$.pipe(v(1)).subscribe({next:i=>this.hooks.onDestroy(i)}).unsubscribe(),this.loadSubscription?.unsubscribe(),this.debugSubscription?.unsubscribe()}}return t.\u0275fac=function(i){return new(i||t)(c(_),c(q),c(K),c(ye))},t.\u0275dir=T({type:t,selectors:[["","lazyLoad",""]],inputs:{lazyImage:[R.None,"lazyLoad","lazyImage"],defaultImage:"defaultImage",errorImage:"errorImage",scrollTarget:"scrollTarget",customObservable:"customObservable",offset:"offset",useSrcset:"useSrcset",decode:"decode",debug:"debug"},outputs:{onStateChange:"onStateChange"},features:[u]}),t})(),ve=(()=>{class t{}return t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=A({type:t}),t.\u0275inj=F({providers:[{provide:ye,useClass:E}]}),t})(),f=class t{constructor(e,i,s,r){this.left=e,this.top=i,this.right=s,this.bottom=r}static fromElement(e){let{left:i,top:s,right:r,bottom:n}=e.getBoundingClientRect();return i===0&&s===0&&r===0&&n===0?t.empty:new t(i,s,r,n)}static fromWindow(e){return new t(0,0,e.innerWidth,e.innerHeight)}inflate(e){this.left-=e,this.top-=e,this.right+=e,this.bottom+=e}intersectsWith(e){return e.left<this.right&&this.left<e.right&&e.top<this.bottom&&this.top<e.bottom}getIntersectionWith(e){let i=Math.max(this.left,e.left),s=Math.max(this.top,e.top),r=Math.min(this.right,e.right),n=Math.min(this.bottom,e.bottom);return r>=i&&n>=s?new t(i,s,r,n):t.empty}};f.empty=new f(0,0,0,0);var Oe=["img"],et=(()=>{let e=class e{constructor(){this.destroyRef=m($),this.imageService=m(he),this.renderer=m(Q),this.hubService=m(le),this.cdRef=m(re),this.width="",this.height="",this.maxWidth="",this.maxHeight="",this.borderRadius="",this.objectFit="",this.background="",this.processEvents=!0,this.classes="",this.styles="",this.errorImage=this.imageService.errorImage,this.hubService.messages$.pipe(ce(this.destroyRef)).subscribe(s=>{if(this.processEvents&&s.event===ae.CoverUpdate){let r=s.payload;if(this.imageUrl===void 0||this.imageUrl===null||this.imageUrl==="")return;let n=this.imageService.getEntityTypeFromUrl(this.imageUrl);if(n===r.entityType){let a=this.imageUrl.split("?")[1].split("&")[0].replace(n+"Id=","");a.includes("&")&&(a=a.split("&")[0]),a===r.id+""&&(this.imageUrl=this.imageService.randomize(this.imageUrl),this.cdRef.markForCheck())}}})}ngOnChanges(){this.width!=""&&this.renderer.setStyle(this.imgElem.nativeElement,"width",this.width),this.height!=""&&this.renderer.setStyle(this.imgElem.nativeElement,"height",this.height),this.maxWidth!=""&&this.renderer.setStyle(this.imgElem.nativeElement,"max-width",this.maxWidth),this.maxHeight!=""&&this.renderer.setStyle(this.imgElem.nativeElement,"max-height",this.maxHeight),this.borderRadius!=""&&this.renderer.setStyle(this.imgElem.nativeElement,"border-radius",this.borderRadius),this.objectFit!=""&&this.renderer.setStyle(this.imgElem.nativeElement,"object-fit",this.objectFit),this.background!=""&&this.renderer.setStyle(this.imgElem.nativeElement,"background",this.background),this.styles!=""&&this.renderer.setStyle(this.imgElem.nativeElement,"styles",this.styles),this.classes!=""&&this.renderer.addClass(this.imgElem.nativeElement,this.classes)}myCallbackFunction(s){let r=this.imgElem.nativeElement;switch(s.reason){case"setup":break;case"observer-emit":break;case"start-loading":break;case"mount-image":break;case"loading-succeeded":this.renderer.addClass(r,"loaded");break;case"loading-failed":this.renderer.removeClass(r,"fade-in"),this.cdRef.markForCheck();break;case"finally":break}}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=W({type:e,selectors:[["app-image"]],viewQuery:function(r,n){if(r&1&&ee(Oe,7),r&2){let o;te(o=ie())&&(n.imgElem=o.first)}},inputs:{imageUrl:"imageUrl",width:"width",height:"height",maxWidth:"maxWidth",maxHeight:"maxHeight",borderRadius:"borderRadius",objectFit:"objectFit",background:"background",processEvents:"processEvents",classes:"classes",styles:"styles",errorImage:"errorImage"},standalone:!0,features:[u,se],decls:2,vars:2,consts:[["img",""],["alt","","aria-hidden","true",1,"img-placeholder","fade-in",3,"onStateChange","lazyLoad","errorImage"]],template:function(r,n){if(r&1){let o=J();G(0,"img",1,0),X("onStateChange",function(p){return V(o),B(n.myCallbackFunction(p))}),Y()}r&2&&Z("lazyLoad",n.imageUrl)("errorImage",n.errorImage)},dependencies:[ne,ve,be],styles:[`img[_ngcontent-%COMP%]{width:100%;transition:opacity 1s}.fade-in[_ngcontent-%COMP%]{opacity:0;transition:opacity .3s ease-in-out}.fade-in.loaded[_ngcontent-%COMP%]{opacity:1}
/*# sourceMappingURL=image.component-DTUQVIGI.css.map */`],changeDetection:0});let t=e;return t})();var rt=(()=>{let e=class e{constructor(s){this.translocoService=s}transform(s){switch(s){case h.EPUB:return this.translocoService.translate("manga-format-pipe.epub");case h.ARCHIVE:return this.translocoService.translate("manga-format-pipe.archive");case h.IMAGE:return this.translocoService.translate("manga-format-pipe.image");case h.PDF:return this.translocoService.translate("manga-format-pipe.pdf");case h.UNKNOWN:return this.translocoService.translate("manga-format-pipe.unknown");default:return""}}};e.\u0275fac=function(r){return new(r||e)(c(me,16))},e.\u0275pipe=U({name:"mangaFormat",type:e,pure:!0,standalone:!0});let t=e;return t})();export{ve as a,et as b,rt as c};
//# sourceMappingURL=chunk-COKVODYN.js.map
