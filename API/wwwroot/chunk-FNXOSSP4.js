import{c as I}from"./chunk-YG7OKVFF.js";import{b as xt}from"./chunk-UZJDSDY3.js";import{a as kt}from"./chunk-7UPYM5OM.js";import{a as f,b as W,c as y}from"./chunk-3BBJCVEK.js";import{a as yt}from"./chunk-G6W3CHAT.js";import{a as bt}from"./chunk-V7YNUPX5.js";import{a as vt}from"./chunk-FVF23ION.js";import{a as Se}from"./chunk-2JQ3KAM5.js";import{a as N,b as U,c as Z}from"./chunk-5TIUG6K2.js";import{a as ft}from"./chunk-K6JLHPZK.js";import"./chunk-SEAKSSGD.js";import{a as Ct}from"./chunk-KWNQHRPC.js";import{a as mt}from"./chunk-WBO5KV4A.js";import{c as gt,d as M,f as _t}from"./chunk-5CMEBAZF.js";import{a as ut}from"./chunk-ZRHV3LXB.js";import{c as je,e as Xe,p as ht,q as pt}from"./chunk-SPNNO5LP.js";import{e as $e,h as ye,i as Pe,k as ie,l as ne,m as we,s as ge}from"./chunk-E6ZKMAWP.js";import{$b as k,$d as qe,Bb as _,Cc as We,F as Ie,Fa as p,Fb as De,G as A,Ga as m,Gc as ce,Ib as h,J as Ee,Jd as F,Kb as Be,Mb as ve,Na as j,Nb as Ce,O as te,Oa as Me,Ob as K,Pa as E,Pb as Fe,Q as Oe,Rb as Le,Rc as J,Rd as G,S,Se as ot,Td as L,Te as rt,U as _e,Ue as at,Vb as l,Ve as st,Wb as d,We as lt,Xb as x,Xe as ct,Yb as T,Zb as R,_b as be,_c as de,_d as Ke,_e as dt,be as Qe,bf as me,cc as g,ce as Ye,dc as r,de as Je,eb as Ne,fa as fe,fe as Ze,g as Re,gd as Ae,hb as X,hc as ke,hd as he,he as et,id as B,jd as He,kb as re,kc as q,kd as ze,lb as a,lc as Q,mb as H,mc as Y,md as Ge,me as tt,nc as z,nd as Ue,ne as it,oc as u,pc as C,qa as b,qc as O,sb as Ve,tc as ae,u as ee,uc as se,ud as pe,va as V,vc as le,xc as D,yc as xe,zc as w,ze as nt}from"./chunk-2LHIXASS.js";function Et(o,c){if(o&1&&(l(0,"div")(1,"em"),u(2),d()()),o&2){let n=r().$implicit;a(2),C(n("no-data"))}}function Ot(o,c){if(o&1){let n=k();l(0,"li")(1,"a",6),g("click",function(){let t=p(n).$implicit,i=r(3);return m(i.loadChapterPage(t.page,t.part))}),u(2),d()()}if(o&2){let n=c.$implicit;a(2),C(n.title)}}function Mt(o,c){if(o&1&&(l(0,"div")(1,"ul"),_(2,Ot,3,1,"li",5),d()()),o&2){let n=r(2);a(2),h("ngForOf",n.chapters[0].children)}}function Nt(o,c){if(o&1){let n=k();l(0,"ul")(1,"li")(2,"a",6),g("click",function(){let t=p(n).$implicit,i=r(4);return m(i.loadChapterPage(t.page,t.part))}),u(3),d()()()}if(o&2){let n=c.$implicit,e=r(4);a(),ve(e.cleanIdSelector(n.part)===e.currentPageAnchor?"active":""),a(2),C(n.title)}}function Vt(o,c){if(o&1){let n=k();l(0,"ul",8)(1,"li",9),g("click",function(){let t=p(n).$implicit,i=r(3);return m(i.loadChapterPage(t.page,""))}),u(2),d(),_(3,Nt,4,4,"ul",5),d()}if(o&2){let n=c.$implicit,e=r(3);a(),ve(n.page===e.pageNum?"active":""),a(),O(" ",n.title," "),a(),h("ngForOf",n.children)}}function Dt(o,c){if(o&1&&_(0,Vt,4,5,"ul",7),o&2){let n=r(2);h("ngForOf",n.chapters)}}function Bt(o,c){if(o&1&&(T(0),l(1,"div",2),_(2,Et,3,1,"div",3)(3,Mt,3,1,"div",4)(4,Dt,1,1,"ng-template",null,0,ce),d(),R()),o&2){let n=z(5),e=r();a(2),h("ngIf",e.chapters.length===0),a(),h("ngIf",e.chapters.length===1)("ngIfElse",n)}}var Pt=(()=>{let c=class c{constructor(){this.chapters=[],this.loadChapter=new E}cleanIdSelector(e){let t=e.split("/");return t.length>0?t[0]:e}loadChapterPage(e,t){this.loadChapter.emit({pageNum:e,part:t})}};c.\u0275fac=function(t){return new(t||c)},c.\u0275cmp=V({type:c,selectors:[["app-table-of-contents"]],inputs:{chapterId:"chapterId",pageNum:"pageNum",currentPageAnchor:"currentPageAnchor",chapters:"chapters"},outputs:{loadChapter:"loadChapter"},standalone:!0,features:[D],decls:1,vars:1,consts:[["nestedChildren",""],[4,"transloco","translocoRead"],[1,"table-of-contents"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],["href","javascript:void(0);",3,"click"],["class","chapter-title",4,"ngFor","ngForOf"],[1,"chapter-title"],[3,"click"]],template:function(t,i){t&1&&_(0,Bt,6,3,"ng-container",1),t&2&&h("translocoRead","table-of-contents")},dependencies:[B,he,L],styles:[`.table-of-contents[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{cursor:pointer}.table-of-contents[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{font-weight:700}.chapter-title[_ngcontent-%COMP%]{padding-inline-start:1rem}
/*# sourceMappingURL=table-of-contents.component-KBWWPMZQ.css.map */`]});let o=c;return o})();function Lt(o,c){if(o&1){let n=k();T(0),l(1,"div",6)(2,"button",7),g("click",function(){p(n);let t=r(3);return m(t.copy())}),x(3,"i",8),l(4,"div"),u(5),d()()(),l(6,"div",6)(7,"button",7),g("click",function(){p(n);let t=r(3);return m(t.switchMode(t.BookLineOverlayMode.Bookmark))}),x(8,"i",9),l(9,"div"),u(10),d()()(),l(11,"div",6)(12,"button",7),g("click",function(){p(n);let t=r(3);return m(t.reset())}),x(13,"i",10),l(14,"div"),u(15),d()()(),R()}if(o&2){let n=r(2).$implicit;a(5),C(n("copy")),a(5),C(n("bookmark")),a(5),C(n("close"))}}function Wt(o,c){if(o&1&&(l(0,"div",18),u(1),d()),o&2){let n=r(4).$implicit;a(),O(" ",n("required-field")," ")}}function At(o,c){if(o&1&&(l(0,"div",16),_(1,Wt,2,1,"div",17),d()),o&2){let n,e=r(4);a(),h("ngIf",(n=e.bookmarkForm.get("name"))==null||n.errors==null?null:n.errors.required)}}function Ht(o,c){if(o&1){let n=k();T(0),l(1,"form",11)(2,"div",12),x(3,"input",13),l(4,"button",14),g("click",function(){p(n);let t=r(3);return m(t.createPTOC())}),u(5),d(),_(6,At,2,1,"div",15),d()(),R()}if(o&2){let n,e=r(2).$implicit,t=r();a(),h("formGroup",t.bookmarkForm),a(2),Be("is-invalid",((n=t.bookmarkForm.get("name"))==null?null:n.invalid)&&((n=t.bookmarkForm.get("name"))==null?null:n.touched)),h("placeholder",e("book-label")),a(2),C(e("save")),a(),h("ngIf",t.bookmarkForm.dirty||t.bookmarkForm.touched)}}function zt(o,c){if(o&1&&(l(0,"div",2)(1,"div",3),T(2,4),_(3,Lt,16,3,"ng-container",5)(4,Ht,7,6,"ng-container",5),R(),d()()),o&2){let n=r(2);a(2),h("ngSwitch",n.mode),a(),h("ngSwitchCase",n.BookLineOverlayMode.None),a(),h("ngSwitchCase",n.BookLineOverlayMode.Bookmark)}}function Gt(o,c){if(o&1&&(T(0),_(1,zt,5,3,"div",1),R()),o&2){let n=r();a(),h("ngIf",n.selectedText.length>0||n.mode!==n.BookLineOverlayMode.None)}}var $=function(o){return o[o.None=0]="None",o[o.Bookmark=1]="Bookmark",o}($||{}),wt=(()=>{let c=class c{get BookLineOverlayMode(){return $}constructor(e,t){this.elementRef=e,this.toastr=t,this.pageNumber=0,this.refreshToC=new E,this.isOpen=new E(!1),this.xPath="",this.selectedText="",this.mode=$.None,this.bookmarkForm=new Je({name:new Ze("",[qe.required])}),this.destroyRef=b(j),this.cdRef=b(J),this.readerService=b(Z)}handleKeyPress(e){if(e.key===M.ESC_KEY){this.reset(),this.cdRef.markForCheck(),e.stopPropagation(),e.preventDefault();return}}ngOnInit(){if(this.parent){let e=A(this.parent.nativeElement,"mouseup"),t=A(this.parent.nativeElement,"touchend");Ee(e,t).pipe(F(this.destroyRef)).subscribe(i=>{this.handleEvent(i)})}}handleEvent(e){let t=window.getSelection();if(e.target){if(t==null||t.toString().trim()===""||t.toString().trim()===this.selectedText){this.selectedText!==""&&(e.preventDefault(),e.stopPropagation()),e instanceof MouseEvent&&e.button===2||this.reset();return}this.selectedText=t?t.toString().trim():"",this.selectedText.length>0&&this.mode===$.None&&(this.xPath=this.readerService.getXPathTo(e.target),this.xPath!==""&&(this.xPath="//"+this.xPath),this.isOpen.emit(!0),e.preventDefault(),e.stopPropagation()),this.cdRef.markForCheck()}}switchMode(e){this.mode=e,this.cdRef.markForCheck(),this.mode===$.Bookmark&&(this.bookmarkForm.get("name")?.setValue(this.selectedText),this.focusOnBookmarkInput())}createPTOC(){this.readerService.createPersonalToC(this.libraryId,this.seriesId,this.volumeId,this.chapterId,this.pageNumber,this.bookmarkForm.get("name")?.value,this.xPath).pipe(te(e=>(this.focusOnBookmarkInput(),ee()))).subscribe(()=>{this.reset(),this.refreshToC.emit(),this.cdRef.markForCheck()})}focusOnBookmarkInput(){this.mode===$.Bookmark&&setTimeout(()=>this.elementRef.nativeElement.querySelector("#bookmark-name")?.focus(),10)}reset(){this.bookmarkForm.reset(),this.mode=$.None,this.xPath="",this.selectedText="";let e=window.getSelection();e&&e.removeAllRanges(),this.isOpen.emit(!1),this.cdRef.markForCheck()}copy(){return Re(this,null,function*(){let e=window.getSelection();e&&(yield navigator.clipboard.writeText(e.toString()),this.toastr.info(G("toasts.copied-to-clipboard"))),this.reset()})}};c.\u0275fac=function(t){return new(t||c)(H(Me),H(ge))},c.\u0275cmp=V({type:c,selectors:[["app-book-line-overlay"]],hostBindings:function(t,i){t&1&&g("keydown",function(v){return i.handleKeyPress(v)},!1,X)},inputs:{libraryId:"libraryId",seriesId:"seriesId",volumeId:"volumeId",chapterId:"chapterId",pageNumber:"pageNumber",parent:"parent"},outputs:{refreshToC:"refreshToC",isOpen:"isOpen"},standalone:!0,features:[D],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],["class","overlay",4,"ngIf"],[1,"overlay"],[1,"row","g-0","justify-content-between"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"col-auto"],[1,"btn","btn-icon","btn-sm",3,"click"],["aria-hidden","true",1,"fa-solid","fa-copy"],["aria-hidden","true",1,"fa-solid","fa-book-bookmark"],["aria-hidden","true",1,"fa-solid","fa-times-circle"],[3,"formGroup"],[1,"input-group"],["id","bookmark-name","formControlName","name","type","text","aria-describedby","bookmark-name-btn",1,"form-control",3,"placeholder"],["id","bookmark-name-btn",1,"btn","btn-outline-primary",3,"click"],["id","bookmark-name-validations","class","invalid-feedback",4,"ngIf"],["id","bookmark-name-validations",1,"invalid-feedback"],["role","status",4,"ngIf"],["role","status"]],template:function(t,i){t&1&&_(0,Gt,2,1,"ng-container",0),t&2&&h("translocoRead","book-line-overlay")},dependencies:[pe,B,He,ze,nt,et,Ke,Qe,Ye,tt,it,L],styles:[`.overlay[_ngcontent-%COMP%]{background-color:var(--br-actionbar-bg-color);color:var(--bs-body-bg);padding:5px;border-radius:4px;z-index:9999;width:100vw}
/*# sourceMappingURL=book-line-overlay.component-WFE2ZRSB.css.map */`],changeDetection:0});let o=c;return o})();var Ut=o=>({value:o}),$t=o=>({bookmarkName:o});function jt(o,c){if(o&1&&(l(0,"div")(1,"em"),u(2),d()()),o&2){let n=r().$implicit;a(2),C(n("no-data"))}}function Xt(o,c){if(o&1){let n=k();l(0,"li",7),g("click",function(t){let i=p(n).$implicit;return r(3).loadChapterPage(i.pageNumber,i.bookScrollId),m(t.stopPropagation())}),u(1),l(2,"button",8),g("click",function(t){let i=p(n).$implicit;return r(3).removeBookmark(i),m(t.stopPropagation())}),x(3,"i",9),l(4,"span",10),u(5),d()()()}if(o&2){let n=c.$implicit,e=r(2).$implicit;h("ngbTooltip",n.title),a(),O(" ",n.title," "),a(4),C(e("delete",w(3,$t,n.title)))}}function Kt(o,c){if(o&1){let n=k();l(0,"li")(1,"span",4),g("click",function(){let t=p(n).$implicit,i=r(2);return m(i.loadChapterPage(t,""))}),u(2),d(),l(3,"ul",5),_(4,Xt,6,5,"li",6),d()()}if(o&2){let n=c.$implicit,e=r().$implicit,t=r();a(2),C(e("page",w(2,Ut,n))),a(2),h("ngForOf",t.bookmarks[n])}}function qt(o,c){if(o&1&&(T(0),l(1,"div",1),_(2,jt,3,1,"div",2),l(3,"ul"),_(4,Kt,5,4,"li",3),d()(),R()),o&2){let n=r();a(2),h("ngIf",n.Pages.length===0),a(2),h("ngForOf",n.Pages)}}var St=(()=>{let c=class c{get Pages(){return Object.keys(this.bookmarks).map(e=>parseInt(e,10))}constructor(e){this.document=e,this.pageNum=0,this.loadChapter=new E,this.readerService=b(Z),this.cdRef=b(J),this.destroyRef=b(j),this.bookmarks=[]}ngOnInit(){this.tocRefresh.pipe(F(this.destroyRef)).subscribe(()=>{this.load()}),this.load()}load(){this.readerService.getPersonalToC(this.chapterId).subscribe(e=>{e.forEach(t=>{this.bookmarks.hasOwnProperty(t.pageNumber)||(this.bookmarks[t.pageNumber]=[]),this.bookmarks[t.pageNumber].push(t)}),this.cdRef.markForCheck()})}loadChapterPage(e,t){this.loadChapter.emit({pageNum:e,scrollPart:t})}removeBookmark(e){this.readerService.removePersonalToc(e.chapterId,e.pageNumber,e.title).subscribe(()=>{this.bookmarks[e.pageNumber]=this.bookmarks[e.pageNumber].filter(t=>t.title!=e.title),this.bookmarks[e.pageNumber].length===0&&delete this.bookmarks[e.pageNumber],this.cdRef.markForCheck()})}};c.\u0275fac=function(t){return new(t||c)(H(de))},c.\u0275cmp=V({type:c,selectors:[["app-personal-table-of-contents"]],inputs:{chapterId:"chapterId",pageNum:"pageNum",tocRefresh:"tocRefresh"},outputs:{loadChapter:"loadChapter"},standalone:!0,features:[D],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"table-of-contents"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"click"],[1,"chapter-title"],["class","ellipsis","placement","right",3,"ngbTooltip","click",4,"ngFor","ngForOf"],["placement","right",1,"ellipsis",3,"click","ngbTooltip"],[1,"btn","btn-icon","ms-1",3,"click"],["aria-hidden","true",1,"fa-solid","fa-trash"],[1,"visually-hidden"]],template:function(t,i){t&1&&_(0,qt,5,2,"ng-container",0),t&2&&h("translocoRead","personal-table-of-contents")},dependencies:[pe,he,B,me,L],styles:[`.table-of-contents[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{cursor:pointer}.table-of-contents[_ngcontent-%COMP%]   li.active[_ngcontent-%COMP%]{font-weight:700}.chapter-title[_ngcontent-%COMP%]{padding-inline-start:1rem}.ellipsis[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}
/*# sourceMappingURL=personal-table-of-contents.component-5ZOG5Y2T.css.map */`],changeDetection:0});let o=c;return o})();var Qt=["bookContainer"],Yt=["readingHtml"],Jt=["readingSection"],Zt=["stickyTop"],ei=["reader"],ti=()=>({isTop:!0}),ii=o=>({topOffset:o}),ni=o=>({width:o}),oe=o=>({immersive:o}),Tt=o=>({height:o}),oi=(o,c,n,e)=>({"max-height":o,"max-width":c,width:n,"column-width":e}),ri=o=>({"bottom-bar":o}),ai=()=>({isTop:!1});function si(o,c){if(o&1){let n=k();l(0,"app-book-line-overlay",42),g("isOpen",function(t){p(n);let i=r(2);return m(i.updateLineOverlayOpen(t))})("refreshToC",function(){p(n);let t=r(2);return m(t.refreshPersonalToC())}),d()}if(o&2){let n=r(2);h("parent",n.bookContainerElemRef)("libraryId",n.libraryId)("volumeId",n.volumeId)("chapterId",n.chapterId)("seriesId",n.seriesId)("pageNumber",n.pageNum)}}function li(o,c){if(o&1){let n=k();l(0,"div",23)(1,"button",45),g("click",function(){p(n);let t=r(3);return m(t.prevPage())}),x(2,"i",46),d(),l(3,"div",47),u(4),d(),l(5,"div",27)(6,"ngb-progressbar",48),g("click",function(){p(n);let t=r(3);return m(t.loadPage())}),d()(),l(7,"div",29),g("click",function(){p(n);let t=r(3);return m(t.loadPage())}),u(8),d(),l(9,"button",45),g("click",function(){p(n);let t=r(3);return m(t.nextPage())}),x(10,"i",49),d()()}if(o&2){let n=c.ngIf,e=r(2).$implicit;a(),h("title",e("prev-page")),a(3),C(n[0]),a(2),h("title",e("virtual-pages"))("value",n[0])("max",n[1]),a(),h("title",e("go-to-last-page")),a(),C(n[1]),a(),h("title",e("next-page"))}}function ci(o,c){if(o&1&&(T(0),l(1,"div",43)(2,"div",22),u(3),d(),_(4,li,11,8,"div",44),d(),R()),o&2){let n=r().$implicit,e=r();a(3),O(" ",n("page-label")," "),a(),h("ngIf",e.getVirtualPage())}}function di(o,c){if(o&1){let n=k();l(0,"app-reader-settings",50),g("colorThemeUpdate",function(t){p(n);let i=r(2);return m(i.updateColorTheme(t))})("styleUpdate",function(t){p(n);let i=r(2);return m(i.updateReaderStyles(t))})("clickToPaginateChanged",function(t){p(n);let i=r(2);return m(i.showPaginationOverlay(t))})("fullscreen",function(){p(n);let t=r(2);return m(t.toggleFullscreen())})("bookReaderWritingStyle",function(t){p(n);let i=r(2);return m(i.updateWritingStyle(t))})("layoutModeUpdate",function(t){p(n);let i=r(2);return m(i.updateLayoutMode(t))})("readingDirection",function(t){p(n);let i=r(2);return m(i.updateReadingDirection(t))})("immersiveMode",function(t){p(n);let i=r(2);return m(i.updateImmersiveMode(t))}),d()}}function hi(o,c){if(o&1){let n=k();l(0,"app-table-of-contents",51),g("loadChapter",function(t){p(n);let i=r(3);return m(i.loadChapterPage(t))}),d()}if(o&2){let n=r(3);h("chapters",n.chapters)("chapterId",n.chapterId)("pageNum",n.pageNum)("currentPageAnchor",n.currentPageAnchor)}}function pi(o,c){if(o&1){let n=k();l(0,"app-personal-table-of-contents",52),g("loadChapter",function(t){p(n);let i=r(3);return m(i.loadChapterPart(t))}),d()}if(o&2){let n=r(3);h("chapterId",n.chapterId)("pageNum",n.pageNum)("tocRefresh",n.refreshPToC)}}function mi(o,c){if(o&1){let n=k();l(0,"ul",33,7),le("activeIdChange",function(t){p(n);let i=r(2);return se(i.tocId,t)||(i.tocId=t),m(t)}),l(2,"li",34)(3,"a",35),u(4),d(),_(5,hi,1,4,"ng-template",36),d(),l(6,"li",34)(7,"a",35),u(8),d(),_(9,pi,1,3,"ng-template",36),d()(),x(10,"div",37)}if(o&2){let n=z(1),e=r().$implicit,t=r();ae("activeId",t.tocId),h("destroyOnHide",!1),a(2),h("ngbNavItem",t.TabID.TableOfContents),a(2),C(e("toc-header")),a(2),h("ngbNavItem",t.TabID.PersonalTableOfContents),a(2),C(e("bookmarks-header")),a(2),h("ngbNavOutlet",n)}}function gi(o,c){if(o&1){let n=k();T(0),l(1,"div",53),g("click",function(){p(n);let t=r(2);return m(t.movePage(t.readingDirection===t.ReadingDirection.LeftToRight?t.PAGING_DIRECTION.BACKWARDS:t.PAGING_DIRECTION.FORWARD))}),d(),l(2,"div",53),g("click",function(){p(n);let t=r(2);return m(t.movePage(t.readingDirection===t.ReadingDirection.LeftToRight?t.PAGING_DIRECTION.FORWARD:t.PAGING_DIRECTION.BACKWARDS))}),d(),R()}if(o&2){let n=r(2);a(),Ce("left ",n.clickOverlayClass("left")," no-observe"),h("ngClass",w(11,oe,n.immersiveMode))("ngStyle",w(13,Tt,n.PageHeightForPagination)),a(),K("",n.scrollbarNeeded?"right-with-scrollbar":"right"," ",n.clickOverlayClass("right")," no-observe"),h("ngClass",w(15,oe,n.immersiveMode))("ngStyle",w(17,Tt,n.PageHeightForPagination))}}function ui(o,c){if(o&1){let n=k();l(0,"div",54,8),g("click",function(t){p(n);let i=r(2);return m(i.toggleMenu(t))})("mousedown",function(t){p(n);let i=r(2);return m(i.mouseDown(t))})("wheel",function(t){p(n);let i=r(2);return m(i.onWheel(t))}),d()}if(o&2){let n=r(2);K("book-content ",n.ColumnLayout," ",n.WritingStyleClass,""),h("ngStyle",We(7,oi,n.ColumnHeight,n.VerticalBookContentWidth,n.VerticalBookContentWidth,n.ColumnWidth))("ngClass",w(12,oe,n.immersiveMode&&n.actionBarVisible))("innerHtml",n.page,Ne)}}function _i(o,c){if(o&1){let n=k();l(0,"div",55),g("click",function(t){return p(n),m(t.stopPropagation())}),be(1,13),d()}if(o&2){r();let n=z(51),e=r();h("ngClass",w(3,ri,e.layoutMode!==e.BookPageLayoutMode.Default)),a(),h("ngTemplateOutlet",n)("ngTemplateOutletContext",xe(5,ai))}}function fi(o,c){if(o&1){let n=k();l(0,"button",66),g("click",function(){p(n);let t=r(4);return m(t.goBack())}),x(1,"i",67),d()}if(o&2){let n=r(3).$implicit;h("title",n("go-back"))}}function vi(o,c){if(o&1&&(l(0,"div",64)(1,"span",68),u(2),d()()),o&2){let n=r(3).$implicit;a(2),C(n("loading-book"))}}function Ci(o,c){if(o&1){let n=k();l(0,"span",71),g("click",function(){p(n);let t=r(5);return m(t.turnOffIncognito())}),u(1," ("),x(2,"i",72),l(3,"span",68),u(4),d(),u(5,")"),d()}if(o&2){let n=r(4).$implicit;De("aria-label",n("incognito-mode-alt")),a(4),C(n("incognito-mode-label"))}}function bi(o,c){if(o&1&&(_(0,Ci,6,2,"span",69),l(1,"span",70),u(2),d()),o&2){let n=r(4);h("ngIf",n.incognitoMode),a(),h("ngbTooltip",n.bookTitle),a(),C(n.bookTitle)}}function ki(o,c){if(o&1){let n=k();l(0,"div",57)(1,"button",58),g("click",function(){p(n);let t=r().$implicit,i=r(2);return m(!t&&i.movePage(i.readingDirection===i.ReadingDirection.LeftToRight?i.PAGING_DIRECTION.BACKWARDS:i.PAGING_DIRECTION.FORWARD))}),x(2,"i",59),d(),_(3,fi,2,1,"button",60),l(4,"button",61),g("click",function(){p(n);let t=r(3);return m(t.toggleDrawer())}),x(5,"i",62),d(),l(6,"div",63),_(7,vi,3,1,"div",64)(8,bi,3,3),d(),l(9,"button",61),g("click",function(){p(n);let t=r(3);return m(t.closeReader())}),x(10,"i",65),d(),l(11,"button",58),g("click",function(){p(n);let t=r().$implicit,i=r(2);return m(!t&&i.movePage(i.readingDirection===i.ReadingDirection.LeftToRight?i.PAGING_DIRECTION.FORWARD:i.PAGING_DIRECTION.BACKWARDS))}),x(12,"i",59),d()()}if(o&2){let n=r(2).$implicit,e=r();a(),ke("title","",e.readingDirection===e.ReadingDirection.LeftToRight?n("previous"):n("next")," Page"),h("disabled",e.readingDirection===e.ReadingDirection.LeftToRight?e.IsPrevDisabled:e.IsNextDisabled),a(),K("fa ",(e.readingDirection===e.ReadingDirection.LeftToRight?e.IsPrevChapter:e.IsNextChapter)?"fa-angle-double-left":"fa-angle-left"," ",e.readingDirection===e.ReadingDirection.RightToLeft?"next-page-highlight":"",""),a(),h("ngIf",!e.adhocPageHistory.isEmpty()),a(4),Le(7,e.isLoading?7:8),a(4),ke("title","",e.readingDirection===e.ReadingDirection.LeftToRight?n("next"):n("previous")," Page"),h("disabled",e.readingDirection===e.ReadingDirection.LeftToRight?e.IsNextDisabled:e.IsPrevDisabled),a(),K("fa ",(e.readingDirection===e.ReadingDirection.LeftToRight?e.IsNextChapter:e.IsPrevChapter)?"fa-angle-double-right":"fa-angle-right"," ",e.readingDirection===e.ReadingDirection.LeftToRight?"next-page-highlight":"","")}}function xi(o,c){if(o&1&&_(0,ki,13,16,"div",56),o&2){let n=r(2);h("ngIf",!n.immersiveMode||n.drawerOpen||n.actionBarVisible)}}function yi(o,c){if(o&1){let n=k();T(0),l(1,"div",11,1)(3,"a",12),g("click",function(){p(n);let t=r();return m(t.moveFocus())}),u(4),d(),be(5,13),_(6,si,1,6,"app-book-line-overlay",14),l(7,"app-drawer",15,2),le("isOpenChange",function(t){p(n);let i=r();return se(i.drawerOpen,t)||(i.drawerOpen=t),m(t)}),l(9,"div",16)(10,"h5",17),u(11),d(),l(12,"span",18),g("click",function(){p(n);let t=r();return m(t.closeReader())}),u(13),d()(),l(14,"div",19)(15,"div",20),_(16,ci,5,2,"ng-container",21),l(17,"div",22),u(18),d(),l(19,"div",23)(20,"button",24),g("click",function(){p(n);let t=r();return m(t.loadPrevChapter())}),x(21,"i",25),d(),l(22,"div",26),g("click",function(){p(n);let t=r();return m(t.goToPage(0))}),u(23),d(),l(24,"div",27)(25,"ngb-progressbar",28),g("click",function(){p(n);let t=r();return m(t.goToPage())}),d()(),l(26,"div",29),g("click",function(){p(n);let t=r();return m(t.goToPage(t.maxPages-1))}),u(27),d(),l(28,"button",24),g("click",function(){p(n);let t=r();return m(t.loadNextChapter())}),x(29,"i",30),d()()()(),l(30,"div",31)(31,"nav",32)(32,"ul",33,3),le("activeIdChange",function(t){p(n);let i=r();return se(i.activeTabId,t)||(i.activeTabId=t),m(t)}),l(34,"li",34)(35,"a",35),u(36),d(),_(37,di,1,0,"ng-template",36),d(),l(38,"li",34)(39,"a",35),u(40),d(),_(41,mi,11,7,"ng-template",36),d()()(),x(42,"div",37),d()()(),l(43,"div",38,4),g("click",function(t){p(n);let i=r();return m(i.handleReaderClick(t))}),_(45,gi,3,19,"ng-container",21),l(46,"div",39,5),g("mousedown",function(t){p(n);let i=r();return m(i.mouseDown(t))}),_(48,ui,2,14,"div",40)(49,_i,2,6,"div",41),d()(),_(50,xi,1,1,"ng-template",null,6,ce),R()}if(o&2){let n=c.$implicit,e=z(33),t=z(51),i=r();a(4),C(n("skip-header")),a(),h("ngTemplateOutlet",t)("ngTemplateOutletContext",xe(41,ti)),a(),h("ngIf",i.page!==void 0),a(),ae("isOpen",i.drawerOpen),h("options",w(42,ii,i.topOffset)),a(4),C(n("title")),a(2),C(n("close-reader")),a(3),h("ngIf",i.layoutMode!==i.BookPageLayoutMode.Default),a(2),O(" ",n("pagination-header")," "),a(2),h("disabled",i.prevChapterDisabled)("title",n("prev-chapter")),a(3),C(i.pageNum),a(2),h("title",n("go-to-page"))("value",i.pageNum)("max",i.maxPages-1),a(),h("title",n("go-to-last-page")),a(),C(i.maxPages-1),a(),h("disabled",i.nextChapterDisabled)("title",n("next-chapter")),a(4),ae("activeId",i.activeTabId),h("destroyOnHide",!1),a(2),h("ngbNavItem",i.TabID.Settings),a(2),C(n("settings-header")),a(2),h("ngbNavItem",i.TabID.TableOfContents),a(2),C(n("table-of-contents-header")),a(2),h("ngbNavOutlet",e),a(),K("reading-section ",i.ColumnLayout," ",i.WritingStyleClass,""),h("ngStyle",w(44,ni,i.PageWidthForPagination))("ngClass",w(46,oe,i.immersiveMode||!i.actionBarVisible))("@isLoading",i.isLoading),a(2),h("ngIf",i.clickToPaginate&&!i.hidePagination),a(),Ce("book-container ",i.WritingStyleClass,""),h("ngClass",w(48,oe,i.immersiveMode)),a(2),h("ngIf",i.page!==void 0),a(),h("ngIf",i.page!==void 0&&(i.scrollbarNeeded||i.layoutMode!==i.BookPageLayoutMode.Default)&&!(i.writingStyle===i.WritingStyle.Vertical&&i.layoutMode===i.BookPageLayoutMode.Default))}}var ue=function(o){return o[o.Settings=1]="Settings",o[o.TableOfContents=2]="TableOfContents",o[o.PersonalTableOfContents=3]="PersonalTableOfContents",o}(ue||{}),Pi=-50*1.5,Rt=20,wi=["margin-left","margin-right","font-size"],Si=["line-height","font-family"],It=(()=>{let c=class c{get IsPrevDisabled(){return this.readingDirection===W.LeftToRight?this.isPrevPageDisabled():this.isNextPageDisabled()}get IsNextDisabled(){return this.readingDirection===W.LeftToRight?this.isNextPageDisabled():this.isPrevPageDisabled()}isNextPageDisabled(){let[e,t,i]=this.getVirtualPage(),s=(this.nextPageDisabled||this.nextChapterId===N)&&this.pageNum+1>this.maxPages-1;return this.layoutMode!==f.Default?s&&e===t:s}isPrevPageDisabled(){let[e,,]=this.getVirtualPage(),t=(this.prevPageDisabled||this.prevChapterId===N)&&this.pageNum===0;return this.layoutMode!==f.Default?t&&e===0:t}get IsNextChapter(){if(this.layoutMode===f.Default)return this.pageNum+1>=this.maxPages;let[e,t,i]=this.getVirtualPage();return this.bookContentElemRef==null?this.pageNum+1>=this.maxPages:this.pageNum+1>=this.maxPages&&e===t}get IsPrevChapter(){if(this.layoutMode===f.Default)return this.pageNum===0;let[e,,]=this.getVirtualPage();return this.bookContentElemRef==null?this.pageNum+1>=this.maxPages:this.pageNum===0&&e===0}get ColumnWidth(){let e=this.writingStyle===y.Vertical?this.windowHeight:this.windowWidth;switch(this.layoutMode){case f.Default:return"unset";case f.Column1:return e/2-4+"px";case f.Column2:return e/4+"px";default:return"unset"}}get ColumnHeight(){return this.layoutMode!==f.Default||this.writingStyle===y.Vertical?this.windowHeight-this.topOffset*2+"px":"unset"}get VerticalBookContentWidth(){return this.layoutMode!==f.Default&&this.writingStyle!==y.Horizontal?this.getVerticalPageWidth()+"px":""}get ColumnLayout(){switch(this.layoutMode){case f.Default:return"";case f.Column1:return"column-layout-1";case f.Column2:return"column-layout-2"}}get WritingStyleClass(){switch(this.writingStyle){case y.Horizontal:return"";case y.Vertical:return"writing-style-vertical"}}get PageWidthForPagination(){return this.layoutMode===f.Default&&this.writingStyle===y.Vertical&&this.horizontalScrollbarNeeded?"unset":"100%"}get PageHeightForPagination(){return this.layoutMode===f.Default?this.bookContainerElemRef?.nativeElement?.clientHeight>this.bookContentElemRef?.nativeElement?.clientHeight?(this.bookContainerElemRef?.nativeElement?.clientHeight||0)+"px":(this.bookContentElemRef?.nativeElement?.scrollHeight||0)-this.topOffset*(this.immersiveMode?0:1)*2+"px":this.immersiveMode?this.windowHeight+"px":this.windowHeight-this.topOffset*2+"px"}constructor(e){this.document=e,this.route=b(je),this.router=b(Xe),this.accountService=b(pt),this.seriesService=b(vt),this.readerService=b(Z),this.renderer=b(Ve),this.navService=b(mt),this.toastr=b(ge),this.domSanitizer=b($e),this.bookService=b(kt),this.memberService=b(Ct),this.scrollService=b(bt),this.utilityService=b(_t),this.libraryService=b(ft),this.themeService=b(ht),this.cdRef=b(J),this.BookPageLayoutMode=f,this.WritingStyle=y,this.TabID=ue,this.ReadingDirection=W,this.PAGING_DIRECTION=I,this.readingListId=N,this.incognitoMode=!1,this.readingListMode=!1,this.chapters=[],this.pageNum=0,this.maxPages=1,this.adhocPageHistory=new Se,this.continuousChaptersStack=new Se,this.isSingleImagePage=!1,this.activeTabId=ue.Settings,this.tocId=ue.TableOfContents,this.drawerOpen=!1,this.isLineOverlayOpen=!1,this.actionBarVisible=!0,this.immersiveMode=!1,this.isLoading=!0,this.bookTitle="",this.clickToPaginateVisualOverlay=!1,this.clickToPaginateVisualOverlayTimeout=void 0,this.clickToPaginateVisualOverlayTimeout2=void 0,this.updateImageSizeTimeout=void 0,this.page=void 0,this.nextChapterId=U,this.prevChapterId=U,this.nextChapterDisabled=!1,this.prevChapterDisabled=!1,this.nextChapterPrefetched=!1,this.prevChapterPrefetched=!1,this.prevPageDisabled=!1,this.nextPageDisabled=!1,this.topOffset=38,this.horizontalScrollbarNeeded=!1,this.scrollbarNeeded=!1,this.readingDirection=W.LeftToRight,this.clickToPaginate=!1,this.darkMode=!0,this.pageAnchors={},this.currentPageAnchor="",this.lastSeenScrollPartPath="",this.libraryType=gt.Book,this.isFullscreen=!1,this.layoutMode=f.Default,this.windowWidth=0,this.windowHeight=0,this.mousePosition={x:0,y:0},this.pagingDirection=I.FORWARD,this.writingStyle=y.Horizontal,this.hidePagination=!1,this.refreshPToC=new E,this.destroyRef=b(j),this.navService.hideNavBar(),this.themeService.clearThemes(),this.navService.hideSideNav(),this.cdRef.markForCheck()}ngAfterViewInit(){A(this.reader.nativeElement,"scroll").pipe(Oe(200),F(this.destroyRef)).subscribe(e=>{this.isLoading||this.handleScrollEvent()}),A(this.bookContainerElemRef.nativeElement,"mousemove").pipe(F(this.destroyRef),_e(),fe(e=>{let t=window.getSelection();this.hidePagination=t!==null&&t.toString().trim()!=="",this.cdRef.markForCheck()})).subscribe(),A(this.bookContainerElemRef.nativeElement,"mouseup").pipe(F(this.destroyRef),_e(),fe(e=>{this.hidePagination=!1,this.cdRef.markForCheck()})).subscribe()}handleScrollEvent(){if(Object.keys(this.pageAnchors).length!==0){let t=this.reader.nativeElement?.scrollTop||this.scrollService.scrollPosition+this.document.body.offsetHeight/2,i=Object.values(this.pageAnchors).filter(s=>s<=t);i.length>0?this.currentPageAnchor=Object.keys(this.pageAnchors)[i.length-1]:this.currentPageAnchor="",this.cdRef.markForCheck()}let e=this.getFirstVisibleElementXPath();e!=null&&(this.lastSeenScrollPartPath=e),this.lastSeenScrollPartPath!==""&&this.saveProgress()}saveProgress(){let e=this.pageNum;this.pageNum==this.maxPages-1&&(e=this.pageNum+1),this.incognitoMode||this.readerService.saveProgress(this.libraryId,this.seriesId,this.volumeId,this.chapterId,e,this.lastSeenScrollPartPath).pipe(S(1)).subscribe(()=>{})}ngOnDestroy(){this.clearTimeout(this.clickToPaginateVisualOverlayTimeout),this.clearTimeout(this.clickToPaginateVisualOverlayTimeout2),this.readerService.disableWakeLock(),this.themeService.clearBookTheme(),this.themeService.currentTheme$.pipe(S(1)).subscribe(e=>{this.themeService.setTheme(e.name)}),this.navService.showNavBar(),this.navService.showSideNav()}ngOnInit(){let e=this.route.snapshot.paramMap.get("libraryId"),t=this.route.snapshot.paramMap.get("seriesId"),i=this.route.snapshot.paramMap.get("chapterId");if(e===null||t===null||i===null){this.router.navigateByUrl("/home");return}this.libraryId=parseInt(e,10),this.seriesId=parseInt(t,10),this.chapterId=parseInt(i,10),this.incognitoMode=this.route.snapshot.queryParamMap.get("incognitoMode")==="true";let s=this.route.snapshot.queryParamMap.get("readingListId");s!=null&&(this.readingListMode=!0,this.readingListId=parseInt(s,10)),this.cdRef.markForCheck(),this.memberService.hasReadingProgress(this.libraryId).pipe(S(1)).subscribe(v=>{v||(this.toggleDrawer(),this.toastr.info(G("toasts.book-settings-info")))}),this.accountService.currentUser$.pipe(S(1)).subscribe(v=>{v&&(this.user=v,this.init())})}init(){this.nextChapterId=U,this.prevChapterId=U,this.nextChapterDisabled=!1,this.prevChapterDisabled=!1,this.nextChapterPrefetched=!1,this.cdRef.markForCheck(),this.bookService.getBookInfo(this.chapterId).subscribe(e=>{if(this.readingListMode&&e.seriesFormat!==ut.EPUB){let t=this.readerService.getQueryParamsObject(this.incognitoMode,this.readingListMode,this.readingListId);this.router.navigate(this.readerService.getNavigationArray(e.libraryId,e.seriesId,this.chapterId,e.seriesFormat),{queryParams:t});return}this.bookTitle=e.bookTitle,this.cdRef.markForCheck(),Ie({chapter:this.seriesService.getChapter(this.chapterId),progress:this.readerService.getProgress(this.chapterId),chapters:this.bookService.getBookChapters(this.chapterId)}).subscribe(t=>{this.chapter=t.chapter,this.volumeId=t.chapter.volumeId,this.maxPages=t.chapter.pages,this.chapters=t.chapters,this.pageNum=t.progress.pageNum,this.cdRef.markForCheck(),t.progress.bookScrollId&&(this.lastSeenScrollPartPath=t.progress.bookScrollId),this.continuousChaptersStack.push(this.chapterId),this.libraryService.getLibraryType(this.libraryId).pipe(S(1)).subscribe(i=>{this.libraryType=i}),this.updateImageSizes(),this.pageNum>=this.maxPages&&(this.pageNum=this.maxPages-1,this.cdRef.markForCheck(),this.saveProgress()),this.readerService.getNextChapter(this.seriesId,this.volumeId,this.chapterId,this.readingListId).pipe(S(1)).subscribe(i=>{if(this.nextChapterId=i,i===N||i===this.chapterId){this.nextChapterDisabled=!0,this.nextChapterPrefetched=!0,this.cdRef.markForCheck();return}this.setPageNum(this.pageNum)}),this.readerService.getPrevChapter(this.seriesId,this.volumeId,this.chapterId,this.readingListId).pipe(S(1)).subscribe(i=>{if(this.prevChapterId=i,i===N||i===this.chapterId){this.prevChapterDisabled=!0,this.prevChapterPrefetched=!0,this.cdRef.markForCheck();return}this.setPageNum(this.pageNum)}),this.loadPage(t.progress.bookScrollId||void 0),this.readerService.enableWakeLock(this.reader.nativeElement)},()=>{setTimeout(()=>{this.closeReader()},200)})})}onResize(){this.updateWidthAndHeightCalcs(),this.updateImageSizes();let e=this.getFirstVisibleElementXPath();this.layoutMode!==f.Default&&e!==null&&e!==void 0&&this.scrollTo(e)}handleKeyPress(e){let t=document.activeElement;if(!(t.tagName==="INPUT"||t.tagName==="TEXTAREA"))if(e.key===M.RIGHT_ARROW)this.movePage(this.readingDirection===W.LeftToRight?I.FORWARD:I.BACKWARDS);else if(e.key===M.LEFT_ARROW)this.movePage(this.readingDirection===W.LeftToRight?I.BACKWARDS:I.FORWARD);else if(e.key===M.ESC_KEY){if(window.getSelection()?.toString()!="")return;this.closeReader()}else e.key===M.SPACE?(this.toggleDrawer(),e.stopPropagation(),e.preventDefault()):e.key===M.G?this.goToPage():e.key===M.F&&this.toggleFullscreen()}onWheel(e){this.layoutMode!==f.Default||this.writingStyle!==y.Vertical||e.deltaY!==0&&(e.preventDefault(),this.scrollService.scrollToX(e.deltaY+this.reader.nativeElement.scrollLeft,this.reader.nativeElement))}closeReader(){this.readerService.closeReader(this.readingListMode,this.readingListId)}sortElements(e,t){let i=e.getBoundingClientRect().top,s=t.getBoundingClientRect().top;return i<s?-1:i>s?1:0}loadNextChapter(){this.nextPageDisabled||(this.isLoading=!0,this.nextChapterId===U||this.nextChapterId===this.chapterId?this.readerService.getNextChapter(this.seriesId,this.volumeId,this.chapterId,this.readingListId).pipe(S(1)).subscribe(e=>{this.nextChapterId=e,this.loadChapter(e,"Next")}):this.loadChapter(this.nextChapterId,"Next"))}loadPrevChapter(){if(this.prevPageDisabled)return;this.isLoading=!0,this.cdRef.markForCheck(),this.continuousChaptersStack.pop();let e=this.continuousChaptersStack.peek();if(e!=this.chapterId&&e!==void 0){this.chapterId=e,this.init();return}if(this.prevChapterPrefetched&&this.prevChapterId===N){this.isLoading=!1,this.cdRef.markForCheck();return}this.prevChapterId===U||this.prevChapterId===this.chapterId&&!this.prevChapterPrefetched?this.readerService.getPrevChapter(this.seriesId,this.volumeId,this.chapterId,this.readingListId).pipe(S(1)).subscribe(t=>{this.prevChapterId=t,this.loadChapter(t,"Prev")}):this.loadChapter(this.prevChapterId,"Prev")}loadChapter(e,t){if(e>=0){this.chapterId=e,this.continuousChaptersStack.push(e);let i=this.readerService.getNextChapterUrl(this.router.url,this.chapterId,this.incognitoMode,this.readingListMode,this.readingListId);window.history.replaceState({},"",i);let s=G(t==="Next"?"toasts.load-next-chapter":"toasts.load-prev-chapter",{entity:this.utilityService.formatChapterName(this.libraryType).toLowerCase()});this.toastr.info(s,"",{timeOut:3e3}),this.cdRef.markForCheck(),this.init()}else{let i=G(t==="Next"?"toasts.no-next-chapter":"toasts.no-prev-chapter",{entity:this.utilityService.formatChapterName(this.libraryType).toLowerCase()});this.toastr.warning(i),this.isLoading=!1,t==="Prev"?this.prevPageDisabled=!0:this.nextPageDisabled=!0,this.cdRef.markForCheck()}}loadChapterPage(e){this.setPageNum(e.pageNum),this.loadPage('id("'+e.part+'")')}loadChapterPart(e){this.setPageNum(e.pageNum),this.loadPage(e.scrollPart)}addLinkClickHandlers(){this.readingSectionElemRef.nativeElement.querySelectorAll("a").forEach(t=>{t.addEventListener("click",i=>{i.stopPropagation();let s=i.target;if(i.target.nodeName!=="A"&&i.target.parentNode.nodeName==="A"&&(s=i.target.parentNode),!s.attributes.hasOwnProperty("kavita-page"))return;let v=parseInt(s.attributes["kavita-page"].value,10);this.adhocPageHistory.peek()?.page!==this.pageNum&&this.adhocPageHistory.push({page:this.pageNum,scrollPart:this.lastSeenScrollPartPath});let P=s.attributes.hasOwnProperty("kavita-part")?s.attributes["kavita-part"].value:void 0;if(P&&v===this.pageNum){this.scrollTo(s.attributes["kavita-part"].value);return}this.setPageNum(v),this.loadPage(P)})})}moveFocus(){let e=this.document.getElementsByClassName("reading-section");e.length>0&&e[0].focus()}promptForPage(){let e=G("book-reader.go-to-page-prompt",{totalPages:this.maxPages-1}),t=window.prompt(e,"");return t===null||t.trim().length===0?null:t}goToPage(e){let t=e;if(e==null){let i=this.promptForPage();if(i===null)return;t=parseInt(i.trim(),10)}t===void 0||this.pageNum===t||(t>this.maxPages?t=this.maxPages:t<0&&(t=0),t===0||t===this.maxPages-1||(t-=1),this.pageNum=t,this.loadPage())}loadPage(e,t){this.isLoading=!0,this.cdRef.markForCheck(),this.bookService.getBookPage(this.chapterId,this.pageNum).pipe(S(1)).subscribe(i=>{i=i.replace(/font-size:[^;]*;/ig,"").replace(/%2520/g,"%20").replace(/OEBPS\/Styles\/\.\.\/Fonts/g,"Fonts"),this.isSingleImagePage=this.checkSingleImagePage(i),this.updateSingleImagePageStyles(),this.page=this.domSanitizer.bypassSecurityTrustHtml(i),this.cdRef.markForCheck(),setTimeout(()=>{this.addLinkClickHandlers(),this.updateReaderStyles(this.pageStyles);let s=this.readingSectionElemRef.nativeElement.querySelectorAll("img");if(s===null||s.length===0){this.setupPage(e,t);return}Promise.all(Array.from(s).filter(v=>!v.complete).map(v=>new Promise(P=>{v.onload=v.onerror=P}))).then(()=>{this.setupPage(e,t),this.updateImageSizes()})},10)})}updateImageSizes(){let e=this.writingStyle===y.Vertical,t=this.windowHeight-this.topOffset*2,i="unset",s="";switch(this.layoutMode){case f.Default:e?i=`${t}px`:s=`${this.getVerticalPageWidth()}px`;break;case f.Column1:i=`${t}px`,s=`${this.getVerticalPageWidth()}px`;break;case f.Column2:s=`${this.getVerticalPageWidth()}px`,e&&!this.isSingleImagePage?i=`${t/2}px`:i=`${t}px`;break}this.document.documentElement.style.setProperty("--book-reader-content-max-height",i),this.document.documentElement.style.setProperty("--book-reader-content-max-width",s)}updateSingleImagePageStyles(){this.isSingleImagePage&&this.layoutMode!==f.Default?(this.document.documentElement.style.setProperty("--book-reader-content-position","absolute"),this.document.documentElement.style.setProperty("--book-reader-content-top","50%"),this.document.documentElement.style.setProperty("--book-reader-content-left","50%"),this.document.documentElement.style.setProperty("--book-reader-content-transform","translate(-50%, -50%)")):(this.document.documentElement.style.setProperty("--book-reader-content-position",""),this.document.documentElement.style.setProperty("--book-reader-content-top",""),this.document.documentElement.style.setProperty("--book-reader-content-left",""),this.document.documentElement.style.setProperty("--book-reader-content-transform",""))}checkSingleImagePage(e){let t=e.replace(/<style>.*<\/style>/s,""),s=new DOMParser().parseFromString(t,"text/html");return s.querySelector("html")?.innerText.trim()!==""?!1:s.querySelectorAll("img, svg").length===1}setupPage(e,t){this.isLoading=!1,this.cdRef.markForCheck(),this.updateWidthAndHeightCalcs(),this.updateLayoutMode(this.layoutMode||f.Default),this.setupPageAnchors(),e!==void 0&&e!==""?this.scrollTo(e):t!==void 0&&t!==0?this.scrollService.scrollTo(t,this.reader.nativeElement):this.writingStyle===y.Vertical&&this.layoutMode===f.Default?setTimeout(()=>this.scrollService.scrollToX(this.bookContentElemRef.nativeElement.clientWidth,this.reader.nativeElement)):this.layoutMode===f.Default?this.scrollService.scrollTo(0,this.reader.nativeElement):this.writingStyle===y.Vertical?this.pagingDirection===I.BACKWARDS?setTimeout(()=>this.scrollService.scrollTo(this.bookContentElemRef.nativeElement.scrollHeight,this.bookContentElemRef.nativeElement,"auto")):setTimeout(()=>this.scrollService.scrollTo(0,this.bookContentElemRef.nativeElement,"auto")):this.pagingDirection===I.BACKWARDS?setTimeout(()=>this.scrollService.scrollToX(this.bookContentElemRef.nativeElement.scrollWidth,this.bookContentElemRef.nativeElement)):setTimeout(()=>this.scrollService.scrollToX(0,this.bookContentElemRef.nativeElement)),this.reader.nativeElement.focus(),this.saveProgress(),this.isLoading=!1,this.cdRef.markForCheck()}goBack(){if(!this.adhocPageHistory.isEmpty()){let e=this.adhocPageHistory.pop();e!==void 0&&(this.setPageNum(e.page),this.loadPage(e.scrollPart))}}setPageNum(e){this.pageNum=Math.max(Math.min(e,this.maxPages),0),this.cdRef.markForCheck(),this.pageNum>=this.maxPages-10?!this.nextChapterPrefetched&&this.nextChapterId!==N&&this.readerService.getChapterInfo(this.nextChapterId).pipe(S(1),te(t=>(this.nextChapterDisabled=!0,this.cdRef.markForCheck(),ee(null)))).subscribe(t=>{this.nextChapterPrefetched=!0}):this.pageNum<=10&&!this.prevChapterPrefetched&&this.prevChapterId!==N&&this.readerService.getChapterInfo(this.prevChapterId).pipe(S(1),te(t=>(this.prevChapterDisabled=!0,this.cdRef.markForCheck(),ee(null)))).subscribe(t=>{this.prevChapterPrefetched=!0})}movePage(e){if(e===I.BACKWARDS){this.prevPage();return}this.nextPage()}prevPage(){let e=this.pageNum;if(this.pagingDirection=I.BACKWARDS,this.layoutMode!==f.Default){let[t,i,s]=this.getVirtualPage();if(t>1){this.writingStyle===y.Vertical?this.scrollService.scrollTo((t-2)*s,this.bookContentElemRef.nativeElement,"auto"):this.scrollService.scrollToX((t-2)*s,this.bookContentElemRef.nativeElement),this.handleScrollEvent();return}}if(this.setPageNum(this.pageNum-1),e===0){this.loadPrevChapter();return}e!==this.pageNum&&this.loadPage()}nextPage(e){if(e&&(e.stopPropagation(),e.preventDefault()),this.pagingDirection=I.FORWARD,this.layoutMode!==f.Default){let[i,s,v]=this.getVirtualPage();if(i<s){this.writingStyle===y.Vertical?this.scrollService.scrollTo(i*v,this.bookContentElemRef.nativeElement,"auto"):this.scrollService.scrollToX(i*v,this.bookContentElemRef.nativeElement),this.handleScrollEvent();return}}let t=this.pageNum;if(t+1===this.maxPages){this.loadNextChapter();return}this.setPageNum(this.pageNum+1),t!==this.pageNum&&this.loadPage()}getPageWidth(){if(this.readingSectionElemRef==null)return 0;let e=this.convertVwToPx(parseInt(this.pageStyles["margin-left"],10))*2;return this.readingSectionElemRef.nativeElement.clientWidth-e+Rt}getPageHeight(){return this.readingSectionElemRef==null?0:parseInt(this.ColumnHeight.replace("px",""),10)-Rt}getVerticalPageWidth(){let e=window.innerWidth*(parseInt(this.pageStyles["margin-left"],10)/100)*2;return(window.innerWidth||document.documentElement.clientWidth)-e}convertVwToPx(e){let t=Math.max(this.readingSectionElemRef.nativeElement.clientWidth||0,window.innerWidth||0);return e*t/100}getVirtualPage(){if(!this.bookContentElemRef||!this.readingSectionElemRef)return[1,1,0];let[e,t]=this.getScrollOffsetAndTotalScroll(),i=this.getPageSize(),s=Math.max(1,Math.ceil(t/i)),v=e-t,P=1;return t===v?P=1:t-v===i?P=2:P=Math.min(Math.max(1,Math.round((e+i)/i)),s),[P,s,i]}getScrollOffsetAndTotalScroll(){let{nativeElement:e}=this.bookContentElemRef,t=this.writingStyle===y.Vertical?e.scrollTop:e.scrollLeft,i=this.writingStyle===y.Vertical?e.scrollHeight:e.scrollWidth;return[t,i]}getPageSize(){return this.writingStyle===y.Vertical?this.getPageHeight():this.getPageWidth()}getFirstVisibleElementXPath(){let e=null;if(this.bookContentElemRef===null)return null;let t=Array.from(this.bookContentElemRef.nativeElement.querySelectorAll("div,o,p,ul,li,a,img,h1,h2,h3,h4,h5,h6,span")).filter(i=>!i.classList.contains("no-observe")).filter(i=>this.utilityService.isInViewport(i,this.topOffset));if(t.sort(this.sortElements),t.length>0){let i=this.readerService.getXPathTo(t[0]);if(i==="")return;i.startsWith("id")||(i="//html[1]/"+i),e=i}return e}updateReaderStyles(e){if(this.pageStyles=e,this.bookContentElemRef===void 0||!this.bookContentElemRef.nativeElement)return;let t=this.getFirstVisibleElementXPath();this.updateImageSizes(),Object.entries(this.pageStyles).forEach(s=>{if(s[1]=="100%"||s[1]=="0px"||s[1]=="inherit"){this.renderer.removeStyle(this.bookContentElemRef.nativeElement,s[0]);return}wi.includes(s[0])&&this.renderer.setStyle(this.bookContentElemRef.nativeElement,s[0],s[1],re.Important)});let i=Object.entries(this.pageStyles).filter(s=>Si.includes(s[0]));for(let s=0;s<this.bookContentElemRef.nativeElement.children.length;s++){let v=this.bookContentElemRef.nativeElement.children.item(s);v?.tagName!=="STYLE"&&i.forEach(P=>{if(P[1]=="100%"||P[1]=="0px"||P[1]=="inherit"){this.renderer.removeStyle(v,P[0]);return}this.renderer.setStyle(v,P[0],P[1],re.Important)})}this.layoutMode!==f.Default&&t!==null&&t!==void 0&&(this.updateWidthAndHeightCalcs(),this.scrollTo(t))}updateColorTheme(e){Array.from(this.document.querySelectorAll('style[id^="brtheme-"]')).forEach(i=>i.remove()),this.darkMode=e.isDarkTheme;let t=this.renderer.createElement("style");t.id=e.selector,t.innerHTML=e.content,this.renderer.appendChild(this.document.querySelector(".reading-section"),t),this.themeService.setBookTheme(e.selector)}updateWidthAndHeightCalcs(){this.windowHeight=Math.max(this.readingSectionElemRef.nativeElement.clientHeight,window.innerHeight),this.windowWidth=Math.max(this.readingSectionElemRef.nativeElement.clientWidth,window.innerWidth),this.scrollbarNeeded=this.bookContentElemRef?.nativeElement?.clientHeight>this.reader?.nativeElement?.clientHeight,this.horizontalScrollbarNeeded=this.bookContentElemRef?.nativeElement?.clientWidth>this.reader?.nativeElement?.clientWidth,this.cdRef.markForCheck()}toggleDrawer(){this.drawerOpen=!this.drawerOpen,this.immersiveMode&&(this.actionBarVisible=!1),this.cdRef.markForCheck()}scrollTo(e){e.startsWith("#")&&(e=e.substr(1,e.length));let t=null;if(e.startsWith("//")||e.startsWith("id(")?t=this.getElementFromXPath(e):t=this.document.querySelector('*[id="'+e+'"]'),t!==null)if(this.layoutMode===f.Default&&this.writingStyle===y.Vertical){let i=window.innerWidth||document.documentElement.clientWidth,s=t.getBoundingClientRect().left+window.pageXOffset-(i-t.getBoundingClientRect().width);setTimeout(()=>this.scrollService.scrollToX(s,this.reader.nativeElement,"smooth"),10)}else if(this.layoutMode===f.Default&&this.writingStyle===y.Horizontal){let i=t.getBoundingClientRect().top+window.pageYOffset+Pi;setTimeout(()=>this.scrollService.scrollTo(i,this.reader.nativeElement),10)}else setTimeout(()=>t.scrollIntoView({block:"start",inline:"start"}))}getElementFromXPath(e){let t=this.document.evaluate(e,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;return t?.nodeType===Node.ELEMENT_NODE?t:null}turnOffIncognito(){this.incognitoMode=!1;let e=this.readerService.getNextChapterUrl(this.router.url,this.chapterId,this.incognitoMode,this.readingListMode,this.readingListId);window.history.replaceState({},"",e),this.toastr.info("Incognito mode is off. Progress will now start being tracked."),this.saveProgress()}toggleFullscreen(){this.isFullscreen=this.readerService.checkFullscreenMode(),this.isFullscreen?this.readerService.toggleFullscreen(this.reader.nativeElement,()=>{this.isFullscreen=!1,this.cdRef.markForCheck(),this.renderer.removeStyle(this.reader.nativeElement,"background")}):this.readerService.toggleFullscreen(this.reader.nativeElement,()=>{this.isFullscreen=!0,this.cdRef.markForCheck(),this.renderer.setStyle(this.reader.nativeElement,"background",this.themeService.getCssVariable("--bs-body-color")),this.darkMode||this.renderer.setStyle(this.reader.nativeElement,"background","white")})}updateWritingStyle(e){if(this.writingStyle=e,setTimeout(()=>this.updateImageSizes()),this.layoutMode!==f.Default){let t=this.lastSeenScrollPartPath;setTimeout(()=>{this.scrollTo(t)})}else if(this.bookContentElemRef!==void 0){let t=this.getFirstVisibleElementXPath();t&&setTimeout(()=>{this.scrollTo(t)})}this.cdRef.markForCheck()}updateLayoutMode(e){let t=e!==this.layoutMode;if(this.layoutMode=e,this.cdRef.markForCheck(),this.clearTimeout(this.updateImageSizeTimeout),this.updateImageSizeTimeout=setTimeout(()=>{this.updateImageSizes()},200),this.updateSingleImagePageStyles(),this.bookContentElemRef==null){setTimeout(()=>this.updateLayoutMode(this.layoutMode),10);return}if(setTimeout(()=>{this.scrollbarNeeded=this.bookContentElemRef?.nativeElement?.clientHeight>this.reader?.nativeElement?.clientHeight,this.horizontalScrollbarNeeded=this.bookContentElemRef?.nativeElement?.clientWidth>this.reader?.nativeElement?.clientWidth,this.cdRef.markForCheck()}),e===f.Default&&t){let i=this.lastSeenScrollPartPath;setTimeout(()=>this.scrollTo(i))}}updateReadingDirection(e){this.readingDirection=e,this.cdRef.markForCheck()}updateImmersiveMode(e){this.immersiveMode=e,this.immersiveMode&&!this.drawerOpen&&(this.actionBarVisible=!1),this.updateReadingSectionHeight(),this.cdRef.markForCheck()}updateReadingSectionHeight(){let e=this.renderer,t=this.readingSectionElemRef;setTimeout(()=>{e===void 0||t===void 0||this.immersiveMode||e.setStyle(t,"height","calc(var(--vh, 1vh) * 100 - "+this.topOffset+"px)",re.Important)})}cleanIdSelector(e){let t=e.split("/");return t.length>0?t[0]:e}getPageMarkers(e){try{return this.document.querySelectorAll(e.map(t=>"#"+this.cleanIdSelector(t)).join(", "))}catch{return this.document.querySelectorAll(e.map(i=>'[href="#'+i+'"]').join(", "))}}setupPageAnchors(){this.pageAnchors={},this.currentPageAnchor="",this.cdRef.markForCheck();let e=this.chapters.map(t=>t.children).flat().filter(t=>t.page===this.pageNum).map(t=>t.part).filter(t=>t.length>0);e.length>0&&this.getPageMarkers(e).forEach(i=>{this.pageAnchors[i.id]=i.getBoundingClientRect().top})}showPaginationOverlay(e){this.clickToPaginate=e,this.cdRef.markForCheck(),this.clearTimeout(this.clickToPaginateVisualOverlayTimeout2),e&&(this.clickToPaginateVisualOverlayTimeout2=setTimeout(()=>{this.showClickToPaginateVisualOverlay()},200))}clearTimeout(e){e!==void 0&&(clearTimeout(e),e=void 0)}showClickToPaginateVisualOverlay(){this.clickToPaginateVisualOverlay=!0,this.cdRef.markForCheck(),this.clickToPaginateVisualOverlay&&this.clickToPaginateVisualOverlayTimeout!==void 0&&(clearTimeout(this.clickToPaginateVisualOverlayTimeout),this.clickToPaginateVisualOverlayTimeout=void 0),this.clickToPaginateVisualOverlayTimeout=setTimeout(()=>{this.clickToPaginateVisualOverlay=!1,this.cdRef.markForCheck()},1e3)}clickOverlayClass(e){return this.clickToPaginateVisualOverlay?this.readingDirection===W.LeftToRight?e==="right"?"highlight":"highlight-2":e==="right"?"highlight-2":"highlight":""}handleReaderClick(e){if(!this.clickToPaginate){e.preventDefault(),e.stopPropagation(),this.toggleMenu(e);return}if(window.getSelection()?.toString()!=""){e.preventDefault(),e.stopPropagation();return}}toggleMenu(e){let t=e.target,i=5;this.immersiveMode&&(t.getAttribute("onclick")!==null||t.getAttribute("href")!==null||t.getAttribute("role")!==null||t.getAttribute("kavita-part")!=null||Math.abs(this.mousePosition.x-e.clientX)<=i&&Math.abs(this.mousePosition.y-e.clientY)<=i&&(this.actionBarVisible=!this.actionBarVisible,this.cdRef.markForCheck()))}mouseDown(e){this.mousePosition.x=e.clientX,this.mousePosition.y=e.clientY}refreshPersonalToC(){this.refreshPToC.emit()}updateLineOverlayOpen(e){this.isLineOverlayOpen=e,this.cdRef.markForCheck()}};c.\u0275fac=function(t){return new(t||c)(H(de))},c.\u0275cmp=V({type:c,selectors:[["app-book-reader"]],viewQuery:function(t,i){if(t&1&&(q(Qt,5),q(Yt,5),q(Jt,5),q(Zt,5),q(ei,5)),t&2){let s;Q(s=Y())&&(i.bookContainerElemRef=s.first),Q(s=Y())&&(i.bookContentElemRef=s.first),Q(s=Y())&&(i.readingSectionElemRef=s.first),Q(s=Y())&&(i.stickyTopElemRef=s.first),Q(s=Y())&&(i.reader=s.first)}},hostBindings:function(t,i){t&1&&g("resize",function(v){return i.onResize(v)},!1,X)("orientationchange",function(v){return i.onResize(v)},!1,X)("keydown",function(v){return i.handleKeyPress(v)},!1,X)},standalone:!0,features:[D],decls:3,vars:6,consts:[["reader",""],["stickyTop",""],["commentDrawer","drawer"],["nav","ngbNav"],["readingSection",""],["bookContainer",""],["actionBar",""],["subnav","ngbNav"],["readingHtml",""],["tabindex","0"],[4,"transloco","translocoRead"],[1,"fixed-top"],["href","javascript:void(0);",1,"visually-hidden-focusable","focus-visible",3,"click"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"parent","libraryId","volumeId","chapterId","seriesId","pageNumber","isOpen","refreshToC",4,"ngIf"],[3,"isOpenChange","isOpen","options"],["header",""],[1,"mb-0"],["tabindex","0","role","button",2,"font-size","14px","color","var(--primary-color)",3,"click"],["subheader",""],[1,"pagination-cont"],[4,"ngIf"],[1,"g-0","text-center"],[1,"d-flex","align-items-center","justify-content-between","text-center","row","g-0"],[1,"btn","btn-small","btn-icon","col-1",3,"click","disabled","title"],["aria-hidden","true",1,"fa","fa-fast-backward"],[1,"col-1",3,"click"],[1,"col-8"],["type","primary","height","5px",1,"clickable",3,"click","title","value","max"],[1,"col-1","btn-icon",3,"click","title"],["aria-hidden","true",1,"fa","fa-fast-forward"],["body","",1,"drawer-body"],["role","navigation"],["ngbNav","",1,"reader-pills","nav","nav-pills","mb-2",3,"activeIdChange","activeId","destroyOnHide"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[1,"mt-3",3,"ngbNavOutlet"],[3,"click","ngStyle","ngClass"],[3,"mousedown","ngClass"],[3,"class","ngStyle","ngClass","innerHtml","click","mousedown","wheel",4,"ngIf"],[3,"ngClass","click",4,"ngIf"],[3,"isOpen","refreshToC","parent","libraryId","volumeId","chapterId","seriesId","pageNumber"],[1,"virt-pagination-cont"],["class","d-flex align-items-center justify-content-between text-center row g-0",4,"ngIf"],[1,"btn","btn-small","btn-icon","col-1",3,"click","title"],["aria-hidden","true",1,"fa-solid","fa-caret-left"],[1,"col-1"],["type","primary","height","5px",3,"click","title","value","max"],["aria-hidden","true",1,"fa-solid","fa-caret-right"],[3,"colorThemeUpdate","styleUpdate","clickToPaginateChanged","fullscreen","bookReaderWritingStyle","layoutModeUpdate","readingDirection","immersiveMode"],[3,"loadChapter","chapters","chapterId","pageNum","currentPageAnchor"],[3,"loadChapter","chapterId","pageNum","tocRefresh"],["tabindex","-1",3,"click","ngClass","ngStyle"],[3,"click","mousedown","wheel","ngStyle","ngClass","innerHtml"],[3,"click","ngClass"],["class","action-bar row g-0 justify-content-between",4,"ngIf"],[1,"action-bar","row","g-0","justify-content-between"],[1,"btn","btn-outline-secondary","btn-icon","col-2","col-xs-1",3,"click","disabled","title"],["aria-hidden","true"],["class","btn btn-outline-secondary btn-icon col-2 col-xs-1",3,"title","click",4,"ngIf"],[1,"btn","btn-secondary","col-2","col-xs-1",3,"click"],["aria-hidden","true",1,"fa","fa-bars"],[1,"book-title","col-2","d-none","d-sm-block"],["role","status",1,"spinner-border","spinner-border-sm","text-primary",2,"border-radius","50%"],["aria-hidden","true",1,"fa","fa-times-circle"],[1,"btn","btn-outline-secondary","btn-icon","col-2","col-xs-1",3,"click","title"],["aria-hidden","true",1,"fa","fa-reply"],[1,"visually-hidden"],["role","button",3,"click",4,"ngIf"],[1,"book-title-text","ms-1",3,"ngbTooltip"],["role","button",3,"click"],["aria-hidden","true",1,"fa","fa-glasses"]],template:function(t,i){t&1&&(l(0,"div",9,0),_(2,yi,52,50,"ng-container",10),d()),t&2&&(Fe("container-flex ",i.darkMode?"dark-mode":""," reader-container ",i.ColumnLayout," ",i.WritingStyleClass,""),a(2),h("translocoRead","book-reader"))},dependencies:[Ue,yt,B,dt,st,at,rt,lt,ot,xt,Pt,ct,Ge,Ae,me,wt,St,L],styles:[`@font-face{font-family:Fira_Sans;src:url("./media/FiraSans-Regular-HOAKZ3FQ.woff2") format("woff2");font-display:swap}@font-face{font-family:Lato;src:url("./media/Lato-Regular-PWVTPZYJ.woff2") format("woff2");font-display:swap}@font-face{font-family:Libre_Baskerville;src:url("./media/LibreBaskerville-Regular-UCPAKWJ2.woff2") format("woff2");font-display:swap}@font-face{font-family:Merriweather;src:url("./media/Merriweather-Regular-V5IUXTRT.woff2") format("woff2");font-display:swap}@font-face{font-family:Nanum_Gothic;src:url("./media/NanumGothic-Regular-TGYLBT35.woff2") format("woff2");font-display:swap}@font-face{font-family:RocknRoll_One;src:url("./media/RocknRollOne-Regular-UVSUXE5M.woff2") format("woff2");font-display:swap}@font-face{font-family:OpenDyslexic2;src:url("./media/OpenDyslexic-Regular-77ZXO6O5.woff2") format("woff2");font-display:swap}@font-face{font-family:THSarabunNewest2;src:url("./media/THSarabunNewest2-26H6ECW5.woff2") format("woff2");font-display:swap}@font-face{font-family:Sarabun;src:url("./media/Sarabun-N2KKBKWX.woff2") format("woff2");font-display:swap}@font-face{font-family:JSJindara;src:url("./media/JSJindara-6LI4GWL3.woff2") format("woff2");font-display:swap}[_ngcontent-%COMP%]:root{--br-actionbar-button-text-color: #6c757d;--accordion-body-bg-color: black;--accordion-header-bg-color: grey;--br-actionbar-button-hover-border-color: #6c757d;--br-actionbar-bg-color: white}.control-container[_ngcontent-%COMP%]{padding-bottom:5px}.page-stub[_ngcontent-%COMP%]{margin-top:6px;padding-left:2px;padding-right:2px}.drawer-body[_ngcontent-%COMP%]{overflow:auto}.drawer-body[_ngcontent-%COMP%]   .reader-pills[_ngcontent-%COMP%]{justify-content:center;margin:0 .25rem}.drawer-body[_ngcontent-%COMP%]   .reader-pills[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{border:1px solid var(--primary-color);margin:0 .25rem}.drawer-body[_ngcontent-%COMP%]   .reader-pills[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{border:unset}.fixed-top[_ngcontent-%COMP%]{z-index:1022;direction:ltr}.dark-mode[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{opacity:0}.action-bar[_ngcontent-%COMP%]{background-color:var(--br-actionbar-bg-color);overflow:hidden;box-shadow:0 0 6px #000000b3;max-height:38px;height:38px}.action-bar[_ngcontent-%COMP%]   .book-title-text[_ngcontent-%COMP%]{text-align:center;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden}@media (max-width: 875px){.action-bar[_ngcontent-%COMP%]   .book-title[_ngcontent-%COMP%]{display:none}}.action-bar[_ngcontent-%COMP%]   .book-title[_ngcontent-%COMP%]{margin-top:10px;text-align:center;text-transform:capitalize;max-height:inherit}.action-bar[_ngcontent-%COMP%]   .next-page-highlight[_ngcontent-%COMP%]{color:var(--primary-color)}.reader-container[_ngcontent-%COMP%]{outline:none;overflow:auto;height:calc(var(--vh, 1vh) * 100);position:relative}.reader-container.column-layout-1[_ngcontent-%COMP%], .reader-container.column-layout-2[_ngcontent-%COMP%]{height:calc(var(--vh) * 100)}.reader-container.writing-style-vertical[_ngcontent-%COMP%]{direction:rtl}.reading-section[_ngcontent-%COMP%]{width:100%;height:100vh;padding-top:38px;padding-bottom:38px;position:relative;direction:ltr}.reading-section.column-layout-1[_ngcontent-%COMP%], .reading-section.column-layout-2[_ngcontent-%COMP%]{height:calc(var(--vh, 1vh) * 100 - 38px)}.reading-section.immersive[_ngcontent-%COMP%]{height:calc(var(--vh, 1vh) * 100)}.reading-section.writing-style-vertical[_ngcontent-%COMP%]{writing-mode:vertical-rl;height:100%}.book-container[_ngcontent-%COMP%]{position:relative;height:100%}.book-container.column-layout-1[_ngcontent-%COMP%], .book-container.column-layout-2[_ngcontent-%COMP%]{height:calc(var(--vh, 1vh) * 100 - 38px)}.book-container.writing-style-vertical[_ngcontent-%COMP%]{overflow:auto}.book-content[_ngcontent-%COMP%]{position:relative;margin:0;padding:20px 0;background-color:var(--brtheme-bg-color)}.book-content.column-layout-1[_ngcontent-%COMP%]{height:calc(var(--vh) * 100 - 38px)}.book-content.column-layout-1.writing-style-vertical[_ngcontent-%COMP%]{padding:0 10px 0 0;margin:20px 0}.book-content.column-layout-2[_ngcontent-%COMP%]{height:calc(var(--vh) * 100 - 38px)}.book-content.column-layout-2.writing-style-vertical[_ngcontent-%COMP%]{padding:0 10px 0 0;margin:20px 0}.book-content.writing-style-vertical[_ngcontent-%COMP%]{height:auto}.book-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%], .book-content[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:link{color:var(--brtheme-link-text-color)}.pagination-cont[_ngcontent-%COMP%]{background:var(--br-actionbar-bg-color);border-radius:5px;padding:5px 15px;margin:0 0 5px;border:var(--drawer-pagination-border)}.virt-pagination-cont[_ngcontent-%COMP%]{padding-bottom:5px;margin-bottom:5px;box-shadow:var(--drawer-pagination-horizontal-rule)}.bottom-bar[_ngcontent-%COMP%]{position:fixed;width:100%;bottom:0;left:0;writing-mode:horizontal-tb}.column-layout-1[_ngcontent-%COMP%]   .book-content[_ngcontent-%COMP%]{column-count:1;column-gap:20px;overflow:hidden;word-break:break-word;overflow-wrap:break-word}.column-layout-2[_ngcontent-%COMP%]   .book-content[_ngcontent-%COMP%]{column-count:2;column-gap:20px;overflow:hidden;word-break:break-word;overflow-wrap:break-word}  .book-content a,   .book-content :link{color:#00f}  .kavita-scale-width-container{width:auto;max-height:calc(var(--book-reader-content-max-height) - 38px)!important;max-width:calc(var(--book-reader-content-max-width))!important;position:var(--book-reader-content-position)!important;top:var(--book-reader-content-top)!important;left:var(--book-reader-content-left)!important;transform:var(--book-reader-content-transform)!important}  .kavita-scale-width{max-height:calc(var(--book-reader-content-max-height) - 38px)!important;max-width:calc(var(--book-reader-content-max-width))!important;object-fit:contain;object-position:top center;break-inside:avoid;break-before:column;max-height:100vh}.icon-primary-color[_ngcontent-%COMP%]{color:#0062cc}.right[_ngcontent-%COMP%]{position:absolute;right:0;top:38px;width:20vw;z-index:3;background:transparent;border-color:transparent;border:none!important;opacity:0;outline:none}.right.immersive[_ngcontent-%COMP%]{top:0}.right.no-pointer-events[_ngcontent-%COMP%]{pointer-events:none}.right-with-scrollbar[_ngcontent-%COMP%]{position:absolute;right:17px;top:38px;width:18%;z-index:3;background:transparent;opacity:0;border-color:transparent;border:none!important;outline:none;cursor:pointer}.right-with-scrollbar.immersive[_ngcontent-%COMP%]{top:0}.left[_ngcontent-%COMP%]{position:absolute;left:0;top:38px;width:20vw;background:transparent;opacity:0;border-color:transparent;border:none!important;z-index:3;outline:none;height:100vw;cursor:pointer}.left.immersive[_ngcontent-%COMP%]{top:0}.highlight[_ngcontent-%COMP%]{background-color:#41e16480!important;animation:fadein .5s both}.highlight-2[_ngcontent-%COMP%]{background-color:#4169e180!important;animation:fadein .5s both}.btn.btn-secondary[_ngcontent-%COMP%]{color:var(--br-actionbar-button-text-color);border-color:transparent;background-color:unset}.btn.btn-secondary[_ngcontent-%COMP%]:hover, .btn.btn-secondary[_ngcontent-%COMP%]:focus{border-color:var(--br-actionbar-button-hover-border-color)}.btn.btn-outline-secondary[_ngcontent-%COMP%]{border-color:transparent;background-color:unset}.btn.btn-outline-secondary[_ngcontent-%COMP%]:hover, .btn.btn-outline-secondary[_ngcontent-%COMP%]:focus{border-color:var(--br-actionbar-button-hover-border-color)}.btn[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{background-color:unset;color:var(--br-actionbar-button-text-color)}.btn[_ngcontent-%COMP%]:active   *[_ngcontent-%COMP%]{color:#fff}
/*# sourceMappingURL=book-reader.component-C5ZORFN6.css.map */`],data:{animation:[ye("isLoading",[ne("false",ie({opacity:1})),ne("true",ie({opacity:0})),we("false <=> true",Pe("200ms"))]),ye("fade",[ne("true",ie({opacity:0})),ne("false",ie({opacity:.5})),we("false <=> true",Pe("4000ms"))])]},changeDetection:0});let o=c;return o})();var Jn=[{path:":chapterId",component:It}];export{Jn as routes};
//# sourceMappingURL=chunk-FNXOSSP4.js.map
