import{a as Tt}from"./chunk-G6W3CHAT.js";import{a as Ft}from"./chunk-DATLIK2Y.js";import{a as De,b as Ct}from"./chunk-C2T36BOI.js";import{a as vt}from"./chunk-GGQU56QW.js";import{a as bt}from"./chunk-V7YNUPX5.js";import{a as wt}from"./chunk-U42B4V5B.js";import{c as _t,d as V,m as Ce}from"./chunk-ZTKUYOP3.js";import{a as gt}from"./chunk-K6JLHPZK.js";import{a as u,b as a,c as ve,d as k,e as xt,f as yt,g as Pe,h as Ne}from"./chunk-LAUBKCQL.js";import{j as ht,k as Ee}from"./chunk-76TOP2FJ.js";import{a as St}from"./chunk-CNATNHH2.js";import{e as Z,f as he}from"./chunk-5CMEBAZF.js";import{e as at}from"./chunk-SPNNO5LP.js";import{h as ut,i as $e,k as Se,m as je,s as ft}from"./chunk-E6ZKMAWP.js";import{$b as T,Ac as be,Bb as f,Dc as $,Ea as Ze,Ec as j,Fa as v,Fb as Te,Ga as C,Gc as D,Ib as s,Ie as mt,Jd as B,Je as dt,L as Qe,Na as ne,Pa as P,Rc as K,Rd as d,Sd as lt,Td as W,U as te,Ud as st,Vb as m,Wb as c,Xb as b,Yb as S,Zb as F,Zd as pt,_b as R,_c as it,_d as Ve,ba as We,be as ae,bf as ge,ca as He,cc as x,ce as le,dc as p,de as se,ec as et,fa as Ye,fc as tt,fe as L,gd as Ie,hb as Be,hc as Le,hd as z,he as pe,id as Q,ie as Me,jc as ye,jd as nt,ka as Xe,kc as Ge,kd as rt,lb as l,lc as Y,mb as N,mc as X,me as ce,n as Ae,nc as I,nd as oe,ne as me,oc as h,od as ke,oe as de,pc as w,pe as ue,qa as y,qc as re,qe as fe,se as ct,u as we,ud as ot,va as q,xc as J,ya as ie,yc as Oe,ye as Re,z as A,zc as E,ze as _e}from"./chunk-2LHIXASS.js";var Ot=25,It=(()=>{let r=class r{constructor(){this.resumeKeys={},this.resumeScroll={}}getResumeKey(e){return this.resumeKeys.hasOwnProperty(e)?this.resumeKeys[e]:""}getResumePosition(e){return this.resumeScroll.hasOwnProperty(e)?this.resumeScroll[e]:0}saveResumeKey(e,i){this.resumeKeys[e]=i}saveScrollOffset(e,i){this.resumeScroll[e]=i}generateJumpBar(e,i){let o=e.length*Ot;if(i>=o)return[...e];let _=[],g=parseInt(Math.floor(i/Ot)+"",10),O=e.length-g-3;if(O<=0)return[...e];let U=Math.ceil(O/2),G=Math.floor(e.length/2);return _.push(e[0]),this._removeFirstPartOfJumpBar(G,U,e,_),_.push(e[G]),this._removeSecondPartOfJumpBar(G,U,e,_),_.push(e[e.length-1]),_}_removeSecondPartOfJumpBar(e,i=1,o,_){let g=[];for(let O=0;O<i;O++){let U=1e8,G=-1;for(let M=e+1;M<o.length-2;M++)o[M].size<U&&!g.includes(M)&&(U=o[M].size,G=M);g.push(G)}for(let O=e+1;O<o.length-2;O++)g.includes(O)||_.push(o[O])}_removeFirstPartOfJumpBar(e,i=1,o,_){let g=[];for(let O=0;O<i;O++){let U=1e8,G=-1;for(let M=1;M<e;M++)o[M].size<U&&!g.includes(M)&&(U=o[M].size,G=M);g.push(G)}for(let O=1;O<e;O++)g.includes(O)||_.push(o[O])}getJumpKeys(e,i){let o={};return e.forEach(_=>{let g=i(_).charAt(0);/\d|\#|!|%|@|\(|\)|\^|\.|_|\*/g.test(g)&&(g="#"),o.hasOwnProperty(g)||(o[g]=0),o[g]+=1}),Object.keys(o).map(_=>({key:_,size:o[_],title:_.toUpperCase()})).sort((_,g)=>_.key<g.key?-1:_.key>g.key?1:0)}};r.\u0275fac=function(i){return new(i||r)},r.\u0275prov=Xe({token:r,factory:r.\u0275fac,providedIn:"root"});let t=r;return t})();var xe=class{constructor(){this.sortDisabled=!1,this.statementLimit=0,this.saveDisabled=!1}};var kt=(()=>{let r=class r{constructor(e){this.translocoService=e}transform(e){switch(e){case k.SortName:return this.translocoService.translate("sort-field-pipe.sort-name");case k.Created:return this.translocoService.translate("sort-field-pipe.created");case k.LastModified:return this.translocoService.translate("sort-field-pipe.last-modified");case k.LastChapterAdded:return this.translocoService.translate("sort-field-pipe.last-chapter-added");case k.TimeToRead:return this.translocoService.translate("sort-field-pipe.time-to-read");case k.ReleaseYear:return this.translocoService.translate("sort-field-pipe.release-year");case k.ReadProgress:return this.translocoService.translate("sort-field-pipe.read-progress");case k.AverageRating:return this.translocoService.translate("sort-field-pipe.average-rating")}}};r.\u0275fac=function(i){return new(i||r)(N(lt,16))},r.\u0275pipe=ie({name:"sortField",type:r,pure:!0,standalone:!0});let t=r;return t})();var Vt=(()=>{let r=class r{transform(e){switch(e){case a.AgeRating:return d("filter-field-pipe.age-rating");case a.Characters:return d("filter-field-pipe.characters");case a.CollectionTags:return d("filter-field-pipe.collection-tags");case a.Colorist:return d("filter-field-pipe.colorist");case a.CoverArtist:return d("filter-field-pipe.cover-artist");case a.Editor:return d("filter-field-pipe.editor");case a.Formats:return d("filter-field-pipe.formats");case a.Genres:return d("filter-field-pipe.genres");case a.Inker:return d("filter-field-pipe.inker");case a.Imprint:return d("filter-field-pipe.imprint");case a.Team:return d("filter-field-pipe.team");case a.Location:return d("filter-field-pipe.location");case a.Languages:return d("filter-field-pipe.languages");case a.Libraries:return d("filter-field-pipe.libraries");case a.Letterer:return d("filter-field-pipe.letterer");case a.PublicationStatus:return d("filter-field-pipe.publication-status");case a.Penciller:return d("filter-field-pipe.penciller");case a.Publisher:return d("filter-field-pipe.publisher");case a.ReadProgress:return d("filter-field-pipe.read-progress");case a.ReadTime:return d("filter-field-pipe.read-time");case a.ReleaseYear:return d("filter-field-pipe.release-year");case a.SeriesName:return d("filter-field-pipe.series-name");case a.Summary:return d("filter-field-pipe.summary");case a.Tags:return d("filter-field-pipe.tags");case a.Translators:return d("filter-field-pipe.translators");case a.UserRating:return d("filter-field-pipe.user-rating");case a.Writers:return d("filter-field-pipe.writers");case a.Path:return d("filter-field-pipe.path");case a.FilePath:return d("filter-field-pipe.file-path");case a.WantToRead:return d("filter-field-pipe.want-to-read");case a.ReadingDate:return d("filter-field-pipe.read-date");case a.AverageRating:return d("filter-field-pipe.average-rating");default:throw new Error(`Invalid FilterField value: ${e}`)}}};r.\u0275fac=function(i){return new(i||r)},r.\u0275pipe=ie({name:"filterField",type:r,pure:!0,standalone:!0});let t=r;return t})();var Mt=(()=>{let r=class r{transform(e){switch(e){case u.BeginsWith:return d("filter-comparison-pipe.begins-with");case u.Contains:return d("filter-comparison-pipe.contains");case u.Equal:return d("filter-comparison-pipe.equal");case u.GreaterThan:return d("filter-comparison-pipe.greater-than");case u.GreaterThanEqual:return d("filter-comparison-pipe.greater-than-or-equal");case u.LessThan:return d("filter-comparison-pipe.less-than");case u.LessThanEqual:return d("filter-comparison-pipe.less-than-or-equal");case u.Matches:return d("filter-comparison-pipe.matches");case u.NotContains:return d("filter-comparison-pipe.does-not-contain");case u.NotEqual:return d("filter-comparison-pipe.not-equal");case u.EndsWith:return d("filter-comparison-pipe.ends-with");case u.IsBefore:return d("filter-comparison-pipe.is-before");case u.IsAfter:return d("filter-comparison-pipe.is-after");case u.IsInLast:return d("filter-comparison-pipe.is-in-last");case u.IsNotInLast:return d("filter-comparison-pipe.is-not-in-last");case u.MustContains:return d("filter-comparison-pipe.must-contains");default:throw new Error(`Invalid FilterComparison value: ${e}`)}}};r.\u0275fac=function(i){return new(i||r)},r.\u0275pipe=ie({name:"filterComparison",type:r,pure:!0,standalone:!0});let t=r;return t})();var Jt=["*"],Kt=(t,r)=>({options:t,multipleAllowed:r});function zt(t,r){if(t&1&&(m(0,"option",13),h(1),$(2,"filterField"),c()),t&2){let n=r.$implicit;s("value",n),l(),w(j(2,2,n))}}function Qt(t,r){if(t&1&&(m(0,"option",13),h(1),$(2,"filterComparison"),c()),t&2){let n=r.$implicit;s("value",n),l(),w(j(2,2,n))}}function Wt(t,r){t&1&&(S(0),b(1,"input",16),F())}function Ht(t,r){t&1&&(S(0),b(1,"input",17),F())}function Yt(t,r){t&1&&(S(0),b(1,"input",18),F())}function Xt(t,r){if(t&1){let n=T();S(0),m(1,"div",19)(2,"input",20,0),x("dateSelect",function(i){v(n);let o=p(3);return C(o.onDateSelect(i))})("blur",function(){v(n);let i=p(3);return C(i.updateIfDateFilled())}),c(),m(4,"button",21),x("click",function(){v(n);let i=I(3);return C(i.toggle())}),c()(),F()}}function Zt(t,r){t&1&&R(0)}function ei(t,r){if(t&1&&b(0,"select2",23),t&2){let n=r.options,e=r.multipleAllowed;s("data",n)("hideSelectedItems",!0)("multiple",e)("infiniteScroll",!0)("resettable",!0)}}function ti(t,r){if(t&1&&(S(0),f(1,Zt,1,0,"ng-container",22)(2,ei,1,5,"ng-template",null,1,D),F()),t&2){let n=r.ngIf,e=I(3),i=p(4);l(),s("ngTemplateOutlet",e)("ngTemplateOutletContext",be(2,Kt,n,i.MultipleDropdownAllowed))}}function ii(t,r){if(t&1&&(S(0),f(1,ti,4,5,"ng-container",11),$(2,"async"),F()),t&2){let n=p(3);l(),s("ngIf",j(2,1,n.dropdownOptions$))}}function ni(t,r){if(t&1&&(S(0)(1,14),f(2,Wt,2,0,"ng-container",15)(3,Ht,2,0,"ng-container",15)(4,Yt,2,0,"ng-container",15)(5,Xt,5,0,"ng-container",15)(6,ii,3,3,"ng-container",15),F()()),t&2){let n=r.ngIf,e=p(2);l(),s("ngSwitch",n),l(),s("ngSwitchCase",e.PredicateType.Text),l(),s("ngSwitchCase",e.PredicateType.Number),l(),s("ngSwitchCase",e.PredicateType.Boolean),l(),s("ngSwitchCase",e.PredicateType.Date),l(),s("ngSwitchCase",e.PredicateType.Dropdown)}}function ri(t,r){if(t&1&&b(0,"i",26),t&2){let n=p(2).$implicit,e=p();s("ngbTooltip",n(e.UiLabel.tooltip))}}function oi(t,r){if(t&1&&(S(0),m(1,"span",24),h(2),c(),f(3,ri,1,1,"i",25),F()),t&2){let n=p().$implicit,e=p();l(2),w(n(e.UiLabel.unit)),l(),s("ngIf",e.UiLabel.tooltip)}}function ai(t,r){if(t&1&&(S(0),m(1,"form",3)(2,"div",4)(3,"div",5)(4,"select",6),f(5,zt,3,4,"option",7),c()(),m(6,"div",8)(7,"select",9),f(8,Qt,3,4,"option",7),$(9,"async"),c()(),m(10,"div",10),f(11,ni,7,6,"ng-container",11),$(12,"async"),c(),m(13,"div",12),f(14,oi,4,2,"ng-container",11),c(),tt(15,0,["#removeBtn",""]),c()(),F()),t&2){let n=p();l(),s("formGroup",n.formGroup),l(4),s("ngForOf",n.availableFields),l(3),s("ngForOf",j(9,5,n.validComparisons$)),l(3),s("ngIf",j(12,7,n.predicateType$)),l(3),s("ngIf",n.UiLabel!==null)}}var H=function(t){return t[t.Text=1]="Text",t[t.Number=2]="Number",t[t.Dropdown=3]="Dropdown",t[t.Boolean=4]="Boolean",t[t.Date=5]="Date",t}(H||{}),Fe=class{constructor(r="",n=""){this.unit="",this.tooltip="",this.unit=r,this.tooltip=n}},Rt=new Map([[a.ReadingDate,new Fe("unit-reading-date")],[a.AverageRating,new Fe("unit-average-rating")],[a.ReadProgress,new Fe("unit-reading-progress")]]),Et=[a.SeriesName,a.Summary,a.Path,a.FilePath],li=[a.ReadTime,a.ReleaseYear,a.ReadProgress,a.UserRating,a.AverageRating],Ue=[a.PublicationStatus,a.Languages,a.AgeRating,a.Translators,a.Characters,a.Publisher,a.Editor,a.CoverArtist,a.Letterer,a.Colorist,a.Inker,a.Penciller,a.Writers,a.Genres,a.Libraries,a.Formats,a.CollectionTags,a.Tags,a.Imprint,a.Team,a.Location],qe=[a.WantToRead],Je=[a.ReadingDate],si=[a.Libraries,a.Formats,a.AgeRating,a.PublicationStatus],pi=[a.AgeRating],ci=[a.ReleaseYear],Dt=[u.Equal,u.NotEqual,u.BeginsWith,u.EndsWith,u.Matches],Ke=[u.IsBefore,u.IsAfter,u.Equal,u.NotEqual],ze=[u.Equal,u.NotEqual,u.LessThan,u.LessThanEqual,u.GreaterThan,u.GreaterThanEqual],mi=[u.Equal,u.NotEqual,u.Contains,u.NotContains,u.MustContains],Pt=[u.Equal],At=(()=>{let r=class r{get UiLabel(){let e=parseInt(this.formGroup.get("input").value,10);return Rt.has(e)?Rt.get(e):null}get MultipleDropdownAllowed(){let e=parseInt(this.formGroup.get("comparison")?.value,10);return e===u.Contains||e===u.NotContains||e===u.MustContains}constructor(e,i,o){this.metadataService=e,this.libraryService=i,this.collectionTagService=o,this.index=0,this.availableFields=ve,this.filterStatement=new P,this.cdRef=y(K),this.destroyRef=y(ne),this.dateParser=y(mt),this.formGroup=new se({comparison:new L(u.Equal,[]),filterValue:new L("",[])}),this.validComparisons$=new Ae([u.Equal]),this.predicateType$=new Ae(H.Text),this.dropdownOptions$=we([]),this.loaded=!1,this.PredicateType=H}ngOnInit(){this.formGroup.addControl("input",new L(a.SeriesName,[])),this.formGroup.get("input")?.valueChanges.pipe(te(),B(this.destroyRef)).subscribe(e=>this.handleFieldChange(e)),this.populateFromPreset(),this.formGroup.get("filterValue")?.valueChanges.pipe(B(this.destroyRef)).subscribe(),this.dropdownOptions$=this.formGroup.get("input").valueChanges.pipe(We(this.preset.value),te(),Qe(()=>{let e=parseInt(this.formGroup.get("input")?.value,10);return Ue.includes(e)}),He(e=>this.getDropdownObservable()),B(this.destroyRef)),this.formGroup.valueChanges.pipe(te(),B(this.destroyRef)).subscribe(e=>{this.propagateFilterUpdate()}),this.loaded=!0,this.cdRef.markForCheck()}propagateFilterUpdate(){let e={comparison:parseInt(this.formGroup.get("comparison")?.value,10),field:parseInt(this.formGroup.get("input")?.value,10),value:this.formGroup.get("filterValue")?.value};typeof e.value=="object"&&Je.includes(e.field)&&(e.value=this.dateParser.format(e.value)),typeof e.value=="number"&&!Number.isNaN(e.value)&&(e.value=e.value+""),typeof e.value=="boolean"&&(e.value=e.value+""),!(!e.value&&![a.SeriesName,a.Summary].includes(e.field)&&!qe.includes(e.field))&&this.filterStatement.emit(e)}populateFromPreset(){let e=this.preset.value==="undefined"||!this.preset.value?"":this.preset.value;this.formGroup.get("comparison")?.patchValue(this.preset.comparison),this.formGroup.get("input")?.patchValue(this.preset.field),Et.includes(this.preset.field)?this.formGroup.get("filterValue")?.patchValue(e):qe.includes(this.preset.field)?this.formGroup.get("filterValue")?.patchValue(e):Je.includes(this.preset.field)?this.formGroup.get("filterValue")?.patchValue(this.dateParser.parse(e)):Ue.includes(this.preset.field)?this.MultipleDropdownAllowed||e.includes(",")?this.formGroup.get("filterValue")?.patchValue(e.split(",").map(i=>parseInt(i,10))):this.preset.field===a.Languages?this.formGroup.get("filterValue")?.patchValue(e):this.formGroup.get("filterValue")?.patchValue(parseInt(e,10)):this.formGroup.get("filterValue")?.patchValue(parseInt(e,10)),this.cdRef.markForCheck()}getDropdownObservable(){switch(parseInt(this.formGroup.get("input")?.value,10)){case a.PublicationStatus:return this.metadataService.getAllPublicationStatus().pipe(A(i=>i.map(o=>({value:o.value,label:o.title}))));case a.AgeRating:return this.metadataService.getAllAgeRatings().pipe(A(i=>i.map(o=>({value:o.value,label:o.title}))));case a.Genres:return this.metadataService.getAllGenres().pipe(A(i=>i.map(o=>({value:o.id,label:o.title}))));case a.Languages:return this.metadataService.getAllLanguages().pipe(A(i=>i.map(o=>({value:o.isoCode,label:o.title+` (${o.isoCode})`}))));case a.Formats:return we(yt).pipe(A(i=>i.map(o=>({value:o.value,label:o.title}))));case a.Libraries:return this.libraryService.getLibraries().pipe(A(i=>i.map(o=>({value:o.id,label:o.name}))));case a.Tags:return this.metadataService.getAllTags().pipe(A(i=>i.map(o=>({value:o.id,label:o.title}))));case a.CollectionTags:return this.collectionTagService.allCollections().pipe(A(i=>i.map(o=>({value:o.id,label:o.title}))));case a.Characters:return this.getPersonOptions(V.Character);case a.Colorist:return this.getPersonOptions(V.Colorist);case a.CoverArtist:return this.getPersonOptions(V.CoverArtist);case a.Editor:return this.getPersonOptions(V.Editor);case a.Inker:return this.getPersonOptions(V.Inker);case a.Letterer:return this.getPersonOptions(V.Letterer);case a.Penciller:return this.getPersonOptions(V.Penciller);case a.Publisher:return this.getPersonOptions(V.Publisher);case a.Imprint:return this.getPersonOptions(V.Imprint);case a.Team:return this.getPersonOptions(V.Team);case a.Location:return this.getPersonOptions(V.Location);case a.Translators:return this.getPersonOptions(V.Translator);case a.Writers:return this.getPersonOptions(V.Writer)}return we([])}getPersonOptions(e){return this.metadataService.getAllPeopleByRole(e).pipe(A(i=>i.map(o=>({value:o.id,label:o.name}))))}handleFieldChange(e){let i=parseInt(e,10);if(Et.includes(i)){this.validComparisons$.next(Dt),this.predicateType$.next(H.Text),this.loaded&&(this.formGroup.get("filterValue")?.patchValue(""),this.formGroup.get("comparison")?.patchValue(Dt[0]));return}if(li.includes(i)){let o=[...ze];ci.includes(i)&&o.push(...Ke),this.validComparisons$.next(o),this.predicateType$.next(H.Number),this.loaded&&(this.formGroup.get("filterValue")?.patchValue(0),this.formGroup.get("comparison")?.patchValue(ze[0]));return}if(Je.includes(i)){this.validComparisons$.next(Ke),this.predicateType$.next(H.Date),this.loaded&&(this.formGroup.get("filterValue")?.patchValue(!1),this.formGroup.get("comparison")?.patchValue(Ke[0]));return}if(qe.includes(i)){this.validComparisons$.next(Pt),this.predicateType$.next(H.Boolean),this.loaded&&(this.formGroup.get("filterValue")?.patchValue(!1),this.formGroup.get("comparison")?.patchValue(Pt[0]));return}if(Ue.includes(i)){let o=[...mi];pi.includes(i)&&o.push(...ze),si.includes(i)&&(o=o.filter(_=>_!==u.MustContains)),this.validComparisons$.next(o),this.predicateType$.next(H.Dropdown),this.loaded&&(this.formGroup.get("filterValue")?.patchValue(0),this.formGroup.get("comparison")?.patchValue(o[0]));return}}onDateSelect(e){this.propagateFilterUpdate()}updateIfDateFilled(){this.propagateFilterUpdate()}};r.\u0275fac=function(i){return new(i||r)(N(Ne),N(gt),N(_t))},r.\u0275cmp=q({type:r,selectors:[["app-metadata-row-filter"]],inputs:{index:"index",preset:"preset",availableFields:"availableFields"},outputs:{filterStatement:"filterStatement"},standalone:!0,features:[J],ngContentSelectors:Jt,decls:1,vars:1,consts:[["d","ngbDatepicker"],["dropdown",""],[4,"transloco","translocoRead"],[3,"formGroup"],[1,"row","g-0"],[1,"col-md-3","me-2","col-10","mb-2"],["formControlName","input",1,"form-select","me-2"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-2","me-2","col-10","mb-2"],["formControlName","comparison",1,"col-auto","form-select"],[1,"col-md-4","col-10","mb-2"],[4,"ngIf"],[1,"col","pt-2","ms-2"],[3,"value"],[3,"ngSwitch"],[4,"ngSwitchCase"],["type","text","autocomplete","true","formControlName","filterValue",1,"form-control","me-2"],["type","number","inputmode","numeric","formControlName","filterValue","min","0",1,"form-control","me-2"],["type","checkbox","formControlName","filterValue",1,"form-check-input","mt-2","me-2",2,"font-size","1.5rem"],[1,"input-group"],["placeholder","yyyy-mm-dd","name","dp","formControlName","filterValue","ngbDatepicker","",1,"form-control",3,"dateSelect","blur"],["type","button",1,"btn","btn-outline-secondary","fa-solid","fa-calendar-days",3,"click"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["formControlName","filterValue",3,"data","hideSelectedItems","multiple","infiniteScroll","resettable"],[1,"text-muted"],["class","fa fa-info-circle ms-1","aria-hidden","true",3,"ngbTooltip",4,"ngIf"],["aria-hidden","true",1,"fa","fa-info-circle","ms-1",3,"ngbTooltip"]],template:function(i,o){i&1&&(et(),f(0,ai,16,9,"ng-container",2)),i&2&&s("translocoRead","metadata-filter-row")},dependencies:[_e,pe,ue,fe,Ve,Me,pt,de,ae,le,ct,ce,me,ke,Vt,Mt,nt,rt,z,Q,Ee,ht,oe,ge,W,dt],styles:[`.select2-selection__rendered{padding-top:4px!important}  .ngb-dp-content,   .ngb-dp-header{background:var(--bs-body-bg);color:var(--body-text-color)}  .ngb-dp-header,   .ngb-dp-weekdays{background-color:var(--bs-body-bg)!important}  .ngb-dp-day .btn-light,   .ngb-dp-weekday{background:var(--bs-body-bg);color:var(--body-text-color)}  [ngbDatepickerDayView]:hover:not(.bg-primary), [ngbDatepickerDayView].active[_ngcontent-%COMP%]:not(.bg-primary){background:var(--primary-color-dark-shade)!important;outline:1px solid var(--primary-color-dark-shade)!important}
/*# sourceMappingURL=metadata-filter-row.component-6UXZPFWY.css.map */`],changeDetection:0});let t=r;return t})();var Bt=t=>({num:t});function di(t,r){if(t&1&&(m(0,"option",15),h(1),c()),t&2){let n=r.$implicit;s("value",n.value),l(),w(n.title)}}function ui(t,r){if(t&1){let n=T();m(0,"button",20,1),x("click",function(){v(n);let i=p().index,o=p(4);return C(o.removeFilter(i))}),b(2,"i",21),m(3,"span",22),h(4),c()()}if(t&2){let n=p().index,e=p(3).$implicit;s("ngbTooltip",e("remove-rule",E(2,Bt,n))),l(4),w(e("remove-rule",E(4,Bt,n)))}}function fi(t,r){if(t&1){let n=T();m(0,"div",7)(1,"div",16)(2,"app-metadata-row-filter",17),x("filterStatement",function(i){let o=v(n).index,_=p(4);return C(_.updateFilter(o,i))}),m(3,"div",18),f(4,ui,5,6,"button",19),c()()()()}if(t&2){let n=r.$implicit,e=r.index,i=p(4);l(2),s("index",e+100)("preset",n)("availableFields",i.availableFilterFields),l(2),s("ngIf",e<i.filter.statements.length-1&&i.filter.statements.length>1)}}function _i(t,r){if(t&1){let n=T();S(0),m(1,"div",6)(2,"div",7)(3,"div",8)(4,"select",9),f(5,di,2,2,"option",10),c()(),m(6,"div",8)(7,"button",11),x("click",function(){v(n);let i=p(3);return C(i.addFilter())}),b(8,"i",12),m(9,"span",13),h(10),c()()()(),f(11,fi,5,4,"div",14),c(),F()}if(t&2){let n=p(2).$implicit,e=p();l(5),s("ngForOf",e.groupOptions),l(2),s("ngbTooltip",n("add-rule"))("disabled",e.statementLimit===-1||e.statementLimit>0&&e.filter.statements.length>=e.statementLimit),l(3),w(n("add-rule")),l(),s("ngForOf",e.filter.statements)}}function gi(t,r){if(t&1&&(m(0,"option",15),h(1),c()),t&2){let n=r.$implicit;s("value",n.value),l(),w(n.title)}}function hi(t,r){if(t&1){let n=T();m(0,"button",20,1),x("click",function(){v(n);let i=p().index,o=p(4);return C(o.removeFilter(i))}),b(2,"i",21),m(3,"span",22),h(4),c()()}if(t&2){let n=p(4).$implicit;s("ngbTooltip",n("remove-rule")),l(4),w(n("remove-rule"))}}function vi(t,r){if(t&1){let n=T();m(0,"div",23)(1,"div",28)(2,"app-metadata-row-filter",17),x("filterStatement",function(i){let o=v(n).index,_=p(4);return C(_.updateFilter(o,i))}),m(3,"div",29),f(4,hi,5,2,"button",19),c()()()()}if(t&2){let n=r.$implicit,e=r.index,i=p(4);l(2),s("index",e)("preset",n)("availableFields",i.availableFilterFields),l(2),s("ngIf",e<i.filter.statements.length-1&&i.filter.statements.length>1)}}function Ci(t,r){if(t&1){let n=T();m(0,"div",6)(1,"div",23)(2,"div",24)(3,"select",9),f(4,gi,2,2,"option",10),c()(),m(5,"div",25)(6,"button",26),x("click",function(){v(n);let i=p(3);return C(i.addFilter())}),b(7,"i",12),m(8,"span",13),h(9),c()()()(),f(10,vi,5,4,"div",27),c()}if(t&2){let n=p(2).$implicit,e=p();l(4),s("ngForOf",e.groupOptions),l(2),s("ngbTooltip",n("add-rule")),l(3),w(n("add-rule")),l(),s("ngForOf",e.filter.statements)}}function xi(t,r){if(t&1&&(S(0),m(1,"form",4),f(2,_i,12,5,"ng-container",5)(3,Ci,11,4,"ng-template",null,0,D),c(),F()),t&2){let n=I(4),e=p(2);l(),s("formGroup",e.formGroup),l(),s("ngIf",e.utilityService.getActiveBreakpoint()===e.Breakpoint.Desktop)("ngIfElse",n)}}function yi(t,r){if(t&1&&(S(0),f(1,xi,5,3,"ng-container",3),F()),t&2){let n=p();l(),s("ngIf",n.filter)}}var Lt=(()=>{let r=class r{constructor(){this.statementLimit=0,this.availableFilterFields=ve,this.update=new P,this.apply=new P,this.cdRef=y(K),this.metadataService=y(Ne),this.utilityService=y(he),this.filterUtilityService=y(Ce),this.destroyRef=y(ne),this.Breakpoint=Z,this.formGroup=new se({}),this.groupOptions=[{value:Pe.Or,title:d("metadata-builder.or")},{value:Pe.And,title:d("metadata-builder.and")}]}ngOnInit(){this.formGroup.addControl("comparison",new L(this.filter?.combination||Pe.Or,[])),this.formGroup.valueChanges.pipe(te(),B(this.destroyRef),Ye(e=>{this.filter.combination=parseInt(this.formGroup.get("comparison")?.value,10),this.update.emit(this.filter)})).subscribe()}addFilter(){this.filter.statements=[this.metadataService.createDefaultFilterStatement(),...this.filter.statements],this.cdRef.markForCheck()}removeFilter(e){this.filter.statements=this.filter.statements.slice(0,e).concat(this.filter.statements.slice(e+1)),this.cdRef.markForCheck()}updateFilter(e,i){this.metadataService.updateFilter(this.filter.statements,e,i),this.update.emit(this.filter)}};r.\u0275fac=function(i){return new(i||r)},r.\u0275cmp=q({type:r,selectors:[["app-metadata-builder"]],inputs:{filter:"filter",statementLimit:"statementLimit",availableFilterFields:"availableFilterFields"},outputs:{update:"update",apply:"apply"},standalone:!0,features:[J],decls:1,vars:1,consts:[["mobileView",""],["removeBtn",""],[4,"transloco","translocoRead"],[4,"ngIf"],[3,"formGroup"],[4,"ngIf","ngIfElse"],[1,"container-fluid"],[1,"row","mb-2"],[1,"col-md-2"],["formControlName","comparison",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-icon",3,"click","ngbTooltip","disabled"],["aria-hidden","true",1,"fa","fa-solid","fa-plus"],["aria-hidden","true",1,"visually-hidden"],["class","row mb-2",4,"ngFor","ngForOf"],[3,"value"],[1,"col-md-10"],[3,"filterStatement","index","preset","availableFields"],[1,"col-md-1","ms-2"],["type","button","class","btn btn-icon",3,"ngbTooltip","click",4,"ngIf"],["type","button",1,"btn","btn-icon",3,"click","ngbTooltip"],["aria-hidden","true",1,"fa-solid","fa-minus"],[1,"visually-hidden"],[1,"row","mb-3"],[1,"col-md-4","col-10"],[1,"col-md-2","col-1"],[1,"btn","btn-icon",3,"click","ngbTooltip"],["class","row mb-3",4,"ngFor","ngForOf"],[1,"col-md-12"],[1,"col-md-1","ms-2","col-1"]],template:function(i,o){i&1&&f(0,yi,2,1,"ng-container",2),i&2&&s("translocoRead","metadata-builder")},dependencies:[Q,At,z,Re,pe,ue,fe,de,ae,le,ge,_e,ce,me,W],styles:["/*# sourceMappingURL=metadata-builder.component-P2BJUT3Q.css.map */"],changeDetection:0});let t=r;return t})();var bi=["[ngbCollapse]"],Si=t=>({isOpen:t}),Fi=()=>({topOffset:56}),wi=t=>({"mt-3":t});function Ti(t,r){if(t&1&&(m(0,"div"),R(1,8),c()),t&2){let n=p(2).ngIf;p();let e=I(4);s("@inOutAnimation",void 0),l(),s("ngTemplateOutlet",e)("ngTemplateOutletContext",E(3,Si,n))}}function Oi(t,r){if(t&1){let n=T();m(0,"div")(1,"app-drawer",9,3),x("drawerClosed",function(){v(n);let i=p(4);return C(i.toggleService.set(!1))}),m(3,"h5",10),h(4),c(),m(5,"div",11),R(6,12),c()()()}if(t&2){let n=p(2).ngIf,e=p().$implicit,i=I(4);l(),s("isOpen",n)("options",Oe(5,Fi))("width",600),l(3),re(" ",e("filter-title")," "),l(2),s("ngTemplateOutlet",i)}}function Ii(t,r){if(t&1&&(S(0),f(1,Ti,2,5,"div",7)(2,Oi,7,6,"ng-template",null,2,D),F()),t&2){let n=r.ngIf,e=I(3),i=p(3);l(),s("ngIf",n>=i.Breakpoint.Tablet)("ngIfElse",e)}}function ki(t,r){if(t&1&&(S(0),f(1,Ii,4,2,"ng-container",6),F()),t&2){let n=p(2);l(),s("ngIf",n.utilityService.getActiveBreakpoint())}}function Vi(t,r){if(t&1&&b(0,"i",34),t&2){let n=p(3).$implicit;s("title",n("ascending-alt"))}}function Mi(t,r){if(t&1&&b(0,"i",35),t&2){let n=p(3).$implicit;s("title",n("descending-alt"))}}function Ri(t,r){if(t&1&&(m(0,"option",36),h(1),$(2,"sortField"),c()),t&2){let n=r.$implicit;s("value",n),l(),w(j(2,2,n))}}function Ei(t,r){if(t&1&&R(0,12),t&2){p(3);let n=I(6);s("ngTemplateOutlet",n)}}function Di(t,r){if(t&1&&(m(0,"div",18),R(1,12),c()),t&2){p(3);let n=I(6);l(),s("ngTemplateOutlet",n)}}function Pi(t,r){if(t&1){let n=T();m(0,"div",14)(1,"div",15)(2,"app-metadata-builder",16),x("update",function(i){v(n);let o=p(3);return C(o.handleFilters(i))}),c()(),m(3,"form",17)(4,"div",18)(5,"div",19)(6,"div",20)(7,"label",21),h(8),c(),b(9,"input",22),c()(),m(10,"div",23)(11,"label",24),h(12),c(),m(13,"button",25),x("click",function(){v(n);let i=p(3);return C(i.updateSortOrder())}),f(14,Vi,1,1,"i",26)(15,Mi,1,1,"ng-template",null,4,D),c(),m(17,"select",27),f(18,Ri,3,4,"option",28),c()(),m(19,"div",29)(20,"label",30),h(21),c(),b(22,"input",31),c(),f(23,Ei,1,1,"ng-container",32),c(),f(24,Di,2,1,"div",33),c()()}if(t&2){let n=I(16),e=p(2).$implicit,i=p();l(2),s("filter",i.filterV2)("availableFilterFields",i.allFilterFields)("statementLimit",i.filterSettings.statementLimit),l(),s("formGroup",i.sortGroup),l(5),w(e("limit-label")),l(4),w(e("sort-by-label")),l(),s("disabled",i.filterSettings.sortDisabled),l(),s("ngIf",i.isAscendingSort)("ngIfElse",n),l(4),s("ngForOf",i.allSortFields),l(),s("ngClass",E(14,wi,i.utilityService.getActiveBreakpoint()<=i.Breakpoint.Mobile)),l(2),w(e("filter-name-label")),l(2),s("ngIf",i.utilityService.getActiveBreakpoint()>i.Breakpoint.Tablet),l(),s("ngIf",i.utilityService.getActiveBreakpoint()<=i.Breakpoint.Tablet)}}function Ni(t,r){if(t&1&&f(0,Pi,25,16,"div",13),t&2){let n=p(2);s("ngIf",n.fullyLoaded&&n.filterV2)}}function Ai(t,r){if(t&1){let n=T();m(0,"div",37)(1,"button",38),x("click",function(){v(n);let i=p(2);return C(i.clear())}),b(2,"i",39),h(3),c(),m(4,"button",40),x("click",function(){v(n);let i=p(2);return C(i.apply())}),b(5,"i",41),h(6),c()(),m(7,"div",42)(8,"button",43),x("click",function(){v(n);let i=p(2);return C(i.save())}),b(9,"i",44),h(10),c()()}if(t&2){let n,e=p().$implicit,i=p();l(3),w(e("reset")),l(3),w(e("apply")),l(2),s("disabled",i.filterSettings.saveDisabled||!((n=i.sortGroup.get("name"))!=null&&n.value)),l(2),re(" ",e("save")," ")}}function Bi(t,r){if(t&1&&(S(0),f(1,ki,2,1,"ng-container",6),$(2,"async"),f(3,Ni,1,1,"ng-template",null,0,D)(5,Ai,11,4,"ng-template",null,1,D),F()),t&2){let n=p();l(),s("ngIf",j(2,1,n.toggleService.toggleState$))}}var Gt=(()=>{let r=class r{constructor(e,i){this.toggleService=e,this.filterService=i,this.filterOpen=new P,this.filteringDisabled=!1,this.applyFilter=new P,this.destroyRef=y(ne),this.utilityService=y(he),this.filterUtilitiesService=y(Ce),this.filteringCollapsed=!0,this.libraries=[],this.isAscendingSort=!0,this.updateApplied=0,this.fullyLoaded=!1,this.allSortFields=xt,this.allFilterFields=ve,this.cdRef=y(K),this.toastr=y(ft),this.Breakpoint=Z,this.filterService.getAllFilters().subscribe(o=>{this.smartFilters=o.map(_=>({value:_,label:_.name}))})}ngOnInit(){this.filterSettings===void 0&&(this.filterSettings=new xe,this.cdRef.markForCheck()),this.filterOpen&&this.filterOpen.pipe(B(this.destroyRef)).subscribe(e=>{this.filteringCollapsed=!e,this.toggleService.set(!this.filteringCollapsed),this.cdRef.markForCheck()}),this.loadFromPresetsAndSetup()}close(){this.filterOpen.emit(!1),this.filteringCollapsed=!0,this.toggleService.set(!this.filteringCollapsed),this.cdRef.markForCheck()}deepClone(e){if(e===null||typeof e!="object")return e;if(e instanceof Array)return e.map(o=>this.deepClone(o));let i={};for(let o in e)Object.prototype.hasOwnProperty.call(e,o)&&(typeof e[o]=="object"&&e[o]!==null?i[o]=this.deepClone(e[o]):i[o]=e[o]);return i}handleFilters(e){this.filterV2=e}loadFromPresetsAndSetup(){this.fullyLoaded=!1,this.filterV2=this.deepClone(this.filterSettings.presetsV2),this.sortGroup=new se({sortField:new L({value:this.filterV2?.sortOptions?.sortField||k.SortName,disabled:this.filterSettings.sortDisabled},[]),limitTo:new L(this.filterV2?.limitTo||0,[]),name:new L(this.filterV2?.name||"",[])}),this.filterSettings?.presetsV2?.sortOptions&&(this.isAscendingSort=this.filterSettings?.presetsV2?.sortOptions.isAscending),this.sortGroup.valueChanges.pipe(B(this.destroyRef)).subscribe(()=>{this.filterV2?.sortOptions===null&&(this.filterV2.sortOptions={isAscending:this.isAscendingSort,sortField:parseInt(this.sortGroup.get("sortField")?.value,10)}),this.filterV2.sortOptions.sortField=parseInt(this.sortGroup.get("sortField")?.value,10),this.filterV2.limitTo=Math.max(parseInt(this.sortGroup.get("limitTo")?.value||"0",10),0),this.filterV2.name=this.sortGroup.get("name")?.value||"",this.cdRef.markForCheck()}),this.fullyLoaded=!0,this.apply()}updateSortOrder(){this.filterSettings.sortDisabled||(this.isAscendingSort=!this.isAscendingSort,this.filterV2?.sortOptions===null&&(this.filterV2.sortOptions={isAscending:this.isAscendingSort,sortField:k.SortName}),this.filterV2.sortOptions.isAscending=this.isAscendingSort,this.cdRef.markForCheck())}clear(){this.loadFromPresetsAndSetup()}apply(){this.applyFilter.emit({isFirst:this.updateApplied===0,filterV2:this.filterV2}),this.utilityService.getActiveBreakpoint()===Z.Mobile&&this.updateApplied!==0&&this.toggleSelected(),this.updateApplied++,this.cdRef.markForCheck()}save(){this.filterV2&&(this.filterV2.name=this.sortGroup.get("name")?.value,this.filterService.saveFilter(this.filterV2).subscribe(()=>{this.toastr.success(d("toasts.smart-filter-updated")),this.apply()}))}toggleSelected(){this.toggleService.toggle(),this.cdRef.markForCheck()}setToggle(e){this.toggleService.set(!this.filteringCollapsed)}};r.\u0275fac=function(i){return new(i||r)(N(wt),N(Ft))},r.\u0275cmp=q({type:r,selectors:[["app-metadata-filter"]],contentQueries:function(i,o,_){if(i&1&&ye(_,bi,5),i&2){let g;Y(g=X())&&(o.collapse=g.first)}},inputs:{filterOpen:"filterOpen",filteringDisabled:"filteringDisabled",filterSettings:"filterSettings"},outputs:{applyFilter:"applyFilter"},standalone:!0,features:[J],decls:1,vars:1,consts:[["filterSection",""],["buttons",""],["mobileView",""],["commentDrawer","drawer"],["descSort",""],[4,"transloco","translocoRead"],[4,"ngIf"],[4,"ngIf","ngIfElse"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"drawerClosed","isOpen","options","width"],["header",""],["body","",1,"drawer-body"],[3,"ngTemplateOutlet"],["class","filter-section mx-auto pb-3",4,"ngIf"],[1,"filter-section","mx-auto","pb-3"],[1,"row","justify-content-center","g-0"],[3,"update","filter","availableFilterFields","statementLimit"],[1,"container-fluid",3,"formGroup"],[1,"row","mb-3"],[1,"col-md-2","col-sm-3"],[1,"form-group","pe-1"],["for","limit-to",1,"form-label"],["id","limit-to","type","number","inputmode","numeric","formControlName","limitTo",1,"form-control"],[1,"col-md-3","col-sm-9"],["for","sort-options",1,"form-label"],[1,"btn","btn-sm","btn-secondary-outline",2,"height","25px","padding-bottom","0",3,"click","disabled"],["class","fa fa-arrow-up",3,"title",4,"ngIf","ngIfElse"],["id","sort-options","formControlName","sortField",1,"form-select",2,"height","38px"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-4","col-sm-12",3,"ngClass"],["for","filter-name",1,"form-label"],["id","filter-name","type","text","formControlName","name",1,"form-control"],[3,"ngTemplateOutlet",4,"ngIf"],["class","row mb-3",4,"ngIf"],[1,"fa","fa-arrow-up",3,"title"],[1,"fa","fa-arrow-down",3,"title"],[3,"value"],[1,"col-md-6","col-sm-6","mt-4","pt-2","d-flex","justify-content-between"],[1,"btn","btn-secondary","col-6","me-1",3,"click"],["aria-hidden","true",1,"fa-solid","fa-arrow-rotate-left","me-1"],[1,"btn","btn-primary","col-6",3,"click"],["aria-hidden","true",1,"fa-solid","fa-play","me-1"],[1,"col-md-2","col-sm-6","mt-4","pt-2"],[1,"btn","btn-primary","col-12",3,"click","disabled"],["aria-hidden","true",1,"fa-solid","fa-floppy-disk"]],template:function(i,o){i&1&&f(0,Bi,7,3,"ng-container",5),i&2&&s("translocoRead","metadata-filter")},dependencies:[Q,oe,Tt,_e,pe,ue,fe,Ve,Me,de,ae,le,ce,me,Re,ke,st,W,kt,Lt,z,Ee,Ie],styles:[`input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}
/*# sourceMappingURL=metadata-filter.component-CYEGCJ7E.css.map */`],data:{animation:[ut("inOutAnimation",[je(":enter",[Se({height:0,opacity:0}),$e(".5s ease-out",Se({height:300,opacity:1}))]),je(":leave",[Se({height:300,opacity:1}),$e(".5s ease-in",Se({height:0,opacity:0}))])])]},changeDetection:0});let t=r;return t})();var Li=["cardItem"],Gi=["noData"],$i=[".jump-bar"],$t=t=>({empty:t}),jt=t=>({count:t}),Ut=(t,r)=>({$implicit:t,idx:r}),ji=()=>({id:"jumpbar"}),Ui=t=>({disabled:t});function qi(t,r){if(t&1){let n=T();m(0,"span",19)(1,"app-card-actionables",20),x("actionHandler",function(i){v(n);let o=p(3);return C(o.performAction(i))}),c(),h(2,"\xA0 "),c()}if(t&2){let n=p(3);l(),s("actions",n.actions)("labelBy",n.header)}}function Ji(t,r){if(t&1&&(m(0,"span",22),h(1),c()),t&2){let n=p(3).$implicit,e=p();Te("aria-label",n("total-items",E(2,jt,e.pagination.totalItems))),l(),w(e.pagination.totalItems)}}function Ki(t,r){if(t&1&&(m(0,"span"),h(1),f(2,Ji,2,4,"span",21),c()),t&2){let n=p(3);l(),re(" ",n.header,"\xA0 "),l(),s("ngIf",n.pagination!==void 0)}}function zi(t,r){if(t&1&&(m(0,"div",16)(1,"div",17)(2,"h2"),f(3,qi,3,2,"span",18)(4,Ki,3,2,"span",10),c()()()),t&2){let n=p(2);l(3),s("ngIf",n.actions.length>0),l(),s("ngIf",n.header!==void 0&&n.header.length>0)}}function Qi(t,r){if(t&1&&(m(0,"p"),R(1,23),c()),t&2){let n=p(2);l(),s("ngTemplateOutlet",n.noDataTemplate)}}function Wi(t,r){if(t&1){let n=T();m(0,"div",24),x("click",function(){let i=v(n).$implicit,o=p(2);return C(o.tryToSaveJumpKey(i))}),R(1,25),c()}if(t&2){let n=r.$implicit,e=r.index;p();let i=I(8),o=p();Le("id","jumpbar-index--",e,""),Te("jumpbar-index",e),l(),s("ngTemplateOutlet",o.itemTemplate)("ngTemplateOutletContext",be(5,Ut,n,i.viewPortInfo.startIndexWithBuffer+e))}}function Hi(t,r){if(t&1&&R(0,25),t&2){p();let n=I(17);s("ngTemplateOutlet",n)("ngTemplateOutletContext",Oe(2,ji))}}function Yi(t,r){if(t&1){let n=T();m(0,"div",24),x("click",function(){let i=v(n).$implicit,o=p(3);return C(o.tryToSaveJumpKey(i))}),R(1,25),c()}if(t&2){let n=r.$implicit,e=r.index,i=p(3);Le("id","jumpbar-index--",e,""),Te("jumpbar-index",e),l(),s("ngTemplateOutlet",i.itemTemplate)("ngTemplateOutletContext",be(5,Ut,n,e))}}function Xi(t,r){if(t&1&&(m(0,"div",28)(1,"p"),R(2,23),c()()),t&2){let n=p(3);l(2),s("ngTemplateOutlet",n.noDataTemplate)}}function Zi(t,r){if(t&1&&(m(0,"virtual-scroller",26,0)(2,"div",12,1),f(4,Yi,2,8,"div",13),c()(),f(5,Xi,3,1,"div",27)),t&2){let n=I(1),e=p(2);s("items",e.items)("bufferAmount",e.bufferAmount),l(4),s("ngForOf",n.viewPortItems)("ngForTrackBy",e.trackByIdentity),l(),s("ngIf",e.items.length===0&&!e.isLoading)}}function en(t,r){if(t&1){let n=T();S(0),m(1,"button",31),x("click",function(){let i=v(n).$implicit,o=p(3);return C(o.scrollTo(i))}),h(2),c(),F()}if(t&2){let n=r.$implicit,e=p(2).$implicit,i=p();l(),s("ngClass",E(3,Ui,i.hasCustomSort()))("ngbTooltip",e("jumpkey-count",E(5,jt,n.size))),l(),re(" ",n.title," ")}}function tn(t,r){if(t&1&&(m(0,"div",29),f(1,en,3,7,"ng-container",30),c()),t&2){let n=p(2);l(),s("ngForOf",n.jumpBarKeysToRender)}}function nn(t,r){if(t&1){let n=T();S(0),f(1,zi,5,2,"div",5),m(2,"app-metadata-filter",6),x("applyFilter",function(i){v(n);let o=p();return C(o.applyMetadataFilter(i))}),c(),m(3,"div",7)(4,"div",8)(5,"div",9),f(6,Qi,2,1,"p",10),m(7,"virtual-scroller",11,0)(9,"div",12,1),f(11,Wi,2,8,"div",13),c()()()(),f(12,Hi,1,3,"ng-container",14),c(),f(13,Zi,6,5,"ng-template",null,2,D),b(15,"app-loading",15),f(16,tn,2,1,"ng-template",null,3,D),F()}if(t&2){let n=I(8),e=p();l(),s("ngIf",e.header!==void 0&&e.header.length>0),l(),s("filterSettings",e.filterSettings)("filterOpen",e.filterOpen),l(),s("ngClass",E(13,$t,e.items.length===0&&!e.isLoading)),l(3),s("ngIf",e.items.length===0&&!e.isLoading),l(),s("ngClass",E(15,$t,e.items.length===0&&!e.isLoading))("items",e.items)("bufferAmount",e.bufferAmount)("parentScroll",e.parentScroll),l(4),s("ngForOf",n.viewPortItems)("ngForTrackBy",e.trackByIdentity),l(),s("ngIf",e.jumpBarKeysToRender.length>=4&&e.items.length>0&&n.viewPortInfo.maxScrollPosition>0),l(3),s("loading",e.isLoading)}}var rn=0,oo=(()=>{let r=class r{constructor(e){this.document=e,this.filterUtilityService=y(Ce),this.utilityService=y(he),this.cdRef=y(K),this.jumpbarService=y(It),this.router=y(at),this.scrollService=y(bt),this.header="",this.isLoading=!1,this.items=[],this.filteringDisabled=!1,this.actions=[],this.jumpBarKeys=[],this.jumpBarKeysToRender=[],this.itemClicked=new P,this.applyFilter=new P,this.filter=this.filterUtilityService.createSeriesV2Filter(),this.libraries=[],this.updateApplied=0,this.hasResumedJumpKey=!1,this.bufferAmount=1,this.Breakpoint=Z}resizeJumpBar(){let e=(this.document.querySelector(".viewport-container")?.getBoundingClientRect().height||10)-30;this.jumpBarKeysToRender=this.jumpbarService.generateJumpBar(this.jumpBarKeys,e),this.cdRef.markForCheck()}ngOnInit(){this.trackByIdentity===void 0&&(this.trackByIdentity=(e,i)=>`${this.header}_${this.updateApplied}_${i?.libraryId}`),this.filterSettings===void 0&&(this.filterSettings=new xe,this.cdRef.markForCheck()),this.pagination===void 0&&(this.pagination={currentPage:1,itemsPerPage:this.items.length,totalItems:this.items.length,totalPages:1},this.cdRef.markForCheck()),this.refresh&&this.refresh.subscribe(()=>{this.cdRef.markForCheck(),this.virtualScroller.refresh()})}ngOnChanges(){if(this.jumpBarKeysToRender=[...this.jumpBarKeys],this.resizeJumpBar(),!this.hasCustomSort()&&!this.hasResumedJumpKey&&this.jumpBarKeysToRender.length>0){let e=this.jumpbarService.getResumeKey(this.router.url);if(e==="")return;let i=this.jumpBarKeysToRender.filter(o=>o.key===e);if(i.length<1)return;this.hasResumedJumpKey=!0,setTimeout(()=>this.scrollTo(i[0]),100)}}hasCustomSort(){return this.filteringDisabled?!1:this.filter?.sortOptions?.sortField!=k.SortName||!this.filter?.sortOptions.isAscending||this.filterSettings?.presetsV2?.sortOptions?.sortField!=k.SortName||!this.filterSettings?.presetsV2?.sortOptions?.isAscending}performAction(e){typeof e.callback=="function"&&e.callback(e,void 0)}applyMetadataFilter(e){this.applyFilter.emit(e),this.updateApplied++,this.filter=e.filterV2,this.cdRef.markForCheck()}scrollTo(e){if(this.hasCustomSort())return;let i=0;for(let o=0;o<this.jumpBarKeys.length&&this.jumpBarKeys[o].key!==e.key;o++)i+=this.jumpBarKeys[o].size;this.virtualScroller.scrollToIndex(i,!0,0,rn),this.jumpbarService.saveResumeKey(this.router.url,e.key),this.jumpbarService.saveScrollOffset(this.router.url,this.scrollService.scrollPosition),this.cdRef.markForCheck()}tryToSaveJumpKey(e){let i="";e.hasOwnProperty("name")?i=e.name:e.hasOwnProperty("title")&&(i=e.title),this.jumpbarService.saveResumeKey(this.router.url,i.charAt(0))}};r.\u0275fac=function(i){return new(i||r)(N(it))},r.\u0275cmp=q({type:r,selectors:[["app-card-detail-layout"]],contentQueries:function(i,o,_){if(i&1&&(ye(_,Li,5),ye(_,Gi,5)),i&2){let g;Y(g=X())&&(o.itemTemplate=g.first),Y(g=X())&&(o.noDataTemplate=g.first)}},viewQuery:function(i,o){if(i&1&&(Ge($i,5),Ge(De,5)),i&2){let _;Y(_=X())&&(o.jumpBar=_.first),Y(_=X())&&(o.virtualScroller=_.first)}},hostBindings:function(i,o){i&1&&x("resize",function(g){return o.resizeJumpBar(g)},!1,Be)("orientationchange",function(g){return o.resizeJumpBar(g)},!1,Be)},inputs:{header:"header",isLoading:"isLoading",items:"items",pagination:"pagination",parentScroll:"parentScroll",filterOpen:"filterOpen",filteringDisabled:"filteringDisabled",actions:"actions",trackByIdentity:"trackByIdentity",filterSettings:"filterSettings",refresh:"refresh",jumpBarKeys:"jumpBarKeys"},outputs:{itemClicked:"itemClicked",applyFilter:"applyFilter"},standalone:!0,features:[Ze,J],decls:1,vars:1,consts:[["scroll",""],["container",""],["cardTemplate",""],["jumpBar",""],[4,"transloco","translocoRead"],["class","row mt-2 g-0 pb-2",4,"ngIf"],[3,"applyFilter","filterSettings","filterOpen"],[1,"viewport-container",3,"ngClass"],[1,"content-container"],[1,"card-container","mt-2","mb-2"],[4,"ngIf"],[3,"ngClass","items","bufferAmount","parentScroll"],[1,"grid","row","g-0"],["class","card col-auto mt-2 mb-2",3,"id","click",4,"ngFor","ngForOf","ngForTrackBy"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[3,"loading"],[1,"row","mt-2","g-0","pb-2"],[1,"col","me-auto"],["class","",4,"ngIf"],[1,""],[3,"actionHandler","actions","labelBy"],["class","badge bg-primary rounded-pill",4,"ngIf"],[1,"badge","bg-primary","rounded-pill"],[3,"ngTemplateOutlet"],[1,"card","col-auto","mt-2","mb-2",3,"click","id"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"items","bufferAmount"],["class","mx-auto","style","width: 200px;",4,"ngIf"],[1,"mx-auto",2,"width","200px"],[1,"jump-bar"],[4,"ngFor","ngForOf"],["placement","left",1,"btn","btn-link",3,"click","ngClass","ngbTooltip"]],template:function(i,o){i&1&&f(0,nn,18,17,"ng-container",4),i&2&&s("translocoRead","card-detail-layout")},dependencies:[ot,Ie,z,Q,oe,St,Ct,De,vt,ge,Gt,W],styles:[`.viewport-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;height:calc(var(--vh) * 100 - 173px);margin-bottom:10px}.viewport-container.empty[_ngcontent-%COMP%]{height:auto}.content-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%;margin-bottom:10px}.card-container[_ngcontent-%COMP%]{display:inline-block;width:100%}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,158px);grid-gap:.5rem;justify-content:space-around;width:100%;overflow-y:auto;overflow-x:hidden;align-items:start}@media (max-width: 576px){.grid[_ngcontent-%COMP%]{grid-gap:.3rem}}.jump-bar[_ngcontent-%COMP%]{display:flex;flex-flow:column;flex-shrink:0;font-size:13px;overflow:hidden;padding:0 10px;align-items:center;justify-content:space-around}@media (max-width: 576px){.jump-bar[_ngcontent-%COMP%]{padding:0 10px 0 5px}}.jump-bar[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{color:#ffffffb3;height:25px;text-align:center;padding:0 5px;-webkit-tap-highlight-color:transparent;background:none;border:0;border-radius:0;cursor:pointer;line-height:inherit;margin:0;outline:none;text-align:inherit;text-decoration:none;touch-action:manipulation;transition:color .2s;-webkit-user-select:none;user-select:none}.jump-bar[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{color:var(--primary-color)}.jump-bar[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{font-weight:700}.jump-bar[_ngcontent-%COMP%]   .btn.disabled[_ngcontent-%COMP%]{color:#d3d3d3;cursor:not-allowed}.virtual-scroller[_ngcontent-%COMP%], virtual-scroller[_ngcontent-%COMP%]{width:100%;height:calc(var(--vh) * 100 - 173px)}virtual-scroller.empty[_ngcontent-%COMP%]{display:none}h2[_ngcontent-%COMP%]{display:inline-block;word-break:break-all}
/*# sourceMappingURL=card-detail-layout.component-FVFJSOIL.css.map */`],changeDetection:0});let t=r;return t})();export{It as a,xe as b,oo as c};
//# sourceMappingURL=chunk-7RIKHQP6.js.map
