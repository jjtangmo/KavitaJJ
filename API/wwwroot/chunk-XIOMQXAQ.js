import{a as ue,b as fe}from"./chunk-KUE2MKW5.js";import{a as se,c as le}from"./chunk-STVWBYRJ.js";import{a as pe}from"./chunk-SBPQBTA5.js";import{b as de}from"./chunk-VAE34R3W.js";import{a as me,b as _e}from"./chunk-RLL2TM5C.js";import"./chunk-5CMEBAZF.js";import"./chunk-ZRHV3LXB.js";import{s as ce}from"./chunk-E6ZKMAWP.js";import{$b as U,Ac as z,Bb as _,Dc as C,Ec as h,Fa as u,Ga as f,Gb as V,Ib as g,Jd as A,Na as H,Q as N,Rb as x,Rc as B,Rd as j,S as w,Td as J,Ud as K,Vb as s,Wb as l,Xb as S,Yb as D,Ye as re,Zb as M,_d as Q,be as X,bf as ae,cc as v,ce as Y,dc as a,de as Z,fb as L,fe as ee,hc as R,hd as W,he as te,ic as $,lb as o,me as ie,ne,oc as c,pc as b,qa as y,qc as m,tc as k,uc as F,ud as q,va as E,vc as O,xc as G,zc as P,ze as oe}from"./chunk-2LHIXASS.js";var d=function(e){return e[e.None=0]="None",e[e.Created=1]="Created",e[e.LastModified=2]="LastModified",e[e.Type=3]="Type",e[e.Series=4]="Series",e[e.IsProcessed=5]="IsProcessed",e}(d||{});var ge=e=>({num:e}),ye=(e,n)=>({v:e,n}),Se=e=>({r:e});function ve(e,n){if(e&1){let i=U();s(0,"ngb-pagination",14),O("pageChange",function(r){u(i);let p=a(2);return F(p.pagination.currentPage,r)||(p.pagination.currentPage=r),f(r)}),v("pageChange",function(r){u(i);let p=a(2);return f(p.onPageChange(r))}),l()}if(e&2){let i=a(2);k("page",i.pagination.currentPage),g("pageSize",i.pagination.itemsPerPage)("collectionSize",i.pagination.totalItems)}}function Te(e,n){if(e&1&&(s(0,"tr")(1,"td",15),c(2),l()()),e&2){let i=a().$implicit;o(2),b(i("no-data"))}}function Pe(e,n){if(e&1&&c(0),e&2){let i=a(2).$implicit,t=a().$implicit;m(" ",t("chapter-num",P(1,ge,i.chapterNumber))," ")}}function Ue(e,n){if(e&1&&c(0),e&2){let i=a(2).$implicit,t=a().$implicit;m(" ",t("volume-num",P(1,ge,i.volumeNumber))," ")}}function Ie(e,n){e&1&&c(0," Special ")}function Ne(e,n){if(e&1&&c(0),e&2){let i=a(2).$implicit,t=a().$implicit;m(" ",t("volume-and-chapter-num",z(1,ye,i.volumeNumber,i.chapterNumber))," ")}}function we(e,n){if(e&1&&_(0,Pe,1,3)(1,Ue,1,3)(2,Ie,1,0)(3,Ne,1,4),e&2){let i=a().$implicit,t=a(2);x(0,i.volumeNumber===t.LooseLeafOrDefaultNumber?0:i.chapterNumber===t.LooseLeafOrDefaultNumber?1:i.chapterNumber===t.LooseLeafOrDefaultNumber&&i.volumeNumber===t.SpecialVolumeNumber?2:3)}}function Ee(e,n){if(e&1&&c(0),e&2){let i=a().$implicit,t=a().$implicit;m(" ",t("rating",P(1,Se,i.rating))," ")}}function He(e,n){if(e&1&&c(0),e&2){let i=a(2).$implicit;m(" ",i("not-applicable")," ")}}function Le(e,n){e&1&&S(0,"i",18)}function Ve(e,n){if(e&1&&S(0,"i",20),e&2){let i=a().$implicit;g("ngbTooltip",i.errorDetails)}}function De(e,n){e&1&&S(0,"i",21)}function Me(e,n){if(e&1&&(s(0,"tr")(1,"td"),c(2),C(3,"utcToLocalTime"),C(4,"defaultValue"),l(),s(5,"td"),c(6),C(7,"utcToLocalTime"),C(8,"defaultValue"),l(),s(9,"td"),c(10),C(11,"scrobbleEventType"),l(),s(12,"td",16)(13,"a",17),c(14),l()(),s(15,"td"),_(16,we,4,1)(17,Ee,1,3)(18,He,1,1),l(),s(19,"td"),_(20,Le,1,0,"i",18)(21,Ve,1,1)(22,De,1,0),s(23,"span",19),c(24),l()()()),e&2){let i,t=n.$implicit,r=n.index,p=a().$implicit,T=a();o(2),m(" ",h(4,16,h(3,14,t.createdUtc))," "),o(4),m(" ",h(8,20,h(7,18,t.lastModifiedUtc))," "),o(4),m(" ",h(11,22,t.scrobbleEventType)," "),o(2),R("id","scrobble-history--",r,""),o(),$("href","/library/",t.libraryId,"/series/",t.seriesId,"",L),o(),b(t.seriesName),o(2),x(16,(i=t.scrobbleEventType)===T.ScrobbleEventType.ChapterRead?16:i===T.ScrobbleEventType.ScoreUpdated?17:18),o(4),x(20,t.isProcessed?20:t.isErrored?21:22),o(3),V("aria-labelledby","scrobble-history--",r,""),o(),m(" ",t.isProcessed?p("processed"):p("not-processed")," ")}}function Re(e,n){if(e&1){let i=U();D(0),s(1,"h5"),c(2),l(),s(3,"p"),c(4),l(),s(5,"div",1)(6,"div",2)(7,"form",3)(8,"div",4)(9,"label",5),c(10),l(),S(11,"input",6),l()()(),s(12,"div",7),_(13,ve,1,3,"ngb-pagination"),l()(),s(14,"table",8)(15,"thead")(16,"tr")(17,"th",9),v("sort",function(r){u(i);let p=a();return f(p.updateSort(r))}),c(18),l(),s(19,"th",10),v("sort",function(r){u(i);let p=a();return f(p.updateSort(r))}),c(20),l(),s(21,"th",11),c(22),l(),s(23,"th",12),v("sort",function(r){u(i);let p=a();return f(p.updateSort(r))}),c(24),l(),s(25,"th",11),c(26),l(),s(27,"th",11),c(28),l()()(),s(29,"tbody"),_(30,Te,3,1,"tr")(31,Me,25,24,"tr",13),l()(),M()}if(e&2){let i=n.$implicit,t=a();o(2),b(i("title")),o(2),b(i("description")),o(3),g("formGroup",t.formGroup),o(3),b(i("filter-label")),o(3),x(13,t.pagination?13:-1),o(5),m(" ",i("created-header")," "),o(2),m(" ",i("last-modified-header")," "),o(2),m(" ",i("type-header")," "),o(2),m(" ",i("series-header")," "),o(2),m(" ",i("data-header")," "),o(2),m(" ",i("is-processed-header")," "),o(2),x(30,t.events.length===0?30:-1),o(),g("ngForOf",t.events)}}var ct=(()=>{let n=class n{constructor(){this.scrobblingService=y(_e),this.cdRef=y(B),this.destroyRef=y(H),this.toastr=y(ce),this.ScrobbleEventType=ue,this.events=[],this.formGroup=new Z({filter:new ee("",[])}),this.SpecialVolumeNumber=1e5,this.LooseLeafOrDefaultNumber=-1e5}ngOnInit(){this.loadPage({column:"createdUtc",direction:"desc"}),this.scrobblingService.hasTokenExpired(me.AniList).subscribe(t=>{t&&this.toastr.error(j("toasts.anilist-token-expired")),this.cdRef.markForCheck()}),this.formGroup.get("filter")?.valueChanges.pipe(N(200),A(this.destroyRef)).subscribe(t=>{this.loadPage()})}onPageChange(t){let r=0;this.pagination&&(r=this.pagination.currentPage,this.pagination.currentPage=t),r!==t&&this.loadPage()}updateSort(t){this.loadPage(t)}loadPage(t){t&&this.pagination&&(this.pagination.currentPage=1,this.cdRef.markForCheck());let r=this.pagination?.currentPage||0,p=this.pagination?.itemsPerPage||0,T=t?.direction==="desc",xe=this.mapSortColumnField(t?.column),be=this.formGroup.get("filter")?.value;this.scrobblingService.getScrobbleEvents({query:be,field:xe,isDescending:T},r,p).pipe(w(1)).subscribe(I=>{this.events=I.result,this.pagination=I.pagination,this.cdRef.markForCheck()})}mapSortColumnField(t){switch(t){case"createdUtc":return d.Created;case"isProcessed":return d.IsProcessed;case"lastModifiedUtc":return d.LastModified;case"seriesName":return d.Series}return d.None}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=E({type:n,selectors:[["app-user-scrobble-history"]],standalone:!0,features:[G],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"row","g-0","mb-2"],[1,"col-md-10"],[3,"formGroup"],[1,"form-group","pe-1"],["for","filter"],["id","filter","type","text","formControlName","filter","autocomplete","off",1,"form-control"],[1,"col-md-2","mt-4"],[1,"table","table-striped","table-hover","table-sm","scrollable"],["scope","col","sortable","createdUtc",3,"sort"],["scope","col","sortable","lastModifiedUtc","direction","desc",3,"sort"],["scope","col"],["scope","col","sortable","seriesName",3,"sort"],[4,"ngFor","ngForOf"],[3,"pageChange","page","pageSize","collectionSize"],["colspan","6"],[3,"id"],["target","_blank",3,"href"],["aria-hidden","true",1,"fa-solid","fa-check-circle","icon"],[1,"visually-hidden"],["aria-hidden","true",1,"fa-solid","fa-circle-exclamation","icon","error",3,"ngbTooltip"],["aria-hidden","true",1,"fa-regular","fa-circle","icon"]],template:function(r,p){r&1&&_(0,Re,32,13,"ng-container",0),r&2&&g("translocoRead","user-scrobble-history")},dependencies:[q,W,fe,re,oe,te,Q,X,Y,ie,ne,de,K,J,se,le,pe,ae],styles:[`.icon[_ngcontent-%COMP%]{color:var(--primary-color)}.error[_ngcontent-%COMP%]{color:var(--error-color)}
/*# sourceMappingURL=user-scrobble-history.component-2F2UW23U.css.map */`],changeDetection:0});let e=n;return e})();export{ct as UserScrobbleHistoryComponent};
//# sourceMappingURL=chunk-XIOMQXAQ.js.map
