import{a as de,b as Pt,c as _e}from"./chunk-7RIKHQP6.js";import"./chunk-G6W3CHAT.js";import{a as Dt}from"./chunk-TXAP7OV7.js";import"./chunk-FEVPSYU2.js";import{a as me}from"./chunk-5JNCF2FD.js";import"./chunk-DATLIK2Y.js";import"./chunk-C2T36BOI.js";import{g as Rt}from"./chunk-CASH644A.js";import{a as Tt,b as ce,i as Et}from"./chunk-GGQU56QW.js";import{a as wt}from"./chunk-V7YNUPX5.js";import{b as pe}from"./chunk-U42B4V5B.js";import{b as bt,c as yt,g as ae}from"./chunk-CIDLU7ZZ.js";import{a as le}from"./chunk-FVF23ION.js";import{a as v,b as re,c as W,g as It,m as Ft}from"./chunk-ZTKUYOP3.js";import"./chunk-2JQ3KAM5.js";import"./chunk-5TIUG6K2.js";import"./chunk-IYLIANWB.js";import"./chunk-63UKDQJP.js";import{b as xt}from"./chunk-COKVODYN.js";import{a as kt}from"./chunk-K6JLHPZK.js";import{a as j}from"./chunk-SEAKSSGD.js";import"./chunk-KWNQHRPC.js";import"./chunk-STVWBYRJ.js";import"./chunk-SBPQBTA5.js";import"./chunk-23B3ZJIN.js";import{a as At}from"./chunk-YK7KIY5R.js";import"./chunk-WBO5KV4A.js";import{a as ke,b as se}from"./chunk-LAUBKCQL.js";import{a as ft}from"./chunk-46CIW37K.js";import"./chunk-76TOP2FJ.js";import"./chunk-4XR5JJUF.js";import{a as St}from"./chunk-DBXQZVFZ.js";import"./chunk-5XQ66AVT.js";import{a as q}from"./chunk-RLL2TM5C.js";import"./chunk-CNATNHH2.js";import{a as vt,d as K,e as Ct,f as oe}from"./chunk-5CMEBAZF.js";import"./chunk-ZRHV3LXB.js";import"./chunk-SBTJKJNK.js";import{c as Qe,e as te,j as xe,k as Je,o as ut,q as $}from"./chunk-SPNNO5LP.js";import{d as ee,s as H}from"./chunk-E6ZKMAWP.js";import{$b as x,$d as Ze,Bb as g,Dc as z,Ec as be,F as he,Fa as u,Fb as Be,Fc as $e,Ga as f,Gc as k,Ib as p,Jd as T,Kb as Ne,Na as B,Nb as ue,Pa as J,Pe as ct,Q,Qe as ne,Rb as I,Rc as U,Rd as w,S as Fe,Sd as ie,Se as st,Tb as Me,Td as O,U as Ae,Ub as Le,Ue as mt,Vb as m,Ve as pt,Wb as c,We as dt,Xb as b,Xe as _t,Yb as A,Ye as gt,Zb as R,Zd as Xe,_b as Ue,_c as Ke,_d as Ye,be as et,bf as ht,ca as Re,cc as S,ce as tt,dc as a,de as ye,fa as De,fb as Pe,fe as P,g as Ie,gc as Oe,ge as it,hc as fe,he as nt,ib as N,id as je,kc as ve,lb as r,lc as Ce,mb as Ve,mc as Se,md as We,me as ot,nc as G,nd as Ge,ne as rt,oc as _,od as ze,pc as C,qa as s,qc as D,rc as He,sd as qe,tc as X,u as we,uc as Y,va as V,vc as Z,xc as M,ye as lt,z as Ee,zc as L,ze as at}from"./chunk-2LHIXASS.js";var Lt=(n,l)=>l.id,Ut=n=>({collectionName:n});function Ot(n,l){if(n&1&&(m(0,"div"),_(1),c()),n&2){let i=a(3).$implicit;r(),C(i("required-field"))}}function Ht(n,l){if(n&1&&(m(0,"div"),_(1),c()),n&2){let i=a(3).$implicit;r(),C(i("name-validation"))}}function $t(n,l){if(n&1&&(m(0,"div",19),g(1,Ot,2,1,"div")(2,Ht,2,1,"div"),c()),n&2){let i,t,e=a(3);r(),I(1,!((i=e.collectionTagForm.get("title"))==null||i.errors==null)&&i.errors.required?1:-1),r(),I(2,!((t=e.collectionTagForm.get("title"))==null||t.errors==null)&&t.errors.duplicateName?2:-1)}}function Kt(n,l){if(n&1&&_(0),n&2){let i=a(2).$implicit;C(i("promote-tooltip"))}}function jt(n,l){if(n&1&&(m(0,"form",14)(1,"div",15)(2,"div",16)(3,"label",17),_(4),c(),b(5,"input",18),g(6,$t,3,2,"div",19),c(),m(7,"div",20)(8,"div",21),b(9,"input",22),m(10,"label",23),_(11),c(),b(12,"i",24),g(13,Kt,1,1,"ng-template",null,1,k),m(15,"span",25),Ue(16,26),c()()()(),m(17,"div",15)(18,"label",27),_(19),c(),b(20,"textarea",28),c()()),n&2){let i,t=G(14),e=a().$implicit,o=a();p("formGroup",o.collectionTagForm),r(4),C(e("name-label")),r(),Ne("is-invalid",((i=o.collectionTagForm.get("title"))==null?null:i.invalid)&&((i=o.collectionTagForm.get("title"))==null?null:i.touched)),r(),I(6,o.collectionTagForm.dirty||o.collectionTagForm.touched?6:-1),r(5),C(e("promote-label")),r(),p("ngbTooltip",t),r(4),p("ngTemplateOutlet",t),r(3),C(e("summary-label"))}}function Wt(n,l){if(n&1){let i=x();m(0,"li",37)(1,"div",34)(2,"input",39),S("change",function(){let e=u(i).$implicit,o=a(4);return f(o.handleSelection(e))}),c(),m(3,"label",40),_(4),c()()()}if(n&2){let i=l.$implicit,t=l.$index,e=a(4);r(2),fe("id","series-",t,""),p("disabled",e.tag.source!==e.ScrobbleProvider.Kavita)("ngModel",e.selections.isSelected(i)),r(),fe("for","series-",t,""),r(),He("",i.name," (",e.libraryName(i.libraryId),")")}}function Gt(n,l){if(n&1){let i=x();m(0,"div",38)(1,"ngb-pagination",41),Z("pageChange",function(e){u(i);let o=a(4);return Y(o.pagination.currentPage,e)||(o.pagination.currentPage=e),f(e)}),S("pageChange",function(e){u(i);let o=a(4);return f(o.onPageChange(e))}),c()()}if(n&2){let i=a(4);r(),X("page",i.pagination.currentPage),p("pageSize",i.pagination.itemsPerPage)("rotate",!1)("ellipses",!1)("boundaryLinks",!0)("collectionSize",i.pagination.totalItems)}}function zt(n,l){if(n&1){let i=x();m(0,"div",29)(1,"form",14)(2,"div",15)(3,"div",30)(4,"label",31),_(5),c(),m(6,"div",32),b(7,"input",33),c()()()(),m(8,"div",34)(9,"input",35),S("change",function(){u(i);let e=a(3);return f(e.toggleAll())}),c(),m(10,"label",36),_(11),c()(),m(12,"ul"),Me(13,Wt,5,8,"li",37,Lt),z(15,"filter"),c(),g(16,Gt,2,6,"div",38),c()}if(n&2){let i=a(2).$implicit,t=a();r(),p("formGroup",t.formGroup),r(4),C(i("filter-label")),r(2),p("placeholder",i("filter-label")),r(2),p("disabled",t.tag.source!==t.ScrobbleProvider.Kavita)("ngModel",t.selectAll)("indeterminate",t.hasSomeSelected),r(2),C(t.selectAll?i("deselect-all"):i("select-all")),r(2),Le($e(15,8,t.series,t.filterList)),r(3),I(16,t.pagination&&t.series.length!==0&&t.pagination.totalPages>1?16:-1)}}function qt(n,l){if(n&1&&g(0,zt,17,11,"div",29),n&2){let i=a(2);I(0,i.isLoading?-1:0)}}function Qt(n,l){if(n&1){let i=x();m(0,"app-cover-image-chooser",42),Z("imageUrlsChange",function(e){u(i);let o=a(2);return Y(o.imageUrls,e)||(o.imageUrls=e),f(e)}),S("imageSelected",function(e){u(i);let o=a(2);return f(o.updateSelectedIndex(e))})("selectedBase64Url",function(e){u(i);let o=a(2);return f(o.updateSelectedImage(e))})("resetClicked",function(){u(i);let e=a(2);return f(e.handleReset())}),c()}if(n&2){let i=a(2);X("imageUrls",i.imageUrls),p("showReset",i.tag.coverImageLocked)}}function Jt(n,l){if(n&1){let i=x();A(0),m(1,"div",3)(2,"h4",4),_(3),c(),m(4,"button",5),S("click",function(){u(i);let e=a();return f(e.close())}),c()(),m(5,"div")(6,"ul",6,0),Z("activeIdChange",function(e){u(i);let o=a();return Y(o.active,e)||(o.active=e),f(e)}),m(8,"li",7)(9,"a",8),_(10),c(),g(11,jt,21,9,"ng-template",9),c(),m(12,"li",7)(13,"a",8),_(14),c(),g(15,qt,1,1,"ng-template",9),c(),m(16,"li",7)(17,"a",8),_(18),c(),g(19,Qt,1,2,"ng-template",9),c()(),b(20,"div",10),c(),m(21,"div",11)(22,"button",12),S("click",function(){u(i);let e=a();return f(e.close())}),_(23),c(),m(24,"button",13),S("click",function(){u(i);let e=a();return f(e.save())}),_(25),c()(),R()}if(n&2){let i=l.$implicit,t=G(7),e=a();r(3),C(i("title",L(20,Ut,e.tag.title))),r(),Be("aria-label",i("close")),r(),ue("modal-body scrollable-modal ",e.utilityService.getActiveBreakpoint()===e.Breakpoint.Mobile?"":"d-flex",""),r(),Oe("orientation",e.utilityService.getActiveBreakpoint()===e.Breakpoint.Mobile?"horizontal":"vertical"),X("activeId",e.active),r(2),p("ngbNavItem",e.TabID.General),r(2),C(i(e.TabID.General)),r(2),p("ngbNavItem",e.TabID.Series),r(2),C(i(e.TabID.Series)),r(2),p("ngbNavItem",e.TabID.CoverImage),r(2),C(i(e.TabID.CoverImage)),r(2),ue("tab-content ",e.utilityService.getActiveBreakpoint()===e.Breakpoint.Mobile?"mt-3":"ms-4 flex-fill",""),p("ngbNavOutlet",t),r(3),C(i("cancel")),r(),p("disabled",e.collectionTagForm.invalid),r(),C(i("save"))}}var Te=function(n){return n.General="general-tab",n.CoverImage="cover-image-tab",n.Series="series-tab",n}(Te||{}),ge=(()=>{let l=class l{constructor(){this.modal=s(ct),this.utilityService=s(oe),this.destroyRef=s(B),this.seriesService=s(le),this.collectionService=s(W),this.toastr=s(H),this.confirmService=s(ut),this.libraryService=s(kt),this.imageService=s(j),this.uploadService=s(bt),this.cdRef=s(U),this.accountService=s($),this.Breakpoint=Ct,this.TabID=Te,this.ScrobbleProvider=q,this.series=[],this.isLoading=!0,this.selectAll=!0,this.active=Te.General,this.imageUrls=[],this.selectedCover="",this.formGroup=new ye({filter:new P("",[])}),this.filterList=t=>{let e=(this.formGroup.get("filter")?.value||"").toLowerCase();return t.name.toLowerCase().indexOf(e)>=0||t.localizedName.toLowerCase().indexOf(e)>=0}}get hasSomeSelected(){return this.selections!=null&&this.selections.hasSomeSelected()}ngOnInit(){this.pagination==null&&(this.pagination={totalPages:1,totalItems:200,itemsPerPage:200,currentPage:0}),this.collectionTagForm=new ye({title:new P(this.tag.title,{nonNullable:!0,validators:[Ze.required]}),summary:new P(this.tag.summary,{nonNullable:!0,validators:[]}),coverImageLocked:new P(this.tag.coverImageLocked,{nonNullable:!0,validators:[]}),coverImageIndex:new P(0,{nonNullable:!0,validators:[]}),promoted:new P(this.tag.promoted,{nonNullable:!0,validators:[]})}),this.tag.source!==q.Kavita&&(this.collectionTagForm.get("title")?.disable(),this.collectionTagForm.get("summary")?.disable()),this.accountService.currentUser$.pipe(T(this.destroyRef)).subscribe(t=>{t&&(this.accountService.hasPromoteRole(t)||(this.collectionTagForm.get("promoted")?.disable(),this.cdRef.markForCheck()))}),this.collectionTagForm.get("title")?.valueChanges.pipe(Q(100),Ae(),Re(t=>this.collectionService.tagNameExists(t)),De(t=>{let e=this.collectionTagForm.get("title")?.value===this.tag.title;!t||e?this.collectionTagForm.get("title")?.setErrors(null):this.collectionTagForm.get("title")?.setErrors({duplicateName:!0}),this.cdRef.markForCheck()}),T(this.destroyRef)).subscribe(),this.imageUrls.push(this.imageService.randomize(this.imageService.getCollectionCoverImage(this.tag.id))),this.loadSeries()}onPageChange(t){this.pagination.currentPage=t,this.loadSeries()}toggleAll(){this.selectAll=!this.selectAll,this.series.forEach(t=>this.selections.toggle(t,this.selectAll)),this.cdRef.markForCheck()}loadSeries(){he([this.seriesService.getSeriesForTag(this.tag.id,this.pagination.currentPage,this.pagination.itemsPerPage),this.libraryService.getLibraryNames()]).subscribe(t=>{let e=t[0];this.pagination=e.pagination,this.series=e.result,this.imageUrls.push(...this.series.map(o=>this.imageService.getSeriesCoverImage(o.id))),this.selections=new It(!0,this.series),this.isLoading=!1,this.libraryNames=t[1],this.cdRef.markForCheck()})}handleSelection(t){this.selections.toggle(t);let e=this.selections.selected().length;e==0?this.selectAll=!1:e==this.series.length&&(this.selectAll=!0),this.cdRef.markForCheck()}libraryName(t){return this.libraryNames[t]}close(){this.modal.dismiss()}save(){return Ie(this,null,function*(){let t=this.collectionTagForm.get("coverImageIndex")?.value||0,e=this.selections.unselected().map(E=>E.id),o=this.collectionTagForm.value;if(o.id=this.tag.id,o.title=this.collectionTagForm.get("title").value,o.summary=this.collectionTagForm.get("summary").value,e.length==this.series.length&&!(yield this.confirmService.confirm(w("toasts.no-series-collection-warning"))))return;let d=[this.collectionService.updateTag(o)],h=this.selections.unselected().map(E=>E.id);h.length>0&&d.push(this.collectionService.updateSeriesForTag(o,h)),t>0&&d.push(this.uploadService.updateCollectionCoverImage(this.tag.id,this.selectedCover)),he(d).subscribe(()=>{this.modal.close({success:!0,coverImageUpdated:t>0}),this.toastr.success(w("toasts.collection-updated"))})})}updateSelectedIndex(t){this.collectionTagForm.patchValue({coverImageIndex:t})}updateSelectedImage(t){this.selectedCover=t,this.cdRef.markForCheck()}handleReset(){this.collectionTagForm.patchValue({coverImageLocked:!1}),this.cdRef.markForCheck()}};l.\u0275fac=function(e){return new(e||l)},l.\u0275cmp=V({type:l,selectors:[["app-edit-collection-tags"]],inputs:{tag:"tag"},standalone:!0,features:[M],decls:1,vars:1,consts:[["nav","ngbNav"],["promotedTooltip",""],[4,"transloco","translocoRead"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button",1,"btn-close",3,"click"],["ngbNav","",1,"nav-pills",2,"min-width","135px",3,"activeIdChange","activeId","orientation"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[3,"formGroup"],[1,"row","g-0","mb-3"],[1,"col-md-8","col-sm-12"],["for","library-name",1,"form-label"],["id","library-name","formControlName","title","type","text",1,"form-control"],["id","inviteForm-validations",1,"invalid-feedback"],[1,"col-md-3","col-sm-12","ms-2"],[1,"form-check","form-switch"],["type","checkbox","id","tag-promoted","role","switch","formControlName","promoted","aria-labelledby","auto-close-label","aria-describedby","tag-promoted-help",1,"form-check-input"],["for","tag-promoted",1,"form-check-label","me-1"],["aria-hidden","true","placement","left","role","button","tabindex","0",1,"fa","fa-info-circle",3,"ngbTooltip"],["id","tag-promoted-help",1,"visually-hidden"],[3,"ngTemplateOutlet"],["for","summary",1,"form-label"],["id","summary","formControlName","summary","rows","3",1,"form-control"],[1,"list-group"],[1,"col-md-12"],["for","filter",1,"visually-hidden"],[1,"input-group"],["id","filter","type","text","formControlName","filter",1,"form-control",3,"placeholder"],[1,"form-check"],["id","select-all","type","checkbox",1,"form-check-input",3,"change","disabled","ngModel","indeterminate"],["for","select-all",1,"form-check-label"],[1,"list-group-item"],[1,"d-flex","justify-content-center"],["type","checkbox",1,"form-check-input",3,"change","id","disabled","ngModel"],[1,"form-check-label",3,"for"],[3,"pageChange","page","pageSize","rotate","ellipses","boundaryLinks","collectionSize"],[3,"imageUrlsChange","imageSelected","selectedBase64Url","resetClicked","imageUrls","showReset"]],template:function(e,o){e&1&&g(0,Jt,26,22,"ng-container",2),e&2&&p("translocoRead","edit-collection-tags")},dependencies:[pt,mt,dt,st,at,nt,Ye,Xe,et,tt,ot,rt,lt,it,gt,yt,_t,ht,O,Ge,St],styles:[`.form-switch[_ngcontent-%COMP%]{margin-top:2.4rem}
/*# sourceMappingURL=edit-collection-tags.component-CZAXB5OO.css.map */`],changeDetection:0});let n=l;return n})();var Xt=n=>({num:n});function Yt(n,l){if(n&1&&b(0,"app-collection-owner",9),n&2){let i=a().$implicit;p("collection",i)}}function Zt(n,l){if(n&1){let i=x();m(0,"app-card-item",8),S("clicked",function(){let e=u(i).$implicit,o=a(2);return f(o.loadCollection(e))})("selection",function(e){let o=u(i).idx,d=a(2);return f(d.bulkSelectionService.handleCardSelection("collection",o,d.collections.length,e))}),g(1,Yt,1,1,"ng-template",null,2,k),c()}if(n&2){let i=l.$implicit,t=l.idx,e=a(2);p("title",i.title)("entity",i)("actions",e.collectionTagActions)("imageUrl",e.imageService.getCollectionCoverImage(i.id))("selected",e.bulkSelectionService.isCardSelected("collection",t))("allowSelection",!0)}}function ei(n,l){if(n&1&&(_(0),m(1,"a",11),_(2),b(3,"i",12),c()),n&2){let i=a(2).$implicit,t=a();D(" ",i("create-one-part-1")," "),r(),p("href",t.WikiLink.Collections,Pe),r(),C(i("create-one-part-2"))}}function ti(n,l){if(n&1&&(_(0),g(1,ei,4,3,"a",10),z(2,"async")),n&2){let i=a().$implicit,t=a();D(" ",i("no-data")," "),r(),I(1,be(2,2,t.isAdmin$)?1:-1)}}function ii(n,l){if(n&1){let i=x();A(0),m(1,"app-side-nav-companion-bar",4),S("filterOpen",function(e){u(i);let o=a();return f(o.filterOpen.emit(e))}),m(2,"h2",5),_(3),c(),m(4,"h6",2),_(5),z(6,"number"),c()(),b(7,"app-bulk-operations",6),m(8,"app-card-detail-layout",7),g(9,Zt,3,6,"ng-template",null,0,k)(11,ti,3,4,"ng-template",null,1,k),c(),R()}if(n&2){let i=l.$implicit,t=a();r(),p("hasFilter",!1),r(2),C(i("title")),r(2),C(i("item-count",L(11,Xt,be(6,9,t.collections.length)))),r(2),p("actionCallback",t.bulkActionCallback),r(),p("isLoading",t.isLoading)("items",t.collections)("filterOpen",t.filterOpen)("jumpBarKeys",t.jumpbarKeys)("trackByIdentity",t.trackByIdentity)}}var Bt=(()=>{let l=class l{handleKeypress(t){t.key===K.SHIFT&&(this.bulkSelectionService.isShiftDown=!0)}handleKeyUp(t){t.key===K.SHIFT&&(this.bulkSelectionService.isShiftDown=!1)}constructor(){this.destroyRef=s(B),this.translocoService=s(ie),this.toastr=s(H),this.collectionService=s(W),this.router=s(te),this.actionFactoryService=s(re),this.modalService=s(ne),this.titleService=s(ee),this.jumpbarService=s(de),this.cdRef=s(U),this.imageService=s(j),this.accountService=s($),this.bulkSelectionService=s(ce),this.actionService=s(ae),this.ScrobbleProvider=q,this.WikiLink=ft,this.isLoading=!0,this.collections=[],this.collectionTagActions=[],this.jumpbarKeys=[],this.isAdmin$=we(!1),this.filterOpen=new J,this.trackByIdentity=(t,e)=>`${e.id}_${e.title}_${e.owner}_${e.promoted}`,this.bulkActionCallback=(t,e)=>{let o=this.bulkSelectionService.getSelectedCardsForSource("collection"),d=this.collections.filter((h,E)=>o.includes(E+""));switch(t.action){case v.Promote:this.actionService.promoteMultipleCollections(d,!0,h=>{h&&(this.bulkSelectionService.deselectAll(),this.loadPage())});break;case v.UnPromote:this.actionService.promoteMultipleCollections(d,!1,h=>{h&&(this.bulkSelectionService.deselectAll(),this.loadPage())});break;case v.Delete:this.actionService.deleteMultipleCollections(d,h=>{h&&(this.loadPage(),this.bulkSelectionService.deselectAll())});break}},this.router.routeReuseStrategy.shouldReuseRoute=()=>!1,this.titleService.setTitle("Kavita - "+this.translocoService.translate("all-collections.title")),this.accountService.currentUser$.pipe(T(this.destroyRef)).subscribe(t=>{t&&(this.user=t,this.cdRef.markForCheck())})}ngOnInit(){this.loadPage(),this.accountService.currentUser$.pipe(T(this.destroyRef)).subscribe(t=>{t&&(this.collectionTagActions=this.actionFactoryService.getCollectionTagActions(this.handleCollectionActionCallback.bind(this)).filter(e=>this.collectionService.actionListFilter(e,t)),this.cdRef.markForCheck())}),this.isAdmin$=this.accountService.currentUser$.pipe(T(this.destroyRef),Ee(t=>t?this.accountService.hasAdminRole(t):!1))}loadCollection(t){this.router.navigate(["collections",t.id])}loadPage(){this.isLoading=!0,this.cdRef.markForCheck(),this.collectionService.allCollections().subscribe(t=>{this.collections=[...t],this.isLoading=!1,this.jumpbarKeys=this.jumpbarService.getJumpKeys(t,e=>e.title),this.cdRef.markForCheck()})}handleCollectionActionCallback(t,e){if(e.owner!=this.user.username){this.toastr.error(w("toasts.collection-not-owned"));return}switch(t.action){case v.Promote:this.collectionService.promoteMultipleCollections([e.id],!0).subscribe(d=>this.loadPage());break;case v.UnPromote:this.collectionService.promoteMultipleCollections([e.id],!1).subscribe(d=>this.loadPage());break;case v.Delete:this.collectionService.deleteTag(e.id).subscribe(d=>{this.loadPage(),this.toastr.success(d)});break;case v.Edit:let o=this.modalService.open(ge,{size:"lg",scrollable:!0});o.componentInstance.tag=e,o.closed.subscribe(d=>{d.success&&this.loadPage()});break;default:break}}};l.\u0275fac=function(e){return new(e||l)},l.\u0275cmp=V({type:l,selectors:[["app-all-collections"]],hostBindings:function(e,o){e&1&&S("keydown.shift",function(h){return o.handleKeypress(h)},!1,N)("keyup.shift",function(h){return o.handleKeyUp(h)},!1,N)},standalone:!0,features:[M],decls:1,vars:1,consts:[["cardItem",""],["noData",""],["subtitle",""],[4,"transloco","translocoRead"],[3,"filterOpen","hasFilter"],["title",""],[3,"actionCallback"],[3,"isLoading","items","filterOpen","jumpBarKeys","trackByIdentity"],[3,"clicked","selection","title","entity","actions","imageUrl","selected","allowSelection"],[3,"collection"],["rel","noopener noreferrer","target","_blank"],["rel","noopener noreferrer","target","_blank",3,"href"],["aria-hidden","true",1,"fa","fa-external-link-alt","ms-1"]],template:function(e,o){e&1&&g(0,ii,13,13,"ng-container",3),e&2&&p("translocoRead","all-collections")},dependencies:[pe,_e,Et,ze,qe,O,Dt,me],styles:["/*# sourceMappingURL=all-collections.component-DVJ6ZQ7X.css.map */"],changeDetection:0});let n=l;return n})();var ni=["scrollingBlock"],oi=["companionBar"],ri=n=>({height:n});function li(n,l){n&1&&(m(0,"span",12),_(1,"("),b(2,"i",13),_(3,")"),c())}function ai(n,l){if(n&1){let i=x();m(0,"h2")(1,"app-card-actionables",10),S("actionHandler",function(e){u(i);let o=a(3);return f(o.performAction(e))}),c(),_(2),g(3,li,4,0,"span",11),c()}if(n&2){let i=a(3);r(),p("disabled",i.actionInProgress)("actions",i.collectionTagActions)("labelBy",i.collectionTag.title),r(),D(" ",i.collectionTag.title,""),r(),p("ngIf",i.collectionTag.promoted)}}function ci(n,l){if(n&1){let i=x();m(0,"app-side-nav-companion-bar",7),S("filterOpen",function(e){u(i);let o=a(2);return f(o.filterOpen.emit(e))}),A(1,8),g(2,ai,4,5,"h2",9),R(),c()}if(n&2){let i=a(2);p("hasFilter",!0)("filterActive",i.filterActive),r(2),p("ngIf",i.collectionTag!==void 0)}}function si(n,l){if(n&1&&(m(0,"div",18)(1,"div",19),b(2,"app-image",20),c(),m(3,"div",21),b(4,"app-read-more",22),c(),b(5,"hr"),c()),n&2){let i=a(3);r(2),p("imageUrl",i.imageService.getCollectionCoverImage(i.collectionTag.id)),r(2),p("text",i.summary)("maxLength",250)}}function mi(n,l){if(n&1){let i=x();m(0,"app-series-card",24),S("reload",function(){u(i);let e=a(4);return f(e.loadPage())})("selection",function(e){let o=u(i).idx,d=a(4);return f(d.bulkSelectionService.handleCardSelection("series",o,d.series.length,e))}),c()}if(n&2){let i=l.$implicit,t=l.idx,e=a(4);p("data",i)("libraryId",i.libraryId)("selected",e.bulkSelectionService.isCardSelected("series",t))("allowSelection",!0)}}function pi(n,l){if(n&1&&_(0),n&2){let i=a(4).$implicit;D(" ",i("no-data")," ")}}function di(n,l){n&1&&(m(0,"div"),g(1,pi,1,1,"ng-template",null,3,k),c())}function _i(n,l){if(n&1&&_(0),n&2){let i=a(4).$implicit;D(" ",i("no-data-filtered")," ")}}function gi(n,l){n&1&&(m(0,"div"),g(1,_i,1,1,"ng-template",null,3,k),c())}function hi(n,l){if(n&1){let i=x();m(0,"app-card-detail-layout",23),S("applyFilter",function(e){u(i);let o=a(3);return f(o.updateFilter(e))}),g(1,mi,1,4,"ng-template",null,2,k)(3,di,3,0,"div",9)(4,gi,3,0,"div",9),c()}if(n&2){a();let i=G(1),t=a().$implicit,e=a();p("header",t("series-header"))("isLoading",e.isLoading)("items",e.series)("pagination",e.pagination)("filterSettings",e.filterSettings)("filterOpen",e.filterOpen)("parentScroll",i)("trackByIdentity",e.trackByIdentity)("jumpBarKeys",e.jumpbarKeys),r(3),p("ngIf",!e.filterActive&&e.series.length===0),r(),p("ngIf",e.filterActive&&e.series.length===0)}}function ui(n,l){if(n&1&&(m(0,"div",14,1),g(2,si,6,3,"div",15),b(3,"app-bulk-operations",16),g(4,hi,5,11,"app-card-detail-layout",17),c()),n&2){let i=a(2);p("ngStyle",L(4,ri,i.ScrollingBlockHeight)),r(2),p("ngIf",i.summary.length>0),r(),p("actionCallback",i.bulkActionCallback),r(),p("ngIf",i.filter)}}function fi(n,l){if(n&1&&(A(0),m(1,"div",null,0),g(3,ci,3,3,"app-side-nav-companion-bar",5),c(),g(4,ui,5,6,"div",6),R()),n&2){let i=a();r(3),p("ngIf",i.series!==void 0),r(),p("ngIf",i.collectionTag!==void 0)}}var Nt=(()=>{let l=class l{get ScrollingBlockHeight(){if(this.scrollingBlock===void 0)return"calc(var(--vh)*100)";let t=this.document.querySelector(".navbar");if(t===null)return"calc(var(--vh)*100)";let e=this.companionBar.nativeElement.offsetHeight,o=t.offsetHeight;return"calc(var(--vh)*100 - "+(e+o+21)+"px)"}constructor(t){this.document=t,this.imageService=s(j),this.bulkSelectionService=s(ce),this.destroyRef=s(B),this.translocoService=s(ie),this.collectionService=s(W),this.router=s(te),this.route=s(Qe),this.seriesService=s(le),this.toastr=s(H),this.actionFactoryService=s(re),this.accountService=s($),this.modalService=s(ne),this.titleService=s(ee),this.jumpbarService=s(de),this.actionService=s(ae),this.messageHub=s(Je),this.filterUtilityService=s(Ft),this.utilityService=s(oe),this.cdRef=s(U),this.scrollService=s(wt),this.isLoading=!0,this.series=[],this.pagination=new vt,this.collectionTagActions=[],this.filter=void 0,this.filterSettings=new Pt,this.summary="",this.actionInProgress=!1,this.filterActive=!1,this.jumpbarKeys=[],this.filterOpen=new J,this.trackByIdentity=(d,h)=>`${h.name}_${h.localizedName}_${h.pagesRead}`,this.bulkActionCallback=(d,h)=>{let E=this.bulkSelectionService.getSelectedCardsForSource("series"),F=this.series.filter((y,Mt)=>E.includes(Mt+""));switch(d.action){case v.AddToReadingList:this.actionService.addMultipleSeriesToReadingList(F,y=>{y&&this.bulkSelectionService.deselectAll(),this.cdRef.markForCheck()});break;case v.AddToWantToReadList:this.actionService.addMultipleSeriesToWantToReadList(F.map(y=>y.id),()=>{this.bulkSelectionService.deselectAll(),this.cdRef.markForCheck()});break;case v.RemoveFromWantToReadList:this.actionService.removeMultipleSeriesFromWantToReadList(F.map(y=>y.id),()=>{this.bulkSelectionService.deselectAll(),this.cdRef.markForCheck()});break;case v.AddToCollection:this.actionService.addMultipleSeriesToCollectionTag(F,y=>{y&&this.bulkSelectionService.deselectAll(),this.cdRef.markForCheck()});break;case v.MarkAsRead:this.actionService.markMultipleSeriesAsRead(F,()=>{this.bulkSelectionService.deselectAll(),this.loadPage(),this.cdRef.markForCheck()});break;case v.MarkAsUnread:this.actionService.markMultipleSeriesAsUnread(F,()=>{this.bulkSelectionService.deselectAll(),this.loadPage(),this.cdRef.markForCheck()});break;case v.Delete:this.actionService.deleteMultipleSeries(F,y=>{y&&(this.bulkSelectionService.deselectAll(),this.loadPage(),this.cdRef.markForCheck())});break}},this.router.routeReuseStrategy.shouldReuseRoute=()=>!1;let e=this.route.snapshot.paramMap.get("id");if(e===null){this.router.navigate(["collections"]);return}let o=parseInt(e,10);this.filterUtilityService.filterPresetsFromUrl(this.route.snapshot).subscribe(d=>{this.filter=d,this.filter.statements.filter(h=>h.field===se.CollectionTags).length===0&&this.filter.statements.push({field:se.CollectionTags,value:o+"",comparison:ke.Equal}),this.filterActiveCheck=this.filterUtilityService.createSeriesV2Filter(),this.filterActiveCheck.statements.push({field:se.CollectionTags,value:o+"",comparison:ke.Equal}),this.filterSettings.presetsV2=this.filter,this.cdRef.markForCheck(),this.updateTag(o)})}ngOnInit(){this.accountService.currentUser$.pipe(T(this.destroyRef)).subscribe(t=>{t&&(this.user=t,this.collectionTagActions=this.actionFactoryService.getCollectionTagActions(this.handleCollectionActionCallback.bind(this)).filter(e=>this.collectionService.actionListFilter(e,t)),this.cdRef.markForCheck())}),this.messageHub.messages$.pipe(T(this.destroyRef),Q(2e3)).subscribe(t=>{t.event==xe.SeriesAddedToCollection?t.payload.tagId===this.collectionTag.id&&this.loadPage():t.event===xe.SeriesRemoved&&this.loadPage()})}ngAfterContentChecked(){this.scrollService.setScrollContainer(this.scrollingBlock)}handleKeypress(t){t.key===K.SHIFT&&(this.bulkSelectionService.isShiftDown=!0)}handleKeyUp(t){t.key===K.SHIFT&&(this.bulkSelectionService.isShiftDown=!1)}updateTag(t){this.collectionService.allCollections().subscribe(e=>{let o=e.filter(d=>d.id===t);if(o.length===0){this.toastr.error(this.translocoService.translate("errors.collection-invalid-access")),this.router.navigateByUrl("/");return}this.collectionTag=o[0],this.summary=(this.collectionTag.summary===null?"":this.collectionTag.summary).replace(/\n/g,"<br>"),this.titleService.setTitle(this.translocoService.translate("collection-detail.title-alt",{collectionName:this.collectionTag.title})),this.cdRef.markForCheck()})}loadPage(){this.filterActive=!this.utilityService.deepEqual(this.filter,this.filterActiveCheck),this.isLoading=!0,this.cdRef.markForCheck(),this.seriesService.getAllSeriesV2(void 0,void 0,this.filter).pipe(Fe(1)).subscribe(t=>{this.series=t.result,this.pagination=t.pagination,this.jumpbarKeys=this.jumpbarService.getJumpKeys(this.series,e=>e.name),this.isLoading=!1,this.cdRef.markForCheck()})}updateFilter(t){if(t.filterV2!==void 0){if(this.filter=t.filterV2,t.isFirst){this.loadPage();return}this.filterUtilityService.updateUrlFromFilter(this.filter).subscribe(e=>{this.loadPage()})}}handleCollectionActionCallback(t,e){if(e.owner!=this.user.username){this.toastr.error(w("toasts.collection-not-owned"));return}switch(t.action){case v.Promote:this.collectionService.promoteMultipleCollections([this.collectionTag.id],!0).subscribe();break;case v.UnPromote:this.collectionService.promoteMultipleCollections([this.collectionTag.id],!1).subscribe();break;case v.Edit:this.openEditCollectionTagModal(this.collectionTag);break;case v.Delete:this.collectionService.deleteTag(this.collectionTag.id).subscribe(()=>{this.toastr.success(w("toasts.collection-tag-deleted")),this.router.navigateByUrl("collections")});break;default:break}}performAction(t){typeof t.callback=="function"&&t.callback(t,this.collectionTag)}openEditCollectionTagModal(t){let e=this.modalService.open(ge,{size:"lg",scrollable:!0});e.componentInstance.tag=this.collectionTag,e.closed.subscribe(o=>{this.updateTag(this.collectionTag.id),this.loadPage()})}};l.\u0275fac=function(e){return new(e||l)(Ve(Ke))},l.\u0275cmp=V({type:l,selectors:[["app-collection-detail"]],viewQuery:function(e,o){if(e&1&&(ve(ni,5),ve(oi,5)),e&2){let d;Ce(d=Se())&&(o.scrollingBlock=d.first),Ce(d=Se())&&(o.companionBar=d.first)}},hostBindings:function(e,o){e&1&&S("keydown.shift",function(h){return o.handleKeypress(h)},!1,N)("keyup.shift",function(h){return o.handleKeyUp(h)},!1,N)},standalone:!0,features:[M],decls:1,vars:1,consts:[["companionBar",""],["scrollingBlock",""],["cardItem",""],["noData",""],[4,"transloco","translocoRead"],[3,"hasFilter","filterActive","filterOpen",4,"ngIf"],["class","main-container container-fluid pt-2",3,"ngStyle",4,"ngIf"],[3,"filterOpen","hasFilter","filterActive"],["title",""],[4,"ngIf"],["iconClass","fa-ellipsis-v",3,"actionHandler","disabled","actions","labelBy"],["class","ms-1",4,"ngIf"],[1,"ms-1"],["aria-hidden","true",1,"fa","fa-angle-double-up"],[1,"main-container","container-fluid","pt-2",3,"ngStyle"],["class","row mb-3",4,"ngIf"],[3,"actionCallback"],[3,"header","isLoading","items","pagination","filterSettings","filterOpen","parentScroll","trackByIdentity","jumpBarKeys","applyFilter",4,"ngIf"],[1,"row","mb-3"],[1,"col-md-2","col-xs-4","col-sm-6","d-none","d-sm-block"],["maxWidth","481px",3,"imageUrl"],[1,"col-md-10","col-xs-8","col-sm-6","mt-2"],[3,"text","maxLength"],[3,"applyFilter","header","isLoading","items","pagination","filterSettings","filterOpen","parentScroll","trackByIdentity","jumpBarKeys"],[3,"reload","selection","data","libraryId","selected","allowSelection"]],template:function(e,o){e&1&&g(0,fi,5,2,"ng-container",4),e&2&&p("translocoRead","collection-detail")},dependencies:[je,pe,Tt,We,xt,At,me,_e,Rt,O],styles:[`.poster[_ngcontent-%COMP%]{width:100%;max-width:300px}@media (max-width: var(--grid-breakpoints-sm)){.poster[_ngcontent-%COMP%]{display:none}}@media (max-width: var(--grid-breakpoints-sm)){.read-btn--text[_ngcontent-%COMP%]{display:none}}.card-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,158px);grid-gap:.5rem;justify-content:space-around}.virtual-scroller[_ngcontent-%COMP%], virtual-scroller[_ngcontent-%COMP%]{width:100%;height:calc(100vh - 85px);max-height:calc(var(--vh) * 100 - 170px)}.main-container[_ngcontent-%COMP%]{overflow-y:auto;position:relative;overscroll-behavior-y:none}h2[_ngcontent-%COMP%]{margin-bottom:0;word-break:break-all}
/*# sourceMappingURL=collection-detail.component-B4WIW5XC.css.map */`],changeDetection:0});let n=l;return n})();var go=[{path:"",component:Bt,pathMatch:"full"},{path:":id",component:Nt}];export{go as routes};
//# sourceMappingURL=chunk-KSGHIAYS.js.map
