import{a as st}from"./chunk-FVF23ION.js";import{c as Mt,d as F,f as Pi,h as Nt,i as Bi}from"./chunk-ZTKUYOP3.js";import{a as Mi}from"./chunk-2JQ3KAM5.js";import{c as Ri}from"./chunk-5TIUG6K2.js";import{a as Ti}from"./chunk-IYLIANWB.js";import{a as Ui,c as Ai}from"./chunk-63UKDQJP.js";import{b as Rt,c as Di}from"./chunk-COKVODYN.js";import{a as Le}from"./chunk-K6JLHPZK.js";import{a as Te}from"./chunk-SEAKSSGD.js";import{a as Vi}from"./chunk-KWNQHRPC.js";import{a as Oi,b as Wi}from"./chunk-STVWBYRJ.js";import{a as $i}from"./chunk-SBPQBTA5.js";import{a as Li}from"./chunk-23B3ZJIN.js";import{h as Ni}from"./chunk-LAUBKCQL.js";import{a as ot}from"./chunk-46CIW37K.js";import{k as Fi}from"./chunk-76TOP2FJ.js";import{a as Ft}from"./chunk-DBXQZVFZ.js";import{b as Ei,c as fe,d as $t,e as lt,f as Ee}from"./chunk-5CMEBAZF.js";import{a as Vt}from"./chunk-SBTJKJNK.js";import{o as Tt,q as Lt}from"./chunk-SPNNO5LP.js";import{s as _e}from"./chunk-E6ZKMAWP.js";import{$b as T,$d as B,Ae as fi,Bb as h,Bd as mi,Be as vi,Ce as xi,Dc as M,Dd as Ye,De as Ci,Ec as D,Ee as bi,F as qe,Fa as _,Fb as ee,Fc as Ne,Fe as yi,G as Ht,Ga as u,Gc as w,Ge as Si,H as Jt,Hd as Ze,Ib as p,Id as he,J as Xt,Jd as Z,Kb as se,L as Kt,Na as Se,Nb as te,O as ei,Pa as Q,Pe as Ce,Q as Me,Qe as wt,Rb as Ie,Rc as ce,Rd as I,Re as Et,S as L,Sb as li,Sd as He,Se as et,Tb as ft,Td as H,Te as Ii,U as Fe,Ub as vt,Ud as $e,Ue as tt,Vb as l,Ve as it,Wb as s,We as nt,Xb as y,Xe as rt,Yb as U,Zb as A,Zd as St,_b as ye,_c as ci,_d as re,a as Qt,b as Yt,be as J,bf as at,ca as ze,cc as f,ce as ae,cf as ki,dc as c,de as we,df as wi,ea as ti,fa as ve,fb as Ae,fe as E,g as ie,gc as ke,gd as Ct,ge as pi,hc as Be,hd as xe,he as oe,id as ne,ie as It,jc as si,ka as Ue,kc as Oe,la as ii,lb as a,lc as Re,le as _i,m as ut,mb as O,mc as Ve,me,nc as $,nd as We,ne as pe,o as Zt,ob as ht,oc as d,od as bt,oe as Je,pa as K,pc as g,pd as di,pe as Xe,qa as k,qc as x,qe as Ke,rc as G,rd as yt,sb as ai,tb as oi,tc as R,u as ge,uc as V,ud as de,ue as ui,va as j,vc as N,ve as gi,wa as ni,xa as ri,xc as Y,xe as kt,y as Wt,ya as Qe,yc as xt,ye as hi,z,zc as q,ze as X}from"./chunk-2LHIXASS.js";var Pt=(()=>{let o=class o{constructor(e,t){this.httpClient=e,this.utilityService=t,this.baseUrl=Ze.apiUrl}getReadingList(e){return this.httpClient.get(this.baseUrl+"readinglist?readingListId="+e)}getReadingLists(e=!0,t=!1,r,m){let v=new mi;return v=this.utilityService.addPaginationIfExists(v,r,m),this.httpClient.post(this.baseUrl+"readinglist/lists?includePromoted="+e+"&sortByLastModified="+t,{},{observe:"response",params:v}).pipe(z(C=>this.utilityService.createPaginatedResult(C,new Ei)))}getReadingListsForSeries(e){return this.httpClient.get(this.baseUrl+"readinglist/lists-for-series?seriesId="+e)}getListItems(e){return this.httpClient.get(this.baseUrl+"readinglist/items?readingListId="+e)}createList(e){return this.httpClient.post(this.baseUrl+"readinglist/create",{title:e})}update(e){return this.httpClient.post(this.baseUrl+"readinglist/update",e,he)}updateByMultiple(e,t,r,m){return this.httpClient.post(this.baseUrl+"readinglist/update-by-multiple",{readingListId:e,seriesId:t,volumeIds:r,chapterIds:m},he)}updateByMultipleSeries(e,t){return this.httpClient.post(this.baseUrl+"readinglist/update-by-multiple-series",{readingListId:e,seriesIds:t},he)}updateBySeries(e,t){return this.httpClient.post(this.baseUrl+"readinglist/update-by-series",{readingListId:e,seriesId:t},he)}updateByVolume(e,t,r){return this.httpClient.post(this.baseUrl+"readinglist/update-by-volume",{readingListId:e,seriesId:t,volumeId:r},he)}updateByChapter(e,t,r){return this.httpClient.post(this.baseUrl+"readinglist/update-by-chapter",{readingListId:e,seriesId:t,chapterId:r},he)}delete(e){return this.httpClient.delete(this.baseUrl+"readinglist?readingListId="+e,he)}updatePosition(e,t,r,m){return this.httpClient.post(this.baseUrl+"readinglist/update-position",{readingListId:e,readingListItemId:t,fromPosition:r,toPosition:m},he)}deleteItem(e,t){return this.httpClient.post(this.baseUrl+"readinglist/delete-item",{readingListId:e,readingListItemId:t},he)}removeRead(e){return this.httpClient.post(this.baseUrl+"readinglist/remove-read?readingListId="+e,{},he)}actionListFilter(e,t,r){return!(t?.promoted&&!r)}nameExists(e){return this.httpClient.get(this.baseUrl+"readinglist/name-exists?name="+e)}validateCbl(e){return this.httpClient.post(this.baseUrl+"cbl/validate",e)}importCbl(e){return this.httpClient.post(this.baseUrl+"cbl/import",e)}getCharacters(e){return this.httpClient.get(this.baseUrl+"readinglist/characters?readingListId="+e)}};o.\u0275fac=function(t){return new(t||o)(K(Ye),K(Ee))},o.\u0275prov=Ue({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var dn=["title"],mn=(i,o)=>o.title;function pn(i,o){if(i&1){let n=T();l(0,"div",7)(1,"label",19),d(2),s(),l(3,"div",20),y(4,"input",21),l(5,"button",22),f("click",function(){let t;_(n);let r=c(2);return u((t=r.listForm.get("filterQuery"))==null?null:t.setValue(""))}),d(6,"Clear"),s()()()}if(i&2){let n=c().$implicit;a(2),g(n("filter-label"))}}function _n(i,o){if(i&1&&y(0,"i",25),i&2){let n=c(2).$implicit;p("title",n("promoted"))}}function un(i,o){if(i&1){let n=T();l(0,"li",23),f("click",function(){let t=_(n).$implicit,r=c(2);return u(r.addToCollection(t))}),d(1),h(2,_n,1,1,"i",24),s()}if(i&2){let n=o.$implicit;a(),x(" ",n.title," "),a(),Ie(2,n.promoted?2:-1)}}function gn(i,o){if(i&1&&(l(0,"li",10),d(1),s()),i&2){let n=c().$implicit;a(),g(n("no-data"))}}function hn(i,o){if(i&1&&(l(0,"li",10)(1,"div",26)(2,"span",27),d(3),s()()()),i&2){let n=c().$implicit;a(3),g(n("loading"))}}function fn(i,o){if(i&1){let n=T();U(0),l(1,"div",2)(2,"h4",3),d(3),s(),l(4,"button",4),f("click",function(){_(n);let t=c();return u(t.close())}),s()(),l(5,"form",5)(6,"div",6),h(7,pn,7,1,"div",7),l(8,"ul",8),ft(9,un,3,2,"li",9,mn),M(11,"filter"),h(12,gn,2,1,"li",10)(13,hn,4,1,"li",10),s()(),l(14,"div",11)(15,"div",12)(16,"div",13)(17,"div",14)(18,"label",15),d(19),s(),y(20,"input",16,0),s(),l(22,"div",17)(23,"button",18),f("click",function(){_(n);let t=c();return u(t.create())}),d(24),s()()()()()(),A()}if(i&2){let n=o.$implicit,e=c();a(3),g(n("title")),a(),ee("aria-label",n("close")),a(),p("formGroup",e.listForm),a(2),Ie(7,e.lists.length>=5?7:-1),a(2),vt(Ne(11,9,e.lists,e.filterList)),a(3),Ie(12,e.lists.length===0&&!e.loading?12:-1),a(),Ie(13,e.loading?13:-1),a(6),g(n("collection-label")),a(4),p("disabled",e.isCreating),a(),g(n("create"))}}var qi=(()=>{let o=class o{constructor(){this.modal=k(Ce),this.collectionService=k(Mt),this.toastr=k(_e),this.cdRef=k(ce),this.seriesIds=[],this.lists=[],this.loading=!1,this.isCreating=!1,this.listForm=new we({}),this.filterList=e=>e.title.toLowerCase().indexOf((this.listForm.value.filterQuery||"").toLowerCase())>=0}ngOnInit(){this.listForm.addControl("title",new E(this.title,[])),this.listForm.addControl("filterQuery",new E("",[])),this.loading=!0,this.cdRef.markForCheck(),this.collectionService.allCollections(!0).subscribe(e=>{this.lists=e,this.loading=!1,this.cdRef.markForCheck()})}ngAfterViewInit(){this.inputElem&&(this.inputElem.nativeElement.select(),this.cdRef.markForCheck())}close(){this.modal.close()}create(){if(this.isCreating)return;let e=this.listForm.value.title;this.isCreating=!0,this.cdRef.markForCheck(),this.collectionService.addByMultiple(0,this.seriesIds,e).subscribe(()=>{this.toastr.success(I("toasts.series-added-to-collection",{collectionName:e})),this.isCreating=!1,this.modal.close()})}addToCollection(e){this.seriesIds.length!==0&&this.collectionService.addByMultiple(e.id,this.seriesIds,"").subscribe(()=>{this.toastr.success(I("toasts.series-added-to-collection",{collectionName:e.title})),this.modal.close()})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=j({type:o,selectors:[["app-bulk-add-to-collection"]],viewQuery:function(t,r){if(t&1&&Oe(dn,5),t&2){let m;Re(m=Ve())&&(r.inputElem=m.first)}},inputs:{title:"title",seriesIds:"seriesIds"},standalone:!0,features:[Y],decls:1,vars:1,consts:[["title",""],[4,"transloco","translocoRead"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button",1,"btn-close",3,"click"],[2,"width","100%",3,"formGroup"],[1,"modal-body"],[1,"mb-3"],[1,"list-group"],["tabindex","0","role","option",1,"list-group-item","clickable"],[1,"list-group-item"],[1,"modal-footer",2,"justify-content","normal"],[2,"width","100%"],[1,"d-flex"],[1,"col-9","col-lg-10"],["for","add-rlist",1,"form-label","visually-hidden"],["width","100%","ngbAutofocus","","type","text","id","add-rlist","formControlName","title",1,"form-control","mb-2"],[1,"col-2"],["type","submit",1,"btn","btn-primary",3,"click","disabled"],["for","filter",1,"form-label"],[1,"input-group"],["id","filter","autocomplete","off","formControlName","filterQuery","type","text","aria-describedby","reset-input",1,"form-control"],["type","button","id","reset-input",1,"btn","btn-outline-secondary",3,"click"],["tabindex","0","role","option",1,"list-group-item","clickable",3,"click"],[1,"fa","fa-angle-double-up"],[1,"fa","fa-angle-double-up",3,"title"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(t,r){t&1&&h(0,fn,25,12,"ng-container",1),t&2&&p("translocoRead","bulk-add-to-collection")},dependencies:[de,X,oe,re,J,ae,me,pe,Ft,Et,H],styles:[`.clickable:hover,.clickable:focus{background-color:#90ee90}.collection{overflow:auto}.collection .modal-body{max-height:calc(100vh - 235px);min-height:150px}.collection .modal-body .list-group{overflow:auto;max-height:calc(100vh - 355px);min-height:32px}
/*# sourceMappingURL=bulk-add-to-collection.component-F2ZHNINB.css.map */
`],encapsulation:2,changeDetection:0});let i=o;return i})();var vn=["title"];function xn(i,o){if(i&1){let n=T();l(0,"div",19)(1,"label",20),d(2),s(),l(3,"div",21),y(4,"input",22),l(5,"button",23),f("click",function(){let t;_(n);let r=c(2);return u((t=r.listForm.get("filterQuery"))==null?null:t.setValue(""))}),d(6,"Clear"),s()()()}if(i&2){let n=c().$implicit;a(2),g(n("filter-label"))}}function Cn(i,o){if(i&1&&y(0,"i",26),i&2){let n=c(2).$implicit;p("title",n("promoted-alt"))}}function bn(i,o){if(i&1){let n=T();l(0,"li",24),f("click",function(){let t=_(n).$implicit,r=c(2);return u(r.addToList(t))}),d(1),h(2,Cn,1,1,"i",25),s()}if(i&2){let n=o.$implicit;a(),x(" ",n.title," "),a(),p("ngIf",n.promoted)}}function yn(i,o){if(i&1&&(l(0,"li",27),d(1),s()),i&2){let n=c().$implicit;a(),g(n("no-data"))}}function Sn(i,o){if(i&1&&(l(0,"li",27)(1,"div",28)(2,"span",29),d(3),s()()()),i&2){let n=c().$implicit;a(3),g(n("loading"))}}function In(i,o){if(i&1){let n=T();U(0),l(1,"div",2)(2,"h4",3),d(3),s(),l(4,"button",4),f("click",function(){_(n);let t=c();return u(t.close())}),s()(),l(5,"form",5)(6,"div",6),h(7,xn,7,1,"div",7),l(8,"ul",8),h(9,bn,3,2,"li",9),M(10,"filter"),h(11,yn,2,1,"li",10)(12,Sn,4,1,"li",10),s()(),l(13,"div",11)(14,"div",12)(15,"div",13)(16,"div",14)(17,"label",15),d(18),s(),y(19,"input",16,0),s(),l(21,"div",17)(22,"button",18),f("click",function(){_(n);let t=c();return u(t.create())}),d(23),s()()()()()(),A()}if(i&2){let n=o.$implicit,e=c();a(3),g(n("title")),a(),ee("aria-label",n("close")),a(),p("formGroup",e.listForm),a(2),p("ngIf",e.lists.length>=5),a(2),p("ngForOf",Ne(10,9,e.lists,e.filterList)),a(2),p("ngIf",e.lists.length===0&&!e.loading),a(),p("ngIf",e.loading),a(6),g(n("reading-list-label")),a(5),g(n("create"))}}var be=function(i){return i[i.Series=0]="Series",i[i.Volume=1]="Volume",i[i.Chapter=2]="Chapter",i[i.Multiple=3]="Multiple",i[i.Multiple_Series=4]="Multiple_Series",i}(be||{}),ct=(()=>{let o=class o{constructor(e,t,r){this.modal=e,this.readingListService=t,this.toastr=r,this.lists=[],this.loading=!1,this.listForm=new we({}),this.filterList=m=>m.title.toLowerCase().indexOf((this.listForm.value.filterQuery||"").toLowerCase())>=0,this.translocoService=k(He)}ngOnInit(){this.listForm.addControl("title",new E(this.title,[])),this.listForm.addControl("filterQuery",new E("",[])),this.loading=!0,this.readingListService.getReadingLists(!1,!0).subscribe(e=>{this.lists=e.result,this.loading=!1})}ngAfterViewInit(){this.inputElem&&this.inputElem.nativeElement.select()}close(){this.modal.close()}create(){this.readingListService.createList(this.listForm.value.title).subscribe(e=>{this.addToList(e)})}addToList(e){this.type===be.Multiple_Series&&this.seriesIds!==void 0&&this.readingListService.updateByMultipleSeries(e.id,this.seriesIds).subscribe(()=>{this.toastr.success(this.translocoService.translate("toasts.series-added-to-reading-list")),this.modal.close()}),this.seriesId!==void 0&&(this.type===be.Series&&this.seriesId!==void 0?this.readingListService.updateBySeries(e.id,this.seriesId).subscribe(()=>{this.toastr.success(this.translocoService.translate("toasts.series-added-to-reading-list")),this.modal.close()}):this.type===be.Volume&&this.volumeId!==void 0?this.readingListService.updateByVolume(e.id,this.seriesId,this.volumeId).subscribe(()=>{this.toastr.success(this.translocoService.translate("toasts.volumes-added-to-reading-list")),this.modal.close()}):this.type===be.Chapter&&this.chapterId!==void 0?this.readingListService.updateByChapter(e.id,this.seriesId,this.chapterId).subscribe(()=>{this.toastr.success(this.translocoService.translate("toasts.chapter-added-to-reading-list")),this.modal.close()}):this.type===be.Multiple&&this.volumeIds!==void 0&&this.chapterIds!==void 0&&this.readingListService.updateByMultiple(e.id,this.seriesId,this.volumeIds,this.chapterIds).subscribe(()=>{this.toastr.success(this.translocoService.translate("toasts.multiple-added-to-reading-list")),this.modal.close()}))}};o.\u0275fac=function(t){return new(t||o)(O(Ce),O(Pt),O(_e))},o.\u0275cmp=j({type:o,selectors:[["app-add-to-list-modal"]],viewQuery:function(t,r){if(t&1&&Oe(vn,5),t&2){let m;Re(m=Ve())&&(r.inputElem=m.first)}},inputs:{title:"title",seriesId:"seriesId",volumeId:"volumeId",chapterId:"chapterId",volumeIds:"volumeIds",chapterIds:"chapterIds",seriesIds:"seriesIds",type:"type"},standalone:!0,features:[Y],decls:1,vars:1,consts:[["title",""],[4,"transloco","translocoRead"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button",1,"btn-close",3,"click"],[2,"width","100%",3,"formGroup"],[1,"modal-body","scrollable-modal"],["class","mb-3",4,"ngIf"],[1,"list-group"],["class","list-group-item clickable","tabindex","0","role","option",3,"click",4,"ngFor","ngForOf"],["class","list-group-item",4,"ngIf"],[1,"modal-footer",2,"justify-content","normal"],[2,"width","100%"],[1,"d-flex"],[1,"col-9","col-lg-10"],["for","add-rlist",1,"form-label","visually-hidden"],["width","100%","ngbAutofocus","","type","text","id","add-rlist","formControlName","title",1,"form-control","mb-2"],[1,"col-2","ps-2"],["type","submit",1,"btn","btn-primary",3,"click"],[1,"mb-3"],["for","filter",1,"form-label"],[1,"input-group"],["id","filter","autocomplete","off","formControlName","filterQuery","type","text","aria-describedby","reset-input",1,"form-control"],["type","button","id","reset-input",1,"btn","btn-outline-secondary",3,"click"],["tabindex","0","role","option",1,"list-group-item","clickable",3,"click"],["class","fa fa-angle-double-up",3,"title",4,"ngIf"],[1,"fa","fa-angle-double-up",3,"title"],[1,"list-group-item"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"]],template:function(t,r){t&1&&h(0,In,24,12,"ng-container",1),t&2&&p("translocoRead","add-to-list-modal")},dependencies:[X,oe,re,J,ae,me,pe,ne,xe,Ft,H],styles:[`.clickable[_ngcontent-%COMP%]:hover, .clickable[_ngcontent-%COMP%]:focus{background-color:var(--primary-color)}.scrollable-modal[_ngcontent-%COMP%]{max-height:calc(var(--vh) * 100 - 198px);overflow:auto}
/*# sourceMappingURL=add-to-list-modal.component-SNVCN2P7.css.map */`]});let i=o;return i})();var kn=["fileSelector"],wn=i=>({openFileSelector:i});function En(i,o){if(i&1&&(l(0,"div",8),d(1),s()),i&2){let n=c(2);a(),g(n.dropZoneLabel)}}function Tn(i,o){if(i&1){let n=T();l(0,"div")(1,"input",9),f("click",function(t){_(n);let r=c(2);return u(r.openFileSelector(t))}),s()()}if(i&2){let n=c(2);a(),ke("value",n.browseBtnLabel),p("className",n.browseBtnClassName)}}function Ln(i,o){if(i&1&&h(0,En,2,1,"div",6)(1,Tn,2,2,"div",7),i&2){let n=c();p("ngIf",n.dropZoneLabel),a(),p("ngIf",n.showBrowseBtn)}}function Mn(i,o){}var dt=class{constructor(o,n){this.relativePath=o,this.fileEntry=n}},jt=(()=>{let o=class o{constructor(e){this.template=e}};o.\u0275fac=function(t){return new(t||o)(O(ht))},o.\u0275dir=ri({type:o,selectors:[["","ngx-file-drop-content-tmp",""]]});let i=o;return i})(),qt=(()=>{let o=class o{get disabled(){return this._disabled}set disabled(e){this._disabled=e!=null&&`${e}`!="false"}constructor(e,t){this.zone=e,this.renderer=t,this.accept="*",this.directory=!1,this.multiple=!0,this.dropZoneLabel="",this.dropZoneClassName="ngx-file-drop__drop-zone",this.useDragEnter=!1,this.contentClassName="ngx-file-drop__content",this.showBrowseBtn=!1,this.browseBtnClassName="btn btn-primary btn-xs ngx-file-drop__browse-btn",this.browseBtnLabel="Browse files",this.onFileDrop=new Q,this.onFileOver=new Q,this.onFileLeave=new Q,this.isDraggingOverDropZone=!1,this.globalDraggingInProgress=!1,this.files=[],this.numOfActiveReadEntries=0,this.helperFormEl=null,this.fileInputPlaceholderEl=null,this.dropEventTimerSubscription=null,this._disabled=!1,this.openFileSelector=r=>{this.fileSelector&&this.fileSelector.nativeElement&&this.fileSelector.nativeElement.click()},this.globalDragStartListener=this.renderer.listen("document","dragstart",r=>{this.globalDraggingInProgress=!0}),this.globalDragEndListener=this.renderer.listen("document","dragend",r=>{this.globalDraggingInProgress=!1})}ngOnDestroy(){this.dropEventTimerSubscription&&(this.dropEventTimerSubscription.unsubscribe(),this.dropEventTimerSubscription=null),this.globalDragStartListener(),this.globalDragEndListener(),this.files=[],this.helperFormEl=null,this.fileInputPlaceholderEl=null}onDragOver(e){this.useDragEnter?(this.preventAndStop(e),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")):!this.isDropzoneDisabled()&&!this.useDragEnter&&e.dataTransfer&&(this.isDraggingOverDropZone||(this.isDraggingOverDropZone=!0,this.onFileOver.emit(e)),this.preventAndStop(e),e.dataTransfer.dropEffect="copy")}onDragEnter(e){!this.isDropzoneDisabled()&&this.useDragEnter&&(this.isDraggingOverDropZone||(this.isDraggingOverDropZone=!0,this.onFileOver.emit(e)),this.preventAndStop(e))}onDragLeave(e){this.isDropzoneDisabled()||(this.isDraggingOverDropZone&&(this.isDraggingOverDropZone=!1,this.onFileLeave.emit(e)),this.preventAndStop(e))}dropFiles(e){if(!this.isDropzoneDisabled()&&(this.isDraggingOverDropZone=!1,e.dataTransfer)){let t;e.dataTransfer.items?t=e.dataTransfer.items:t=e.dataTransfer.files,this.preventAndStop(e),this.checkFiles(t)}}uploadFiles(e){if(!this.isDropzoneDisabled()&&e.target){let t=e.target.files||[];this.checkFiles(t),this.resetFileInput()}}getFakeDropEntry(e){let t={name:e.name,isDirectory:!1,isFile:!0,file:r=>r(e)};return new dt(t.name,t)}checkFile(e){if(e){if("webkitGetAsEntry"in e){let t=e.webkitGetAsEntry();if(t){if(t.isFile){let r=new dt(t.name,t);this.addToQueue(r)}else t.isDirectory&&this.traverseFileTree(t,t.name);return}}this.addToQueue(this.getFakeDropEntry(e))}}checkFiles(e){for(let t=0;t<e.length;t++)this.checkFile(e[t]);this.dropEventTimerSubscription&&this.dropEventTimerSubscription.unsubscribe(),this.dropEventTimerSubscription=Jt(200,200).subscribe(()=>{if(this.files.length>0&&this.numOfActiveReadEntries===0){let t=this.files;this.files=[],this.onFileDrop.emit(t)}})}traverseFileTree(e,t){if(e.isFile){let r=new dt(t,e);this.files.push(r)}else{t=t+"/";let r=e.createReader(),m=[],v=()=>{this.numOfActiveReadEntries++,r.readEntries(C=>{if(C.length)m=m.concat(C),v();else if(m.length===0){let W=new dt(t,e);this.zone.run(()=>{this.addToQueue(W)})}else for(let W=0;W<m.length;W++)this.zone.run(()=>{this.traverseFileTree(m[W],t+m[W].name)});this.numOfActiveReadEntries--})};v()}}resetFileInput(){if(this.fileSelector&&this.fileSelector.nativeElement){let e=this.fileSelector.nativeElement,t=e.parentElement,r=this.getHelperFormElement(),m=this.getFileInputPlaceholderElement();t!==r&&(this.renderer.insertBefore(t,m,e),this.renderer.appendChild(r,e),r.reset(),this.renderer.insertBefore(t,e,m),this.renderer.removeChild(t,m))}}getHelperFormElement(){return this.helperFormEl||(this.helperFormEl=this.renderer.createElement("form")),this.helperFormEl}getFileInputPlaceholderElement(){return this.fileInputPlaceholderEl||(this.fileInputPlaceholderEl=this.renderer.createElement("div")),this.fileInputPlaceholderEl}isDropzoneDisabled(){return this.globalDraggingInProgress||this.disabled}addToQueue(e){this.files.push(e)}preventAndStop(e){e.stopPropagation(),e.preventDefault()}};o.\u0275fac=function(t){return new(t||o)(O(oi),O(ai))},o.\u0275cmp=j({type:o,selectors:[["ngx-file-drop"]],contentQueries:function(t,r,m){if(t&1&&si(m,jt,5,ht),t&2){let v;Re(v=Ve())&&(r.contentTemplate=v.first)}},viewQuery:function(t,r){if(t&1&&Oe(kn,7),t&2){let m;Re(m=Ve())&&(r.fileSelector=m.first)}},inputs:{accept:"accept",directory:"directory",multiple:"multiple",dropZoneLabel:"dropZoneLabel",dropZoneClassName:"dropZoneClassName",useDragEnter:"useDragEnter",contentClassName:"contentClassName",showBrowseBtn:"showBrowseBtn",browseBtnClassName:"browseBtnClassName",browseBtnLabel:"browseBtnLabel",disabled:"disabled"},outputs:{onFileDrop:"onFileDrop",onFileOver:"onFileOver",onFileLeave:"onFileLeave"},decls:7,vars:15,consts:[["fileSelector",""],["defaultContentTemplate",""],[3,"drop","dragover","dragenter","dragleave","className"],[3,"className"],["type","file",1,"ngx-file-drop__file-input",3,"change","accept","multiple"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["class","ngx-file-drop__drop-zone-label",4,"ngIf"],[4,"ngIf"],[1,"ngx-file-drop__drop-zone-label"],["type","button",3,"click","className","value"]],template:function(t,r){if(t&1){let m=T();l(0,"div",2),f("drop",function(C){return _(m),u(r.dropFiles(C))})("dragover",function(C){return _(m),u(r.onDragOver(C))})("dragenter",function(C){return _(m),u(r.onDragEnter(C))})("dragleave",function(C){return _(m),u(r.onDragLeave(C))}),l(1,"div",3)(2,"input",4,0),f("change",function(C){return _(m),u(r.uploadFiles(C))}),s(),h(4,Ln,2,2,"ng-template",null,1,w)(6,Mn,0,0,"ng-template",5),s()()}if(t&2){let m=$(5);se("ngx-file-drop__drop-zone--over",r.isDraggingOverDropZone),p("className",r.dropZoneClassName),a(),p("className",r.contentClassName),a(),p("accept",r.accept)("multiple",r.multiple),ee("directory",r.directory||void 0)("webkitdirectory",r.directory||void 0)("mozdirectory",r.directory||void 0)("msdirectory",r.directory||void 0)("odirectory",r.directory||void 0),a(4),p("ngTemplateOutlet",r.contentTemplate||m)("ngTemplateOutletContext",q(13,wn,r.openFileSelector))}},dependencies:[ne,We],styles:[".ngx-file-drop__drop-zone[_ngcontent-%COMP%]{height:100px;margin:auto;border:2px dotted #0782d0;border-radius:30px}.ngx-file-drop__drop-zone--over[_ngcontent-%COMP%]{background-color:#93939380}.ngx-file-drop__content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:100px;color:#0782d0}.ngx-file-drop__drop-zone-label[_ngcontent-%COMP%]{text-align:center}.ngx-file-drop__file-input[_ngcontent-%COMP%]{display:none}"]});let i=o;return i})(),Qi=(()=>{let o=class o{};o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=ni({type:o,bootstrap:[qt]}),o.\u0275inj=ii({imports:[de]});let i=o;return i})();var je=(()=>{let o=class o{constructor(e){this.httpClient=e,this.baseUrl=Ze.apiUrl}uploadByUrl(e){return this.httpClient.post(this.baseUrl+"upload/upload-by-url",{url:e},he)}updateSeriesCoverImage(e,t){return this.httpClient.post(this.baseUrl+"upload/series",{id:e,url:this._cleanBase64Url(t)})}updateCollectionCoverImage(e,t){return this.httpClient.post(this.baseUrl+"upload/collection",{id:e,url:this._cleanBase64Url(t)})}updateReadingListCoverImage(e,t){return this.httpClient.post(this.baseUrl+"upload/reading-list",{id:e,url:this._cleanBase64Url(t)})}updateChapterCoverImage(e,t){return this.httpClient.post(this.baseUrl+"upload/chapter",{id:e,url:this._cleanBase64Url(t)})}updateLibraryCoverImage(e,t){return this.httpClient.post(this.baseUrl+"upload/library",{id:e,url:this._cleanBase64Url(t)})}resetChapterCoverLock(e){return this.httpClient.post(this.baseUrl+"upload/reset-chapter-lock",{id:e,url:""})}_cleanBase64Url(e){return e.startsWith("data")&&(e=e.split(",")[1]),e}};o.\u0275fac=function(t){return new(t||o)(K(Ye))},o.\u0275prov=Ue({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var Vn=()=>({url:""}),Yi=i=>({selected:i}),Nn=i=>({num:i});function Pn(i,o){if(i&1){let n=T();l(0,"div",10)(1,"div",11)(2,"div",12),y(3,"i",13),s(),l(4,"div",14)(5,"div",15)(6,"a",16),f("click",function(){_(n);let t=c(3);return u(t.changeMode("url"))}),l(7,"span",17),d(8),s(),d(9),s(),l(10,"span",18),d(11,"\u2022"),s(),l(12,"span",19),d(13),s(),l(14,"span",18),d(15,"\u2022"),s(),l(16,"a",16),f("click",function(){_(n);let t=c().openFileSelector;return u(t())}),d(17),l(18,"span",17),d(19),s()()()()()()}if(i&2){let n=c(2).$implicit;a(8),g(n("enter-an-url-pre-title",xt(5,Vn))),a(),x("",n("url")," "),a(4),g(n("drag-n-drop")),a(4),g(n("upload")),a(2),x(" ",n("upload-continued"),"")}}function Dn(i,o){if(i&1){let n=T();U(0),l(1,"div",20)(2,"div",21)(3,"label",22),d(4),s(),y(5,"input",23),l(6,"button",24),f("click",function(){_(n);let t=c(3);return t.loadImageFromUrl(),u(t.mode="all")}),d(7),s()(),l(8,"button",25),f("click",function(){_(n);let t=c(3);return u(t.mode="all")}),y(9,"i",26),d(10,"\xA0 "),l(11,"span",17),d(12),s()()(),A()}if(i&2){let n,e=c(2).$implicit,t=c();a(4),g(e("url-label")),a(2),p("disabled",((n=t.form.get("coverImageUrl"))==null?null:n.value.length)===0),a(),x(" ",e("load")," "),a(5),g(e("back"))}}function Un(i,o){if(i&1&&h(0,Pn,20,6,"div",8)(1,Dn,13,4,"ng-container",9),i&2){let n=c(2);p("ngIf",n.mode==="all"),a(),p("ngIf",n.mode==="url")}}function An(i,o){}function Bn(i,o){if(i&1){let n=T();U(0),y(1,"br"),l(2,"button",29),f("click",function(){_(n);let t=c(3);return u(t.resetImage())}),d(3),s(),A()}if(i&2){let n=c(2).$implicit;a(3),g(n("reset"))}}function On(i,o){if(i&1){let n=T();l(0,"div",27),f("click",function(){_(n);let t=c(2);return u(t.reset())}),y(1,"app-image",28),h(2,Bn,4,1,"ng-container",9),s()}if(i&2){let n=c().$implicit,e=c();p("ngClass",q(4,Yi,!e.showApplyButton&&e.selectedIndex===-1)),a(),p("title",n("reset-cover-tooltip"))("imageUrl",e.imageService.resetCoverImage),a(),p("ngIf",e.showApplyButton)}}function Wn(i,o){if(i&1){let n=T();U(0),y(1,"br"),l(2,"button",31),f("click",function(){_(n);let t=c().index,r=c(2);return u(r.applyImage(t))}),d(3),s(),A()}if(i&2){let n=c().index,e=c().$implicit,t=c();a(3),x(" ",t.appliedIndex===n?e("applied"):e("apply")," ")}}function $n(i,o){if(i&1){let n=T();l(0,"div",27),f("click",function(){let t=_(n).index,r=c(2);return u(r.selectImage(t))}),y(1,"app-image",30),h(2,Wn,4,1,"ng-container",9),s()}if(i&2){let n=o.$implicit,e=o.index,t=c().$implicit,r=c();p("ngClass",q(5,Yi,!r.showApplyButton&&r.selectedIndex===e)),ee("aria-label",t("image-num",q(7,Nn,e+1))),a(),p("imageUrl",n)("processEvents",e>0),a(),p("ngIf",r.showApplyButton)}}function Gn(i,o){if(i&1){let n=T();U(0),l(1,"div",1)(2,"form",2)(3,"ngx-file-drop",3),f("onFileDrop",function(t){_(n);let r=c();return u(r.dropped(t))})("onFileOver",function(t){_(n);let r=c();return u(r.fileOver(t))})("onFileLeave",function(t){_(n);let r=c();return u(r.fileLeave(t))}),h(4,Un,2,2,"ng-template",4),s(),h(5,An,0,0,"ng-template"),s(),l(6,"div",5),h(7,On,3,6,"div",6)(8,$n,3,9,"div",7),s()(),A()}if(i&2){let n=c();a(2),p("formGroup",n.form),a(),p("accept",n.acceptableExtensions)("directory",!1),a(4),p("ngIf",n.showReset),a(),p("ngForOf",n.imageUrls)}}var mt=(()=>{let o=class o{constructor(e){this.document=e,this.cdRef=k(ce),this.imageService=k(Te),this.fb=k(kt),this.toastr=k(_e),this.uploadService=k(je),this.showApplyButton=!1,this.applyCover=new Q,this.resetCover=new Q,this.imageUrls=[],this.imageUrlsChange=new Q,this.showReset=!1,this.resetClicked=new Q,this.imageSelected=new Q,this.selectedBase64Url=new Q,this.selectedIndex=0,this.appliedIndex=0,this.files=[],this.acceptableExtensions=[".png",".jpg",".jpeg",".gif",".webp",".avif"].join(","),this.mode="all"}ngOnInit(){this.form=this.fb.group({coverImageUrl:new E("",[])}),this.cdRef.markForCheck()}getBase64Image(e){let t=document.createElement("canvas");t.width=e.width,t.height=e.height;let r=t.getContext("2d",{alpha:!1});return r?(r.drawImage(e,0,0),t.toDataURL("image/png")):""}selectImage(e,t){if(this.selectedIndex!==e){if(!this.imageUrls[e].startsWith("data:image/")){let r=this.imageUrls[e],m=new Image;m.crossOrigin="Anonymous",m.src=r,m.onload=v=>{this.handleUrlImageAdd(m,e),this.selectedBase64Url.emit(this.imageUrls[this.selectedIndex]),t&&t(e)},m.onerror=v=>{this.toastr.error(I("errors.rejected-cover-upload")),this.form.get("coverImageUrl")?.setValue(""),this.cdRef.markForCheck()},this.form.get("coverImageUrl")?.setValue(""),this.cdRef.markForCheck();return}this.selectedIndex=e,this.cdRef.markForCheck(),this.imageSelected.emit(this.selectedIndex),this.selectedBase64Url.emit(this.imageUrls[this.selectedIndex])}}applyImage(e){this.showApplyButton&&this.selectImage(e,()=>{this.applyCover.emit(this.imageUrls[e]),this.appliedIndex=e,this.cdRef.markForCheck()})}resetImage(){this.showApplyButton&&this.resetCover.emit()}loadImage(e){e=e||this.form.get("coverImageUrl")?.value.trim(),!(!e||e==="")&&this.uploadService.uploadByUrl(e).subscribe(t=>{let r=new Image;r.crossOrigin="Anonymous",r.src=this.imageService.getCoverUploadImage(t),r.onload=m=>this.handleUrlImageAdd(r),r.onerror=m=>{this.toastr.error(I("errors.rejected-cover-upload")),this.form.get("coverImageUrl")?.setValue(""),this.cdRef.markForCheck()},this.form.get("coverImageUrl")?.setValue(""),this.cdRef.markForCheck()})}loadImageFromUrl(e){e=e||this.form.get("coverImageUrl")?.value.trim(),!(!e||e==="")&&this.uploadService.uploadByUrl(e).subscribe(t=>{let r=new Image;r.crossOrigin="Anonymous",r.src=this.imageService.getCoverUploadImage(t),r.onload=m=>this.handleUrlImageAdd(r),r.onerror=m=>{this.toastr.error(I("errors.rejected-cover-upload")),this.form.get("coverImageUrl")?.setValue(""),this.cdRef.markForCheck()},this.form.get("coverImageUrl")?.setValue(""),this.cdRef.markForCheck()})}changeMode(e){this.mode=e,this.setupEnterHandler(),this.cdRef.markForCheck(),setTimeout(()=>this.document.querySelector("#load-image")?.focus(),10)}dropped(e){this.files=e;for(let t of e)t.fileEntry.isFile&&t.fileEntry.file(m=>{let v=new FileReader;v.onload=C=>this.handleFileImageAdd(C),v.readAsDataURL(m)})}handleFileImageAdd(e){e.target!=null&&(this.imageUrls.push(e.target.result),this.imageUrlsChange.emit(this.imageUrls),this.selectedIndex=this.imageUrls.length-1,this.imageSelected.emit(this.selectedIndex),this.selectedBase64Url.emit(e.target.result),setTimeout(()=>{this.document.querySelector('div.image-card[aria-label="Image '+this.selectedIndex+'"]').focus()}),this.cdRef.markForCheck())}handleUrlImageAdd(e,t=-1){let r=this.getBase64Image(e);t>=0?this.imageUrls[t]=r:this.imageUrls.push(r),this.imageUrlsChange.emit(this.imageUrls),this.cdRef.markForCheck(),setTimeout(()=>{this.selectImage(t>=0?t:this.imageUrls.length-1)})}reset(){this.resetClicked.emit(),this.selectedIndex=-1}setupEnterHandler(){setTimeout(()=>{let e=document.querySelector('input[id="load-image"]');e!=null&&Ht(e,"keydown").pipe(ti(()=>this.mode==="url")).subscribe(t=>{switch(t.key){case $t.ENTER:{this.loadImage();break}case $t.ESC_KEY:this.mode="all",t.stopPropagation();break;default:break}})})}fileOver(e){}fileLeave(e){}};o.\u0275fac=function(t){return new(t||o)(O(ci))},o.\u0275cmp=j({type:o,selectors:[["app-cover-image-chooser"]],inputs:{showApplyButton:"showApplyButton",imageUrls:"imageUrls",showReset:"showReset"},outputs:{applyCover:"applyCover",resetCover:"resetCover",imageUrlsChange:"imageUrlsChange",resetClicked:"resetClicked",imageSelected:"imageSelected",selectedBase64Url:"selectedBase64Url"},standalone:!0,features:[Y],decls:1,vars:1,consts:[[4,"transloco","translocoRead"],[1,"container-fluid",2,"padding-left","0px","padding-right","0px"],[3,"formGroup"],["dropZoneClassName","file-upload","contentClassName","file-upload-zone",3,"onFileDrop","onFileOver","onFileLeave","accept","directory"],["ngx-file-drop-content-tmp",""],[1,"row","g-0","chooser",2,"padding-top","10px"],["class","clickable col-auto","tabindex","0",3,"ngClass","click",4,"ngIf"],["class","clickable col-auto","tabindex","0",3,"ngClass","click",4,"ngFor","ngForOf"],["class","row g-0 mt-3 pb-3",4,"ngIf"],[4,"ngIf"],[1,"row","g-0","mt-3","pb-3"],[1,"mx-auto"],[1,"row","g-0","mb-3"],["aria-hidden","true",1,"fa","fa-file-upload","mx-auto",2,"font-size","24px","width","20px"],[1,"d-flex","justify-content-center"],[1,"d-flex","justify-content-evenly"],["href","javascript:void(0)",1,"pe-0",3,"click"],[1,"phone-hidden"],[1,"ps-1","pe-1"],["href","javascript:void(0)",1,"pe-0"],[1,"row","g-0","mt-3","pb-3","ms-md-2","me-md-2"],[1,"input-group","col-auto","me-md-2",2,"width","83%"],["for","load-image",1,"input-group-text"],["type","text","autofocus","","autocomplete","off","formControlName","coverImageUrl","placeholder","https://","id","load-image",1,"form-control"],["type","button","id","load-image-addon",1,"btn","btn-outline-secondary",3,"click","disabled"],["href","javascript:void(0)",1,"btn","btn-secondary","col-auto",3,"click"],["aria-hidden","true",1,"fas","fa-share",2,"transform","rotateY(180deg)"],["tabindex","0",1,"clickable","col-auto",3,"click","ngClass"],["height","230px","width","158px",1,"card-img-top",3,"title","imageUrl"],[1,"btn","btn-secondary",2,"width","100%",3,"click"],["height","230px","width","158px",1,"card-img-top",3,"imageUrl","processEvents"],[1,"btn","btn-primary",2,"width","100%",3,"click"]],template:function(t,r){t&1&&h(0,Gn,9,5,"ng-container",0),t&2&&p("translocoRead","cover-image-chooser")},dependencies:[X,oe,re,J,ae,me,pe,Qi,qt,jt,de,Ct,xe,ne,Rt,$e,H],styles:[`.card-img-top[_ngcontent-%COMP%]{width:160px;height:230px;max-height:230px}.selected[_ngcontent-%COMP%]{outline:5px solid var(--primary-color);outline-width:medium;outline-offset:-1px}.chooser[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,158px);grid-gap:.5rem;justify-content:space-around}ngx-file-drop[_ngcontent-%COMP%]    >div{width:100%;border:2px solid var(--primary-color);border-radius:5px;height:100px;margin:auto}ngx-file-drop[_ngcontent-%COMP%]    >div>div{width:100%;display:inline-block}
/*# sourceMappingURL=cover-image-chooser.component-46I2DHEI.css.map */`],changeDetection:0});let i=o;return i})();var jn=i=>({name:i});function qn(i,o){if(i&1&&(l(0,"div"),d(1),s()),i&2){let n=c(3).$implicit;a(),x(" ",n("required-field")," ")}}function zn(i,o){if(i&1&&(l(0,"div"),d(1),s()),i&2){let n=c(3).$implicit;a(),x(" ",n("name-unique-validation")," ")}}function Qn(i,o){if(i&1&&(l(0,"div",27),h(1,qn,2,1,"div",20)(2,zn,2,1,"div",20),s()),i&2){let n,e,t=c(3);a(),p("ngIf",(n=t.reviewGroup.get("title"))==null||n.errors==null?null:n.errors.required),a(),p("ngIf",(e=t.reviewGroup.get("title"))==null||e.errors==null?null:e.errors.duplicateName)}}function Yn(i,o){if(i&1&&d(0),i&2){let n=c(4).$implicit;g(n("promote-tooltip"))}}function Zn(i,o){if(i&1&&(l(0,"div",29)(1,"div",30),y(2,"input",31),l(3,"label",32),d(4),s(),y(5,"i",33),h(6,Yn,1,1,"ng-template",null,1,w),l(8,"span",34),ye(9,35),s()()()),i&2){let n=$(7),e=c(3).$implicit;a(4),g(e("promote-label")),a(),p("ngbTooltip",n),a(4),p("ngTemplateOutlet",n)}}function Hn(i,o){if(i&1&&(U(0),h(1,Zn,10,3,"div",28),A()),i&2){let n=o.ngIf,e=c(3);a(),p("ngIf",e.accountService.hasAdminRole(n))}}function Jn(i,o){if(i&1&&(l(0,"div"),d(1),s()),i&2){let n=c(4).$implicit;a(),x(" ",n("month-validation")," ")}}function Xn(i,o){if(i&1&&(l(0,"div",40),h(1,Jn,2,1,"div",20),s()),i&2){let n=c().ngIf;a(),p("ngIf",(n.errors==null?null:n.errors.min)||(n.errors==null?null:n.errors.max))}}function Kn(i,o){if(i&1&&(l(0,"div",36)(1,"label",37),d(2),s(),y(3,"input",38),h(4,Xn,2,1,"div",39),s()),i&2){let n=o.ngIf,e=c(2).$implicit,t=c();a(2),g(e("month-label")),a(),se("is-invalid",(n==null?null:n.invalid)&&(n==null?null:n.touched)),a(),p("ngIf",t.reviewGroup.dirty||t.reviewGroup.touched)}}function er(i,o){if(i&1&&(l(0,"div"),d(1),s()),i&2){let n=c(4).$implicit;a(),x(" ",n("year-validation")," ")}}function tr(i,o){if(i&1&&(l(0,"div",40),h(1,er,2,1,"div",20),s()),i&2){let n=c().ngIf;a(),p("ngIf",(n.errors==null?null:n.errors.min)||(n.errors==null?null:n.errors.max))}}function ir(i,o){if(i&1&&(l(0,"div",36)(1,"label",41),d(2),s(),y(3,"input",42),h(4,tr,2,1,"div",39),s()),i&2){let n=o.ngIf,e=c(2).$implicit,t=c();a(2),g(e("year-label")),a(),se("is-invalid",n.invalid&&n.touched),a(),p("ngIf",t.reviewGroup.dirty||t.reviewGroup.touched)}}function nr(i,o){if(i&1&&(l(0,"div"),d(1),s()),i&2){let n=c(4).$implicit;a(),x(" ",n("month-validation")," ")}}function rr(i,o){if(i&1&&(l(0,"div",40),h(1,nr,2,1,"div",20),s()),i&2){let n=c().ngIf;a(),p("ngIf",(n.errors==null?null:n.errors.min)||(n.errors==null?null:n.errors.max))}}function ar(i,o){if(i&1&&(l(0,"div",36)(1,"label",43),d(2),s(),y(3,"input",44),h(4,rr,2,1,"div",39),s()),i&2){let n=o.ngIf,e=c(2).$implicit,t=c();a(2),g(e("month-label")),a(),se("is-invalid",(n==null?null:n.invalid)&&(n==null?null:n.touched)),a(),p("ngIf",t.reviewGroup.dirty||t.reviewGroup.touched)}}function or(i,o){if(i&1&&(l(0,"div"),d(1),s()),i&2){let n=c(4).$implicit;a(),x(" ",n("year-validation")," ")}}function lr(i,o){if(i&1&&(l(0,"div",40),h(1,or,2,1,"div",20),s()),i&2){let n=c().ngIf;a(),p("ngIf",(n.errors==null?null:n.errors.min)||(n.errors==null?null:n.errors.max))}}function sr(i,o){if(i&1&&(l(0,"div",36)(1,"label",45),d(2),s(),y(3,"input",46),h(4,lr,2,1,"div",39),s()),i&2){let n=o.ngIf,e=c(2).$implicit,t=c();a(2),g(e("year-label")),a(),se("is-invalid",(n==null?null:n.invalid)&&(n==null?null:n.touched)),a(),p("ngIf",t.reviewGroup.dirty||t.reviewGroup.touched)}}function cr(i,o){if(i&1&&(l(0,"form",14)(1,"div",15)(2,"div",16)(3,"label",17),d(4,"Name"),s(),y(5,"input",18),h(6,Qn,3,2,"div",19),s(),h(7,Hn,2,1,"ng-container",20),M(8,"async"),s(),l(9,"div",15)(10,"div",21)(11,"h6",22),d(12),s(),h(13,Kn,5,4,"div",23)(14,ir,5,4,"div",23),s(),l(15,"div",21)(16,"h6",24),d(17),s(),h(18,ar,5,4,"div",23)(19,sr,5,4,"div",23),s()(),l(20,"div",15)(21,"label",25),d(22),s(),y(23,"textarea",26),s()()),i&2){let n,e=c().$implicit,t=c();p("formGroup",t.reviewGroup),a(5),se("is-invalid",((n=t.reviewGroup.get("title"))==null?null:n.invalid)&&((n=t.reviewGroup.get("title"))==null?null:n.touched)),a(),p("ngIf",t.reviewGroup.dirty||t.reviewGroup.touched),a(),p("ngIf",D(8,12,t.accountService.currentUser$)),a(5),g(e("starting-title")),a(),p("ngIf",t.reviewGroup.get("startingMonth")),a(),p("ngIf",t.reviewGroup.get("startingYear")),a(3),g(e("ending-title")),a(),p("ngIf",t.reviewGroup.get("endingMonth")),a(),p("ngIf",t.reviewGroup.get("endingYear")),a(3),g(e("summary-label"))}}function dr(i,o){if(i&1){let n=T();l(0,"app-cover-image-chooser",47),N("imageUrlsChange",function(t){_(n);let r=c(2);return V(r.imageUrls,t)||(r.imageUrls=t),u(t)}),f("imageSelected",function(t){_(n);let r=c(2);return u(r.updateSelectedIndex(t))})("selectedBase64Url",function(t){_(n);let r=c(2);return u(r.updateSelectedImage(t))})("resetClicked",function(){_(n);let t=c(2);return u(t.handleReset())}),s()}if(i&2){let n=c(2);R("imageUrls",n.imageUrls),p("showReset",n.readingList.coverImageLocked)}}function mr(i,o){if(i&1){let n=T();U(0),l(1,"div",3)(2,"h4",4),d(3),s(),l(4,"button",5),f("click",function(){_(n);let t=c();return u(t.close())}),s()(),l(5,"div")(6,"ul",6,0),N("activeIdChange",function(t){_(n);let r=c();return V(r.active,t)||(r.active=t),u(t)}),l(8,"li",7)(9,"a",8),d(10),s(),h(11,cr,24,14,"ng-template",9),s(),l(12,"li",7)(13,"a",8),d(14),s(),h(15,dr,1,2,"ng-template",9),s()(),y(16,"div",10),s(),l(17,"div",11)(18,"button",12),f("click",function(){_(n);let t=c();return u(t.close())}),d(19),s(),l(20,"button",13),f("click",function(){_(n);let t=c();return u(t.save())}),d(21),s()(),A()}if(i&2){let n=o.$implicit,e=$(7),t=c();a(3),g(n("title",q(17,jn,t.readingList.title))),a(),ee("aria-label",n("close")),a(),te("modal-body scrollable-modal ",t.utilityService.getActiveBreakpoint()===t.Breakpoint.Mobile?"":"d-flex",""),a(),ke("orientation",t.utilityService.getActiveBreakpoint()===t.Breakpoint.Mobile?"horizontal":"vertical"),R("activeId",t.active),a(2),p("ngbNavItem",t.TabID.General),a(2),g(n(t.TabID.General)),a(2),p("ngbNavItem",t.TabID.CoverImage),a(2),g(n(t.TabID.CoverImage)),a(2),te("tab-content ",t.utilityService.getActiveBreakpoint()===t.Breakpoint.Mobile?"mt-3":"ms-4 flex-fill",""),p("ngbNavOutlet",e),a(3),g(n("close")),a(2),g(n("save"))}}var zt=function(i){return i.General="general-tab",i.CoverImage="cover-image-tab",i}(zt||{}),Zi=(()=>{let o=class o{get Breakpoint(){return lt}get TabID(){return zt}constructor(e,t,r,m,v,C,W,ue){this.ngModal=e,this.readingListService=t,this.utilityService=r,this.uploadService=m,this.toastr=v,this.imageService=C,this.cdRef=W,this.accountService=ue,this.destroyRef=k(Se),this.coverImageIndex=0,this.selectedCover="",this.coverImageLocked=!1,this.imageUrls=[],this.active=zt.General}ngOnInit(){this.reviewGroup=new we({title:new E(this.readingList.title,{nonNullable:!0,validators:[B.required]}),summary:new E(this.readingList.summary,{nonNullable:!0,validators:[]}),promoted:new E(this.readingList.promoted,{nonNullable:!0,validators:[]}),startingMonth:new E(this.readingList.startingMonth,{nonNullable:!0,validators:[B.min(1),B.max(12)]}),startingYear:new E(this.readingList.startingYear,{nonNullable:!0,validators:[B.min(1e3)]}),endingMonth:new E(this.readingList.endingMonth,{nonNullable:!0,validators:[B.min(1),B.max(12)]}),endingYear:new E(this.readingList.endingYear,{nonNullable:!0,validators:[B.min(1e3)]})}),this.coverImageLocked=this.readingList.coverImageLocked,this.reviewGroup.get("title")?.valueChanges.pipe(Me(100),Fe(),ze(e=>this.readingListService.nameExists(e)),ve(e=>{let t=this.reviewGroup.get("title")?.value===this.readingList.title;!e||t?this.reviewGroup.get("title")?.setErrors(null):this.reviewGroup.get("title")?.setErrors({duplicateName:!0}),this.cdRef.markForCheck()}),Z(this.destroyRef)).subscribe(),this.imageUrls.push(this.imageService.randomize(this.imageService.getReadingListCoverImage(this.readingList.id))),!this.readingList.items||this.readingList.items.length===0?this.readingListService.getListItems(this.readingList.id).subscribe(e=>{this.imageUrls.push(...e.map(t=>this.imageService.getChapterCoverImage(t.chapterId)))}):this.imageUrls.push(...this.readingList.items.map(e=>this.imageService.getChapterCoverImage(e.chapterId)))}close(){this.ngModal.dismiss(void 0)}save(){if(this.reviewGroup.value.title.trim()==="")return;let e=Yt(Qt({},this.reviewGroup.value),{readingListId:this.readingList.id,coverImageLocked:this.coverImageLocked});e.startingMonth=e.startingMonth||0,e.startingYear=e.startingYear||0,e.endingMonth=e.endingMonth||0,e.endingYear=e.endingYear||0;let t=[this.readingListService.update(e)];this.selectedCover!==""&&t.push(this.uploadService.updateReadingListCoverImage(this.readingList.id,this.selectedCover)),qe(t).subscribe(r=>{this.readingList.title=e.title,this.readingList.summary=e.summary,this.readingList.coverImageLocked=this.coverImageLocked,this.readingList.promoted=e.promoted,this.ngModal.close(this.readingList),this.toastr.success(I("toasts.reading-list-updated"))})}updateSelectedIndex(e){this.coverImageIndex=e,this.cdRef.detectChanges()}updateSelectedImage(e){this.selectedCover=e}handleReset(){this.coverImageLocked=!1}};o.\u0275fac=function(t){return new(t||o)(O(Ce),O(Pt),O(Ee),O(je),O(_e),O(Te),O(ce),O(Lt))},o.\u0275cmp=j({type:o,selectors:[["app-edit-reading-list-modal"]],inputs:{readingList:"readingList"},standalone:!0,features:[Y],decls:1,vars:1,consts:[["nav","ngbNav"],["promotedTooltip",""],[4,"transloco","translocoRead"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button",1,"btn-close",3,"click"],["ngbNav","",1,"nav-pills",2,"min-width","135px",3,"activeIdChange","activeId","orientation"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"click"],[3,"formGroup"],[1,"row","g-0","mb-3"],[1,"col-md-8","col-sm-12"],["for","library-name",1,"form-label"],["id","library-name","formControlName","title","type","text",1,"form-control"],["id","inviteForm-validations","class","invalid-feedback",4,"ngIf"],[4,"ngIf"],[1,"col-md-6","col-sm-12"],["id","starting-year-header"],["class","col-md-6 col-sm-12","style","width: 90%",4,"ngIf"],["id","ending-year-heading"],["for","summary",1,"form-label"],["id","summary","formControlName","summary","rows","3",1,"form-control"],["id","inviteForm-validations",1,"invalid-feedback"],["class","col-md-3 col-sm-12 ms-2",4,"ngIf"],[1,"col-md-3","col-sm-12","ms-2"],[1,"form-check","form-switch"],["type","checkbox","id","tag-promoted","role","switch","formControlName","promoted","aria-labelledby","auto-close-label","aria-describedby","tag-promoted-help",1,"form-check-input"],["for","tag-promoted",1,"form-check-label","me-1"],["aria-hidden","true","placement","left","role","button","tabindex","0",1,"fa","fa-info-circle",3,"ngbTooltip"],["id","tag-promoted-help",1,"visually-hidden"],[3,"ngTemplateOutlet"],[1,"col-md-6","col-sm-12",2,"width","90%"],["for","start-month",1,"form-label"],["id","start-month","formControlName","startingMonth","type","number","inputmode","numeric","aria-describedby","starting-year-header",1,"form-control"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"],["for","start-year",1,"form-label"],["id","start-year","formControlName","startingYear","type","number","inputmode","numeric","aria-describedby","starting-year-header",1,"form-control"],["for","ending-month",1,"form-label"],["id","ending-month","formControlName","endingMonth","type","number","inputmode","numeric","aria-describedby","ending-year-header",1,"form-control"],["for","ending-year",1,"form-label"],["id","ending-year","formControlName","endingYear","type","number","inputmode","numeric","aria-describedby","ending-year-header",1,"form-control"],[3,"imageUrlsChange","imageSelected","selectedBase64Url","resetClicked","imageUrls","showReset"]],template:function(t,r){t&1&&h(0,mr,22,19,"ng-container",2),t&2&&p("translocoRead","edit-reading-list-modal")},dependencies:[it,tt,Ii,nt,et,X,oe,re,It,St,J,ae,me,pe,ne,at,We,mt,rt,bt,H],styles:[`.form-switch[_ngcontent-%COMP%]{margin-top:2.4rem}
/*# sourceMappingURL=edit-reading-list-modal.component-HTAZ3RET.css.map */`],changeDetection:0});let i=o;return i})();var _r=["instance"],ur=i=>({disabled:i});function gr(i,o){if(i&1&&y(0,"ngb-highlight",25),i&2){let n=o.result,e=o.term;p("result",n)("term",e)}}function hr(i,o){if(i&1&&(U(0),d(1),A()),i&2){let n=c().$implicit;a(),x(" ",n," ")}}function fr(i,o){if(i&1){let n=T();l(0,"a",29),f("click",function(){_(n);let t=c().index,r=c(3);return u(r.navigateTo(t))}),d(1),s()}if(i&2){let n=c().$implicit;a(),g(n)}}function vr(i,o){if(i&1&&(l(0,"li"),h(1,hr,2,1,"ng-container",28)(2,fr,2,1,"ng-template",null,3,w),s()),i&2){let n=o.$implicit,e=o.last,t=$(3),r=c(3);te("breadcrumb-item ",n===r.routeStack.peek()?"active":"",""),a(),p("ngIf",e)("ngIfElse",t)}}function xr(i,o){if(i&1&&(l(0,"ol",26),h(1,vr,4,5,"li",27),s()),i&2){let n=c(2);a(),p("ngForOf",n.routeStack.items)}}function Cr(i,o){if(i&1&&(l(0,"div",26),d(1),s()),i&2){let n=c().$implicit;a(),x("",n("instructions")," ")}}function br(i,o){if(i&1){let n=T();l(0,"tr",30),f("click",function(){let t=_(n).$implicit,r=c(2);return u(r.selectNode(t))}),l(1,"td"),y(2,"i",31),s(),l(3,"td",32),d(4),s()()}if(i&2){let n=o.$implicit,e=o.index;p("ngClass",q(4,ur,n.disabled)),a(3),Be("id","folder--",e,""),a(),x(" ",n.name," ")}}function yr(i,o){if(i&1&&(l(0,"a",33),d(1),s()),i&2){let n=c().$implicit,e=c();ke("href",e.helpUrl,Ae),a(),g(n("help"))}}function Sr(i,o){if(i&1){let n=T();U(0),l(1,"div",5)(2,"h4",6),d(3),s(),l(4,"button",7),f("click",function(){_(n);let t=c();return u(t.close())}),s()(),l(5,"div",8)(6,"div",9)(7,"label",10),d(8),s(),l(9,"div",11)(10,"input",12,0),N("ngModelChange",function(t){_(n);let r=c();return V(r.path,t)||(r.path=t),u(t)}),f("focus",function(t){_(n);let r=c();return u(r.focus$.next(t.target.value))})("click",function(t){_(n);let r=c();return u(r.click$.next(t.target.value))})("ngModelChange",function(){_(n);let t=c();return u(t.updateTable())}),s()(),h(12,gr,1,2,"ng-template",null,1,w),s(),l(14,"nav",13),h(15,xr,2,1,"ol",14)(16,Cr,2,1,"ng-template",null,2,w),s(),l(18,"table",15)(19,"thead")(20,"tr")(21,"th",16),d(22),s(),l(23,"th",17),d(24),s()()(),l(25,"tbody")(26,"tr",18),f("click",function(){_(n);let t=c();return u(t.goBack())}),l(27,"td"),y(28,"i",19),s(),l(29,"td"),d(30,"..."),s()(),h(31,br,5,6,"tr",20),s()()(),l(32,"div",21),h(33,yr,2,2,"a",22),l(34,"button",23),f("click",function(){_(n);let t=c();return u(t.close())}),d(35),s(),l(36,"button",24),f("click",function(){_(n);let t=c();return u(t.share())}),d(37),s()(),A()}if(i&2){let n=o.$implicit,e=$(13),t=$(17),r=c();a(3),g(n("title")),a(),ee("aria-label",n("close")),a(4),g(n("path-label")),a(2),R("ngModel",r.path),p("ngbTypeahead",r.search)("placeholder",n("path-placeholder"))("resultTemplate",e),a(5),p("ngIf",r.routeStack.peek()!==void 0)("ngIfElse",t),a(7),g(n("type-header")),a(2),g(n("name-header")),a(7),p("ngForOf",r.folders),a(2),p("ngIf",r.helpUrl.length>0),a(2),g(n("cancel")),a(2),g(n("share"))}}var Hi=(()=>{let o=class o{constructor(e,t){this.modal=e,this.libraryService=t,this.startingFolder="",this.helpUrl=ot.Library,this.currentRoot="",this.folders=[],this.routeStack=new Mi,this.path="",this.focus$=new ut,this.click$=new ut,this.searching=!1,this.searchFailed=!1,this.search=r=>{let m=r.pipe(Me(200),Fe()),v=this.click$.pipe(Kt(()=>!this.instance.isPopupOpen())),C=this.focus$;return Xt(m,C,v,r).pipe(Me(300),Fe(),ve(()=>this.searching=!0),ze(W=>this.libraryService.listDirectories(this.path).pipe(ve(()=>this.searchFailed=!1),ve(ue=>this.folders=ue),z(ue=>ue.map(_t=>_t.fullPath)),ei(()=>(this.searchFailed=!0,ge([]))))),ve(()=>this.searching=!1))}}ngOnInit(){if(this.startingFolder&&this.startingFolder.length>0){let e=this.startingFolder.split("/"),t=this.startingFolder.split("\\");e.length===1&&t.length>1&&(e=t),e[0].endsWith("/")||(e[0]=e[0]+"/"),e.forEach(m=>this.routeStack.push(m));let r=this.routeStack.items.join("/");this.loadChildren(r)}else this.loadChildren(this.currentRoot)}updateTable(){this.loadChildren(this.path)}selectNode(e){e.disabled||(this.currentRoot=e.name,this.routeStack.push(e.name),this.path=e.fullPath,this.loadChildren(this.path))}goBack(){this.routeStack.pop();let e=this.routeStack.peek();if(e!==void 0){this.currentRoot=e;let t=this.routeStack.items.join("/");this.loadChildren(t)}else this.currentRoot="",this.loadChildren(this.currentRoot)}loadChildren(e){this.libraryService.listDirectories(e).subscribe(t=>{this.folders=t},t=>{this.routeStack.pop();let r=this.folders.find(m=>m.fullPath===e);r&&(r.disabled=!0)})}share(){this.modal.close({success:!0,folderPath:this.path})}close(){this.modal.close({success:!1,folderPath:void 0})}navigateTo(e){for(;this.routeStack.items.length-1>e;)this.routeStack.pop();let t=this.routeStack.items.join("/");this.path=t,this.loadChildren(t)}};o.\u0275fac=function(t){return new(t||o)(O(Ce),O(Le))},o.\u0275cmp=j({type:o,selectors:[["app-directory-picker"]],viewQuery:function(t,r){if(t&1&&Oe(_r,5),t&2){let m;Re(m=Ve())&&(r.instance=m.first)}},inputs:{startingFolder:"startingFolder",helpUrl:"helpUrl"},standalone:!0,features:[Y],decls:1,vars:1,consts:[["instance","ngbTypeahead"],["rt",""],["noBreadcrumb",""],["nonActive",""],[4,"transloco","translocoRead"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-3"],["for","typeahead-focus",1,"form-label"],[1,"input-group"],["id","typeahead-focus","type","text",1,"form-control",2,"width","100%",3,"ngModelChange","focus","click","ngModel","ngbTypeahead","placeholder","resultTemplate"],["aria-label","directory breadcrumb"],["class","breadcrumb",4,"ngIf","ngIfElse"],[1,"table","table-striped","scrollable"],["scope","col",2,"width","40px"],["scope","col"],[3,"click"],["aria-hidden","true",1,"fa-solid","fa-arrow-turn-up"],["class","clickable",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"modal-footer"],["class","btn btn-icon","target","_blank","rel","noopener noreferrer",3,"href",4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[3,"result","term"],[1,"breadcrumb"],[3,"class",4,"ngFor","ngForOf"],[4,"ngIf","ngIfElse"],["href","javascript:void(0);",3,"click"],[1,"clickable",3,"click","ngClass"],["aria-hidden","true",1,"fa-regular","fa-folder"],[3,"id"],["target","_blank","rel","noopener noreferrer",1,"btn","btn-icon",3,"href"]],template:function(t,r){t&1&&h(0,Sr,38,15,"ng-container",4),t&2&&p("translocoRead","directory-picker")},dependencies:[X,re,J,wi,hi,pi,ki,ne,xe,Ct,H],styles:[`.breadcrumb-item[_ngcontent-%COMP%] + .breadcrumb-item[_ngcontent-%COMP%]:before{content:">"}.scrollable[_ngcontent-%COMP%]{overflow-y:auto;max-height:400px}.btn-outline-secondary[_ngcontent-%COMP%]{border:1px solid #ced4da}.table[_ngcontent-%COMP%]{background-color:#d3d3d3}.disabled[_ngcontent-%COMP%]{color:#d3d3d3!important;cursor:not-allowed!important;background-color:var(--error-color)}
/*# sourceMappingURL=directory-picker.component-ZTAZGF7P.css.map */`]});let i=o;return i})();var At=(()=>{let o=class o{constructor(e){this.translocoService=e}transform(e,t="default-date-pipe.never"){return e==null||e===""||e===1/0||Number.isNaN(e)||e==="1/1/01"?this.translocoService.translate(t):e}};o.\u0275fac=function(t){return new(t||o)(O(He,16))},o.\u0275pipe=Qe({name:"defaultDate",type:o,pure:!0,standalone:!0});let i=o;return i})();var P=function(i){return i[i.Archive=1]="Archive",i[i.Epub=2]="Epub",i[i.Pdf=3]="Pdf",i[i.Images=4]="Images",i}(P||{}),gt=Object.keys(P).filter(i=>!isNaN(Number(i))&&parseInt(i,10)>=0).map(i=>parseInt(i,10));var Ji=(()=>{let o=class o{transform(e){switch(e){case P.Archive:return I("file-type-group-pipe.archive");case P.Epub:return I("file-type-group-pipe.epub");case P.Pdf:return I("file-type-group-pipe.pdf");case P.Images:return I("file-type-group-pipe.image")}}};o.\u0275fac=function(t){return new(t||o)},o.\u0275pipe=Qe({name:"fileTypeGroup",type:o,pure:!0,standalone:!0});let i=o;return i})();function Ir(i,o){if(i&1){let n=T();l(0,"div",2)(1,"div",3)(2,"div",4)(3,"label",5),d(4),s(),y(5,"input",6),s()(),l(6,"div",7)(7,"button",8),f("click",function(){_(n);let t=c(2);return u(t.add())}),y(8,"i",9),l(9,"span",10),d(10),s()(),l(11,"button",11),f("click",function(){let t=_(n).$index,r=c(2);return u(r.remove(t))}),y(12,"i",12),l(13,"span",10),d(14),s()()()()}if(i&2){let n=o.$index,e=c().$implicit,t=c();a(3),Be("for","item--",n,""),a(),g(t.label),a(),Be("formControlName","link",n,""),Be("id","item--",n,""),a(5),g(e("common.add")),a(4),g(e("common.remove"))}}function kr(i,o){if(i&1&&(l(0,"form",1),ft(1,Ir,15,9,"div",2,li),s()),i&2){let n=c();p("formGroup",n.form),a(),vt(n.Items)}}var Bt=(()=>{let o=class o{constructor(){this.cdRef=k(ce),this.destroyRef=k(Se),this.items=[],this.label="",this.updateItems=new Q,this.form=new we({}),this.combinedItems=""}get Items(){return this.combinedItems.split(",")||[""]}ngOnInit(){this.items.forEach((e,t)=>{this.form.addControl("link"+t,new E(e,[]))}),this.combinedItems=this.items.join(","),this.form.valueChanges.pipe(Me(100),Fe(),ve(e=>this.emit()),Z(this.destroyRef)).subscribe(),this.cdRef.markForCheck()}add(){this.combinedItems+=",",this.form.addControl("link"+(this.Items.length-1),new E("",[])),this.emit(),this.cdRef.markForCheck()}remove(e){let t=this.combinedItems.split(","),r=t[e];this.combinedItems=t.filter(m=>m!=r).join(",");for(let[m,[v,C]]of Object.entries(Object.entries(this.form.controls)))v.startsWith("link")&&this.form.get(v)?.value===r&&this.form.removeControl("link"+m,{emitEvent:!0});this.emit(),this.cdRef.markForCheck()}emit(){this.updateItems.emit(Object.keys(this.form.controls).filter(e=>e.startsWith("link")).map(e=>this.form.get(e)?.value).filter(e=>e!==null&&e!==""))}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=j({type:o,selectors:[["app-edit-list"]],inputs:{items:"items",label:"label"},outputs:{updateItems:"updateItems"},standalone:!0,features:[Y],decls:1,vars:0,consts:[[3,"formGroup",4,"transloco"],[3,"formGroup"],[1,"row","g-0","mb-3"],[1,"col-lg-10","col-md-12","pe-2"],[1,"mb-3"],[1,"visually-hidden",3,"for"],["type","text",1,"form-control",3,"formControlName","id"],[1,"col-lg-2"],[1,"btn","btn-secondary","me-1",3,"click"],["aria-hidden","true",1,"fa-solid","fa-plus"],[1,"visually-hidden"],[1,"btn","btn-secondary",3,"click"],["aria-hidden","true",1,"fa-solid","fa-xmark"]],template:function(t,r){t&1&&h(0,kr,3,1,"form",0)},dependencies:[de,X,oe,re,J,ae,me,pe,Fi,H],styles:["/*# sourceMappingURL=edit-list.component-2MJRBC6D.css.map */"],changeDetection:0});let i=o;return i})();var wr=i=>({name:i});function Er(i,o){if(i&1&&(U(0),d(1),M(2,"sentenceCase"),A()),i&2){let n=c().$implicit,e=c();a(),x(" ",n("edit-title",q(3,wr,D(2,1,e.library.name)))," ")}}function Tr(i,o){if(i&1&&d(0),i&2){let n=c().$implicit;x(" ",n("add-title")," ")}}function Lr(i,o){if(i&1&&(l(0,"div"),d(1),s()),i&2){let n=c(3).$implicit;a(),x(" ",n("required-field")," ")}}function Mr(i,o){if(i&1&&(l(0,"div"),d(1),s()),i&2){let n=c(3).$implicit;a(),x(" ",n("library-name-unique")," ")}}function Fr(i,o){if(i&1&&(l(0,"div",33),h(1,Lr,2,1,"div",32)(2,Mr,2,1,"div",32),s()),i&2){let n,e,t=c(3);a(),p("ngIf",(n=t.libraryForm.get("name"))==null||n.errors==null?null:n.errors.required),a(),p("ngIf",(e=t.libraryForm.get("name"))==null||e.errors==null?null:e.errors.duplicateName)}}function Rr(i,o){if(i&1&&(l(0,"span",27),d(1),y(2,"i",34),s()),i&2){c();let n=$(13),e=c().$implicit;a(),x(" ",e("kavitaplus-eligible-label")," "),a(),p("ngbTooltip",n)}}function Vr(i,o){if(i&1&&d(0),i&2){let n=c(2).$implicit;g(n("type-tooltip"))}}function Nr(i,o){if(i&1&&d(0),i&2){let n=c(2).$implicit;g(n("kavitaplus-eligible-tooltip"))}}function Pr(i,o){if(i&1&&(l(0,"option",35),d(1),s()),i&2){let n=o.$implicit,e=o.index;p("value",e),a(),g(n)}}function Dr(i,o){if(i&1&&(l(0,"div"),d(1),l(2,"span"),d(3),M(4,"date"),M(5,"defaultDate"),s()()),i&2){let n=c(2).$implicit,e=c();a(),x(" ",n("last-scanned-label")," "),a(2),g(D(5,5,Ne(4,2,e.library==null?null:e.library.lastScanned,"short")))}}function Ur(i,o){if(i&1&&(l(0,"div",21)(1,"label",22),d(2),s(),y(3,"input",23),h(4,Fr,3,2,"div",24),s(),l(5,"div",21)(6,"label",25),d(7),s(),y(8,"i",26),h(9,Rr,3,2,"span",27)(10,Vr,1,1,"ng-template",null,3,w)(12,Nr,1,1,"ng-template",null,4,w),l(14,"span",28),ye(15,29),s(),l(16,"select",30),h(17,Pr,2,2,"option",31),s()(),h(18,Dr,6,7,"div",32)),i&2){let n,e=$(11),t=c().$implicit,r=c();a(2),g(t("name-label")),a(),se("is-invalid",((n=r.libraryForm.get("name"))==null?null:n.invalid)&&((n=r.libraryForm.get("name"))==null?null:n.touched)),a(),p("ngIf",r.libraryForm.dirty||r.libraryForm.touched),a(3),g(t("type-label")),a(),p("ngbTooltip",e),a(),Ie(9,r.IsKavitaPlusEligible?9:-1),a(6),p("ngTemplateOutlet",e),a(2),p("ngForOf",r.libraryTypes),a(),p("ngIf",!r.isAddLibrary)}}function Ar(i,o){if(i&1){let n=T();l(0,"li",42),d(1),l(2,"button",43),f("click",function(){let t=_(n).$implicit,r=c(3);return u(r.removeFolder(t))}),y(3,"i",44),s()()}if(i&2){let n=o.$implicit;a(),x(" ",n," ")}}function Br(i,o){if(i&1){let n=T();l(0,"p"),d(1),s(),l(2,"ul",36),h(3,Ar,4,1,"li",37),s(),l(4,"div",38)(5,"button",39),f("click",function(){_(n);let t=c(2);return u(t.openDirectoryPicker())}),y(6,"i",40),d(7),s()(),l(8,"div",38)(9,"p"),d(10),l(11,"a",41),d(12),s(),d(13),s()(),l(14,"div",38)(15,"p"),d(16),l(17,"a",41),d(18),s(),d(19),s()()}if(i&2){let n=c().$implicit,e=c();a(),g(n("folder-description")),a(2),p("ngForOf",e.selectedFolders),a(4),x(" ",n("browse")," "),a(3),g(n("help-us-part-1")),a(),p("href",e.WikiLink.ManagingFiles,Ae),a(),g(n("help-us-part-2")),a(),x(" ",n("help-us-part-3"),""),a(3),g(n("naming-conventions-part-1")),a(),p("href",e.WikiLink.Scanner,Ae),a(),g(n("naming-conventions-part-2")),a(),x(" ",n("naming-conventions-part-3"),"")}}function Or(i,o){if(i&1&&(l(0,"p",47),d(1),s()),i&2){let n=c(2).$implicit;a(),g(n("cover-description"))}}function Wr(i,o){if(i&1){let n=T();h(0,Or,2,1,"p",45),l(1,"p"),d(2),s(),l(3,"app-cover-image-chooser",46),N("imageUrlsChange",function(t){_(n);let r=c(2);return V(r.imageUrls,t)||(r.imageUrls=t),u(t)}),f("imageSelected",function(t){_(n);let r=c(2);return u(r.updateCoverImageIndex(t))})("selectedBase64Url",function(t){_(n);let r=c(2);return u(r.applyCoverImage(t))})("resetClicked",function(){_(n);let t=c(2);return u(t.resetCoverImage())}),s()}if(i&2){let n=c().$implicit,e=c();p("ngIf",e.isAddLibrary),a(2),g(n("cover-description-extra")),a(),R("imageUrls",e.imageUrls),p("showReset",(e.library==null?null:e.library.coverImage)!==null)}}function $r(i,o){if(i&1&&(l(0,"div",60),y(1,"input",75),l(2,"label",76),d(3),M(4,"fileTypeGroup"),s()()),i&2){let n=o.$implicit;a(),p("formControlName",n)("id",n),a(),p("for",n),a(),g(D(4,4,n))}}function Gr(i,o){if(i&1){let n=T();l(0,"span"),d(1),l(2,"a",77),d(3),y(4,"i",78),s()(),l(5,"div",79)(6,"app-edit-list",80),f("updateItems",function(t){_(n);let r=c(3);return u(r.updateGlobs(t))}),s()()}if(i&2){let n=c(2).$implicit,e=c();a(),g(n("exclude-patterns-tooltip")),a(),p("href",e.WikiLink.ScannerExclude,Ae),a(),g(n("help")),a(3),p("items",e.excludePatterns)("label",n("exclude-patterns-label"))}}function jr(i,o){if(i&1&&(l(0,"div",48)(1,"div",49)(2,"div",50)(3,"h6"),d(4),s(),l(5,"p",51),d(6),s(),l(7,"div",52),h(8,$r,5,6,"div",53),s()()()(),l(9,"div",48)(10,"div",49)(11,"div",54)(12,"div",55)(13,"h2",56)(14,"button",57),d(15),s()(),l(16,"div",58)(17,"div",59),h(18,Gr,7,5,"ng-template"),s()()()()()(),l(19,"div",48)(20,"div",49)(21,"div",50)(22,"div",60),y(23,"input",61),l(24,"label",62),d(25),s()()(),l(26,"p",51),d(27),s()()(),l(28,"div",48)(29,"div",49)(30,"div",50)(31,"div",60),y(32,"input",63),l(33,"label",64),d(34),s()()(),l(35,"p",51),d(36),s()()(),l(37,"div",48)(38,"div",49)(39,"div",50)(40,"div",60),y(41,"input",65),l(42,"label",66),d(43),s()()(),l(44,"p",51),d(45),s()()(),l(46,"div",48)(47,"div",49)(48,"div",50)(49,"div",60),y(50,"input",67),l(51,"label",68),d(52),s()()(),l(53,"p",51),d(54),s()()(),l(55,"div",48)(56,"div",49)(57,"div",50)(58,"div",60),y(59,"input",69),l(60,"label",70),d(61),s()()(),l(62,"p",51),d(63),s()()(),l(64,"div",48)(65,"div",49)(66,"div",50)(67,"div",60),y(68,"input",71),l(69,"label",72),d(70),s()()(),l(71,"p",51),d(72),s()()(),l(73,"div",48)(74,"div",49)(75,"div",50)(76,"div",60),y(77,"input",73),l(78,"label",74),d(79),s()()(),l(80,"p",51),d(81),s()()()),i&2){let n=c().$implicit,e=c();a(4),g(n("file-type-group-label")),a(2),x(" ",n("file-type-group-tooltip")," "),a(2),p("ngForOf",e.fileTypeGroups),a(7),g(n("exclude-patterns-label")),a(10),g(n("manage-collection-label")),a(2),x(" ",n("manage-collection-tooltip")," "),a(7),g(n("manage-reading-list-label")),a(2),x(" ",n("manage-reading-list-tooltip")," "),a(7),g(n("allow-scrobbling-label")),a(2),x(" ",n("allow-scrobbling-tooltip")," "),a(7),g(n("folder-watching-label")),a(2),x(" ",n("folder-watching-tooltip")," "),a(7),g(n("include-in-dashboard-label")),a(2),x(" ",n("include-in-dashboard-tooltip")," "),a(7),g(n("include-in-recommendation-label")),a(2),x(" ",n("include-in-recommendation-tooltip")," "),a(7),g(n("include-in-search-label")),a(2),x(" ",n("include-in-search-tooltip")," ")}}function qr(i,o){if(i&1){let n=T();U(0),l(1,"button",81),f("click",function(){_(n);let t=c(2);return u(t.nextStep())}),d(2),s(),A()}if(i&2){let n=c().$implicit,e=c();a(),p("disabled",e.isNextDisabled()||e.libraryForm.invalid),a(),g(n("next"))}}function zr(i,o){if(i&1){let n=T();l(0,"button",81),f("click",function(){_(n);let t=c(2);return u(t.save())}),d(1),s()}if(i&2){let n=c().$implicit,e=c();p("disabled",e.isDisabled()),a(),g(n("save"))}}function Qr(i,o){if(i&1){let n=T();U(0),l(1,"div",6)(2,"h4",7),h(3,Er,3,5,"ng-container",8)(4,Tr,1,1,"ng-template",null,0,w),s(),l(6,"button",9),f("click",function(){_(n);let t=c();return u(t.close())}),s()(),l(7,"form",10)(8,"div")(9,"ul",11,1),N("activeIdChange",function(t){_(n);let r=c();return V(r.active,t)||(r.active=t),u(t)}),l(11,"li",12)(12,"a",13),d(13),s(),h(14,Ur,19,10,"ng-template",14),s(),l(15,"li",15)(16,"a",13),d(17),s(),h(18,Br,20,11,"ng-template",14),s(),l(19,"li",15)(20,"a",13),d(21),s(),h(22,Wr,4,4,"ng-template",14),s(),l(23,"li",15)(24,"a",13),d(25),s(),h(26,jr,82,18,"ng-template",14),s()(),y(27,"div",16),s()(),l(28,"div",17)(29,"button",18),f("click",function(){_(n);let t=c();return u(t.forceScan())}),d(30),s(),l(31,"button",19),f("click",function(){_(n);let t=c();return u(t.reset())}),d(32),s(),l(33,"button",20),f("click",function(){_(n);let t=c();return u(t.close())}),d(34),s(),h(35,qr,3,2,"ng-container",8)(36,zr,2,2,"ng-template",null,2,w),s(),A()}if(i&2){let n=o.$implicit,e=$(5),t=$(10),r=$(37),m=c();a(3),p("ngIf",!m.isAddLibrary)("ngIfElse",e),a(3),ee("aria-label",n("close")),a(),p("formGroup",m.libraryForm),a(),te("modal-body scrollable-modal ",m.utilityService.getActiveBreakpoint()===m.Breakpoint.Mobile?"":"d-flex",""),a(),ke("orientation",m.utilityService.getActiveBreakpoint()===m.Breakpoint.Mobile?"horizontal":"vertical"),R("activeId",m.active),a(2),p("ngbNavItem",m.TabID.General),a(2),g(n(m.TabID.General)),a(2),p("ngbNavItem",m.TabID.Folder)("disabled",m.isAddLibrary&&m.setupStep<1),a(2),g(n(m.TabID.Folder)),a(2),p("ngbNavItem",m.TabID.Cover)("disabled",m.isAddLibrary&&m.setupStep<2),a(2),g(n(m.TabID.Cover)),a(2),p("ngbNavItem",m.TabID.Advanced)("disabled",m.isAddLibrary&&m.setupStep<3),a(2),g(n(m.TabID.Advanced)),a(2),te("tab-content ",m.utilityService.getActiveBreakpoint()===m.Breakpoint.Mobile?"mt-3":"ms-4 flex-fill",""),p("ngbNavOutlet",t),a(2),p("placement","above")("ngbTooltip",n("force-scan-tooltip")),a(),g(n("force-scan")),a(2),g(n("reset")),a(2),g(n("cancel")),a(),p("ngIf",m.isAddLibrary&&m.setupStep!==3)("ngIfElse",r)}}var pt=function(i){return i.General="general-tab",i.Folder="folder-tab",i.Cover="cover-tab",i.Advanced="advanced-tab",i}(pt||{}),Pe=function(i){return i[i.General=0]="General",i[i.Folder=1]="Folder",i[i.Cover=2]="Cover",i[i.Advanced=3]="Advanced",i}(Pe||{}),Xi=(()=>{let o=class o{constructor(){this.LibraryType=fe,this.Breakpoint=lt,this.TabID=pt,this.WikiLink=ot,this.utilityService=k(Ee),this.modal=k(Ce),this.destroyRef=k(Se),this.uploadService=k(je),this.modalService=k(wt),this.settingService=k(Li),this.confirmService=k(Tt),this.libraryService=k(Le),this.toastr=k(_e),this.cdRef=k(ce),this.imageService=k(Te),this.active=pt.General,this.imageUrls=[],this.libraryForm=new we({name:new E("",{nonNullable:!0,validators:[B.required]}),type:new E(fe.Manga,{nonNullable:!0,validators:[B.required]}),folderWatching:new E(!0,{nonNullable:!0,validators:[B.required]}),includeInDashboard:new E(!0,{nonNullable:!0,validators:[B.required]}),includeInRecommended:new E(!0,{nonNullable:!0,validators:[B.required]}),includeInSearch:new E(!0,{nonNullable:!0,validators:[B.required]}),manageCollections:new E(!0,{nonNullable:!0,validators:[B.required]}),manageReadingLists:new E(!0,{nonNullable:!0,validators:[B.required]}),allowScrobbling:new E(!0,{nonNullable:!0,validators:[B.required]}),collapseSeriesRelationships:new E(!1,{nonNullable:!0,validators:[B.required]})}),this.selectedFolders=[],this.madeChanges=!1,this.libraryTypes=[],this.isAddLibrary=!1,this.setupStep=Pe.General,this.fileTypeGroups=gt,this.excludePatterns=[""]}get IsKavitaPlusEligible(){let e=parseInt(this.libraryForm.get("type")?.value+"",10);return e===fe.Manga||e===fe.LightNovel}ngOnInit(){this.settingService.getLibraryTypes().subscribe(e=>{this.libraryTypes=e,this.cdRef.markForCheck()}),this.library===void 0&&(this.isAddLibrary=!0,this.cdRef.markForCheck()),this.library?.coverImage!=null&&this.library?.coverImage!==""&&(this.imageUrls.push(this.imageService.getLibraryCoverImage(this.library.id)),this.cdRef.markForCheck()),this.library&&(this.library.type===fe.Comic||this.library.type===fe.Book)&&(this.libraryForm.get("allowScrobbling")?.setValue(!1),this.libraryForm.get("allowScrobbling")?.disable()),this.libraryForm.get("name")?.valueChanges.pipe(Me(100),Fe(),ze(e=>this.libraryService.libraryNameExists(e)),ve(e=>{let t=this.libraryForm.get("name")?.value===this.library?.name;!e||t?this.libraryForm.get("name")?.setErrors(null):this.libraryForm.get("name")?.setErrors({duplicateName:!0}),this.cdRef.markForCheck()}),Z(this.destroyRef)).subscribe(),this.setValues(),this.libraryForm.get("type")?.valueChanges.pipe(ve(e=>{switch(parseInt(e+"",10)){case fe.Manga:this.libraryForm.get(P.Archive+"")?.setValue(!0),this.libraryForm.get(P.Images+"")?.setValue(!0),this.libraryForm.get(P.Pdf+"")?.setValue(!1),this.libraryForm.get(P.Epub+"")?.setValue(!1);break;case fe.Comic:case fe.ComicVine:this.libraryForm.get(P.Archive+"")?.setValue(!0),this.libraryForm.get(P.Images+"")?.setValue(!1),this.libraryForm.get(P.Pdf+"")?.setValue(!1),this.libraryForm.get(P.Epub+"")?.setValue(!1);break;case fe.Book:this.libraryForm.get(P.Archive+"")?.setValue(!1),this.libraryForm.get(P.Images+"")?.setValue(!1),this.libraryForm.get(P.Pdf+"")?.setValue(!0),this.libraryForm.get(P.Epub+"")?.setValue(!0);break;case fe.LightNovel:this.libraryForm.get(P.Archive+"")?.setValue(!1),this.libraryForm.get(P.Images+"")?.setValue(!1),this.libraryForm.get(P.Pdf+"")?.setValue(!1),this.libraryForm.get(P.Epub+"")?.setValue(!0);break;case fe.Images:this.libraryForm.get(P.Archive+"")?.setValue(!1),this.libraryForm.get(P.Images+"")?.setValue(!0),this.libraryForm.get(P.Pdf+"")?.setValue(!1),this.libraryForm.get(P.Epub+"")?.setValue(!1);break}this.libraryForm.get("allowScrobbling")?.setValue(this.IsKavitaPlusEligible),this.cdRef.markForCheck()}),Z(this.destroyRef)).subscribe()}setValues(){if(this.library!==void 0){this.libraryForm.get("name")?.setValue(this.library.name),this.libraryForm.get("type")?.setValue(this.library.type),this.libraryForm.get("folderWatching")?.setValue(this.library.folderWatching),this.libraryForm.get("includeInDashboard")?.setValue(this.library.includeInDashboard),this.libraryForm.get("includeInRecommended")?.setValue(this.library.includeInRecommended),this.libraryForm.get("includeInSearch")?.setValue(this.library.includeInSearch),this.libraryForm.get("manageCollections")?.setValue(this.library.manageCollections),this.libraryForm.get("manageReadingLists")?.setValue(this.library.manageReadingLists),this.libraryForm.get("collapseSeriesRelationships")?.setValue(this.library.collapseSeriesRelationships),this.libraryForm.get("allowScrobbling")?.setValue(this.library.allowScrobbling),this.selectedFolders=this.library.folders,this.madeChanges=!1;for(let e of gt)this.libraryForm.addControl(e+"",new E(this.library.libraryFileTypes.includes(e),[]));for(let e of this.library.excludePatterns)this.libraryForm.addControl("excludeGlob-",new E(e,[]));this.excludePatterns=this.library.excludePatterns}else for(let e of gt)this.libraryForm.addControl(e+"",new E(!0,[]));this.excludePatterns.length===0&&(this.excludePatterns=[""]),this.cdRef.markForCheck()}updateGlobs(e){this.excludePatterns=e,this.cdRef.markForCheck()}isDisabled(){return!(this.libraryForm.valid&&this.selectedFolders.length>0)}reset(){this.setValues()}close(e=!1){this.modal.close(e)}forceScan(){this.libraryService.scan(this.library.id,!0).subscribe(()=>{this.toastr.info(I("toasts.forced-scan-queued",{name:this.library.name})),this.close()})}save(){return ie(this,null,function*(){let e=this.libraryForm.value;e.folders=this.selectedFolders,e.fileGroupTypes=[];for(let t of gt)e[t]&&e.fileGroupTypes.push(t);if(e.excludePatterns=this.excludePatterns,!this.libraryForm.errors)if(this.library!==void 0){if(e.id=this.library.id,e.folders=e.folders.map(t=>t.startsWith("\\")?t.substr(1,t.length):t),e.type=parseInt(e.type,10),e.type!==this.library.type&&!(yield this.confirmService.confirm(I("toasts.confirm-library-type-change"))))return;this.libraryService.update(e).subscribe(()=>{this.close(!0)})}else e.folders=e.folders.map(t=>t.startsWith("\\")?t.substr(1,t.length):t),e.type=parseInt(e.type,10),this.libraryService.create(e).subscribe(()=>{this.toastr.success(I("toasts.library-created")),this.close(!0)})})}nextStep(){switch(this.setupStep++,this.setupStep){case Pe.Folder:this.active=pt.Folder;break;case Pe.Cover:this.active=pt.Cover;break;case Pe.Advanced:this.active=pt.Advanced;break}this.cdRef.markForCheck()}applyCoverImage(e){this.uploadService.updateLibraryCoverImage(this.library.id,e).subscribe(()=>{})}updateCoverImageIndex(e){e<=0||this.applyCoverImage(this.imageUrls[e])}resetCoverImage(){this.uploadService.updateLibraryCoverImage(this.library.id,"").subscribe(()=>{})}openDirectoryPicker(){this.modalService.open(Hi,{scrollable:!0,size:"lg"}).closed.subscribe(t=>{t.success&&(this.selectedFolders.includes(t.folderPath)||(this.selectedFolders.push(t.folderPath),this.madeChanges=!0,this.cdRef.markForCheck()))})}removeFolder(e){this.selectedFolders=this.selectedFolders.filter(t=>t!==e),this.madeChanges=!0,this.cdRef.markForCheck()}isNextDisabled(){switch(this.setupStep){case Pe.General:return this.libraryForm.get("name")?.invalid||this.libraryForm.get("type")?.invalid;case Pe.Folder:return this.selectedFolders.length===0;case Pe.Cover:return!1;case Pe.Advanced:return!1}}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=j({type:o,selectors:[["app-library-settings-modal"]],inputs:{library:"library"},standalone:!0,features:[Y],decls:1,vars:1,consts:[["addLibraryTitle",""],["nav","ngbNav"],["editLibraryButton",""],["typeTooltip",""],["kavitaplusEligibleTooltip",""],[4,"transloco","translocoRead"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],[4,"ngIf","ngIfElse"],["type","button",1,"btn-close",3,"click"],[3,"formGroup"],["ngbNav","",1,"nav-pills",2,"min-width","135px",3,"activeIdChange","activeId","orientation"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavItem","disabled"],[3,"ngbNavOutlet"],[1,"modal-footer"],["type","button",1,"btn","btn-light",3,"click","placement","ngbTooltip"],["type","button",1,"btn","btn-light",3,"click"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"mb-3"],["for","library-name",1,"form-label"],["id","library-name","formControlName","name","type","text",1,"form-control"],["id","inviteForm-validations","class","invalid-feedback",4,"ngIf"],["for","library-type",1,"form-label"],["placement","end","role","button","tabindex","0",1,"fa","fa-info-circle","ms-1",3,"ngbTooltip"],[1,"float-end"],["id","library-type-help",1,"visually-hidden"],[3,"ngTemplateOutlet"],["id","library-type","formControlName","type","aria-describedby","library-type-help",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["id","inviteForm-validations",1,"invalid-feedback"],["placement","start","role","button","tabindex","0",1,"fa","fa-info-circle","ms-1",3,"ngbTooltip"],[3,"value"],[1,"list-group",2,"width","100%"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"row","mt-2"],[1,"btn","btn-secondary","float-end","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-plus"],["rel","noopener noreferrer","target","_blank","referrerpolicy","no-referrer",3,"href"],[1,"list-group-item"],[1,"btn","float-end","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-times-circle"],["class","alert alert-secondary","role","alert",4,"ngIf"],[3,"imageUrlsChange","imageSelected","selectedBase64Url","resetClicked","imageUrls","showReset"],["role","alert",1,"alert","alert-secondary"],[1,"row"],[1,"col-md-12","col-sm-12","pe-2","mb-2"],[1,"mb-3","mt-1"],[1,"accent"],[1,"hstack","gap-2"],["class","form-check form-switch",4,"ngFor","ngForOf"],["ngbAccordion",""],["ngbAccordionItem",""],["ngbAccordionHeader",""],["ngbAccordionButton",""],["ngbAccordionCollapse",""],["ngbAccordionBody",""],[1,"form-check","form-switch"],["type","checkbox","id","manage-collections","role","switch","formControlName","manageCollections",1,"form-check-input"],["for","manage-collections",1,"form-check-label"],["type","checkbox","id","manage-readinglists","role","switch","formControlName","manageReadingLists",1,"form-check-input"],["for","manage-readinglists",1,"form-check-label"],["type","checkbox","id","scrobbling","role","switch","formControlName","allowScrobbling",1,"form-check-input"],["for","scrobbling",1,"form-check-label"],["type","checkbox","id","lib-folder-watching","role","switch","formControlName","folderWatching","aria-labelledby","auto-close-label",1,"form-check-input"],["for","lib-folder-watching",1,"form-check-label"],["type","checkbox","id","include-dashboard","role","switch","formControlName","includeInDashboard","aria-labelledby","auto-close-label",1,"form-check-input"],["for","include-dashboard",1,"form-check-label"],["type","checkbox","id","include-recommended","role","switch","formControlName","includeInRecommended","aria-labelledby","auto-close-label",1,"form-check-input"],["for","include-recommended",1,"form-check-label"],["type","checkbox","id","include-search","role","switch","formControlName","includeInSearch","aria-labelledby","auto-close-label",1,"form-check-input"],["for","include-search",1,"form-check-label"],["type","checkbox",1,"form-check-input",3,"formControlName","id"],[1,"form-check-label",3,"for"],["rel","noopener noreferrer","target","_blank",1,"ms-1",3,"href"],["aria-hidden","true",1,"fa","fa-external-link-alt","ms-1"],[1,"mt-2"],[3,"updateItems","items","label"],["type","button",1,"btn","btn-primary",3,"click","disabled"]],template:function(t,r){t&1&&h(0,Qr,38,31,"ng-container",5),t&2&&p("translocoRead","library-settings-modal")},dependencies:[de,xe,ne,We,yt,Et,nt,tt,et,X,oe,Xe,Ke,re,St,Je,J,ae,me,pe,at,Vt,it,rt,mt,$e,H,At,Ji,Si,yi,bi,Ci,xi,vi,Bt],styles:["/*# sourceMappingURL=library-settings-modal.component-RALEQG7Z.css.map */"],changeDetection:0});let i=o;return i})();var Xs=(()=>{let o=class o{constructor(e,t,r,m,v,C,W,ue,_t){this.libraryService=e,this.seriesService=t,this.readerService=r,this.toastr=m,this.modalService=v,this.confirmService=C,this.memberService=W,this.deviceService=ue,this.collectionTagService=_t,this.onDestroy=new ut,this.readingListModalRef=null,this.collectionModalRef=null}ngOnDestroy(){this.onDestroy.next(),this.onDestroy.complete()}scanLibrary(e,t){return ie(this,null,function*(){if(!e.hasOwnProperty("id")||e.id===void 0)return;this.libraryService.scan(e.id,!1).pipe(L(1)).subscribe(m=>{this.toastr.info(I("toasts.scan-queued",{name:e.name})),t&&t(e)})})}refreshMetadata(e,t){return ie(this,null,function*(){if(!e.hasOwnProperty("id")||e.id===void 0)return;if(!(yield this.confirmService.confirm(I("toasts.confirm-regen-covers")))){t&&t(e);return}this.libraryService.refreshMetadata(e?.id,!0).pipe(L(1)).subscribe(m=>{this.toastr.info(I("toasts.scan-queued",{name:e.name})),t&&t(e)})})}editLibrary(e,t){let r=this.modalService.open(Xi,{size:"xl",fullscreen:"md"});r.componentInstance.library=e,r.closed.subscribe(m=>{t&&t(e)})}analyzeFiles(e,t){return ie(this,null,function*(){if(!(!e.hasOwnProperty("id")||e.id===void 0)){if(!(yield this.confirmService.alert(I("toasts.alert-long-running")))){t&&t(e);return}this.libraryService.analyze(e?.id).pipe(L(1)).subscribe(r=>{this.toastr.info(I("toasts.library-file-analysis-queued",{name:e.name})),t&&t(e)})}})}deleteLibrary(e,t){return ie(this,null,function*(){if(!(!e.hasOwnProperty("id")||e.id===void 0)){if(!(yield this.confirmService.alert(I("toasts.confirm-library-delete")))){t&&t(e);return}this.libraryService.delete(e?.id).pipe(L(1)).subscribe(r=>{this.toastr.info(I("toasts.library-deleted",{name:e.name})),t&&t(e)})}})}markSeriesAsRead(e,t){this.seriesService.markRead(e.id).pipe(L(1)).subscribe(r=>{e.pagesRead=e.pages,this.toastr.success(I("toasts.entity-read",{name:e.name})),t&&t(e)})}markSeriesAsUnread(e,t){this.seriesService.markUnread(e.id).pipe(L(1)).subscribe(r=>{e.pagesRead=0,this.toastr.success(I("toasts.entity-unread",{name:e.name})),t&&t(e)})}scanSeries(e,t){return ie(this,null,function*(){this.seriesService.scan(e.libraryId,e.id).pipe(L(1)).subscribe(r=>{this.toastr.info(I("toasts.scan-queued",{name:e.name})),t&&t(e)})})}analyzeFilesForSeries(e,t){this.seriesService.analyzeFiles(e.libraryId,e.id).pipe(L(1)).subscribe(r=>{this.toastr.info(I("toasts.scan-queued",{name:e.name})),t&&t(e)})}refreshMetdata(e,t){return ie(this,null,function*(){if(!(yield this.confirmService.confirm(I("toasts.confirm-regen-covers")))){t&&t(e);return}this.seriesService.refreshMetadata(e).pipe(L(1)).subscribe(r=>{this.toastr.info(I("toasts.refresh-covers-queued",{name:e.name})),t&&t(e)})})}markVolumeAsRead(e,t,r){this.readerService.markVolumeRead(e,t.id).pipe(L(1)).subscribe(()=>{t.pagesRead=t.pages,t.chapters?.forEach(m=>m.pagesRead=m.pages),this.toastr.success(I("toasts.mark-read")),r&&r(t)})}markVolumeAsUnread(e,t,r){this.readerService.markVolumeUnread(e,t.id).subscribe(()=>{t.pagesRead=0,t.chapters?.forEach(m=>m.pagesRead=0),this.toastr.success(I("toasts.mark-unread")),r&&r(t)})}markChapterAsRead(e,t,r,m){this.readerService.saveProgress(e,t,r.volumeId,r.id,r.pages).pipe(L(1)).subscribe(v=>{r.pagesRead=r.pages,this.toastr.success(I("toasts.mark-read")),m&&m(r)})}markChapterAsUnread(e,t,r,m){this.readerService.saveProgress(e,t,r.volumeId,r.id,0).pipe(L(1)).subscribe(v=>{r.pagesRead=0,this.toastr.success(I("toasts.mark-unread")),m&&m(r)})}markMultipleAsRead(e,t,r,m){this.readerService.markMultipleRead(e,t.map(v=>v.id),r?.map(v=>v.id)).pipe(L(1)).subscribe(()=>{t.forEach(v=>{v.pagesRead=v.pages,v.chapters?.forEach(C=>C.pagesRead=C.pages)}),r?.forEach(v=>v.pagesRead=v.pages),this.toastr.success(I("toasts.mark-read")),m&&m()})}markMultipleAsUnread(e,t,r,m){this.readerService.markMultipleUnread(e,t.map(v=>v.id),r?.map(v=>v.id)).pipe(L(1)).subscribe(()=>{t.forEach(v=>{v.pagesRead=0,v.chapters?.forEach(C=>C.pagesRead=0)}),r?.forEach(v=>v.pagesRead=0),this.toastr.success(I("toasts.mark-unread")),m&&m()})}markMultipleSeriesAsRead(e,t){this.readerService.markMultipleSeriesRead(e.map(r=>r.id)).pipe(L(1)).subscribe(()=>{e.forEach(r=>{r.pagesRead=r.pages}),this.toastr.success(I("toasts.mark-read")),t&&t()})}markMultipleSeriesAsUnread(e,t){this.readerService.markMultipleSeriesUnread(e.map(r=>r.id)).pipe(L(1)).subscribe(()=>{e.forEach(r=>{r.pagesRead=r.pages}),this.toastr.success(I("toasts.mark-unread")),t&&t()})}promoteMultipleCollections(e,t,r){this.collectionTagService.promoteMultipleCollections(e.map(m=>m.id),t).pipe(L(1)).subscribe(()=>{t?this.toastr.success(I("toasts.collections-promoted")):this.toastr.success(I("toasts.collections-unpromoted")),r&&r(!0)})}deleteMultipleCollections(e,t){return ie(this,null,function*(){(yield this.confirmService.confirm(I("toasts.confirm-delete-collections")))&&this.collectionTagService.deleteMultipleCollections(e.map(r=>r.id)).pipe(L(1)).subscribe(()=>{this.toastr.success(I("toasts.collections-deleted")),t&&t(!0)})})}addMultipleToReadingList(e,t,r,m){this.readingListModalRef==null&&(this.readingListModalRef=this.modalService.open(ct,{scrollable:!0,size:"md",fullscreen:"md"}),this.readingListModalRef.componentInstance.seriesId=e,this.readingListModalRef.componentInstance.volumeIds=t.map(v=>v.id),this.readingListModalRef.componentInstance.chapterIds=r?.map(v=>v.id),this.readingListModalRef.componentInstance.title="Multiple Selections",this.readingListModalRef.componentInstance.type=be.Multiple,this.readingListModalRef.closed.pipe(L(1)).subscribe(()=>{this.readingListModalRef=null,m&&m(!0)}),this.readingListModalRef.dismissed.pipe(L(1)).subscribe(()=>{this.readingListModalRef=null,m&&m(!1)}))}addMultipleSeriesToWantToReadList(e,t){this.memberService.addSeriesToWantToRead(e).subscribe(()=>{this.toastr.success("Series added to Want to Read list"),t&&t()})}removeMultipleSeriesFromWantToReadList(e,t){this.memberService.removeSeriesToWantToRead(e).subscribe(()=>{this.toastr.success(I("toasts.series-removed-want-to-read")),t&&t()})}addMultipleSeriesToReadingList(e,t){this.readingListModalRef==null&&(this.readingListModalRef=this.modalService.open(ct,{scrollable:!0,size:"md",fullscreen:"md"}),this.readingListModalRef.componentInstance.seriesIds=e.map(r=>r.id),this.readingListModalRef.componentInstance.title="Multiple Selections",this.readingListModalRef.componentInstance.type=be.Multiple_Series,this.readingListModalRef.closed.pipe(L(1)).subscribe(()=>{this.readingListModalRef=null,t&&t(!0)}),this.readingListModalRef.dismissed.pipe(L(1)).subscribe(()=>{this.readingListModalRef=null,t&&t(!1)}))}addMultipleSeriesToCollectionTag(e,t){this.collectionModalRef==null&&(this.collectionModalRef=this.modalService.open(qi,{scrollable:!0,size:"md",windowClass:"collection",fullscreen:"md"}),this.collectionModalRef.componentInstance.seriesIds=e.map(r=>r.id),this.collectionModalRef.componentInstance.title="New Collection",this.collectionModalRef.closed.pipe(L(1)).subscribe(()=>{this.collectionModalRef=null,t&&t(!0)}),this.collectionModalRef.dismissed.pipe(L(1)).subscribe(()=>{this.collectionModalRef=null,t&&t(!1)}))}addSeriesToReadingList(e,t){this.readingListModalRef==null&&(this.readingListModalRef=this.modalService.open(ct,{scrollable:!0,size:"md",fullscreen:"md"}),this.readingListModalRef.componentInstance.seriesId=e.id,this.readingListModalRef.componentInstance.title=e.name,this.readingListModalRef.componentInstance.type=be.Series,this.readingListModalRef.closed.pipe(L(1)).subscribe(()=>{this.readingListModalRef=null,t&&t(e)}),this.readingListModalRef.dismissed.pipe(L(1)).subscribe(()=>{this.readingListModalRef=null,t&&t(e)}))}addVolumeToReadingList(e,t,r){this.readingListModalRef==null&&(this.readingListModalRef=this.modalService.open(ct,{scrollable:!0,size:"md",fullscreen:"md"}),this.readingListModalRef.componentInstance.seriesId=t,this.readingListModalRef.componentInstance.volumeId=e.id,this.readingListModalRef.componentInstance.type=be.Volume,this.readingListModalRef.closed.pipe(L(1)).subscribe(()=>{this.readingListModalRef=null,r&&r(e)}),this.readingListModalRef.dismissed.pipe(L(1)).subscribe(()=>{this.readingListModalRef=null,r&&r(e)}))}addChapterToReadingList(e,t,r){this.readingListModalRef==null&&(this.readingListModalRef=this.modalService.open(ct,{scrollable:!0,size:"md",fullscreen:"md"}),this.readingListModalRef.componentInstance.seriesId=t,this.readingListModalRef.componentInstance.chapterId=e.id,this.readingListModalRef.componentInstance.type=be.Chapter,this.readingListModalRef.closed.pipe(L(1)).subscribe(()=>{this.readingListModalRef=null,r&&r(e)}),this.readingListModalRef.dismissed.pipe(L(1)).subscribe(()=>{this.readingListModalRef=null,r&&r(e)}))}editReadingList(e,t){let r=this.modalService.open(Zi,{scrollable:!0,size:"lg",fullscreen:"md"});r.componentInstance.readingList=e,r.closed.pipe(L(1)).subscribe(m=>{t&&m!==void 0&&t(e)}),r.dismissed.pipe(L(1)).subscribe(m=>{t&&m!==void 0&&t(e)})}deleteMultipleSeries(e,t){return ie(this,null,function*(){if(!(yield this.confirmService.confirm(I("toasts.confirm-delete-multiple-series",{count:e.length})))){t&&t(!1);return}this.seriesService.deleteMultipleSeries(e.map(r=>r.id)).pipe(L(1)).subscribe(r=>{r?this.toastr.success(I("toasts.series-deleted")):this.toastr.error(I("errors.generic")),t&&t(r)})})}deleteSeries(e,t){return ie(this,null,function*(){if(!(yield this.confirmService.confirm(I("toasts.confirm-delete-series")))){t&&t(!1);return}this.seriesService.delete(e.id).subscribe(r=>{t&&(r?this.toastr.success(I("toasts.series-deleted")):this.toastr.error(I("errors.generic")),t(r))})})}sendToDevice(e,t,r){this.deviceService.sendTo(e,t.id).subscribe(()=>{this.toastr.success(I("toasts.file-send-to",{name:t.name})),r&&r()})}sendSeriesToDevice(e,t,r){this.deviceService.sendSeriesTo(e,t.id).subscribe(()=>{this.toastr.success(I("toasts.file-send-to",{name:t.name})),r&&r()})}};o.\u0275fac=function(t){return new(t||o)(K(Le),K(st),K(Ri),K(_e),K(wt),K(Tt),K(Vi),K(Ti),K(Mt))},o.\u0275prov=Ue({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var S=function(i){return i[i.Prequel=1]="Prequel",i[i.Sequel=2]="Sequel",i[i.SpinOff=3]="SpinOff",i[i.Adaptation=4]="Adaptation",i[i.SideStory=5]="SideStory",i[i.Character=6]="Character",i[i.Contains=7]="Contains",i[i.Other=8]="Other",i[i.AlternativeSetting=9]="AlternativeSetting",i[i.AlternativeVersion=10]="AlternativeVersion",i[i.Doujinshi=11]="Doujinshi",i[i.Parent=12]="Parent",i[i.Edition=13]="Edition",i[i.Annual=14]="Annual",i}(S||{}),Yr=[{text:"Prequel",value:S.Prequel},{text:"Sequel",value:S.Sequel},{text:"Spin Off",value:S.SpinOff},{text:"Adaptation",value:S.Adaptation},{text:"Annual",value:S.Annual},{text:"Alternative Setting",value:S.AlternativeSetting},{text:"Alternative Version",value:S.AlternativeVersion},{text:"Side Story",value:S.SideStory},{text:"Character",value:S.Character},{text:"Contains",value:S.Contains},{text:"Edition",value:S.Edition},{text:"Doujinshi",value:S.Doujinshi},{text:"Other",value:S.Other}],Ki=Yr.slice().sort((i,o)=>i.text.localeCompare(o.text));var De=class{constructor(){this.debounce=200,this.multiple=!1,this.id="",this.showLocked=!1,this.minCharacters=1,this.unique=!0,this.addIfNonExisting=!1}};var Ot=class{constructor(){this.libraries=[],this.series=[],this.collections=[],this.readingLists=[],this.persons=[],this.genres=[],this.tags=[],this.files=[],this.chapters=[],this.bookmarks=[]}reset(){this.libraries=[],this.series=[],this.collections=[],this.readingLists=[],this.persons=[],this.genres=[],this.tags=[],this.files=[],this.chapters=[],this.bookmarks=[]}};var en=(()=>{let o=class o{constructor(e){this.httpClient=e,this.baseUrl=Ze.apiUrl}search(e){return e===""?ge(new Ot):this.httpClient.get(this.baseUrl+"search/search?queryString="+encodeURIComponent(e))}getSeriesForMangaFile(e){return this.httpClient.get(this.baseUrl+"search/series-for-mangafile?mangaFileId="+e)}getSeriesForChapter(e){return this.httpClient.get(this.baseUrl+"search/series-for-chapter?chapterId="+e)}};o.\u0275fac=function(t){return new(t||o)(K(Ye))},o.\u0275prov=Ue({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var tn=(()=>{let o=class o{constructor(){this.translocoService=k(He)}transform(e){if(e===void 0)return"";switch(e){case S.Adaptation:return this.translocoService.translate("relationship-pipe.adaptation");case S.AlternativeSetting:return this.translocoService.translate("relationship-pipe.alternative-setting");case S.AlternativeVersion:return this.translocoService.translate("relationship-pipe.alternative-version");case S.Character:return this.translocoService.translate("relationship-pipe.character");case S.Contains:return this.translocoService.translate("relationship-pipe.contains");case S.Doujinshi:return this.translocoService.translate("relationship-pipe.doujinshi");case S.Other:return this.translocoService.translate("relationship-pipe.other");case S.Prequel:return this.translocoService.translate("relationship-pipe.prequel");case S.Sequel:return this.translocoService.translate("relationship-pipe.sequel");case S.SideStory:return this.translocoService.translate("relationship-pipe.side-story");case S.SpinOff:return this.translocoService.translate("relationship-pipe.spin-off");case S.Parent:return this.translocoService.translate("relationship-pipe.parent");case S.Edition:return this.translocoService.translate("relationship-pipe.edition");case S.Annual:return this.translocoService.translate("relationship-pipe.annual");default:return""}}};o.\u0275fac=function(t){return new(t||o)},o.\u0275pipe=Qe({name:"relationship",type:o,pure:!0,standalone:!0});let i=o;return i})();function Zr(i,o){if(i&1&&(l(0,"div",9)(1,"label",10),d(2),s(),l(3,"label",11),d(4),s()()),i&2){let n=c().$implicit;a(2),g(n("target-series")),a(2),g(n("relationship"))}}function Hr(i,o){if(i&1&&d(0),i&2){let n=o.$implicit,e=c(3);G(" ",n.name," (",e.libraryNames[n.libraryId],") ")}}function Jr(i,o){if(i&1&&d(0),i&2){let n=o.$implicit,e=c(3);G(" ",n.name," (",e.libraryNames[n.libraryId],") ")}}function Xr(i,o){if(i&1&&(l(0,"option",21),d(1),M(2,"relationship"),s()),i&2){let n=o.$implicit;p("value",n.value),a(),g(D(2,2,n.value))}}function Kr(i,o){if(i&1){let n=T();l(0,"div",9)(1,"div",12)(2,"app-typeahead",13),f("selectedData",function(t){let r=_(n).$implicit,m=c(2);return u(m.updateSeries(t,r))}),h(3,Hr,1,2,"ng-template",null,0,w)(5,Jr,1,2,"ng-template",null,1,w),s()(),l(7,"div",14)(8,"select",15)(9,"option",16),d(10),s(),h(11,Xr,3,4,"option",17),s()(),l(12,"button",18),f("click",function(){let t=_(n).index,r=c(2);return u(r.removeRelation(t))}),y(13,"i",19),l(14,"span",20),d(15),s()()()}if(i&2){let n=o.$implicit,e=o.index,t=c().$implicit,r=c();a(2),Be("id","relation--",e,""),p("settings",n.typeaheadSettings)("focus",r.focusTypeahead),a(6),p("formControl",n.formControl),a(),p("value",r.RelationKind.Parent),a(),g(t("parent")),a(),p("ngForOf",r.relationOptions),a(4),g(t("remove"))}}function ea(i,o){if(i&1){let n=T();U(0),l(1,"div",3)(2,"p"),d(3),l(4,"a",4),d(5),s()(),h(6,Zr,5,2,"div",5),l(7,"form"),h(8,Kr,16,9,"div",6),s(),l(9,"div",7)(10,"button",8),f("click",function(){_(n);let t=c();return u(t.addNewRelation())}),d(11),s()()(),A()}if(i&2){let n=o.$implicit,e=c();a(3),x(" ",n("description-part-1")," "),a(),p("href",e.WikiLink.SeriesRelationships,Ae),a(),g(n("description-part-2")),a(),p("ngIf",e.relations.length>0),a(2),p("ngForOf",e.relations),a(3),g(n("add-relationship"))}}var nn=(()=>{let o=class o{constructor(){this.destroyRef=k(Se),this.cdRef=k(ce),this.seriesService=k(st),this.utilityService=k(Ee),this.libraryService=k(Le),this.searchService=k(en),this.imageService=k(Te),this.RelationKind=S,this.WikiLink=ot,this.save=new Q,this.saveApi=new Zt(1),this.relationOptions=Ki,this.relations=[],this.libraryNames={},this.focusTypeahead=new Q}ngOnInit(){this.seriesService.getRelatedForSeries(this.series.id).subscribe(e=>{this.setupRelationRows(e.prequels,S.Prequel),this.setupRelationRows(e.sequels,S.Sequel),this.setupRelationRows(e.sideStories,S.SideStory),this.setupRelationRows(e.spinOffs,S.SpinOff),this.setupRelationRows(e.adaptations,S.Adaptation),this.setupRelationRows(e.others,S.Other),this.setupRelationRows(e.characters,S.Character),this.setupRelationRows(e.alternativeSettings,S.AlternativeSetting),this.setupRelationRows(e.alternativeVersions,S.AlternativeVersion),this.setupRelationRows(e.doujinshis,S.Doujinshi),this.setupRelationRows(e.contains,S.Contains),this.setupRelationRows(e.parent,S.Parent),this.setupRelationRows(e.editions,S.Edition),this.setupRelationRows(e.annuals,S.Annual),this.cdRef.detectChanges()}),this.libraryService.getLibraryNames().subscribe(e=>{this.libraryNames=e,this.cdRef.markForCheck()}),this.save.pipe(Z(this.destroyRef)).subscribe(()=>this.saveState())}setupRelationRows(e,t){e.map((r,m)=>ie(this,null,function*(){let v=yield Wt(this.createSeriesTypeahead(r,t,m)),C=new E(t,[]);return t===S.Parent&&C.disable(),{series:r,typeaheadSettings:v,formControl:C}})).forEach(r=>ie(this,null,function*(){this.relations.push(yield r),this.cdRef.markForCheck()}))}addNewRelation(){return ie(this,null,function*(){this.relations.push({series:void 0,formControl:new E(S.Adaptation,[]),typeaheadSettings:yield Wt(this.createSeriesTypeahead(void 0,S.Adaptation,this.relations.length))}),this.cdRef.markForCheck(),setTimeout(()=>{this.focusTypeahead.emit(`relation--${this.relations.length-1}`)},10)})}removeRelation(e){this.relations.splice(e,1),this.cdRef.markForCheck()}updateSeries(e,t){if(e[0]===void 0){t.series=void 0,this.cdRef.markForCheck();return}t.series={id:e[0].seriesId,name:e[0].name},this.cdRef.markForCheck()}createSeriesTypeahead(e,t,r){let m=new De;return m.minCharacters=0,m.multiple=!1,m.id="relation--"+r,m.unique=!0,m.addIfNonExisting=!1,m.fetchFn=v=>this.searchService.search(v).pipe(z(C=>C.series),z(C=>m.compareFn(C,v)),z(C=>C.filter(W=>W.seriesId!==this.series.id))),m.compareFn=(v,C)=>v.filter(W=>this.utilityService.filter(W.name,C)),m.selectionCompareFn=(v,C)=>v.seriesId==C.seriesId,e!==void 0?this.searchService.search(e.name).pipe(z(v=>v.series),z(v=>(m.savedData=v.filter(C=>C.seriesId===e.id),m))):ge(m)}saveState(){let e=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.Adaptation&&b.series!==void 0).map(b=>b.series.id),t=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.Character&&b.series!==void 0).map(b=>b.series.id),r=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.Contains&&b.series!==void 0).map(b=>b.series.id),m=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.Other&&b.series!==void 0).map(b=>b.series.id),v=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.Prequel&&b.series!==void 0).map(b=>b.series.id),C=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.Sequel&&b.series!==void 0).map(b=>b.series.id),W=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.SideStory&&b.series!==void 0).map(b=>b.series.id),ue=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.SpinOff&&b.series!==void 0).map(b=>b.series.id),_t=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.AlternativeSetting&&b.series!==void 0).map(b=>b.series.id),an=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.AlternativeVersion&&b.series!==void 0).map(b=>b.series.id),on=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.Doujinshi&&b.series!==void 0).map(b=>b.series.id),ln=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.Edition&&b.series!==void 0).map(b=>b.series.id),sn=this.relations.filter(b=>parseInt(b.formControl.value,10)===S.Annual&&b.series!==void 0).map(b=>b.series.id);this.seriesService.updateRelationships(this.series.id,e,t,r,m,v,C,W,ue,_t,an,on,ln,sn).subscribe(()=>{})}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=j({type:o,selectors:[["app-edit-series-relation"]],inputs:{series:"series",save:"save"},outputs:{saveApi:"saveApi"},standalone:!0,features:[Y],decls:1,vars:1,consts:[["badgeItem",""],["optionItem",""],[4,"transloco","translocoRead"],[1,"container-fluid"],["target","_blank","rel","noopener noreferrer","referrerpolicy","no-referrer",3,"href"],["class","row g-0",4,"ngIf"],["class","row g-0",4,"ngFor","ngForOf"],[1,"row","g-0","mt-3","mb-3"],[1,"btn","btn-outline-secondary","col-md-12",3,"click"],[1,"row","g-0"],[1,"form-label","col-md-7"],[1,"form-label","col-md-5"],[1,"col-sm-12","col-md-12","col-lg-7","mb-3"],[3,"selectedData","settings","id","focus"],[1,"col-sm-12","col-md-10","col-lg-3","mb-3"],[1,"form-select",3,"formControl"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"col-sm-auto","col-md-2","mb-3","btn","btn-outline-secondary",3,"click"],[1,"fa","fa-trash"],[1,"visually-hidden"],[3,"value"]],template:function(t,r){t&1&&h(0,ea,12,6,"ng-container",2),t&2&&p("translocoRead","edit-series-relation")},dependencies:[Nt,de,xe,ne,X,oe,Xe,Ke,Je,J,ae,_i,$e,H,tn],styles:["/*# sourceMappingURL=edit-series-relation.component-EUCZKYZI.css.map */"],changeDetection:0});let i=o;return i})();var na=i=>({seriesName:i}),ra=i=>({item:i,field:"sortNameLocked"}),aa=i=>({item:i,field:"localizedNameLocked"}),oa=i=>({item:i,field:"summaryLocked"}),la=i=>({item:i,field:"releaseYearLocked"}),sa=i=>({item:i,field:"ageRatingLocked"}),ca=i=>({item:i,field:"publicationStatusLocked"}),da=()=>({dateStyle:"short"});function ma(i,o){if(i&1&&(l(0,"div",35),d(1),s()),i&2){let n=c(4).$implicit;a(),x(" ",n("required-field")," ")}}function pa(i,o){if(i&1&&(U(0),h(1,ma,2,1,"div",34),A()),i&2){let n=o.ngIf;a(),p("ngIf",n.required)}}function _a(i,o){if(i&1&&(l(0,"div",35),d(1),s()),i&2){let n=c(4).$implicit;a(),x(" ",n("required-field")," ")}}function ua(i,o){if(i&1&&(U(0),h(1,_a,2,1,"div",34),A()),i&2){let n=o.ngIf;a(),p("ngIf",n.required)}}function ga(i,o){if(i&1&&(l(0,"div",22)(1,"div",23)(2,"label",36),d(3),s(),l(4,"div"),ye(5,29),y(6,"textarea",37),s()()()),i&2){let n=c(3).$implicit,e=$(3),t=c();a(3),g(n("summary-label")),a(),te("input-group ",t.metadata.summaryLocked?"lock-active":"",""),a(),p("ngTemplateOutlet",e)("ngTemplateOutletContext",q(6,oa,t.metadata))}}function ha(i,o){if(i&1&&(l(0,"div",22)(1,"div",23)(2,"label",24),d(3),s(),l(4,"div",25),y(5,"input",26),h(6,pa,2,1,"ng-container",27),s()()(),l(7,"div",22)(8,"div",23)(9,"label",28),d(10),s(),l(11,"div"),ye(12,29),y(13,"input",30),h(14,ua,2,1,"ng-container",27),s()()(),l(15,"div",22)(16,"div",23)(17,"label",31),d(18),s(),l(19,"div"),ye(20,29),y(21,"input",32),s()()(),h(22,ga,7,8,"div",33)),i&2){let n,e,t,r,m=c(2).$implicit,v=$(3),C=c();a(3),g(m("name-label")),a(2),se("is-invalid",((n=C.editSeriesForm.get("name"))==null?null:n.invalid)&&((n=C.editSeriesForm.get("name"))==null?null:n.touched)),a(),p("ngIf",(e=C.editSeriesForm.get("name"))==null?null:e.errors),a(4),g(m("sort-name-label")),a(),te("input-group ",C.series.sortNameLocked?"lock-active":"",""),a(),p("ngTemplateOutlet",v)("ngTemplateOutletContext",q(20,ra,C.series)),a(),se("is-invalid",((t=C.editSeriesForm.get("sortName"))==null?null:t.invalid)&&((t=C.editSeriesForm.get("sortName"))==null?null:t.touched)),a(),p("ngIf",(r=C.editSeriesForm.get("sortName"))==null?null:r.errors),a(4),g(m("localized-name-label")),a(),te("input-group ",C.series.localizedNameLocked?"lock-active":"",""),a(),p("ngTemplateOutlet",v)("ngTemplateOutletContext",q(22,aa,C.series)),a(2),p("ngIf",C.metadata)}}function fa(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.title," ")}}function va(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;G(" ",n.title," (",n.isoCode,") ")}}function xa(i,o){i&1&&(l(0,"p",35),d(1," This must be a valid year greater than 1000 and 4 characters long "),s())}function Ca(i,o){if(i&1&&(U(0),h(1,xa,2,0,"p",34),A()),i&2){let n=o.ngIf;a(),p("ngIf",n.pattern)}}function ba(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.title," ")}}function ya(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.title," ")}}function Sa(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.title," ")}}function Ia(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.title," ")}}function ka(i,o){if(i&1&&(l(0,"option",55),d(1),M(2,"titlecase"),s()),i&2){let n=o.$implicit;p("value",n.value),a(),g(D(2,2,n.title))}}function wa(i,o){if(i&1&&(l(0,"option",55),d(1),M(2,"titlecase"),s()),i&2){let n=o.$implicit;p("value",n.value),a(),g(D(2,2,n.title))}}function Ea(i,o){if(i&1){let n=T();l(0,"div",22)(1,"div",38)(2,"div",39)(3,"label",40),d(4),s(),l(5,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(4);return r.updateLanguage(t),u(r.metadata.languageLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(4);return V(r.metadata.languageLocked,t)||(r.metadata.languageLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(4);return u(t.metadata.languageLocked=!1)})("newItemAdded",function(){_(n);let t=c(4);return u(t.metadata.languageLocked=!0)}),h(6,fa,1,1,"ng-template",null,2,w)(8,va,1,2,"ng-template",null,3,w),s()()(),l(10,"div",42)(11,"div",23)(12,"label",43),d(13),s(),l(14,"div"),ye(15,29),y(16,"input",44),h(17,Ca,2,1,"ng-container",27),s()()()(),l(18,"div",22)(19,"div",45)(20,"div",39)(21,"label",46),d(22),s(),l(23,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(4);return r.updateGenres(t),u(r.metadata.genresLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(4);return V(r.metadata.genresLocked,t)||(r.metadata.genresLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(4);return u(t.metadata.genresLocked=!1)})("newItemAdded",function(){_(n);let t=c(4);return u(t.metadata.genresLocked=!0)}),h(24,ba,1,1,"ng-template",null,2,w)(26,ya,1,1,"ng-template",null,3,w),s()()()(),l(28,"div",22)(29,"div",45)(30,"div",39)(31,"label",47),d(32),s(),l(33,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(4);return r.updateTags(t),u(r.metadata.tagsLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(4);return V(r.metadata.tagsLocked,t)||(r.metadata.tagsLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(4);return u(t.metadata.tagsLocked=!1)})("newItemAdded",function(){_(n);let t=c(4);return u(t.metadata.tagsLocked=!0)}),h(34,Sa,1,1,"ng-template",null,2,w)(36,Ia,1,1,"ng-template",null,3,w),s()()()(),l(38,"div",22)(39,"div",48)(40,"div",39)(41,"label",49),d(42),s(),l(43,"div"),ye(44,29),l(45,"select",50),h(46,ka,3,4,"option",51),s()()()(),l(47,"div",52)(48,"div",39)(49,"label",53),d(50),s(),l(51,"div"),ye(52,29),l(53,"select",54),h(54,wa,3,4,"option",51),s()()()()()}if(i&2){let n,e,t=c(3).$implicit,r=$(3),m=c();a(4),g(t("language-label")),a(),p("settings",m.languageSettings),R("locked",m.metadata.languageLocked),a(8),g(t("release-year-label")),a(),te("input-group ",m.metadata.releaseYearLocked?"lock-active":"",""),a(),p("ngTemplateOutlet",r)("ngTemplateOutletContext",q(32,la,m.metadata)),a(),se("is-invalid",((n=m.editSeriesForm.get("releaseYear"))==null?null:n.invalid)&&((n=m.editSeriesForm.get("releaseYear"))==null?null:n.touched)),a(),p("ngIf",(e=m.editSeriesForm.get("releaseYear"))==null?null:e.errors),a(5),g(t("genres-label")),a(),p("settings",m.genreSettings),R("locked",m.metadata.genresLocked),a(9),g(t("tags-label")),a(),p("settings",m.tagsSettings),R("locked",m.metadata.tagsLocked),a(9),g(t("age-rating-label")),a(),te("input-group ",m.metadata.ageRatingLocked?"lock-active":"",""),a(),p("ngTemplateOutlet",r)("ngTemplateOutletContext",q(34,sa,m.metadata)),a(2),p("ngForOf",m.ageRatings),a(4),g(t("publication-status-label")),a(),te("input-group ",m.metadata.publicationStatusLocked?"lock-active":"",""),a(),p("ngTemplateOutlet",r)("ngTemplateOutletContext",q(36,ca,m.metadata)),a(2),p("ngForOf",m.publicationStatuses)}}function Ta(i,o){if(i&1&&(l(0,"li",13)(1,"a",14),d(2),s(),h(3,Ea,55,38,"ng-template",15),s()),i&2){let n=c(2).$implicit,e=c();p("ngbNavItem",e.tabs[e.TabID.Metadata]),a(2),g(n(e.tabs[e.TabID.Metadata]))}}function La(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Ma(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Fa(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Ra(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Va(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Na(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Pa(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Da(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Ua(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Aa(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Ba(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Oa(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Wa(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function $a(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Ga(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function ja(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function qa(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function za(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Qa(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Ya(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Za(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Ha(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Ja(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Xa(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function Ka(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function eo(i,o){if(i&1&&d(0),i&2){let n=o.$implicit;x(" ",n.name," ")}}function to(i,o){if(i&1){let n=T();l(0,"div",22)(1,"div",39)(2,"label",56),d(3),s(),l(4,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Writer),u(r.metadata.writerLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.writerLocked,t)||(r.metadata.writerLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.writerLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.writerLocked=!0)}),h(5,La,1,1,"ng-template",null,2,w)(7,Ma,1,1,"ng-template",null,3,w),s()()(),l(9,"div",22)(10,"div",39)(11,"label",57),d(12),s(),l(13,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.CoverArtist),u(r.metadata.coverArtistLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.coverArtistLocked,t)||(r.metadata.coverArtistLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.coverArtistLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.coverArtistLocked=!0)}),h(14,Fa,1,1,"ng-template",null,2,w)(16,Ra,1,1,"ng-template",null,3,w),s()()(),l(18,"div",22)(19,"div",39)(20,"label",58),d(21),s(),l(22,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Publisher),u(r.metadata.publisherLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.publisherLocked,t)||(r.metadata.publisherLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.publisherLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.publisherLocked=!0)}),h(23,Va,1,1,"ng-template",null,2,w)(25,Na,1,1,"ng-template",null,3,w),s()()(),l(27,"div",22)(28,"div",39)(29,"label",59),d(30),s(),l(31,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Imprint),u(r.metadata.publisherLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.imprintLocked,t)||(r.metadata.imprintLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.imprintLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.imprintLocked=!0)}),h(32,Pa,1,1,"ng-template",null,2,w)(34,Da,1,1,"ng-template",null,3,w),s()()(),l(36,"div",22)(37,"div",39)(38,"label",60),d(39),s(),l(40,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Penciller),u(r.metadata.pencillerLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.pencillerLocked,t)||(r.metadata.pencillerLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.pencillerLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.pencillerLocked=!0)}),h(41,Ua,1,1,"ng-template",null,2,w)(43,Aa,1,1,"ng-template",null,3,w),s()()(),l(45,"div",22)(46,"div",39)(47,"label",61),d(48),s(),l(49,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Letterer),u(r.metadata.lettererLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.lettererLocked,t)||(r.metadata.lettererLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.lettererLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.lettererLocked=!0)}),h(50,Ba,1,1,"ng-template",null,2,w)(52,Oa,1,1,"ng-template",null,3,w),s()()(),l(54,"div",22)(55,"div",39)(56,"label",62),d(57),s(),l(58,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Inker),u(r.metadata.inkerLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.inkerLocked,t)||(r.metadata.inkerLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.inkerLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.inkerLocked=!0)}),h(59,Wa,1,1,"ng-template",null,2,w)(61,$a,1,1,"ng-template",null,3,w),s()()(),l(63,"div",22)(64,"div",39)(65,"label",63),d(66),s(),l(67,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Editor),u(r.metadata.editorLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.editorLocked,t)||(r.metadata.editorLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.editorLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.editorLocked=!0)}),h(68,Ga,1,1,"ng-template",null,2,w)(70,ja,1,1,"ng-template",null,3,w),s()()(),l(72,"div",22)(73,"div",39)(74,"label",64),d(75),s(),l(76,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Colorist),u(r.metadata.coloristLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.coloristLocked,t)||(r.metadata.coloristLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.coloristLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.coloristLocked=!0)}),h(77,qa,1,1,"ng-template",null,2,w)(79,za,1,1,"ng-template",null,3,w),s()()(),l(81,"div",22)(82,"div",39)(83,"label",65),d(84),s(),l(85,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Translator),u(r.metadata.translatorLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.translatorLocked,t)||(r.metadata.translatorLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.translatorLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.translatorLocked=!0)}),h(86,Qa,1,1,"ng-template",null,2,w)(88,Ya,1,1,"ng-template",null,3,w),s()()(),l(90,"div",22)(91,"div",39)(92,"label",66),d(93),s(),l(94,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Character),u(r.metadata.characterLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.characterLocked,t)||(r.metadata.characterLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.characterLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.characterLocked=!0)}),h(95,Za,1,1,"ng-template",null,2,w)(97,Ha,1,1,"ng-template",null,3,w),s()()(),l(99,"div",22)(100,"div",39)(101,"label",67),d(102),s(),l(103,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Character),u(r.metadata.teamLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.teamLocked,t)||(r.metadata.teamLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.teamLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.teamLocked=!0)}),h(104,Ja,1,1,"ng-template",null,2,w)(106,Xa,1,1,"ng-template",null,3,w),s()()(),l(108,"div",22)(109,"div",39)(110,"label",68),d(111),s(),l(112,"app-typeahead",41),f("selectedData",function(t){_(n);let r=c(3);return r.updatePerson(t,r.PersonRole.Location),u(r.metadata.locationLocked=!0)}),N("lockedChange",function(t){_(n);let r=c(3);return V(r.metadata.locationLocked,t)||(r.metadata.locationLocked=t),u(t)}),f("onUnlock",function(){_(n);let t=c(3);return u(t.metadata.locationLocked=!1)})("newItemAdded",function(){_(n);let t=c(3);return u(t.metadata.locationLocked=!0)}),h(113,Ka,1,1,"ng-template",null,2,w)(115,eo,1,1,"ng-template",null,3,w),s()()()}if(i&2){let n=c(2).$implicit,e=c();a(3),g(n("writer-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Writer)),R("locked",e.metadata.writerLocked),a(8),g(n("cover-artist-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.CoverArtist)),R("locked",e.metadata.coverArtistLocked),a(8),g(n("publisher-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Publisher)),R("locked",e.metadata.publisherLocked),a(8),g(n("imprint-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Imprint)),R("locked",e.metadata.imprintLocked),a(8),g(n("penciller-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Penciller)),R("locked",e.metadata.pencillerLocked),a(8),g(n("letterer-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Letterer)),R("locked",e.metadata.lettererLocked),a(8),g(n("inker-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Inker)),R("locked",e.metadata.inkerLocked),a(8),g(n("editor-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Editor)),R("locked",e.metadata.editorLocked),a(8),g(n("colorist-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Colorist)),R("locked",e.metadata.coloristLocked),a(8),g(n("translator-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Translator)),R("locked",e.metadata.translatorLocked),a(8),g(n("character-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Character)),R("locked",e.metadata.characterLocked),a(8),g(n("team-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Team)),R("locked",e.metadata.teamLocked),a(8),g(n("location-label")),a(),p("settings",e.getPersonsSettings(e.PersonRole.Location)),R("locked",e.metadata.locationLocked)}}function io(i,o){if(i&1){let n=T();l(0,"p"),d(1),s(),l(2,"app-edit-list",69),f("updateItems",function(t){_(n);let r=c(4);return u(r.updateWeblinks(t))}),s()}if(i&2){let n=c(3).$implicit,e=c();a(),g(n("web-link-description")),a(),p("items",e.WebLinks)("label",n("web-link-label"))}}function no(i,o){if(i&1&&(l(0,"li",13)(1,"a",14),d(2),s(),h(3,io,3,3,"ng-template",15),s()),i&2){let n=c(2).$implicit,e=c();p("ngbNavItem",e.tabs[e.TabID.WebLinks]),a(2),g(n(e.tabs[e.TabID.WebLinks]))}}function ro(i,o){if(i&1){let n=T();l(0,"p",70),d(1),s(),l(2,"app-cover-image-chooser",71),N("imageUrlsChange",function(t){_(n);let r=c(3);return V(r.imageUrls,t)||(r.imageUrls=t),u(t)}),f("imageSelected",function(t){_(n);let r=c(3);return u(r.updateSelectedIndex(t))})("selectedBase64Url",function(t){_(n);let r=c(3);return u(r.updateSelectedImage(t))})("resetClicked",function(){_(n);let t=c(3);return u(t.handleReset())}),s()}if(i&2){let n=c(2).$implicit,e=c();a(),x(" ",n("cover-image-description")," "),a(),R("imageUrls",e.imageUrls),p("showReset",e.series.coverImageLocked)}}function ao(i,o){if(i&1&&y(0,"app-edit-series-relation",72),i&2){let n=c(3);p("series",n.series)("save",n.saveNestedComponents)}}function oo(i,o){if(i&1&&(l(0,"div",75),d(1),M(2,"sentenceCase"),s()),i&2){let n=c(3).$implicit,e=c();a(),G("",n("library-title")," ",D(2,2,e.libraryName),"")}}function lo(i,o){if(i&1&&(l(0,"div",73)(1,"div",75),d(2),y(3,"i",80),s(),l(4,"div",75),d(5),y(6,"i",80),s(),l(7,"div",75),d(8),M(9,"publicationStatus"),s(),l(10,"div",75),d(11),s(),l(12,"div",75),d(13),M(14,"bytes"),s()()),i&2){let n=c(3).$implicit,e=c();a(2),G(" ",n("max-items-title")," ",e.metadata.maxCount," "),a(),p("ngbTooltip",n("highest-count-tooltip")),a(2),G(" ",n("total-items-title")," ",e.metadata.totalCount," "),a(),p("ngbTooltip",n("max-issue-tooltip")),a(2),G("",n("publication-status-title")," ",D(9,12,e.metadata.publicationStatus),""),a(3),G("",n("total-pages-title")," ",e.series.pages,""),a(2),G("",n("size-title")," ",D(14,14,e.size),"")}}function so(i,o){if(i&1&&(l(0,"div",81)(1,"span",82),d(2),s()()),i&2){let n=c(3).$implicit;a(2),g(n("loading"))}}function co(i,o){if(i&1&&(l(0,"li",94)(1,"span"),d(2),s(),l(3,"div",22)(4,"div",89),d(5),s(),l(6,"div",89),d(7),s(),l(8,"div",89),d(9),l(10,"span",95),d(11),s()()()()),i&2){let n=o.$implicit,e=c(5).$implicit,t=c();a(2),g(n.filePath),a(3),G(" ",e("chapter-title")," ",n.chapter," "),a(2),G(" ",e("pages-title")," ",n.pages," "),a(2),x(" ",e("format-title")," "),a(2),g(t.utilityService.mangaFormatToText(n.format))}}function mo(i,o){if(i&1){let n=T();l(0,"li",85),y(1,"app-image",86),l(2,"div",87)(3,"h5",88),d(4),s(),l(5,"div")(6,"div",22)(7,"div",89),d(8),M(9,"utcToLocalTime"),M(10,"defaultDate"),s(),l(11,"div",89),d(12),M(13,"utcToLocalTime"),M(14,"translocoDate"),M(15,"defaultDate"),s()(),l(16,"div",22)(17,"div",89)(18,"button",90),f("click",function(){_(n);let t=$(23);return u(t.toggle())}),d(19),s()(),l(20,"div",89),d(21),s()(),l(22,"div",91,4),N("ngbCollapseChange",function(t){let r=_(n).$implicit,m=c(5);return V(m.volumeCollapsed[r.name],t)||(m.volumeCollapsed[r.name]=t),u(t)}),l(24,"ul",92),h(25,co,12,7,"li",93),s()()()()()}if(i&2){let n=o.$implicit,e=c(4).$implicit,t=c();a(),p("imageUrl",t.imageService.getVolumeCoverImage(n.id)),a(3),g(t.formatVolumeName(n)),a(4),G(" ",e("added-title")," ",D(10,14,D(9,12,n.createdUtc))," "),a(4),G(" ",e("last-modified-title")," ",D(15,21,Ne(14,18,D(13,16,n.lastModifiedUtc),xt(23,da)))," "),a(6),ee("aria-expanded",!t.volumeCollapsed[n.name]),a(),x(" ",e("view-files")," "),a(2),G(" ",e("pages-title")," ",n.pages," "),a(),R("ngbCollapse",t.volumeCollapsed[n.name]),a(3),p("ngForOf",n.volumeFiles)}}function po(i,o){if(i&1&&(l(0,"ul",83),h(1,mo,26,24,"li",84),s()),i&2){let n=c(4);a(),p("ngForOf",n.seriesVolumes)}}function _o(i,o){if(i&1&&(l(0,"h4"),d(1),s(),l(2,"div",73),h(3,oo,3,4,"div",74),l(4,"div",75),d(5),l(6,"app-tag-badge"),d(7),M(8,"mangaFormat"),s()()(),l(9,"div",73)(10,"div",75),d(11),M(12,"date"),s(),l(13,"div",75),d(14),M(15,"defaultDate"),M(16,"timeAgo"),s(),l(17,"div",75),d(18),M(19,"defaultDate"),M(20,"timeAgo"),s(),l(21,"div",75),d(22),M(23,"defaultDate"),M(24,"timeAgo"),s()(),l(25,"div",73)(26,"div",76),d(27),M(28,"defaultValue"),s()(),h(29,lo,15,16,"div",77),l(30,"h4"),d(31,"Volumes"),s(),h(32,so,3,1,"div",78)(33,po,2,1,"ul",79)),i&2){let n=c(2).$implicit,e=c();a(),g(n("info-title")),a(2),p("ngIf",e.libraryName),a(2),x("",n("format-title")," "),a(2),g(D(8,17,e.series.format)),a(4),G("",n("created-title")," ",Ne(12,19,e.series.created,"shortDate"),""),a(3),G("",n("last-read-title")," ",D(16,24,D(15,22,e.series.latestReadDate)),""),a(4),G("",n("last-added-title")," ",D(20,28,D(19,26,e.series.lastChapterAdded)),""),a(4),G("",n("last-scanned-title")," ",D(24,32,D(23,30,e.series.lastFolderScanned)),""),a(5),G("",n("folder-path-title")," ",D(28,34,e.series.folderPath),""),a(2),p("ngIf",e.metadata),a(3),p("ngIf",e.isLoadingVolumes),a(),p("ngIf",!e.isLoadingVolumes)}}function uo(i,o){i&1&&(l(0,"div",97)(1,"span",82),d(2,"loading..."),s()())}function go(i,o){if(i&1&&d(0),i&2){let n=c(3).$implicit;x(" ",n("force-refresh")," ")}}function ho(i,o){if(i&1){let n=T();l(0,"button",96),f("click",function(){_(n);let t=c(3);return u(t.forceScan())}),h(1,uo,3,0,"div",97)(2,go,1,1),s()}if(i&2){let n=c(2).$implicit,e=c();p("ngbTooltip",n("force-refresh-tooltip")),a(),Ie(1,e.forceIsLoading?1:2)}}function fo(i,o){if(i&1){let n=T();l(0,"div",7)(1,"div",8)(2,"h4",9),d(3),s(),l(4,"button",10),f("click",function(){_(n);let t=c(2);return u(t.close())}),s()(),l(5,"div")(6,"form",11)(7,"ul",12,1),N("activeIdChange",function(t){_(n);let r=c(2);return V(r.active,t)||(r.active=t),u(t)}),l(9,"li",13)(10,"a",14),d(11),s(),h(12,ha,23,24,"ng-template",15),s(),h(13,Ta,4,2,"li",16),l(14,"li",13)(15,"a",14),d(16),s(),h(17,to,117,39,"ng-template",15),s(),h(18,no,4,2,"li",16),l(19,"li",13)(20,"a",14),d(21),s(),h(22,ro,3,3,"ng-template",15),s(),l(23,"li",13)(24,"a",14),d(25),s(),h(26,ao,1,2,"ng-template",15),s(),l(27,"li",13)(28,"a",14),d(29),s(),h(30,_o,34,36,"ng-template",15),s()()(),y(31,"div",17),s(),l(32,"div",18),h(33,ho,3,2,"button",19),M(34,"async"),l(35,"button",20),f("click",function(){_(n);let t=c(2);return u(t.close())}),d(36),s(),l(37,"button",21),f("click",function(){_(n);let t=c(2);return u(t.save())}),d(38),s()()()}if(i&2){let n=$(8),e=c().$implicit,t=c();a(3),x(" ",e("title",q(30,na,t.series.name)),""),a(),ee("aria-label",e("close")),a(),te("modal-body scrollable-modal ",t.utilityService.getActiveBreakpoint()===t.Breakpoint.Mobile?"":"d-flex",""),a(),p("formGroup",t.editSeriesForm),a(),ke("orientation",t.utilityService.getActiveBreakpoint()===t.Breakpoint.Mobile?"horizontal":"vertical"),R("activeId",t.active),a(2),p("ngbNavItem",t.tabs[t.TabID.General]),a(2),g(e(t.tabs[t.TabID.General])),a(2),p("ngIf",t.metadata),a(),p("ngbNavItem",t.tabs[t.TabID.People]),a(2),g(e(t.tabs[t.TabID.People])),a(2),p("ngIf",t.metadata),a(),p("ngbNavItem",t.tabs[t.TabID.CoverImage]),a(2),g(e(t.tabs[t.TabID.CoverImage])),a(2),p("ngbNavItem",t.tabs[t.TabID.Related]),a(2),g(e(t.tabs[t.TabID.Related])),a(2),p("ngbNavItem",t.tabs[t.TabID.Info]),a(2),g(e(t.tabs[t.TabID.Info])),a(2),te("tab-content ",t.utilityService.getActiveBreakpoint()===t.Breakpoint.Mobile?"mt-3":"ms-4 flex-fill",""),p("ngbNavOutlet",n),a(2),Ie(33,D(34,28,t.accountService.hasValidLicense$)?33:-1),a(3),g(e("close")),a(),p("disabled",!t.editSeriesForm.valid),a(),g(e("save"))}}function vo(i,o){if(i&1){let n=T();l(0,"span",98),f("click",function(){let t=_(n),r=t.item,m=t.field,v=c(2);return u(v.unlock(r,m))}),y(1,"i",99),l(2,"span",82),d(3),s()()}if(i&2){let n=c().$implicit;a(3),g(n("field-locked-alt"))}}function xo(i,o){if(i&1&&(U(0),h(1,fo,39,32,"div",6)(2,vo,4,1,"ng-template",null,0,w),A()),i&2){let n=c();a(),p("ngIf",n.series!==void 0)}}var rn=function(i){return i[i.General=0]="General",i[i.Metadata=1]="Metadata",i[i.People=2]="People",i[i.WebLinks=3]="WebLinks",i[i.CoverImage=4]="CoverImage",i[i.Related=5]="Related",i[i.Info=6]="Info",i}(rn||{}),vd=(()=>{let o=class o{constructor(){this.modal=k(Ce),this.seriesService=k(st),this.utilityService=k(Ee),this.fb=k(kt),this.imageService=k(Te),this.libraryService=k(Le),this.uploadService=k(je),this.metadataService=k(Ni),this.cdRef=k(ce),this.accountService=k(Lt),this.destroyRef=k(Se),this.toastr=k(_e),this.TabID=rn,this.PersonRole=F,this.Breakpoint=lt,this.seriesVolumes=[],this.isLoadingVolumes=!1,this.volumeCollapsed={},this.tabs=["general-tab","metadata-tab","people-tab","web-links-tab","cover-image-tab","related-tab","info-tab"],this.active=this.tabs[0],this.libraryName=void 0,this.size=0,this.hasForcedKPlus=!1,this.forceIsLoading=!1,this.tagsSettings=new De,this.languageSettings=new De,this.peopleSettings={},this.genreSettings=new De,this.tags=[],this.genres=[],this.ageRatings=[],this.publicationStatuses=[],this.validLanguages=[],this.imageUrls=[],this.selectedCover="",this.coverImageReset=!1,this.saveNestedComponents=new Q}get WebLinks(){return this.metadata?.webLinks.split(",")||[""]}getPersonsSettings(e){return this.peopleSettings[e]}ngOnInit(){this.imageUrls.push(this.imageService.getSeriesCoverImage(this.series.id)),this.libraryService.getLibraryNames().pipe(Z(this.destroyRef)).subscribe(e=>{this.libraryName=e[this.series.libraryId]}),this.initSeries=Object.assign({},this.series),this.editSeriesForm=this.fb.group({id:new E(this.series.id,[]),summary:new E("",[]),name:new E(this.series.name,[B.required]),localizedName:new E(this.series.localizedName,[]),sortName:new E(this.series.sortName,[B.required]),rating:new E(this.series.userRating,[]),coverImageIndex:new E(0,[]),coverImageLocked:new E(this.series.coverImageLocked,[]),ageRating:new E("",[]),publicationStatus:new E("",[]),language:new E("",[]),releaseYear:new E("",[B.minLength(4),B.maxLength(4),B.pattern(/([1-9]\d{3})|[0]{1}/)])}),this.cdRef.markForCheck(),this.metadataService.getAllAgeRatings().subscribe(e=>{this.ageRatings=e,this.cdRef.markForCheck()}),this.metadataService.getAllPublicationStatus().subscribe(e=>{this.publicationStatuses=e,this.cdRef.markForCheck()}),this.metadataService.getAllValidLanguages().subscribe(e=>{this.validLanguages=e,this.cdRef.markForCheck()}),this.seriesService.getMetadata(this.series.id).subscribe(e=>{e&&(this.metadata=e,this.setupTypeaheads(),this.editSeriesForm.get("summary")?.patchValue(this.metadata.summary),this.editSeriesForm.get("ageRating")?.patchValue(this.metadata.ageRating),this.editSeriesForm.get("publicationStatus")?.patchValue(this.metadata.publicationStatus),this.editSeriesForm.get("language")?.patchValue(this.metadata.language),this.editSeriesForm.get("releaseYear")?.patchValue(this.metadata.releaseYear),this.cdRef.markForCheck(),this.editSeriesForm.get("name")?.valueChanges.pipe(Z(this.destroyRef)).subscribe(t=>{this.series.nameLocked=!0,this.cdRef.markForCheck()}),this.editSeriesForm.get("sortName")?.valueChanges.pipe(Z(this.destroyRef)).subscribe(t=>{this.series.sortNameLocked=!0,this.cdRef.markForCheck()}),this.editSeriesForm.get("localizedName")?.valueChanges.pipe(Z(this.destroyRef)).subscribe(t=>{this.series.localizedNameLocked=!0,this.cdRef.markForCheck()}),this.editSeriesForm.get("summary")?.valueChanges.pipe(Z(this.destroyRef)).subscribe(t=>{this.metadata.summaryLocked=!0,this.metadata.summary=t,this.cdRef.markForCheck()}),this.editSeriesForm.get("ageRating")?.valueChanges.pipe(Z(this.destroyRef)).subscribe(t=>{this.metadata.ageRating=parseInt(t+"",10),this.metadata.ageRatingLocked=!0,this.cdRef.markForCheck()}),this.editSeriesForm.get("publicationStatus")?.valueChanges.pipe(Z(this.destroyRef)).subscribe(t=>{this.metadata.publicationStatus=parseInt(t+"",10),this.metadata.publicationStatusLocked=!0,this.cdRef.markForCheck()}),this.editSeriesForm.get("releaseYear")?.valueChanges.pipe(Z(this.destroyRef)).subscribe(t=>{this.metadata.releaseYear=parseInt(t+"",10),this.metadata.releaseYearLocked=!0,this.cdRef.markForCheck()}))}),this.isLoadingVolumes=!0,this.cdRef.markForCheck(),this.seriesService.getVolumes(this.series.id).subscribe(e=>{this.seriesVolumes=e,this.isLoadingVolumes=!1,this.seriesVolumes.length===1?this.imageUrls.push(...this.seriesVolumes[0].chapters.map(t=>this.imageService.getChapterCoverImage(t.id))):this.imageUrls.push(...this.seriesVolumes.map(t=>this.imageService.getVolumeCoverImage(t.id))),e.forEach(t=>{this.volumeCollapsed[t.name]=!0}),this.seriesVolumes.forEach(t=>{t.volumeFiles=t.chapters?.map(r=>r.files.map(m=>(m.chapter=r.range,m))).flat()}),e.length>0&&(this.size=e.reduce((t,r)=>t+r.chapters.reduce((m,v)=>m+v.files.reduce((C,W)=>C+W.bytes,0),0),0)),this.cdRef.markForCheck()})}formatVolumeName(e){return e.minNumber===-1e5?I("edit-series-modal.loose-leaf-volume"):e.minNumber===1e5?I("edit-series-modal.specials-volume"):I("edit-series-modal.volume-num")+" "+e.name}setupTypeaheads(){qe([this.setupTagSettings(),this.setupGenreTypeahead(),this.setupPersonTypeahead(),this.setupLanguageTypeahead()]).subscribe(e=>{this.cdRef.markForCheck()})}setupTagSettings(){return this.tagsSettings.minCharacters=0,this.tagsSettings.multiple=!0,this.tagsSettings.id="tags",this.tagsSettings.unique=!0,this.tagsSettings.showLocked=!0,this.tagsSettings.addIfNonExisting=!0,this.tagsSettings.compareFn=(e,t)=>e.filter(r=>this.utilityService.filter(r.title,t)),this.tagsSettings.fetchFn=e=>this.metadataService.getAllTags().pipe(z(t=>this.tagsSettings.compareFn(t,e))),this.tagsSettings.addTransformFn=e=>({id:0,title:e}),this.tagsSettings.selectionCompareFn=(e,t)=>e.title.toLowerCase()==t.title.toLowerCase(),this.tagsSettings.compareFnForAdd=(e,t)=>e.filter(r=>this.utilityService.filterMatches(r.title,t)),this.metadata.tags&&(this.tagsSettings.savedData=this.metadata.tags),ge(!0)}setupGenreTypeahead(){return this.genreSettings.minCharacters=0,this.genreSettings.multiple=!0,this.genreSettings.id="genres",this.genreSettings.unique=!0,this.genreSettings.showLocked=!0,this.genreSettings.addIfNonExisting=!0,this.genreSettings.fetchFn=e=>this.metadataService.getAllGenres().pipe(z(t=>this.genreSettings.compareFn(t,e))),this.genreSettings.compareFn=(e,t)=>e.filter(r=>this.utilityService.filter(r.title,t)),this.genreSettings.compareFnForAdd=(e,t)=>e.filter(r=>this.utilityService.filterMatches(r.title,t)),this.genreSettings.selectionCompareFn=(e,t)=>e.title.toLowerCase()==t.title.toLowerCase(),this.genreSettings.addTransformFn=e=>({id:0,title:e}),this.metadata.genres&&(this.genreSettings.savedData=this.metadata.genres),ge(!0)}updateFromPreset(e,t,r){let m=this.createBlankPersonSettings(e,r);if(t&&t.length>0){let v=m.fetchFn;return v("").pipe(z(C=>{let W=t.map(ue=>ue.id);return m.savedData=C.filter(ue=>W.includes(ue.id)),this.peopleSettings[r]=m,this.updatePerson(m.savedData,r),!0}))}else return this.peopleSettings[r]=m,ge(!0)}setupLanguageTypeahead(){this.languageSettings.minCharacters=0,this.languageSettings.multiple=!1,this.languageSettings.id="language",this.languageSettings.unique=!0,this.languageSettings.showLocked=!0,this.languageSettings.addIfNonExisting=!1,this.languageSettings.compareFn=(t,r)=>t.filter(m=>this.utilityService.filter(m.title,r)),this.languageSettings.compareFnForAdd=(t,r)=>t.filter(m=>this.utilityService.filterMatches(m.title,r)),this.languageSettings.fetchFn=t=>ge(this.validLanguages).pipe(z(r=>this.languageSettings.compareFn(r,t))),this.languageSettings.selectionCompareFn=(t,r)=>t.isoCode==r.isoCode;let e=this.validLanguages.find(t=>t.isoCode===this.metadata.language);return e!==void 0&&(this.languageSettings.savedData=e),ge(!0)}setupPersonTypeahead(){return this.peopleSettings={},qe([this.updateFromPreset("writer",this.metadata.writers,F.Writer),this.updateFromPreset("character",this.metadata.characters,F.Character),this.updateFromPreset("colorist",this.metadata.colorists,F.Colorist),this.updateFromPreset("cover-artist",this.metadata.coverArtists,F.CoverArtist),this.updateFromPreset("editor",this.metadata.editors,F.Editor),this.updateFromPreset("inker",this.metadata.inkers,F.Inker),this.updateFromPreset("letterer",this.metadata.letterers,F.Letterer),this.updateFromPreset("penciller",this.metadata.pencillers,F.Penciller),this.updateFromPreset("publisher",this.metadata.publishers,F.Publisher),this.updateFromPreset("imprint",this.metadata.imprints,F.Imprint),this.updateFromPreset("translator",this.metadata.translators,F.Translator),this.updateFromPreset("teams",this.metadata.teams,F.Team),this.updateFromPreset("locations",this.metadata.locations,F.Location)]).pipe(z(e=>ge(!0)))}fetchPeople(e,t){return this.metadataService.getAllPeople().pipe(z(r=>r.filter(m=>m.role==e&&this.utilityService.filter(m.name,t))))}createBlankPersonSettings(e,t){var r=new De;return r.minCharacters=0,r.multiple=!0,r.showLocked=!0,r.unique=!0,r.addIfNonExisting=!0,r.id=e,r.compareFn=(m,v)=>m.filter(C=>this.utilityService.filter(C.name,v)),r.compareFnForAdd=(m,v)=>m.filter(C=>this.utilityService.filterMatches(C.name,v)),r.selectionCompareFn=(m,v)=>m.name==v.name&&m.role==v.role,r.fetchFn=m=>this.fetchPeople(t,m).pipe(z(v=>r.compareFn(v,m))),r.addTransformFn=m=>({id:0,name:m,role:t}),r}close(){this.modal.close({success:!1,series:void 0,coverImageUpdate:this.coverImageReset,updateExternal:this.hasForcedKPlus})}forceScan(){this.forceIsLoading=!0,this.metadataService.forceRefreshFromPlus(this.series.id).subscribe(()=>{this.hasForcedKPlus=!0,this.forceIsLoading=!1,this.toastr.info(I("toasts.force-kavita+-refresh-success")),this.cdRef.markForCheck()})}updateWeblinks(e){this.metadata.webLinks=e.map(t=>t.replaceAll(",","%2C")).join(",")}save(){let e=this.editSeriesForm.value,t=this.editSeriesForm.get("coverImageIndex")?.value||0,r=[this.seriesService.updateMetadata(this.metadata)],m=this.editSeriesForm.get("name")?.dirty||this.editSeriesForm.get("sortName")?.dirty||this.editSeriesForm.get("localizedName")?.dirty,v=this.series.nameLocked!==this.initSeries.nameLocked||this.series.sortNameLocked!==this.initSeries.sortNameLocked||this.series.localizedNameLocked!==this.initSeries.localizedNameLocked;(m||v||this.coverImageReset)&&(e.nameLocked=this.series.nameLocked,e.sortNameLocked=this.series.sortNameLocked,e.localizedNameLocked=this.series.localizedNameLocked,e.language=this.metadata.language,r.push(this.seriesService.updateSeries(e))),t>0&&this.selectedCover!==""&&r.push(this.uploadService.updateSeriesCoverImage(e.id,this.selectedCover)),this.saveNestedComponents.emit(),qe(r).subscribe(C=>{this.modal.close({success:!0,series:e,coverImageUpdate:t>0||this.coverImageReset,updateExternal:this.hasForcedKPlus})})}updateTags(e){this.tags=e,this.metadata.tags=e,this.cdRef.markForCheck()}updateGenres(e){this.genres=e,this.metadata.genres=e,this.cdRef.markForCheck()}updateLanguage(e){if(e.length===0){this.metadata.language="";return}this.metadata.language=e[0].isoCode,this.cdRef.markForCheck()}updatePerson(e,t){switch(t){case F.Other:break;case F.Artist:break;case F.CoverArtist:this.metadata.coverArtists=e;break;case F.Character:this.metadata.characters=e;break;case F.Colorist:this.metadata.colorists=e;break;case F.Editor:this.metadata.editors=e;break;case F.Inker:this.metadata.inkers=e;break;case F.Letterer:this.metadata.letterers=e;break;case F.Penciller:this.metadata.pencillers=e;break;case F.Publisher:this.metadata.publishers=e;break;case F.Imprint:this.metadata.imprints=e;break;case F.Team:this.metadata.teams=e;break;case F.Location:this.metadata.locations=e;break;case F.Writer:this.metadata.writers=e;break;case F.Translator:this.metadata.translators=e;break}this.cdRef.markForCheck()}updateSelectedIndex(e){this.editSeriesForm.patchValue({coverImageIndex:e}),this.cdRef.markForCheck()}updateSelectedImage(e){this.selectedCover=e,this.cdRef.markForCheck()}handleReset(){this.coverImageReset=!0,this.editSeriesForm.patchValue({coverImageLocked:!1}),this.cdRef.markForCheck()}unlock(e,t){e&&(e[t]=!e[t]),this.cdRef.markForCheck()}};o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=j({type:o,selectors:[["app-edit-series-modal"]],inputs:{series:"series"},standalone:!0,features:[Y],decls:1,vars:1,consts:[["lock",""],["nav","ngbNav"],["badgeItem",""],["optionItem",""],["collapse","ngbCollapse"],[4,"transloco","translocoRead"],["class","modal-container",4,"ngIf"],[1,"modal-container"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[3,"formGroup"],["ngbNav","",1,"nav-pills",2,"min-width","135px",3,"activeIdChange","activeId","orientation"],[3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavItem",4,"ngIf"],[3,"ngbNavOutlet"],[1,"modal-footer"],["type","button","position","above",1,"btn","btn-light"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"],[1,"row","g-0"],[1,"mb-3",2,"width","100%"],["for","name",1,"form-label"],[1,"input-group"],["id","name","formControlName","name","type","text","readonly","",1,"form-control"],[4,"ngIf"],["for","sort-name",1,"form-label"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["id","sort-name","formControlName","sortName","type","text",1,"form-control"],["for","localized-name",1,"form-label"],["id","localized-name","formControlName","localizedName","type","text",1,"form-control"],["class","row g-0",4,"ngIf"],["class","invalid-feedback",4,"ngIf"],[1,"invalid-feedback"],["for","summary",1,"form-label"],["id","summary","formControlName","summary","rows","4",1,"form-control"],[1,"col-lg-8","col-md-12","pe-2"],[1,"mb-3"],["for","language",1,"form-label"],[3,"selectedData","lockedChange","onUnlock","newItemAdded","settings","locked"],[1,"col-lg-4","col-md-12"],["for","release-year",1,"form-label"],["type","number","inputmode","numeric","id","release-year","formControlName","releaseYear","maxlength","4","minlength","4",1,"form-control"],[1,"col-md-12"],["for","genres",1,"form-label"],["for","tags",1,"form-label"],[1,"col-lg-6","col-md-12","pe-2"],["for","age-rating",1,"form-label"],["id","age-rating","formControlName","ageRating",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[1,"col-lg-6","col-md-12"],["for","publication-status",1,"form-label"],["id","publication-status","formControlName","publicationStatus",1,"form-select"],[3,"value"],["for","writer",1,"form-label"],["for","cover-artist",1,"form-label"],["for","publisher",1,"form-label"],["for","imprint",1,"form-label"],["for","penciller",1,"form-label"],["for","letterer",1,"form-label"],["for","inker",1,"form-label"],["for","editor",1,"form-label"],["for","colorist",1,"form-label"],["for","translator",1,"form-label"],["for","character",1,"form-label"],["for","team",1,"form-label"],["for","location",1,"form-label"],[3,"updateItems","items","label"],["role","alert",1,"alert","alert-primary"],[3,"imageUrlsChange","imageSelected","selectedBase64Url","resetClicked","imageUrls","showReset"],[3,"series","save"],[1,"row","g-0","mb-2"],["class","col-md-6",4,"ngIf"],[1,"col-md-6"],[1,"col-auto"],["class","row g-0 mb-2",4,"ngIf"],["class","spinner-border text-secondary","role","status",4,"ngIf"],["class","list-unstyled",4,"ngIf"],["placement","right","role","button","tabindex","0",1,"fa","fa-info-circle","ms-1",3,"ngbTooltip"],["role","status",1,"spinner-border","text-secondary"],[1,"visually-hidden"],[1,"list-unstyled"],["class","d-flex my-4",4,"ngFor","ngForOf"],[1,"d-flex","my-4"],["width","74px",1,"me-3",2,"width","74px",3,"imageUrl"],[1,"flex-grow-1"],[1,"mt-0","mb-1"],[1,"col"],["type","button",1,"btn","btn-outline-primary",3,"click"],[3,"ngbCollapseChange","ngbCollapse"],[1,"list-group","mt-2"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"badge","badge-secondary"],["type","button","position","above",1,"btn","btn-light",3,"click","ngbTooltip"],["role","status",1,"spinner-border","spinner-border-sm","text-primary"],[1,"input-group-text","clickable",3,"click"],["aria-hidden","true",1,"fa","fa-lock"]],template:function(t,r){t&1&&h(0,xo,4,1,"ng-container",5),t&2&&p("translocoRead","edit-series-modal")},dependencies:[X,oe,Xe,Ke,re,It,Je,J,ae,ui,gi,me,pe,it,et,tt,nt,de,xe,ne,We,bt,di,yt,Nt,mt,nn,Vt,Di,At,Ui,Pi,Ai,at,Bi,Rt,fi,rt,Oi,$e,H,Wi,$i,Bt],styles:[`.lock-active[_ngcontent-%COMP%] > .input-group-text[_ngcontent-%COMP%]{background-color:var(--primary-color);color:#fff}
/*# sourceMappingURL=edit-series-modal.component-PVLLB57R.css.map */`],changeDetection:0});let i=o;return i})();export{Pt as a,je as b,mt as c,Hi as d,At as e,Xi as f,Xs as g,S as h,Ot as i,en as j,tn as k,vd as l};
//# sourceMappingURL=chunk-CIDLU7ZZ.js.map
