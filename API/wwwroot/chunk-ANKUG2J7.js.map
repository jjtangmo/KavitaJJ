{
  "version": 3,
  "sources": ["src/app/user-settings/change-age-restriction/change-age-restriction.component.ts", "src/app/user-settings/change-age-restriction/change-age-restriction.component.html"],
  "sourcesContent": ["import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component, DestroyRef,\n  EventEmitter,\n  inject,\n  OnInit\n} from '@angular/core';\nimport { ToastrService } from 'ngx-toastr';\nimport { Observable, of, shareReplay, map, take } from 'rxjs';\nimport { AgeRestriction } from 'src/app/_models/metadata/age-restriction';\nimport { AgeRating } from 'src/app/_models/metadata/age-rating';\nimport { User } from 'src/app/_models/user';\nimport { AccountService } from 'src/app/_services/account.service';\nimport {takeUntilDestroyed} from \"@angular/core/rxjs-interop\";\nimport { AgeRatingPipe } from '../../_pipes/age-rating.pipe';\nimport { RestrictionSelectorComponent } from '../restriction-selector/restriction-selector.component';\nimport { NgbCollapse } from '@ng-bootstrap/ng-bootstrap';\nimport { NgIf, AsyncPipe } from '@angular/common';\nimport {translate, TranslocoDirective} from \"@ngneat/transloco\";\n\n@Component({\n    selector: 'app-change-age-restriction',\n    templateUrl: './change-age-restriction.component.html',\n    styleUrls: ['./change-age-restriction.component.scss'],\n    changeDetection: ChangeDetectionStrategy.OnPush,\n    standalone: true,\n    imports: [NgIf, NgbCollapse, RestrictionSelectorComponent, AsyncPipe, AgeRatingPipe, TranslocoDirective]\n})\nexport class ChangeAgeRestrictionComponent implements OnInit {\n\n  user: User | undefined = undefined;\n  hasChangeAgeRestrictionAbility: Observable<boolean> = of(false);\n  isViewMode: boolean = true;\n  selectedRestriction!: AgeRestriction;\n  originalRestriction!: AgeRestriction;\n  reset: EventEmitter<AgeRestriction> = new EventEmitter();\n  private readonly destroyRef = inject(DestroyRef);\n\n  get AgeRating() { return AgeRating; }\n\n  constructor(private accountService: AccountService, private toastr: ToastrService, private readonly cdRef: ChangeDetectorRef) { }\n\n  ngOnInit(): void {\n    this.accountService.currentUser$.pipe(takeUntilDestroyed(this.destroyRef), shareReplay(), take(1)).subscribe(user => {\n      if (!user) return;\n      this.user = user;\n      this.originalRestriction = this.user.ageRestriction;\n      this.cdRef.markForCheck();\n    });\n\n    this.hasChangeAgeRestrictionAbility = this.accountService.currentUser$.pipe(takeUntilDestroyed(this.destroyRef), shareReplay(), map(user => {\n      return user !== undefined && !this.accountService.hasReadOnlyRole(user) && (!this.accountService.hasAdminRole(user) && this.accountService.hasChangeAgeRestrictionRole(user));\n    }));\n    this.cdRef.markForCheck();\n  }\n\n  updateRestrictionSelection(restriction: AgeRestriction) {\n    this.selectedRestriction = restriction;\n  }\n\n  resetForm() {\n    if (!this.user) return;\n    this.reset.emit(this.originalRestriction);\n    this.cdRef.markForCheck();\n  }\n\n  saveForm() {\n    if (this.user === undefined) { return; }\n\n    this.accountService.updateAgeRestriction(this.selectedRestriction.ageRating, this.selectedRestriction.includeUnknowns).subscribe(() => {\n      this.toastr.success(translate('toasts.age-restriction-updated'));\n      this.originalRestriction = this.selectedRestriction;\n      if (this.user) {\n        this.user.ageRestriction.ageRating = this.selectedRestriction.ageRating;\n        this.user.ageRestriction.includeUnknowns = this.selectedRestriction.includeUnknowns;\n      }\n      this.resetForm();\n      this.isViewMode = true;\n    }, err => {\n\n    });\n  }\n\n  toggleViewMode() {\n    this.isViewMode = !this.isViewMode;\n    this.resetForm();\n  }\n\n}\n", "<ng-container *transloco=\"let t; read:'change-age-restriction'\">\n  <div class=\"card mt-2\">\n    <div class=\"card-body\">\n      <div class=\"card-title\">\n        <div class=\"container-fluid row mb-2\">\n          <div class=\"col-10 col-sm-11\"><h4 id=\"age-restriction\">{{t('age-restriction-label')}}</h4></div>\n          <div class=\"col-1 text-end\">\n            <button class=\"btn btn-primary btn-sm\" (click)=\"toggleViewMode()\" [disabled]=\"!(hasChangeAgeRestrictionAbility | async)\">{{isViewMode ? t('edit') : t('cancel')}}</button>\n          </div>\n        </div>\n      </div>\n\n      <ng-container *ngIf=\"isViewMode\">\n        <div class=\"container-fluid row\">\n                <span class=\"col-12\">{{user?.ageRestriction?.ageRating | ageRating }}\n                  <ng-container *ngIf=\"user?.ageRestriction?.ageRating !== AgeRating.NotApplicable && user?.ageRestriction?.includeUnknowns\">\n                        <span class=\"ms-1 me-1\">+</span> {{t('unknowns')}}\n                    </ng-container>\n                </span>\n        </div>\n      </ng-container>\n\n      <div #collapse=\"ngbCollapse\" [(ngbCollapse)]=\"isViewMode\">\n        <ng-container *ngIf=\"user\">\n          <app-restriction-selector (selected)=\"updateRestrictionSelection($event)\" [showContext]=\"false\" [member]=\"user\" [reset]=\"reset\"></app-restriction-selector>\n\n          <div class=\"col-auto d-flex d-md-block justify-content-sm-center text-md-end mb-3\">\n            <button type=\"button\" class=\"flex-fill btn btn-secondary me-2\" aria-describedby=\"age-restriction\" (click)=\"resetForm()\">{{t('reset')}}</button>\n            <button type=\"submit\" class=\"flex-fill btn btn-primary\" aria-describedby=\"age-restriction\" (click)=\"saveForm()\">{{t('save')}}</button>\n          </div>\n        </ng-container>\n      </div>\n\n\n    </div>\n\n\n  </div>\n\n\n</ng-container>\n"],
  "mappings": "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",
  "names": ["\u0275\u0275elementContainerStart", "\u0275\u0275elementStart", "\u0275\u0275text", "\u0275\u0275elementEnd", "\u0275\u0275advance", "\u0275\u0275textInterpolate1", "t_r3", "\u0275\u0275template", "ChangeAgeRestrictionComponent_ng_container_0_ng_container_12_ng_container_5_Template", "\u0275\u0275pipeBind1", "ctx_r1", "user", "ageRestriction", "ageRating", "\u0275\u0275property", "AgeRating", "NotApplicable", "includeUnknowns", "\u0275\u0275listener", "$event", "\u0275\u0275restoreView", "_r4", "\u0275\u0275nextContext", "\u0275\u0275resetView", "updateRestrictionSelection", "resetForm", "saveForm", "reset", "\u0275\u0275textInterpolate", "_r1", "toggleViewMode", "ChangeAgeRestrictionComponent_ng_container_0_ng_container_12_Template", "\u0275\u0275twoWayListener", "i0", "\u0275\u0275twoWayBindingSet", "isViewMode", "ChangeAgeRestrictionComponent_ng_container_0_ng_container_15_Template", "hasChangeAgeRestrictionAbility", "\u0275\u0275twoWayProperty", "ChangeAgeRestrictionComponent", "constructor", "accountService", "toastr", "cdRef", "undefined", "of", "EventEmitter", "destroyRef", "inject", "DestroyRef", "ngOnInit", "currentUser$", "pipe", "takeUntilDestroyed", "shareReplay", "take", "subscribe", "originalRestriction", "markForCheck", "map", "hasReadOnlyRole", "hasAdminRole", "hasChangeAgeRestrictionRole", "restriction", "selectedRestriction", "emit", "updateAgeRestriction", "success", "translate", "err", "\u0275\u0275directiveInject", "AccountService", "ToastrService", "ChangeDetectorRef", "selectors", "standalone", "features", "\u0275\u0275StandaloneFeature", "decls", "vars", "consts", "template", "rf", "ctx", "ChangeAgeRestrictionComponent_ng_container_0_Template", "NgIf", "NgbCollapse", "RestrictionSelectorComponent", "AsyncPipe", "AgeRatingPipe", "TranslocoDirective", "styles", "changeDetection", "_ChangeAgeRestrictionComponent"]
}
