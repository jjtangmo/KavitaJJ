import{a as Ve}from"./chunk-W3BILLRV.js";import{a as $e}from"./chunk-T42ECNDU.js";import{g as we}from"./chunk-CASH644A.js";import{i as Fe}from"./chunk-GGQU56QW.js";import"./chunk-V7YNUPX5.js";import{b as Ue}from"./chunk-U42B4V5B.js";import"./chunk-CIDLU7ZZ.js";import{a as ye}from"./chunk-FVF23ION.js";import{m as ke}from"./chunk-ZTKUYOP3.js";import"./chunk-2JQ3KAM5.js";import"./chunk-5TIUG6K2.js";import"./chunk-IYLIANWB.js";import"./chunk-63UKDQJP.js";import"./chunk-COKVODYN.js";import{a as Se}from"./chunk-K6JLHPZK.js";import{a as be}from"./chunk-SEAKSSGD.js";import"./chunk-KWNQHRPC.js";import"./chunk-STVWBYRJ.js";import"./chunk-SBPQBTA5.js";import"./chunk-23B3ZJIN.js";import"./chunk-YK7KIY5R.js";import"./chunk-WBO5KV4A.js";import{a as P,b as M,d as L,h as ve}from"./chunk-LAUBKCQL.js";import"./chunk-46CIW37K.js";import"./chunk-76TOP2FJ.js";import"./chunk-4XR5JJUF.js";import"./chunk-DBXQZVFZ.js";import"./chunk-5XQ66AVT.js";import{a as Re,b as Te}from"./chunk-RLL2TM5C.js";import{a as Ie}from"./chunk-WIQ43ZSS.js";import{a as De}from"./chunk-CNATNHH2.js";import{f as xe}from"./chunk-5CMEBAZF.js";import"./chunk-ZRHV3LXB.js";import"./chunk-SBTJKJNK.js";import{e as me,f as de,j as O,k as fe,q as ge}from"./chunk-SPNNO5LP.js";import{d as pe,s as Ce}from"./chunk-E6ZKMAWP.js";import{$ as R,$b as g,Bb as _,Bd as I,Dc as F,Dd as _e,Ec as D,Fa as h,Ga as f,Gc as b,Hd as he,Ib as l,Jd as S,Na as ee,Q as K,Rb as C,Rc as se,Rd as U,S as J,Tb as te,Td as ue,Ub as ie,Vb as p,Wb as m,Xb as z,Yb as ne,Zb as re,_b as w,a as W,ca as B,cc as x,dc as o,fa as v,g as G,ga as X,ka as Y,lb as y,m as N,nc as $,nd as le,o as q,oc as E,od as ce,pa as j,pc as H,qa as c,qc as ae,u as Q,va as Z,xc as oe,z as d,zc as T}from"./chunk-2LHIXASS.js";var Ee=(()=>{let a=class a{constructor(i,n){this.httpClient=i,this.utilityService=n,this.baseUrl=he.apiUrl}getQuickReads(i,n,r){let s=new I;return s=this.utilityService.addPaginationIfExists(s,n,r),this.httpClient.get(this.baseUrl+"recommended/quick-reads?libraryId="+i,{observe:"response",params:s}).pipe(d(u=>this.utilityService.createPaginatedResult(u)))}getQuickCatchupReads(i,n,r){let s=new I;return s=this.utilityService.addPaginationIfExists(s,n,r),this.httpClient.get(this.baseUrl+"recommended/quick-catchup-reads?libraryId="+i,{observe:"response",params:s}).pipe(d(u=>this.utilityService.createPaginatedResult(u)))}getHighlyRated(i,n,r){let s=new I;return s=this.utilityService.addPaginationIfExists(s,n,r),this.httpClient.get(this.baseUrl+"recommended/highly-rated?libraryId="+i,{observe:"response",params:s}).pipe(d(u=>this.utilityService.createPaginatedResult(u)))}getRediscover(i,n,r){let s=new I;return s=this.utilityService.addPaginationIfExists(s,n,r),this.httpClient.get(this.baseUrl+"recommended/rediscover?libraryId="+i,{observe:"response",params:s}).pipe(d(u=>this.utilityService.createPaginatedResult(u)))}getMoreIn(i,n,r,s){let u=new I;return u=this.utilityService.addPaginationIfExists(u,r,s),this.httpClient.get(this.baseUrl+"recommended/more-in?libraryId="+i+"&genreId="+n,{observe:"response",params:u}).pipe(d(Ae=>this.utilityService.createPaginatedResult(Ae)))}};a.\u0275fac=function(n){return new(n||a)(j(_e),j(xe))},a.\u0275prov=Y({token:a,factory:a.\u0275fac,providedIn:"root"});let e=a;return e})();var k=function(e){return e[e.OnDeck=1]="OnDeck",e[e.RecentlyUpdated=2]="RecentlyUpdated",e[e.NewlyAdded=3]="NewlyAdded",e[e.SmartFilter=4]="SmartFilter",e[e.MoreInGenre=5]="MoreInGenre",e}(k||{});var Me=(e,a)=>a.id,A=e=>({stream:e}),Le=e=>({genre:e});function Ge(e,a){if(e&1&&(p(0,"div",9)(1,"p"),E(2),p(3,"a",10),E(4),m(),E(5,"."),m()()),e&2){let t=o(4).$implicit;y(2),ae("",t("no-libraries")," "),y(2),H(t("server-settings-link"))}}function Ne(e,a){if(e&1&&(p(0,"div",9)(1,"p"),E(2),m()()),e&2){let t=o(4).$implicit;y(2),H(t("not-granted"))}}function Be(e,a){e&1&&(p(0,"div",8),_(1,Ge,6,2,"div",9)(2,Ne,3,1),m()),e&2&&(y(),C(1,a?1:2))}function je(e,a){if(e&1&&(_(0,Be,3,1,"div",8),F(1,"async")),e&2){let t,i=o(3);C(0,(t=D(1,1,i.isAdmin$))?0:-1,t)}}function ze(e,a){e&1&&_(0,je,2,3),e&2&&C(0,a.length===0?0:-1)}function He(e,a){if(e&1&&w(0,12),e&2){let t=o().$implicit,i=$(8);l("ngTemplateOutlet",i)("ngTemplateOutletContext",T(2,A,t))}}function We(e,a){if(e&1&&w(0,12),e&2){let t=o().$implicit,i=$(10);l("ngTemplateOutlet",i)("ngTemplateOutletContext",T(2,A,t))}}function qe(e,a){if(e&1&&w(0,12),e&2){let t=o().$implicit,i=$(12);l("ngTemplateOutlet",i)("ngTemplateOutletContext",T(2,A,t))}}function Qe(e,a){if(e&1&&w(0,12),e&2){let t=o().$implicit,i=$(6);l("ngTemplateOutlet",i)("ngTemplateOutletContext",T(2,A,t))}}function Ke(e,a){if(e&1&&w(0,12),e&2){let t=o().$implicit,i=$(14);l("ngTemplateOutlet",i)("ngTemplateOutletContext",T(2,A,t))}}function Je(e,a){if(e&1){let t=g();p(0,"app-series-card",14),x("reload",function(){let n=h(t).$implicit,r=o(5);return f(r.reloadStream(n.id))})("dataChanged",function(){let n=h(t).$implicit,r=o(5);return f(r.reloadStream(n.id))}),m()}if(e&2){let t=a.$implicit;l("data",t)("libraryId",t.libraryId)}}function Xe(e,a){if(e&1){let t=g();p(0,"app-carousel-reel",13),x("sectionClick",function(){h(t);let n=o(2).$implicit,r=o(2);return f(r.handleFilterSectionClick(n))}),_(1,Je,1,2,"ng-template",null,5,b),m()}if(e&2){let t=o(2).$implicit;l("items",a)("title",t.name)}}function Ye(e,a){if(e&1&&(_(0,Xe,3,2,"app-carousel-reel"),F(1,"async")),e&2){let t,i=o().$implicit;C(0,(t=D(1,1,i.api))?0:-1,t)}}function Ze(e,a){if(e&1){let t=g();p(0,"app-series-card",15),x("reload",function(){h(t);let n=o(3).$implicit,r=o(2);return f(r.reloadStream(n.id,!0))})("dataChanged",function(){h(t);let n=o(3).$implicit,r=o(2);return f(r.reloadStream(n.id))}),m()}if(e&2){let t=a.$implicit;l("data",t)("libraryId",t.libraryId)("isOnDeck",!0)}}function et(e,a){if(e&1){let t=g();p(0,"app-carousel-reel",13),x("sectionClick",function(){h(t);let n=o(4);return f(n.handleSectionClick(n.StreamId.OnDeck))}),_(1,Ze,1,3,"ng-template",null,5,b),m()}if(e&2){let t=o(3).$implicit;l("items",a)("title",t("on-deck-title"))}}function tt(e,a){if(e&1&&(_(0,et,3,2,"app-carousel-reel"),F(1,"async")),e&2){let t,i=o().$implicit;C(0,(t=D(1,1,i.api))?0:-1,t)}}function it(e,a){if(e&1){let t=g();p(0,"app-card-item",16),x("clicked",function(){let n=h(t).$implicit,r=o(5);return f(r.handleRecentlyAddedChapterClick(n))}),m()}if(e&2){let t=a.$implicit,i=o(5);l("entity",t)("title",t.seriesName)("imageUrl",i.imageService.getSeriesCoverImage(t.seriesId))("suppressArchiveWarning",!0)("count",t.count)}}function nt(e,a){if(e&1){let t=g();p(0,"app-carousel-reel",13),x("sectionClick",function(){h(t);let n=o(4);return f(n.handleSectionClick(n.StreamId.RecentlyUpdatedSeries))}),_(1,it,1,5,"ng-template",null,5,b),m()}if(e&2){let t=o(3).$implicit;l("items",a)("title",t("recently-updated-title"))}}function rt(e,a){if(e&1&&(_(0,nt,3,2,"app-carousel-reel"),F(1,"async")),e&2){let t,i=o().$implicit;C(0,(t=D(1,1,i.api))?0:-1,t)}}function at(e,a){if(e&1){let t=g();p(0,"app-series-card",17),x("dataChanged",function(){h(t);let n=o(3).$implicit,r=o(2);return f(r.reloadStream(n.id))}),m()}if(e&2){let t=a.$implicit;l("data",t)("libraryId",t.libraryId)}}function ot(e,a){if(e&1){let t=g();p(0,"app-carousel-reel",13),x("sectionClick",function(){h(t);let n=o(4);return f(n.handleSectionClick(n.StreamId.NewlyAddedSeries))}),_(1,at,1,2,"ng-template",null,5,b),m()}if(e&2){let t=o(3).$implicit;l("items",a)("title",t("recently-added-title"))}}function st(e,a){if(e&1&&(_(0,ot,3,2,"app-carousel-reel"),F(1,"async")),e&2){let t,i=o().$implicit;C(0,(t=D(1,1,i.api))?0:-1,t)}}function lt(e,a){if(e&1){let t=g();p(0,"app-series-card",17),x("dataChanged",function(){h(t);let n=o(3).$implicit,r=o(2);return f(r.reloadStream(n.id))}),m()}if(e&2){let t=a.$implicit;l("data",t)("libraryId",t.libraryId)}}function ct(e,a){if(e&1){let t=g();p(0,"app-carousel-reel",13),x("sectionClick",function(){h(t);let n=o(4);return f(n.handleSectionClick(n.StreamId.MoreInGenre))}),_(1,lt,1,2,"ng-template",null,5,b),m()}if(e&2){let t=o(3).$implicit,i=o();l("items",a)("title",t("more-in-genre-title",T(2,Le,i.genre==null?null:i.genre.title)))}}function _t(e,a){if(e&1&&(_(0,ct,3,4,"app-carousel-reel"),F(1,"async")),e&2){let t,i=o().$implicit;C(0,(t=D(1,1,i.api))?0:-1,t)}}function pt(e,a){if(e&1&&_(0,He,1,4)(1,We,1,4)(2,qe,1,4)(3,Qe,1,4)(4,Ke,1,4)(5,Ye,2,3,"ng-template",11,0,b)(7,tt,2,3,"ng-template",11,1,b)(9,rt,2,3,"ng-template",11,2,b)(11,st,2,3,"ng-template",11,3,b)(13,_t,2,3,"ng-template",11,4,b),e&2){let t,i=a.$implicit,n=o(2);C(0,(t=i.streamType)===n.StreamType.OnDeck?0:t===n.StreamType.RecentlyUpdated?1:t===n.StreamType.NewlyAdded?2:t===n.StreamType.SmartFilter?3:t===n.StreamType.MoreInGenre?4:-1)}}function mt(e,a){if(e&1&&(ne(0),_(1,ze,1,1),F(2,"async"),te(3,pt,15,1,null,null,Me),z(5,"app-loading",7),re()),e&2){let t,i=o();y(),C(1,(t=D(2,2,i.libraries$))?1:-1,t),y(2),ie(i.streams),y(2),l("loading",i.isLoadingDashboard||i.streamCount!==i.streamsLoaded)}}var V=function(e){return e[e.OnDeck=0]="OnDeck",e[e.RecentlyUpdatedSeries=1]="RecentlyUpdatedSeries",e[e.NewlyAddedSeries=2]="NewlyAddedSeries",e[e.MoreInGenre=3]="MoreInGenre",e}(V||{}),Oe=(()=>{let a=class a{constructor(){this.destroyRef=c(ee),this.filterUtilityService=c(ke),this.metadataService=c(ve),this.recommendationService=c(Ee),this.accountService=c(ge),this.libraryService=c(Se),this.seriesService=c(ye),this.router=c(me),this.titleService=c(pe),this.imageService=c(be),this.messageHub=c(fe),this.cdRef=c(se),this.dashboardService=c($e),this.scrobblingService=c(Te),this.toastr=c(Ce),this.serverService=c(Ie),this.libraries$=this.libraryService.getLibraries().pipe(J(1),S(this.destroyRef)),this.isLoadingDashboard=!0,this.isAdmin$=Q(!1),this.streams=[],this.refreshStreams$=new N,this.refreshStreamsFromDashboardUpdate$=new N,this.streamCount=0,this.streamsLoaded=0,this.loadRecentlyAdded$=new q,this.StreamType=k,this.StreamId=V,this.loadDashboard(),this.refreshStreamsFromDashboardUpdate$.pipe(S(this.destroyRef),K(1e3),v(()=>{this.loadDashboard()})).subscribe(),this.refreshStreams$.pipe(S(this.destroyRef),X(1e4),v(()=>{this.loadDashboard()})).subscribe(),this.messageHub.messages$.pipe(S(this.destroyRef)).subscribe(i=>{i.event===O.DashboardUpdate?this.refreshStreamsFromDashboardUpdate$.next():i.event===O.SeriesAdded?this.refreshStreams$.next():i.event===O.SeriesRemoved?this.refreshStreams$.next():i.event===O.ScanSeries&&(this.loadRecentlyAdded$.next(),this.refreshStreams$.next())}),this.scrobblingService.hasTokenExpired(Re.AniList).subscribe(i=>{i&&this.toastr.error(U("toasts.anilist-token-expired")),this.cdRef.markForCheck()}),this.isAdmin$=this.accountService.currentUser$.pipe(S(this.destroyRef),d(i=>i&&this.accountService.hasAdminRole(i)||!1),R({bufferSize:1,refCount:!0}))}ngOnInit(){this.titleService.setTitle("Kavita")}loadDashboard(){this.isLoadingDashboard=!0,this.streamsLoaded=0,this.streamCount=0,this.cdRef.markForCheck(),this.dashboardService.getDashboardStreams().subscribe(i=>{this.streams=i,this.streamCount=i.length,this.streams.forEach(n=>{switch(n.streamType){case k.OnDeck:n.api=this.seriesService.getOnDeck(0,1,20).pipe(d(r=>r.result),v(()=>this.increment()),S(this.destroyRef),R({bufferSize:1,refCount:!0}));break;case k.NewlyAdded:n.api=this.seriesService.getRecentlyAdded(1,20).pipe(d(r=>r.result),v(()=>this.increment()),S(this.destroyRef),R({bufferSize:1,refCount:!0}));break;case k.RecentlyUpdated:n.api=this.seriesService.getRecentlyUpdatedSeries().pipe(v(()=>this.increment()),S(this.destroyRef),R({bufferSize:1,refCount:!0}));break;case k.SmartFilter:n.api=this.filterUtilityService.decodeFilter(n.smartFilterEncoded).pipe(B(r=>this.seriesService.getAllSeriesV2(0,20,r))).pipe(d(r=>r.result),v(()=>this.increment()),S(this.destroyRef),R({bufferSize:1,refCount:!0}));break;case k.MoreInGenre:n.api=this.metadataService.getAllGenres().pipe(d(r=>(this.genre=r[Math.floor(Math.random()*r.length)],this.genre)),B(r=>this.recommendationService.getMoreIn(0,r.id,0,30)),d(r=>r.result),v(()=>this.increment()),S(this.destroyRef),R({bufferSize:1,refCount:!0}));break}}),this.isLoadingDashboard=!1,this.cdRef.markForCheck()})}increment(){this.streamsLoaded++,this.cdRef.markForCheck()}reloadStream(i,n=!1){let r=this.streams.findIndex(s=>s.id===i);r<0||(n?(this.refreshStreams$.next(),this.cdRef.markForCheck()):(this.streams[r]=W({},this.streams[r]),this.cdRef.markForCheck()))}handleRecentlyAddedChapterClick(i){return G(this,null,function*(){yield this.router.navigate(["library",i.libraryId,"series",i.seriesId])})}handleFilterSectionClick(i){return G(this,null,function*(){yield this.router.navigateByUrl("all-series?"+i.smartFilterEncoded)})}handleSectionClick(i){if(i===V.RecentlyUpdatedSeries){let n={};n.page=1,n.title=U("dashboard.recently-updated-title");let r=this.filterUtilityService.createSeriesV2Filter();r.sortOptions&&(r.sortOptions.sortField=L.LastChapterAdded,r.sortOptions.isAscending=!1),this.filterUtilityService.applyFilterWithParams(["all-series"],r,n).subscribe()}else if(i===V.OnDeck){let n={};n.page=1,n.title=U("dashboard.on-deck-title");let r=this.filterUtilityService.createSeriesV2Filter();r.statements.push({field:M.ReadProgress,comparison:P.GreaterThan,value:"0"}),r.statements.push({field:M.ReadProgress,comparison:P.LessThan,value:"100"}),r.sortOptions&&(r.sortOptions.sortField=L.LastChapterAdded,r.sortOptions.isAscending=!1),this.filterUtilityService.applyFilterWithParams(["all-series"],r,n).subscribe()}else if(i===V.NewlyAddedSeries){let n={};n.page=1,n.title=U("dashboard.recently-added-title");let r=this.filterUtilityService.createSeriesV2Filter();r.sortOptions&&(r.sortOptions.sortField=L.Created,r.sortOptions.isAscending=!1),this.filterUtilityService.applyFilterWithParams(["all-series"],r,n).subscribe()}else if(i===V.MoreInGenre){let n={};n.page=1,n.title=U("dashboard.more-in-genre-title",{genre:this.genre?.title});let r=this.filterUtilityService.createSeriesV2Filter();r.statements.push({field:M.Genres,value:this.genre?.id+"",comparison:P.MustContains}),this.filterUtilityService.applyFilterWithParams(["all-series"],r,n).subscribe()}}};a.\u0275fac=function(n){return new(n||a)},a.\u0275cmp=Z({type:a,selectors:[["app-dashboard"]],standalone:!0,features:[oe],decls:2,vars:1,consts:[["smartFilter",""],["onDeck",""],["recentlyUpdated",""],["newlyUpdated",""],["moreInGenre",""],["carouselItem",""],[4,"transloco","translocoRead"],[3,"loading"],[1,"mt-3"],[1,"d-flex","justify-content-center"],["routerLink","/admin/dashboard","fragment","libraries"],["DashboardStream",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"sectionClick","items","title"],[3,"reload","dataChanged","data","libraryId"],[3,"reload","dataChanged","data","libraryId","isOnDeck"],[3,"clicked","entity","title","imageUrl","suppressArchiveWarning","count"],[3,"dataChanged","data","libraryId"]],template:function(n,r){n&1&&(z(0,"app-side-nav-companion-bar"),_(1,mt,6,4,"ng-container",6)),n&2&&(y(),l("translocoRead","dashboard"))},dependencies:[Ue,de,Ve,we,Fe,ce,ue,le,De],styles:["/*# sourceMappingURL=dashboard.component-5AVST4RP.css.map */"],changeDetection:0});let e=a;return e})();var ti=[{path:"",component:Oe}];export{ti as routes};
//# sourceMappingURL=chunk-6UQRQD2S.js.map
