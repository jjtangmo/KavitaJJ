import{a as ne}from"./chunk-OWYEASWT.js";import{q as ie}from"./chunk-SPNNO5LP.js";import{s as te}from"./chunk-E6ZKMAWP.js";import{$ as V,$b as D,$d as w,Ae as Z,Bb as f,Fa as g,Ga as h,Gc as O,Ib as d,Jd as A,Kb as S,Na as R,Rb as k,Rc as j,Rd as y,Td as W,Vb as o,Wb as r,Xb as u,Yb as x,Zb as C,_d as z,be as J,bf as ee,cc as E,ce as B,dc as c,de as K,fb as M,fe as I,gc as N,hd as G,he as X,id as U,lb as i,mb as b,me as H,ne as Q,oc as s,pc as _,qa as T,qc as v,tc as L,uc as $,va as F,vc as P,xc as q,ze as Y}from"./chunk-2LHIXASS.js";function ae(t,l){if(t&1&&(u(0,"i",26),o(1,"span",27),s(2),r()),t&2){let e=c().$implicit;d("ngbTooltip",e("email-confirmed")),i(2),_(e("email-confirmed"))}}function re(t,l){if(t&1&&(u(0,"i",28),o(1,"span",27),s(2),r()),t&2){let e=c().$implicit;d("ngbTooltip",e("email-not-confirmed")),i(2),_(e("email-not-confirmed"))}}function oe(t,l){if(t&1&&(x(0),o(1,"div",29)(2,"span",30),s(3),r()(),C()),t&2){let e=c(2);i(3),_(e.user==null?null:e.user.email)}}function le(t,l){if(t&1&&(o(0,"div"),s(1),r()),t&2){let e=l.$implicit;i(),_(e)}}function me(t,l){if(t&1&&(o(0,"div",31),f(1,le,2,1,"div",32),r()),t&2){let e=c(2);i(),d("ngForOf",e.errors)}}function ce(t,l){if(t&1&&(o(0,"div",15),s(1),r()),t&2){let e=c().$implicit;i(),v(" ",e("has-invalid-email")," ")}}function se(t,l){if(t&1&&(o(0,"div"),s(1),r()),t&2){let e=c(2).$implicit;i(),v(" ",e("required-field")," ")}}function de(t,l){if(t&1&&(o(0,"div"),s(1),r()),t&2){let e=c(2).$implicit;i(),v(" ",e("valid-email")," ")}}function pe(t,l){if(t&1&&(o(0,"div",33),f(1,se,2,1,"div",11)(2,de,2,1,"div",11),r()),t&2){let e,a,n=c(2);i(),d("ngIf",(e=n.form.get("email"))==null||e.errors==null?null:e.errors.required),i(),d("ngIf",(a=n.form.get("email"))==null||a.errors==null?null:a.errors.email)}}function _e(t,l){if(t&1&&(o(0,"div"),s(1),r()),t&2){let e=c(2).$implicit;i(),v(" ",e("required-field")," ")}}function fe(t,l){if(t&1&&(o(0,"div",34),f(1,_e,2,1,"div",11),r()),t&2){let e,a=c(2);i(),d("ngIf",(e=a.form.get("password"))==null||e.errors==null?null:e.errors.required)}}function ue(t,l){if(t&1&&(x(0),o(1,"h4"),s(2),r(),o(3,"p"),s(4),r(),o(5,"a",35),s(6),r(),u(7,"app-api-key",36),C()),t&2){let e=c().$implicit,a=c();i(2),_(e("email-updated-title")),i(2),_(e("email-updated-description")),i(),N("href",a.emailLink,M),i(),_(e("setup-user-account")),i(),d("title",e("invite-url-label"))("tooltipText",e("invite-url-tooltip"))("hideData",!1)("showRefresh",!1)("transform",a.makeLink)}}function ve(t,l){if(t&1&&(o(0,"p"),s(1),r()),t&2){let e=c().$implicit;i(),_(e("permission-error"))}}function ge(t,l){if(t&1){let e=D();x(0),o(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7)(6,"h4",8),s(7),f(8,ae,3,2)(9,re,3,2),r()(),o(10,"div",9)(11,"button",10),E("click",function(){g(e);let n=c();return h(n.toggleViewMode())}),s(12),r()()()(),f(13,oe,4,1,"ng-container",11),o(14,"div",12,0),P("ngbCollapseChange",function(n){g(e);let p=c();return $(p.isViewMode,n)||(p.isViewMode=n),h(n)}),x(16),f(17,me,2,1,"div",13),o(18,"form",14),f(19,ce,2,1,"div",15),o(20,"div",16)(21,"label",17),s(22),r(),u(23,"input",18),f(24,pe,3,2,"div",19),r(),o(25,"div",16)(26,"label",20),s(27),r(),u(28,"input",21),f(29,fe,2,1,"div",22),r(),o(30,"div",23)(31,"button",24),E("click",function(){g(e);let n=c();return h(n.resetForm())}),s(32),r(),o(33,"button",25),E("click",function(){g(e);let n=c();return h(n.saveForm())}),s(34),r()()(),C(),f(35,ue,8,9,"ng-container",11)(36,ve,2,1,"ng-template",null,1,O),r()()(),C()}if(t&2){let e,a,n,p=l.$implicit,m=c();i(7),v("",p("email-title")," "),i(),k(8,m.emailConfirmed?8:9),i(3),d("disabled",!m.canEdit),i(),_(m.isViewMode?p("edit"):p("cancel")),i(),d("ngIf",m.isViewMode),i(),L("ngbCollapse",m.isViewMode),i(3),d("ngIf",m.errors.length>0),i(),d("formGroup",m.form),i(),k(19,m.hasValidEmail?-1:19),i(3),_(p("email-label")),i(),S("is-invalid",((e=m.form.get("email"))==null?null:e.invalid)&&((e=m.form.get("email"))==null?null:e.touched)),i(),d("ngIf",(a=m.form.get("email"))==null?null:a.errors),i(3),_(p("current-password-label")),i(),S("is-invalid",((n=m.form.get("password"))==null?null:n.invalid)&&((n=m.form.get("password"))==null?null:n.touched)),i(),d("ngIf",m.form.dirty||m.form.touched),i(3),_(p("reset")),i(),d("disabled",!m.form.valid||!(m.form.dirty||m.form.touched)),i(),_(p("save")),i(),d("ngIf",m.emailLink!=="")}}var De=(()=>{let l=class l{get email(){return this.form.get("email")}constructor(a,n,p){this.accountService=a,this.toastr=n,this.cdRef=p,this.destroyRef=T(R),this.form=new K({}),this.user=void 0,this.errors=[],this.isViewMode=!0,this.emailLink="",this.emailConfirmed=!0,this.hasValidEmail=!0,this.canEdit=!1,this.makeLink=m=>this.emailLink}ngOnInit(){this.accountService.currentUser$.pipe(A(this.destroyRef),V()).subscribe(a=>{this.user=a,this.canEdit=!this.accountService.hasReadOnlyRole(a),this.form.addControl("email",new I(a?.email,[w.required,w.email])),this.form.addControl("password",new I("",[w.required])),this.cdRef.markForCheck(),this.accountService.isEmailConfirmed().subscribe(n=>{this.emailConfirmed=n,this.cdRef.markForCheck()}),this.accountService.isEmailValid().subscribe(n=>{this.hasValidEmail=n,this.cdRef.markForCheck()})})}resetForm(){this.form.get("email")?.setValue(this.user?.email),this.errors=[],this.cdRef.markForCheck()}saveForm(){if(this.user===void 0)return;let a=this.form.value;this.errors=[],this.accountService.updateEmail(a.email,a.password).subscribe(n=>{n.invalidEmail&&this.toastr.success(y("toasts.email-sent-to-no-existing",{email:a.email})),n.emailSent?this.toastr.success(y("toasts.email-sent-to")):(this.toastr.success(y("toasts.change-email-no-email")),this.accountService.refreshAccount().subscribe(p=>{this.user=p,this.form.get("email")?.setValue(this.user?.email),this.cdRef.markForCheck()})),this.isViewMode=!0,this.resetForm()},n=>{this.errors=n})}toggleViewMode(){this.isViewMode=!this.isViewMode,this.resetForm()}};l.\u0275fac=function(n){return new(n||l)(b(ie),b(te),b(j))},l.\u0275cmp=F({type:l,selectors:[["app-change-email"]],standalone:!0,features:[q],decls:1,vars:1,consts:[["collapse","ngbCollapse"],["noPermission",""],[4,"transloco","translocoRead"],[1,"card","mt-2"],[1,"card-body"],[1,"card-title"],[1,"container-fluid","row","mb-2"],[1,"col-10","col-sm-11"],["id","email-card"],[1,"col-1","text-end"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],[4,"ngIf"],[3,"ngbCollapseChange","ngbCollapse"],["class","alert alert-danger","role","alert",4,"ngIf"],[3,"formGroup"],["role","alert",1,"alert","alert-warning"],[1,"mb-3"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email",1,"form-control","custom-input"],["id","email-validations","class","invalid-feedback",4,"ngIf"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password",1,"form-control","custom-input"],["id","password-validations","class","invalid-feedback",4,"ngIf"],[1,"col-auto","d-flex","d-md-block","justify-content-sm-center","text-md-end","mb-3"],["type","button","aria-describedby","email-card",1,"flex-fill","btn","btn-secondary","me-2",3,"click"],["type","submit","aria-describedby","email-card",1,"flex-fill","btn","btn-primary",3,"click","disabled"],["aria-hidden","true",1,"fa-solid","fa-circle-check","ms-1","confirm-icon",3,"ngbTooltip"],[1,"visually-hidden"],["aria-hidden","true",1,"fa-solid","fa-circle","ms-1","confirm-icon","error",3,"ngbTooltip"],[1,"container-fluid","row"],[1,"col-12"],["role","alert",1,"alert","alert-danger"],[4,"ngFor","ngForOf"],["id","email-validations",1,"invalid-feedback"],["id","password-validations",1,"invalid-feedback"],["target","_blank","rel","noopener noreferrer",1,"email-link",3,"href"],[3,"title","tooltipText","hideData","showRefresh","transform"]],template:function(n,p){n&1&&f(0,ge,38,21,"ng-container",2),n&2&&d("translocoRead","change-email")},dependencies:[U,ee,Z,G,Y,X,z,J,B,H,Q,ne,W],styles:[`.confirm-icon[_ngcontent-%COMP%]{color:var(--primary-color);font-size:14px;vertical-align:middle}.error[_ngcontent-%COMP%]{color:var(--error-color)}
/*# sourceMappingURL=change-email.component-6WMLXU6J.css.map */`],changeDetection:0});let t=l;return t})();export{De as ChangeEmailComponent};
//# sourceMappingURL=chunk-OW5SHVKA.js.map
