import{b as Se,c as ve}from"./chunk-7RIKHQP6.js";import"./chunk-G6W3CHAT.js";import{a as T,b as M}from"./chunk-MK37P623.js";import{a as _e}from"./chunk-5JNCF2FD.js";import"./chunk-DATLIK2Y.js";import"./chunk-C2T36BOI.js";import{g as be}from"./chunk-CASH644A.js";import{a as pe,b as he}from"./chunk-GGQU56QW.js";import"./chunk-V7YNUPX5.js";import{b as ye}from"./chunk-U42B4V5B.js";import{g as de}from"./chunk-CIDLU7ZZ.js";import{a as ce}from"./chunk-FVF23ION.js";import{a as s,b as oe,m as ue}from"./chunk-ZTKUYOP3.js";import"./chunk-2JQ3KAM5.js";import"./chunk-5TIUG6K2.js";import"./chunk-IYLIANWB.js";import"./chunk-63UKDQJP.js";import"./chunk-COKVODYN.js";import{a as le}from"./chunk-K6JLHPZK.js";import"./chunk-SEAKSSGD.js";import"./chunk-KWNQHRPC.js";import"./chunk-STVWBYRJ.js";import"./chunk-SBPQBTA5.js";import"./chunk-23B3ZJIN.js";import"./chunk-YK7KIY5R.js";import{a as ne}from"./chunk-WBO5KV4A.js";import{a as N,b as A,h as me}from"./chunk-LAUBKCQL.js";import"./chunk-46CIW37K.js";import"./chunk-76TOP2FJ.js";import"./chunk-4XR5JJUF.js";import"./chunk-DBXQZVFZ.js";import"./chunk-5XQ66AVT.js";import"./chunk-RLL2TM5C.js";import{a as fe}from"./chunk-CNATNHH2.js";import{d as D,f as se}from"./chunk-5CMEBAZF.js";import"./chunk-ZRHV3LXB.js";import"./chunk-SBTJKJNK.js";import{c as ee,e as te,j as w,k as ie}from"./chunk-SPNNO5LP.js";import{d as Z}from"./chunk-E6ZKMAWP.js";import{$b as L,Bb as k,Dc as W,Ec as Y,Fa as S,Ga as v,Gc as z,Ib as h,Jd as re,Na as B,Pa as F,Rc as J,S as P,Td as ae,Vb as _,Wb as y,Xb as O,Yb as U,Zb as H,cc as g,dc as c,g as C,ib as x,id as Q,lb as p,mb as o,oc as R,pc as K,qa as I,qc as $,sd as X,va as V,xc as q,zc as G}from"./chunk-2LHIXASS.js";var we=a=>({num:a});function De(a,l){if(a&1&&(_(0,"h6",9),R(1),W(2,"number"),y()),a&2){let i=c().$implicit,e=c();p(),$("",i("common.series-count",G(3,we,Y(2,1,e.pagination.totalItems)))," ")}}function Ne(a,l){if(a&1){let i=L();_(0,"app-series-card",11),g("reload",function(){S(i);let t=c(3);return v(t.loadPage())})("selection",function(t){let r=S(i).idx,n=c(3);return v(n.bulkSelectionService.handleCardSelection("series",r,n.series.length,t))}),y()}if(a&2){let i=l.$implicit,e=l.idx,t=c(3);h("data",i)("libraryId",t.libraryId)("suppressLibraryLink",!0)("selected",t.bulkSelectionService.isCardSelected("series",e))("allowSelection",!0)}}function Te(a,l){if(a&1){let i=L();_(0,"app-card-detail-layout",10),g("applyFilter",function(t){S(i);let r=c(2);return v(r.updateFilter(t))}),k(1,Ne,1,5,"ng-template",null,0,z),y()}if(a&2){let i=c(2);h("isLoading",i.loadingSeries)("items",i.series)("pagination",i.pagination)("filterSettings",i.filterSettings)("trackByIdentity",i.trackByIdentity)("filterOpen",i.filterOpen)("jumpBarKeys",i.jumpKeys)("refresh",i.refresh)}}function Me(a,l){if(a&1){let i=L();U(0),_(1,"app-side-nav-companion-bar",2),g("filterOpen",function(t){S(i);let r=c();return v(r.filterOpen.emit(t))}),_(2,"h2",3)(3,"app-card-actionables",4),g("actionHandler",function(t){S(i);let r=c();return v(r.performAction(t))}),y(),_(4,"span"),R(5),y()(),k(6,De,3,5,"h6",5),y(),O(7,"app-bulk-operations",6)(8,"app-loading",7),k(9,Te,3,8,"app-card-detail-layout",8),H()}if(a&2){let i=c();p(),h("hasFilter",!0)("filterActive",i.filterActive),p(2),h("actions",i.actions),p(2),K(i.libraryName),p(),h("ngIf",i.active.fragment===""),p(),h("actionCallback",i.bulkActionCallback),p(),h("absolute",!0)("loading",i.bulkLoader),p(),h("ngIf",i.filter)}}var E=(()=>{let l=class l{constructor(e,t,r,n,m,ge,ke,Ce,Ie,Le,Ae,Fe){this.route=e,this.router=t,this.seriesService=r,this.libraryService=n,this.titleService=m,this.actionFactoryService=ge,this.actionService=ke,this.bulkSelectionService=Ce,this.hubService=Ie,this.utilityService=Le,this.navService=Ae,this.filterUtilityService=Fe,this.destroyRef=I(B),this.metadataService=I(me),this.cdRef=I(J),this.libraryName="",this.series=[],this.loadingSeries=!1,this.pagination={currentPage:0,totalPages:0,totalItems:0,itemsPerPage:0},this.actions=[],this.filter=void 0,this.filterSettings=new Se,this.filterOpen=new F,this.filterActive=!1,this.refresh=new F,this.jumpKeys=[],this.bulkLoader=!1,this.tabs=[{title:"library-tab",fragment:"",icon:"fa-landmark"},{title:"recommended-tab",fragment:"recommended",icon:"fa-award"}],this.active=this.tabs[0],this.bulkActionCallback=(f,b)=>C(this,null,function*(){let xe=this.bulkSelectionService.getSelectedCardsForSource("series"),u=this.series.filter((d,Re)=>xe.includes(Re+""));switch(f.action){case s.AddToReadingList:this.actionService.addMultipleSeriesToReadingList(u,d=>{d&&this.bulkSelectionService.deselectAll(),this.cdRef.markForCheck()});break;case s.AddToWantToReadList:this.actionService.addMultipleSeriesToWantToReadList(u.map(d=>d.id),()=>{this.bulkSelectionService.deselectAll(),this.cdRef.markForCheck()});break;case s.RemoveFromWantToReadList:this.actionService.removeMultipleSeriesFromWantToReadList(u.map(d=>d.id),()=>{this.bulkSelectionService.deselectAll(),this.cdRef.markForCheck()});break;case s.AddToCollection:this.actionService.addMultipleSeriesToCollectionTag(u,d=>{d&&this.bulkSelectionService.deselectAll(),this.cdRef.markForCheck()});break;case s.MarkAsRead:this.actionService.markMultipleSeriesAsRead(u,()=>{this.bulkSelectionService.deselectAll(),this.loadPage()});break;case s.MarkAsUnread:this.actionService.markMultipleSeriesAsUnread(u,()=>{this.bulkSelectionService.deselectAll(),this.loadPage()});break;case s.Delete:u.length>25&&(this.bulkLoader=!0,this.cdRef.markForCheck()),yield this.actionService.deleteMultipleSeries(u,d=>{this.bulkLoader=!1,this.cdRef.markForCheck(),d&&(this.bulkSelectionService.deselectAll(),this.loadPage())});break}}),this.trackByIdentity=(f,b)=>`${b.id}_${b.name}_${b.localizedName}_${b.pagesRead}`;let j=this.route.snapshot.paramMap.get("libraryId");if(j===null){this.router.navigateByUrl("/home");return}this.actions=this.actionFactoryService.getLibraryActions(this.handleAction.bind(this)),this.router.routeReuseStrategy.shouldReuseRoute=()=>!1,this.libraryId=parseInt(j,10),this.libraryService.getLibraryNames().pipe(P(1)).subscribe(f=>{this.libraryName=f[this.libraryId],this.titleService.setTitle("Kavita - "+this.libraryName),this.cdRef.markForCheck()}),this.libraryService.getJumpBar(this.libraryId).subscribe(f=>{this.jumpKeys=f,this.cdRef.markForCheck()}),this.actions=this.actionFactoryService.getLibraryActions(this.handleAction.bind(this)),this.filterUtilityService.filterPresetsFromUrl(this.route.snapshot).subscribe(f=>{this.filter=f,this.filter.statements.filter(b=>b.field===A.Libraries).length===0&&this.filter.statements.push({field:A.Libraries,value:this.libraryId+"",comparison:N.Equal}),this.filterActiveCheck=this.filterUtilityService.createSeriesV2Filter(),this.filterActiveCheck.statements.push({field:A.Libraries,value:this.libraryId+"",comparison:N.Equal}),this.filterSettings.presetsV2=this.filter,this.cdRef.markForCheck()})}ngOnInit(){this.hubService.messages$.pipe(re(this.destroyRef)).subscribe(e=>{if(e.event===w.SeriesAdded){let t=e.payload;if(t.libraryId!==this.libraryId)return;if(!this.utilityService.deepEqual(this.filter,this.filterActiveCheck)){this.loadPage();return}this.seriesService.getSeries(t.seriesId).subscribe(r=>{this.series.filter(n=>r.id===n.id).length>0||(this.series=[...this.series,r].sort((n,m)=>n.sortName<m.sortName?-1:n.sortName>m.sortName?1:0),this.pagination.totalItems++,this.cdRef.markForCheck(),this.refresh.emit())})}else if(e.event===w.SeriesRemoved){let t=e.payload;if(t.libraryId!==this.libraryId)return;if(!this.utilityService.deepEqual(this.filter,this.filterActiveCheck)){this.loadPage();return}this.series=this.series.filter(r=>r.id!=t.seriesId),this.pagination.totalItems--,this.cdRef.markForCheck(),this.refresh.emit()}})}handleKeypress(e){e.key===D.SHIFT&&(this.bulkSelectionService.isShiftDown=!0)}handleKeyUp(e){e.key===D.SHIFT&&(this.bulkSelectionService.isShiftDown=!1)}handleAction(e,t){return C(this,null,function*(){let r=t;if(t===void 0){this.libraryService.getLibrary(this.libraryId).subscribe(n=>C(this,null,function*(){switch(e.action){case s.Scan:yield this.actionService.scanLibrary(n);break;case s.RefreshMetadata:yield this.actionService.refreshMetadata(n);break;case s.Edit:this.actionService.editLibrary(n);break;default:break}}));return}switch(e.action){case s.Scan:yield this.actionService.scanLibrary(r);break;case s.RefreshMetadata:yield this.actionService.refreshMetadata(r);break;case s.Edit:this.actionService.editLibrary(r);break;default:break}})}performAction(e){typeof e.callback=="function"&&e.callback(e,void 0)}updateFilter(e){if(e.filterV2!==void 0){if(this.filter=e.filterV2,e.isFirst){this.loadPage();return}this.filterUtilityService.updateUrlFromFilter(this.filter).subscribe(t=>{this.loadPage()})}}loadPage(){this.loadingSeries=!0,this.filterActive=!this.utilityService.deepEqual(this.filter,this.filterActiveCheck),this.cdRef.markForCheck(),this.seriesService.getSeriesForLibraryV2(void 0,void 0,this.filter).subscribe(e=>{this.series=e.result,this.pagination=e.pagination,this.loadingSeries=!1,this.cdRef.markForCheck()})}};l.\u0275fac=function(t){return new(t||l)(o(ee),o(te),o(ce),o(le),o(Z),o(oe),o(de),o(he),o(ie),o(se),o(ne),o(ue))},l.\u0275cmp=V({type:l,selectors:[["app-library-detail"]],hostBindings:function(t,r){t&1&&g("keydown.shift",function(m){return r.handleKeypress(m)},!1,x)("keyup.shift",function(m){return r.handleKeyUp(m)},!1,x)},standalone:!0,features:[q],decls:1,vars:0,consts:[["cardItem",""],[4,"transloco"],[3,"filterOpen","hasFilter","filterActive"],["title",""],[3,"actionHandler","actions"],["subtitle","","class","subtitle-with-actionables",4,"ngIf"],[3,"actionCallback"],[3,"absolute","loading"],[3,"isLoading","items","pagination","filterSettings","trackByIdentity","filterOpen","jumpBarKeys","refresh","applyFilter",4,"ngIf"],["subtitle","",1,"subtitle-with-actionables"],[3,"applyFilter","isLoading","items","pagination","filterSettings","trackByIdentity","filterOpen","jumpBarKeys","refresh"],[3,"reload","selection","data","libraryId","suppressLibraryLink","selected","allowSelection"]],template:function(t,r){t&1&&k(0,Me,10,9,"ng-container",1)},dependencies:[ye,pe,Q,ve,be,_e,X,ae,fe],styles:[`.card[_ngcontent-%COMP%]{height:400;width:200}.viewport[_ngcontent-%COMP%]{width:600px;height:100%;overflow-y:auto}
/*# sourceMappingURL=library-detail.component-SOM4LPYA.css.map */`],changeDetection:0});let a=l;return a})();var kt=[{path:":libraryId",runGuardsAndResolvers:"always",canActivate:[T,M],component:E},{path:"",runGuardsAndResolvers:"always",canActivate:[T,M],component:E}];export{kt as routes};
//# sourceMappingURL=chunk-OTUH3ALY.js.map
