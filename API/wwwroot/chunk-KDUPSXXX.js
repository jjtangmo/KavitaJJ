import"./chunk-ZCIXPP5E.js";import"./chunk-VAE34R3W.js";import"./chunk-46CIW37K.js";import{k as ie}from"./chunk-76TOP2FJ.js";import"./chunk-4XR5JJUF.js";import"./chunk-DBXQZVFZ.js";import"./chunk-5XQ66AVT.js";import{a as oe,b as ae}from"./chunk-RLL2TM5C.js";import"./chunk-WIQ43ZSS.js";import{a as ne}from"./chunk-CNATNHH2.js";import"./chunk-5CMEBAZF.js";import"./chunk-ZRHV3LXB.js";import{q as te}from"./chunk-SPNNO5LP.js";import{s as ee}from"./chunk-E6ZKMAWP.js";import{$b as f,$d as k,Ad as N,Ae as j,Bb as p,Be as z,Ce as Y,De as K,Ee as Q,Fa as u,Fe as J,Ga as C,Ge as X,Ib as m,Na as I,Rb as g,Rc as F,Rd as y,Td as $,Vb as a,Wb as n,Xb as _,Yb as M,Zb as E,_d as R,be as U,bf as Z,cc as h,ce as D,dc as r,de as B,fe as S,he as O,id as G,lb as i,me as q,ne as H,oc as l,pc as d,qa as b,qc as x,tc as V,uc as w,va as L,vc as A,xc as P,yc as v,ze as W}from"./chunk-2LHIXASS.js";var le=()=>({product:"Kavita+"}),re=()=>({service:"AniList"}),ce=()=>({service:"MAL"});function se(t,o){if(t&1&&(_(0,"i",9),a(1,"span",10),l(2),n()),t&2){let e=r().$implicit;m("ngbTooltip",e("token-valid")),i(2),d(e("token-valid"))}}function de(t,o){if(t&1&&(_(0,"i",11),a(1,"span",10),l(2),n()),t&2){let e=r().$implicit;m("ngbTooltip",e("token-expired")),i(2),d(e("token-expired"))}}function me(t,o){if(t&1&&l(0),t&2){let e=r(3).$implicit;x(" ",e("requires",v(1,le))," ")}}function pe(t,o){if(t&1&&l(0),t&2){let e=r(4).$implicit;x(" ",e("token-set")," ")}}function _e(t,o){if(t&1&&l(0),t&2){let e=r(4).$implicit;x(" ",e("no-token-set")," ")}}function ge(t,o){if(t&1&&(a(0,"i",29)(1,"span",10),l(2),n()()),t&2){let e=r(4).$implicit;m("ngbTooltip",e("token-expired")),i(2),d(e("token-expired"))}}function xe(t,o){if(t&1&&l(0),t&2){let e=r(4).$implicit;x(" ",e("token-set")," ")}}function be(t,o){if(t&1&&l(0),t&2){let e=r(4).$implicit;x(" ",e("no-token-set")," ")}}function ue(t,o){if(t&1&&(a(0,"i",29)(1,"span",10),l(2),n()()),t&2){let e=r(4).$implicit;m("ngbTooltip",e("token-expired")),i(2),d(e("token-expired"))}}function Ce(t,o){if(t&1&&l(0),t&2){let e=r(4).$implicit;x(" ",e("no-token-set")," ")}}function fe(t,o){if(t&1&&(a(0,"span"),_(1,"img",25),p(2,pe,1,1)(3,_e,1,1)(4,ge,3,2,"i",26),n(),a(5,"span",27),_(6,"img",28),p(7,xe,1,1)(8,be,1,1),n(),p(9,ue,3,2,"i",26)(10,Ce,1,1)),t&2){let e=r(4);i(2),g(2,e.aniListToken&&e.aniListToken.length>0?2:3),i(2),g(4,e.aniListTokenExpired?4:-1),i(3),g(7,e.malToken&&e.malToken.length>0?7:8),i(2),g(9,e.malTokenExpired?9:-1),i(),g(10,!e.aniListToken&&!e.malToken?10:-1)}}function ve(t,o){if(t&1&&(M(0),a(1,"div",23)(2,"span",24),p(3,me,1,2)(4,fe,11,5),n()(),E()),t&2){let e=r(3);i(3),g(3,e.hasValidLicense?4:3)}}function he(t,o){if(t&1&&(_(0,"i",9),a(1,"span",10),l(2),n()),t&2){let e=r(2).$implicit;m("ngbTooltip",e("token-valid")),i(2),d(e("token-valid"))}}function ke(t,o){if(t&1&&(_(0,"i",11),a(1,"span",10),l(2),n()),t&2){let e=r(2).$implicit;m("ngbTooltip",e("token-expired")),i(2),d(e("token-expired"))}}function Se(t,o){if(t&1){let e=f();a(0,"p"),l(1),n(),a(2,"div",30)(3,"label",31),l(4),n(),_(5,"textarea",32),n(),a(6,"div",33)(7,"a",34),l(8),n(),a(9,"button",35),h("click",function(){u(e);let c=r(3);return C(c.saveAniListForm())}),l(10),n()()}if(t&2){let e=r(2).$implicit;i(),d(e("instructions",v(4,re))),i(3),d(e("token-input-label",v(5,re))),i(4),d(e("generate")),i(2),d(e("save"))}}function Te(t,o){if(t&1&&(_(0,"i",9),a(1,"span",10),l(2),n()),t&2){let e=r(2).$implicit;m("ngbTooltip",e("token-valid")),i(2),d(e("token-valid"))}}function Me(t,o){if(t&1&&(_(0,"i",11),a(1,"span",10),l(2),n()),t&2){let e=r(2).$implicit;m("ngbTooltip",e("token-expired")),i(2),d(e("token-expired"))}}function Ee(t,o){if(t&1){let e=f();a(0,"p"),l(1),n(),a(2,"div",30)(3,"label",36),l(4),n(),_(5,"input",37),n(),a(6,"div",30)(7,"label",38),l(8),n(),_(9,"input",39),n(),a(10,"div",33)(11,"button",40),h("click",function(){u(e);let c=r(3);return C(c.saveMalForm())}),l(12),n()()}if(t&2){let e=r(2).$implicit;i(),d(e("mal-instructions",v(4,ce))),i(3),d(e("mal-token-input-label")),i(4),d(e("mal-username-input-label")),i(4),d(e("save"))}}function ye(t,o){if(t&1){let e=f();p(0,ve,5,1,"ng-container",12),a(1,"div",13),A("ngbCollapseChange",function(c){u(e);let T=r(2);return w(T.isViewMode,c)||(T.isViewMode=c),C(c)}),a(2,"p"),l(3),n(),a(4,"form",14)(5,"div",15,0)(7,"div",16)(8,"h2",17)(9,"button",18),l(10," AniList "),p(11,he,3,2)(12,ke,3,2),n()(),a(13,"div",19)(14,"div",20),p(15,Se,11,6,"ng-template"),n()()(),a(16,"div",21)(17,"h2",17)(18,"button",22),l(19," MAL "),p(20,Te,3,2)(21,Me,3,2),n()(),a(22,"div",19)(23,"div",20),p(24,Ee,13,5,"ng-template"),n()()()()()()}if(t&2){let e=r().$implicit,s=r();m("ngIf",s.isViewMode),i(),V("ngbCollapse",s.isViewMode),i(2),d(e("generic-instructions")),i(),m("formGroup",s.formGroup),i(),m("destroyOnHide",!1)("closeOthers",!0),i(6),g(11,s.aniListTokenExpired?12:11),i(9),g(20,s.malTokenExpired?21:20)}}function Le(t,o){if(t&1&&_(0,"app-loading",41),t&2){let e=r().$implicit,s=r();m("loading",!s.loaded)("message",e("loading"))}}function Ie(t,o){if(t&1){let e=f();M(0),a(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6)(6,"h4"),l(7),p(8,se,3,2)(9,de,3,2),n()(),a(10,"div",7)(11,"button",8),h("click",function(){u(e);let c=r();return C(c.toggleViewMode())}),l(12),n()()()(),p(13,ye,25,8)(14,Le,1,2),n()(),E()}if(t&2){let e=o.$implicit,s=r();i(7),x("",e("title")," "),i(),g(8,s.aniListTokenExpired?9:8),i(3),m("disabled",!s.hasValidLicense),i(),d(s.isViewMode?e("edit"):e("cancel")),i(),g(13,s.loaded?13:14)}}var We=(()=>{let o=class o{constructor(){this.accountService=b(te),this.scrobblingService=b(ae),this.toastr=b(ee),this.cdRef=b(F),this.destroyRef=b(I),this.hasValidLicense=!1,this.formGroup=new B({}),this.aniListToken="",this.malToken="",this.malUsername="",this.aniListTokenExpired=!1,this.malTokenExpired=!1,this.isViewMode=!0,this.loaded=!1,this.accountService.hasValidLicense$.subscribe(s=>{this.hasValidLicense=s,this.cdRef.markForCheck(),this.hasValidLicense&&(this.scrobblingService.getAniListToken().subscribe(c=>{this.aniListToken=c,this.formGroup.get("aniListToken")?.setValue(c),this.loaded=!0,this.cdRef.markForCheck()}),this.scrobblingService.getMalToken().subscribe(c=>{this.malToken=c.accessToken,this.malUsername=c.username,this.formGroup.get("malToken")?.setValue(this.malToken),this.formGroup.get("malUsername")?.setValue(this.malUsername),this.cdRef.markForCheck()}),this.scrobblingService.hasTokenExpired(oe.AniList).subscribe(c=>{this.aniListTokenExpired=c,this.cdRef.markForCheck()}))})}ngOnInit(){this.formGroup.addControl("aniListToken",new S("",[k.required])),this.formGroup.addControl("malClientId",new S("",[k.required])),this.formGroup.addControl("malUsername",new S("",[k.required]))}resetForm(){this.formGroup.get("aniListToken")?.setValue(""),this.formGroup.get("malClientId")?.setValue(""),this.formGroup.get("malUsername")?.setValue(""),this.cdRef.markForCheck()}saveAniListForm(){this.scrobblingService.updateAniListToken(this.formGroup.get("aniListToken").value).subscribe(()=>{this.toastr.success(y("toasts.anilist-token-updated")),this.aniListToken=this.formGroup.get("aniListToken").value,this.resetForm(),this.cdRef.markForCheck()})}saveMalForm(){this.scrobblingService.updateMalToken(this.formGroup.get("malUsername").value,this.formGroup.get("malClientId").value).subscribe(()=>{this.toastr.success(y("toasts.mal-clientId-updated")),this.malToken=this.formGroup.get("malClientId").value,this.malUsername=this.formGroup.get("malUsername").value,this.resetForm(),this.cdRef.markForCheck()})}toggleViewMode(){this.isViewMode=!this.isViewMode,this.resetForm()}};o.\u0275fac=function(c){return new(c||o)},o.\u0275cmp=L({type:o,selectors:[["app-manage-scrobbling-providers"]],standalone:!0,features:[P],decls:1,vars:1,consts:[["accordion",""],[4,"transloco","translocoRead"],[1,"card","mt-2"],[1,"card-body"],[1,"card-title"],[1,"container-fluid","row","mb-2"],[1,"col-10","col-sm-11"],[1,"col-1","text-end"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],["aria-hidden","true",1,"fa-solid","fa-circle-check","ms-1","confirm-icon",3,"ngbTooltip"],[1,"visually-hidden"],["aria-hidden","true",1,"fa-solid","fa-circle","ms-1","confirm-icon","error",3,"ngbTooltip"],[4,"ngIf"],[3,"ngbCollapseChange","ngbCollapse"],[3,"formGroup"],["ngbAccordion","",1,"mt-3",3,"destroyOnHide","closeOthers"],["ngbAccordionItem","anilist"],["ngbAccordionHeader",""],["ngbAccordionButton","","id","anilist-token-header"],["ngbAccordionCollapse",""],["ngbAccordionBody",""],["ngbAccordionItem","mal"],["ngbAccordionButton","","id","mal-token-header"],[1,"container-fluid","row"],[1,"col-12"],["width","32","height","32","ngSrc","assets/images/ExternalServices/AniList.png","alt","AniList","ngbTooltip","AniList",1,"me-2"],[1,"error","fa-solid","fa-exclamation-circle"],[1,"ms-2"],["width","32","height","32","ngSrc","assets/images/ExternalServices/MAL.png","alt","MAL","ngbTooltip","MAL",1,"me-2"],[1,"error","fa-solid","fa-exclamation-circle",3,"ngbTooltip"],[1,"form-group","mb-3"],["for","anilist-token"],["id","anilist-token","rows","2","cols","3","formControlName","aniListToken",1,"form-control"],[1,"col-auto","d-flex","d-md-block","justify-content-sm-center","text-md-end","mb-3"],["href","https://anilist.co/api/v2/oauth/authorize?client_id=12809&redirect_url=https://anilist.co/api/v2/oauth/pin&response_type=token","target","_blank","rel","noopener noreferrer",1,"flex-fill","btn","btn-secondary","me-2"],["type","button","aria-describedby","anilist-token-header",1,"flex-fill","btn","btn-primary",3,"click"],["for","mal-token"],["type","text","id","mal-token","formControlName","malClientId",1,"form-control"],["for","mal-username"],["type","text","id","mal-username","formControlName","malUsername",1,"form-control"],["type","button","aria-describedby","mal-token-header",1,"flex-fill","btn","btn-primary",3,"click"],[3,"loading","message"]],template:function(c,T){c&1&&p(0,Ie,15,5,"ng-container",1),c&2&&m("translocoRead","scrobbling-providers")},dependencies:[G,N,Z,W,O,R,U,D,q,H,ie,$,j,z,K,Y,X,Q,J,ne],styles:["/*# sourceMappingURL=manage-scrobbling-providers.component-BULQOYIY.css.map */"]});let t=o;return t})();export{We as ManageScrobblingProvidersComponent};
//# sourceMappingURL=chunk-KDUPSXXX.js.map
